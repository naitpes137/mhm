import{a as Gn,b as Jt,c as et}from"./chunk-KJPTR26Z.js";import{C as Pn,Cb as $t,Db as jn,Ea as pi,Eb as Hn,Gb as qn,I as kn,Ja as Dn,Ka as Bn,L as De,M as H,N as at,O as Mt,P as Un,Pa as Nn,Q as Ln,R as Rn,T as Gt,b as gn,ba as En,c as pn,ca as Vn,ea as pe,ga as Wt,ia as Qt,la as An,v as Tn,xb as xt,yb as zn,zb as Fn}from"./chunk-GXZQKE6V.js";import{$a as r,$f as Re,Ae as hi,Ag as hn,Ai as ce,B as Ne,Ca as Ge,Cb as T,Cg as Ft,D as He,Da as I,Db as L,Dg as mn,Di as se,Ea as Dt,Eb as ae,Ed as Z,Ff as X,Fh as Ct,G as Ni,Ha as ci,Ia as g,Ig as B,Ii as Ye,Ja as p,Jd as Zi,Ji as xe,Kf as ot,Ki as yn,La as qi,Lh as Ae,Li as Ze,Ma as Q,Md as zt,Mg as jt,Mh as ne,Mi as ft,Na as $,Nd as Xi,Nh as gi,Ni as Sn,O as zi,Oa as u,Od as en,Og as j,Oh as vn,Oi as Xe,Pa as l,Qa as c,Qd as Ue,Qf as Qe,Qi as In,R as Fi,Ra as v,Rf as pt,S as ji,Sd as te,Td as tn,Ti as vt,Ud as nn,Vd as sn,W as h,Wd as on,Wf as D,X as m,Xb as Nt,Ya as b,Yb as ge,Za as Gi,_a as _,ae as gt,bc as Qi,bh as un,cg as Ee,ch as $e,cj as On,db as J,dh as Je,ea as qe,eb as K,eh as Ke,fb as Y,fh as Cn,ga as Vt,gb as Ce,gg as ln,gh as Ve,hb as We,hh as _n,i as Ai,ib as V,id as $i,ig as cn,j as Pe,kb as f,la as ke,lb as U,ld as Ji,mb as P,md as Ki,nb as me,ni as Mn,oa as At,oh as Ht,pa as dt,pb as Wi,pe as an,pi as xn,qa as a,qb as _e,qe as rn,rb as fe,rh as ut,s as Di,sb as ve,si as G,tb as di,ti as bn,ua as C,ub as Me,uf as mi,ui as le,vg as dn,vi as wn,wb as Bt,wf as re,xa as k,xd as ht,xh as qt,ya as Hi,yd as mt,yf as Le,yh as fn,yi as _t,z as Bi,zd as Yi,zg as ie,zh as N}from"./chunk-4LPE7HNY.js";function xs(s,o){s&1&&v(0,"ss-icon",3),s&2&&u("size",17)}function bs(s,o){s&1&&v(0,"ss-icon",4),s&2&&u("size",17)}function ws(s,o){if(s&1&&(l(0,"div",6)(1,"div",7),v(2,"ss-icon",8),l(3,"em"),f(4,"About this channel"),c()(),l(5,"div",9),f(6),c()(),l(7,"div",10)(8,"div",7),v(9,"i",11),l(10,"em"),f(11,"Channel Rules"),c()(),l(12,"div",9),f(13),c()()),s&2){let n=r();a(2),u("size",20),a(4),U(n.channel.description),a(7),U(n.channel.rules)}}function ys(s,o){if(s&1){let n=b();l(0,"ss-textarea",12),ve("ngModelChange",function(t){h(n);let i=r();return fe(i.channel.description,t)||(i.channel.description=t),m(t)}),c(),l(1,"ss-textarea",13),ve("ngModelChange",function(t){h(n);let i=r();return fe(i.channel.rules,t)||(i.channel.rules=t),m(t)}),c()}if(s&2){let n=r();_e("ngModel",n.channel.description),u("rows",5)("maxlength",250),a(),_e("ngModel",n.channel.rules),u("rows",5)("maxlength",250)}}function Ss(s,o){if(s&1){let n=b();l(0,"div",5)(1,"ss-button",14),_("buttonClick",function(){h(n);let t=r();return m(t.discardChanges())}),f(2," Discard "),c(),l(3,"ss-button",15),_("buttonClick",function(){h(n);let t=r();return m(t.saveChanges())}),f(4," Save "),c()()}if(s&2){let n=r();a(),u("iconSize",24),a(2),u("iconSize",24)("isLoading",n.saving)}}var Is=(()=>{let o=class o{constructor(){this.backClick=new I,this.panelClose=new I,this.saved=new I,this.editMode=!1,this.saving=!1}editChannel(){this.editMode=!0,this.channel=JSON.parse(JSON.stringify(this.channel))}discardChanges(){this.editMode=!1}saveChanges(){this.editMode=!1,this.saved.emit(this.channel)}onBackClicked(){this.backClick.emit()}onCloseClicked(){this.panelClose.emit()}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=k({type:o,selectors:[["ss-channel-about"]],inputs:{channel:"channel"},outputs:{backClick:"backClick",panelClose:"panelClose",saved:"saved"},standalone:!1,decls:11,vars:8,consts:[["role","button","iconName","arrow_left","color","default-60",1,"back-button",3,"click","size"],["role","button","iconName","dismiss","color","default-60",1,"close-button",3,"click","size"],[1,"name-wrapper"],["iconName","lock_closed",1,"private-icon",3,"size"],["iconName","number_symbol",1,"public-icon",3,"size"],[1,"button-wrapper"],[1,"about-channel"],[1,"heading"],["iconName","error_circle",3,"size"],[1,"text"],[1,"channel-rules"],[1,"channel-rules-icon"],["id","about","name","about","label","About this channel","placeholder","About this channel",3,"ngModelChange","ngModel","rows","maxlength"],["id","rules","name","rules","label","Channel Rules","placeholder","Channel Rules",3,"ngModelChange","ngModel","rows","maxlength"],["iconName","delete","color","secondary",3,"buttonClick","iconSize"],["iconName","save",3,"buttonClick","iconSize","isLoading"]],template:function(t,i){t&1&&(l(0,"div")(1,"ss-icon",0),_("click",function(){return i.onBackClicked()}),c(),l(2,"ss-icon",1),_("click",function(){return i.onCloseClicked()}),c(),l(3,"div",2),g(4,xs,1,1,"ss-icon",3),g(5,bs,1,1,"ss-icon",4),l(6,"h3"),f(7),c()(),g(8,ws,14,3),g(9,ys,2,6),c(),g(10,Ss,5,3,"div",5)),t&2&&(a(),u("size",24),a(),u("size",24),a(2),p(i.channel.isPrivate?4:-1),a(),p(i.channel.isPrivate?-1:5),a(2),U(i.channel.name),a(),p(i.editMode?-1:8),a(),p(i.editMode?9:-1),a(),p(i.editMode?10:-1))},dependencies:[Re,ln,Ee,jt,D,wn],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;width:332px;padding-top:25px;background:var(--grayscale)}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{height:100%}}.back-button[_ngcontent-%COMP%]{position:absolute;top:25px;left:28px;z-index:1}.close-button[_ngcontent-%COMP%]{position:absolute;top:25px;right:28px;z-index:1;width:24px;height:24px;cursor:pointer}.name-wrapper[_ngcontent-%COMP%]{display:-webkit-box;overflow:hidden;margin:0 25px 20px;font-weight:700;color:var(--default);text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical;text-align:center}.name-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:3px}.name-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]     i:before{font-weight:700}.name-wrapper[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{display:initial}.about-channel[_ngcontent-%COMP%], .channel-rules[_ngcontent-%COMP%]{padding:20px 30px;border-radius:10px;background:var(--alt-80)}.about-channel[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%], .channel-rules[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{display:flex;margin-bottom:5px}.about-channel[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .about-channel[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%], .channel-rules[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .channel-rules[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{display:block;width:20px;height:20px;margin-right:8px}.about-channel[_ngcontent-%COMP%]   i.channel-rules-icon[_ngcontent-%COMP%], .about-channel[_ngcontent-%COMP%]   ss-icon.channel-rules-icon[_ngcontent-%COMP%], .channel-rules[_ngcontent-%COMP%]   i.channel-rules-icon[_ngcontent-%COMP%], .channel-rules[_ngcontent-%COMP%]   ss-icon.channel-rules-icon[_ngcontent-%COMP%]{background-image:url(/assets/icons/channel-rules-icon.svg)}.about-channel[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%], .channel-rules[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{white-space:pre-wrap;overflow-wrap:break-word}.about-channel[_ngcontent-%COMP%]{margin:30px 20px 20px;border:1px solid var(--alt)}.channel-rules[_ngcontent-%COMP%]{margin:0 20px;border:1px solid var(--accent-blue-60)}ss-textarea#about[_ngcontent-%COMP%]{margin:30px 20px 20px}ss-textarea#rules[_ngcontent-%COMP%]{margin:0 20px}.button-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:15px 30px 31px;box-shadow:var(--elevation-s1)}.button-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]:first-child{margin-right:10px}.next-step-btn[_ngcontent-%COMP%]{padding:15px 30px 31px;box-shadow:var(--elevation-s1)}"]});let s=o;return s})();function Os(s,o){s&1&&v(0,"ss-icon",3),s&2&&u("size",13)}function Ts(s,o){s&1&&(l(0,"span",4),f(1,"#"),c())}function Ps(s,o){if(s&1&&(l(0,"small",7),f(1),c()),s&2){let n=r();a(),me("",n.channel.totalMembers," member",n.channel.totalMembers===1?"":"s")}}var Ci=(()=>{let o=class o{constructor(e,t,i,d,M){this.channelService=e,this.router=t,this.dialog=i,this.toastService=d,this.accountService=M}onInfoClicked(){this.router.navigate([`/conversations/channels/${this.channel.id}`],{queryParams:{sidePanel:pe.ChannelInfo}})}onSharedFilesClicked(){this.router.navigate([`/conversations/channels/${this.channel.id}`],{queryParams:{sidePanel:pe.SharedFiles}})}leaveChannelModal(){this.channel.isPrivate?this.dialog.open(re,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"LeavePrivateChannel",confirmButtonLabel:"Leave Channel"}}).afterClosed().subscribe(t=>{t&&this.leaveChannel()}):this.leaveChannel()}leaveChannel(){this.channelService.leaveChannel(this.channel.id).subscribe({error:e=>this.handleErrors(e)})}toggleMutedState(){this.channelService.toggleMutedState(this.channel.id).subscribe({error:e=>this.handleErrors(e)})}shouldShowMembersCount(){return!(this.accountService.isInRole(j.RegularUser)&&this.channel.totalMembers>1e3&&!this.channel.isPrivate)}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(ce),C(te),C(Z),C(N),C(B))},o.\u0275cmp=k({type:o,selectors:[["ss-channel-header"]],inputs:{channel:"channel"},standalone:!1,decls:29,vars:13,consts:[["channelHeaderMenu","matMenu"],[1,"info-wrapper"],[1,"name-wrapper"],["iconName","lock_closed",1,"private-icon",3,"size"],[1,"public-icon"],["role","button",1,"name",3,"click"],[1,"menu-wrapper"],[1,"members"],["role","button","iconName","more_vertical","color","default-60",3,"size","matMenuTriggerFor"],["mat-menu-item","",3,"click"],["iconName","info",3,"size"],["iconName","document",3,"size"],[3,"iconName","size"],["iconName","sign_out",3,"size"]],template:function(t,i){if(t&1){let d=b();l(0,"div",1)(1,"div",2),g(2,Os,1,1,"ss-icon",3),g(3,Ts,2,0,"span",4),l(4,"strong",5),_("click",function(){return h(d),m(i.onInfoClicked())}),f(5),c()(),l(6,"small"),f(7),c()(),l(8,"div",6),g(9,Ps,2,2,"small",7),v(10,"ss-icon",8),c(),l(11,"mat-menu",null,0)(13,"button",9),_("click",function(){return h(d),m(i.onInfoClicked())}),v(14,"ss-icon",10),l(15,"span"),f(16,"Channel Info"),c()(),l(17,"button",9),_("click",function(){return h(d),m(i.onSharedFilesClicked())}),v(18,"ss-icon",11),l(19,"span"),f(20,"Shared Files"),c()(),l(21,"button",9),_("click",function(){return h(d),m(i.toggleMutedState())}),v(22,"ss-icon",12),l(23,"span"),f(24),c()(),l(25,"button",9),_("click",function(){return h(d),m(i.leaveChannelModal())}),v(26,"ss-icon",13),l(27,"span"),f(28,"Leave Channel"),c()()()}if(t&2){let d=Ce(12);a(2),p(i.channel.isPrivate?2:-1),a(),p(i.channel.isPrivate?-1:3),a(2),U(i.channel.name),a(2),U(i.channel.description),a(2),p(i.shouldShowMembersCount()?9:-1),a(),u("size",24)("matMenuTriggerFor",d),a(4),u("size",24),a(4),u("size",24),a(4),u("iconName",i.channel.isMuted?"mic":"mic_off")("size",24),a(2),P("",i.channel.isMuted?"Unmute":"Mute"," Channel"),a(2),u("size",24)}},dependencies:[Je,$e,Ke,D],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:space-between;align-items:center;min-height:73px;padding:14px 33px 14px 30px;box-shadow:var(--elevation-s1-bottom-only);background:var(--alt-60)}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{padding:10px}}.info-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.info-wrapper[_ngcontent-%COMP%]   .name-wrapper[_ngcontent-%COMP%], .info-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.info-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-20)}.info-wrapper[_ngcontent-%COMP%]   .name-wrapper[_ngcontent-%COMP%]{padding-right:10px;font-weight:700;color:var(--default)}.info-wrapper[_ngcontent-%COMP%]   .name-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:3px}.info-wrapper[_ngcontent-%COMP%]   .name-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]     i:before{font-weight:700}.info-wrapper[_ngcontent-%COMP%]   .public-icon[_ngcontent-%COMP%]{margin-right:3px;font-size:13px}.info-wrapper[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]:hover{text-decoration:underline}.menu-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;flex-shrink:0;color:var(--default-20)}.menu-wrapper[_ngcontent-%COMP%]   .members[_ngcontent-%COMP%]{margin-right:25px}"]});let s=o;return s})();var Us=["groupName"],Ls=["olderMessagesLoader"],Rs=["searchInput"],Qn=(s,o)=>o.id;function Es(s,o){s&1&&v(0,"ss-icon",5),s&2&&u("size",13)}function Vs(s,o){s&1&&v(0,"ss-icon",6),s&2&&u("size",13)}function As(s,o){if(s&1&&(l(0,"small"),v(1,"ss-icon",31),l(2,"span"),f(3),c()()),s&2){let n=r().$implicit;a(),u("size",18),a(2),U(n.originalFileName)}}function Ds(s,o){if(s&1&&(l(0,"div",30),g(1,As,4,2,"small"),c()),s&2){let n=o.$implicit,e=r(2);We("background-image",e.getThumbnailSrc(n)),V("is-file",!e.utilityService.isImage(n.originalFileName)),u("matTooltip",n.originalFileName),a(),p(e.utilityService.isImage(n.originalFileName)?-1:1)}}function Bs(s,o){if(s&1){let n=b();l(0,"div",25),_("click",function(){h(n);let t=r();return m(t.showSharedFiles())}),l(1,"div",26)(2,"small"),f(3,"Shared Files"),c(),v(4,"ss-icon",27),c(),l(5,"div",28),Q(6,Ds,2,6,"div",29,Qn),c()()}if(s&2){let n=r();a(4),u("size",17),a(2),$(n.attachments)}}function Ns(s,o){if(s&1&&(l(0,"strong",15),f(1),c()),s&2){let n=r();a(),P("Members (",n.totalUsers,")")}}function zs(s,o){s&1&&(l(0,"div",18),v(1,"mat-spinner",32),c())}function Fs(s,o){if(s&1){let n=b();l(0,"div",33),_("click",function(){h(n);let t=r();return m(t.addMembers())}),l(1,"div"),v(2,"ss-icon",34),l(3,"em"),f(4,"Add New Member"),c()(),v(5,"ss-icon",35),c()}s&2&&(a(2),u("size",24),a(3),u("size",24))}function js(s,o){if(s&1){let n=b();l(0,"ss-user-list-item",36),_("startChatWith",function(t){h(n);let i=r();return m(i.onStartChat(t))})("reportUser",function(t){h(n);let i=r();return m(i.onReportUser(t))})("leave",function(){h(n);let t=r();return m(t.leaveChannel())})("blockUser",function(t){h(n);let i=r();return m(i.toggleBlock(t))})("unblockUser",function(t){h(n);let i=r();return m(i.toggleBlock(t))})("followUser",function(t){h(n);let i=r();return m(i.followUser(t))})("removeUser",function(t){h(n);let i=r();return m(i.onRemoveUserFromChannel(t))})("toggleAdminRights",function(t){h(n);let i=r();return m(i.toggleRights(t,i.ChannelRoleRef.Admin))})("toggleModeratorRights",function(t){h(n);let i=r();return m(i.toggleRights(t,i.ChannelRoleRef.Moderator))})("toggleReadOnly",function(t){h(n);let i=r();return m(i.toggleReadOnly(t))}),c()}if(s&2){let n=o.$implicit,e=r();u("userListItem",n)("showStartChat",!0)("showLeave",!0)("showRemove",!0)("showAdminToggle",!0)("showModeratorToggle",!0)("showReadOnlyToggle",!0)("isConversationAdmin",e.isRole(n.id,e.ChannelRoleRef.Admin))("isCurrentUserConversationAdmin",e.isRole(e.currentUser.id,e.ChannelRoleRef.Admin))("isConversationModerator",e.isRole(n.id,e.ChannelRoleRef.Moderator))("isCurrentUserConversationModerator",e.isRole(e.currentUser.id,e.ChannelRoleRef.Moderator))("isReadOnly",e.isReadOnly(n.id))("conversationType",e.ConversationTypeRef.Channel)}}function Hs(s,o){s&1&&v(0,"mat-spinner",24)}var qs=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A,R,z){this.utilityService=e,this.channelService=t,this.chatService=i,this.router=d,this.accountService=M,this.signalRService=x,this.userService=E,this.dialog=A,this.toastService=R,this.userFollowService=z,this.panelClose=new I,this.userList=[],this.attachments=[],this.startingChat=!1,this.loadedAllUsers=!1,this.searchTerm="",this.searchTermChange=new Pe,this.searchResults=[],this.displayedUsers=[],this.usersLoading=!1,this.hideInfiniteLoader=!1,this.followingUser=!1,this.ChannelRoleRef=et,this.ConversationTypeRef=ne,this.intersectionObserver=new IntersectionObserver(Be=>{Be[0].isIntersecting===!0&&this.searchTerm.length===0&&this.loadChannelUsers()},{threshold:[0]}),this.channelUsers=[],this.subscriptions=[]}ngOnInit(){this.currentUser=this.accountService.currentUser,this.channelService.getChannelAttachments(this.channel.id,null,4).subscribe({next:e=>{this.attachments=e.attachments},error:e=>this.handleErrors(e)}),this.subscriptions.push(this.signalRService.channelJoined.subscribe(e=>this.onChannelJoined(e)),this.signalRService.channelLeft.subscribe(e=>this.onChannelLeft(e)),this.signalRService.channelUserUpdated.subscribe(e=>this.onChannelUserUpdated(e)),this.signalRService.userBlocked.subscribe(e=>this.onUserBlocked(e)),this.signalRService.userUnblocked.subscribe(e=>this.onUserUnblocked(e)))}ngAfterViewInit(){this.intersectionObserver.observe(this.olderMessagesLoader.nativeElement),this.searchTermChangeSubscription=this.searchTermChange.pipe(Ne(300),He()).subscribe(()=>{if(!this.usersLoading){if(this.searchTerm.length===0){this.setDisplayedUsers();return}this.usersLoading=!0,this.searchResults=[],this.channelService.searchChannelUsers(this.channel.id,this.searchTerm).subscribe({next:e=>{this.usersLoading=!1,this.searchResults=this.mapUsersToUserList(e),this.setDisplayedUsers(),setTimeout(()=>{this.searchInput.focusInput()})},error:e=>this.handleErrors(e)})}})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),ot(this.intersectionObserver,this.olderMessagesLoader?.nativeElement),this.searchTermChangeSubscription.unsubscribe()}loadChannelUsers(e=!1){e&&(this.channelUsers=[],this.userList=[],this.loadedAllUsers=!1),!this.loadedAllUsers&&this.channelService.getChannelUsers(this.channel.id,this.channelUsers.length,20).subscribe({next:t=>{for(let i of t.channelUsers)this.userList.find(d=>d.id===i.userId)||this.userList.push({id:i.userId,avatarColor:i.avatarColor,avatarUrl:i.avatarUrl,avatarThumbUrl:i.avatarThumbUrl,displayName:i.displayName,initials:i.initials,lastActive:i.lastActive,followsMe:i.followsMe,following:i.following,blocked:i.blocked,blockedMe:i.blockedMe,firstName:i.displayName,userBadge:i.userBadge,showPremiumTick:i.showPremiumTick}),this.channelUsers.find(d=>d.id===i.id)||this.channelUsers.push(i);this.loadedAllUsers=t.totalUsers===this.userList.length,this.totalUsers=t.totalUsers,this.setDisplayedUsers()},error:t=>this.handleErrors(t)})}onChannelJoined(e){if(e.channelId!==this.channel.id&&!this.loadedAllUsers)return;this.userList.find(i=>i.id===e.userJoiningId)||this.userService.getUserProfileShort(e.userJoiningId).subscribe({next:i=>{this.userList.push(i),this.totalUsers++},error:i=>this.handleErrors(i)})}onChannelLeft(e){e.channelId===this.channel.id&&this.tryRemovingUserFromChannel(e.userLeavingId)}onSearchChange(e){this.searchTermChange.next(e)}onBackClicked(){this.panelClose.emit()}onCloseClicked(){this.panelClose.emit()}showAboutPanel(){this.router.navigate([`/conversations/channels/${this.channel.id}`],{queryParams:{sidePanel:pe.ChannelAbout}})}showSharedFiles(){this.router.navigate([`/conversations/channels/${this.channel.id}`],{queryParams:{sidePanel:pe.SharedFiles}})}leaveChannelModal(){this.channel.isPrivate?this.dialog.open(re,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"LeavePrivateChannel",confirmButtonLabel:"Leave Channel"}}).afterClosed().subscribe(t=>{t&&this.leaveChannel()}):this.leaveChannel()}leaveChannel(){this.channelService.leaveChannel(this.channel.id).subscribe({next:()=>{this.onCloseClicked()},error:e=>this.handleErrors(e)})}getThumbnailSrc(e){return this.utilityService.isImage(e.originalFileName)?`url(${e.thumbUrl})`:"none"}getOtherUsers(){let e=this.accountService.currentUser.id;return this.userList.filter(t=>t.id!==e)}onStartChat(e){let t={otherUserIds:[e.id]};this.chatService.checkIfChatExists(t.otherUserIds[0]).subscribe({next:()=>{this.createGroupOrContinueExistingChat(t)},error:i=>{i.length&&i[0].errorCode==="ChatDoesNotExist"?this.router.navigate(["/conversations/chats/create"],{queryParams:{userId:t.otherUserIds[0]}}):this.handleErrors(i)}})}createGroupOrContinueExistingChat(e){this.startingChat=!0,this.chatService.startChat(e).subscribe({next:t=>{this.startingChat=!1,this.router.navigate([`/conversations/chats/${t.id}`]),this.onCloseClicked()},error:t=>{t.length&&t[0].errorCode==="ChatAlreadyExists"?this.router.navigate([`/conversations/chats/${t[0].params.chatId}`]):this.handleErrors(t)}})}onReportUser(e){this.dialog.open(Ye,{panelClass:"fullscreen-dialog",width:"480px",disableClose:!0,data:{reportedUser:e,roomName:null,elementToScreenshotSelector:"ss-dashboard"}})}toggleBlock(e){this.dialog.open(xe,{panelClass:"fullscreen-dialog",width:"414px",data:{user:e}})}followUser(e){this.followingUser||(this.followingUser=!0,this.userFollowService.followUser(e.id).subscribe({next:()=>{e.following=!0,this.followingUser=!1,this.toastService.success({message:`You started following ${e.displayName}.`})},error:t=>this.handleErrors(t)}))}isRole(e,t){return this.channelUsers.find(i=>i.userId===e)?.role===t}isReadOnly(e){return!!this.channelUsers.find(t=>t.userId===e)?.readOnly}toggleRights(e,t){let i=this.channelUsers.find(M=>M.userId===e.id);if(!i)return;let d=i.role===et.Member?t:et.Member;this.channelService.updateChannelRole(this.channel.id,i.id,d).subscribe({error:M=>this.handleErrors(M)})}toggleReadOnly(e){let t=this.channelUsers.find(i=>i.userId===e.id);t&&this.channelService.toggleReadOnly(this.channel.id,t.id).subscribe({error:i=>this.handleErrors(i)})}toggleMutedState(){this.channelService.toggleMutedState(this.channel.id).subscribe({error:e=>this.handleErrors(e)})}onRemoveUserFromChannel(e){let t=this.channelUsers.find(i=>i.userId===e.id);t&&this.channelService.removeUserFromChannel(this.channel.id,t.id).subscribe({next:()=>{this.tryRemovingUserFromChannel(t.id)},error:i=>this.handleErrors(i)})}addMembers(){this.dialog.open(Gn,{panelClass:"fullscreen-dialog",width:"640px",data:{channelId:this.channel.id}}).afterClosed().subscribe(t=>{t&&this.loadChannelUsers(!0)})}shouldShowMembersCount(){return!(this.accountService.isInRole(j.RegularUser)&&this.channel.totalMembers>1e3&&!this.channel.isPrivate)}setDisplayedUsers(){this.searchTerm.length>0?(this.displayedUsers=this.searchResults,this.hideInfiniteLoader=!0):(this.displayedUsers=this.userList,this.hideInfiniteLoader=!1)}mapUsersToUserList(e){return e.map(t=>({id:t.id,displayName:t.displayName,initials:t.initials,firstName:t.firstName,fullName:t.fullName,avatarColor:t.avatarColor,avatarUrl:t.avatarUrl,avatarThumbUrl:t.avatarThumbUrl,showPremiumTick:t.showPremiumTick}))}tryRemovingUserFromChannel(e){let t=this.channelUsers.find(d=>d.userId===e);t&&this.channelUsers.splice(this.channelUsers.indexOf(t),1);let i=this.userList.find(d=>d.id===e);i&&(this.userList.splice(this.userList.indexOf(i),1),this.totalUsers--)}onUserBlocked(e){let t=this.userList.find(d=>d.id===e.userBlockingId),i=this.userList.find(d=>d.id===e.blockedUserId);t&&this.currentUser.id===e.blockedUserId&&(t.following=!1,t.followsMe=!1,t.blockedMe=!0),i&&this.currentUser.id===e.userBlockingId&&(i.following=!1,i.followsMe=!1,i.blocked=!0)}onUserUnblocked(e){let t=this.userList.find(d=>d.id===e.userUnblockingId),i=this.userList.find(d=>d.id===e.unblockedUserId);t&&this.currentUser.id===e.unblockedUserId&&(t.blockedMe=!1),i&&this.currentUser.id===e.userUnblockingId&&(i.blocked=!1)}onChannelUserUpdated(e){this.channel.id===e.channelId&&this.loadChannelUsers(!0)}handleErrors(e){if(this.followingUser=!1,e[0].errorCode==="ErrorChattingAgeRestriction"){this.toastService.info({exceptionDetail:e[0]});return}this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(X),C(ce),C(se),C(te),C(B),C(G),C(Ae),C(Z),C(N),C(Ze))},o.\u0275cmp=k({type:o,selectors:[["ss-channel-info"]],viewQuery:function(t,i){if(t&1&&(J(Us,5),J(Ls,5),J(Rs,5)),t&2){let d;K(d=Y())&&(i.groupName=d.first),K(d=Y())&&(i.olderMessagesLoader=d.first),K(d=Y())&&(i.searchInput=d.first)}},inputs:{channel:"channel"},outputs:{panelClose:"panelClose"},standalone:!1,decls:38,vars:17,consts:[["searchInput","","searchTermControl","ngModel"],["olderMessagesLoader",""],["role","button","iconName","arrow_left","color","default-60",1,"back-button",3,"click","size"],["role","button","iconName","dismiss","color","default-60",1,"close-button",3,"click","size"],[1,"name-wrapper"],["iconName","lock_closed","color","default",1,"private-icon",3,"size"],["iconName","number_symbol","color","default",1,"public-icon",3,"size"],[1,"scroll-holder"],[1,"group-actions"],["role","button",1,"about",3,"click"],["iconName","error_circle",3,"size"],["role","button",3,"click"],[3,"iconName","size"],["iconName","sign_out",3,"size"],["role","button",1,"shared-files"],[1,"members-count"],[1,"search"],["placeholder","Search","prefixIconName","search",3,"ngModelChange","noMargin","ngModel"],[1,"loader-wrapper"],["role","button",1,"add-member-wrapper"],[1,"list-wrapper"],[1,"list-holder"],[3,"userListItem","showStartChat","showLeave","showRemove","showAdminToggle","showModeratorToggle","showReadOnlyToggle","isConversationAdmin","isCurrentUserConversationAdmin","isConversationModerator","isCurrentUserConversationModerator","isReadOnly","conversationType"],[1,"older-attachments-loader"],["diameter","30","strokeWidth","3"],["role","button",1,"shared-files",3,"click"],[1,"text"],["role","button","iconName","arrow_right","color","default-60",3,"size"],[1,"image-wrapper"],[1,"image",3,"is-file","backgroundImage","matTooltip"],[1,"image",3,"matTooltip"],["iconName","document",3,"size"],["diameter","20","strokeWidth","2"],["role","button",1,"add-member-wrapper",3,"click"],["iconName","people","color","default-20",3,"size"],["iconName","add","color","default-60",3,"size"],[3,"startChatWith","reportUser","leave","blockUser","unblockUser","followUser","removeUser","toggleAdminRights","toggleModeratorRights","toggleReadOnly","userListItem","showStartChat","showLeave","showRemove","showAdminToggle","showModeratorToggle","showReadOnlyToggle","isConversationAdmin","isCurrentUserConversationAdmin","isConversationModerator","isCurrentUserConversationModerator","isReadOnly","conversationType"]],template:function(t,i){if(t&1){let d=b();l(0,"h3"),f(1,"Channel Info"),c(),l(2,"ss-icon",2),_("click",function(){return h(d),m(i.onBackClicked())}),c(),l(3,"ss-icon",3),_("click",function(){return h(d),m(i.onCloseClicked())}),c(),l(4,"div",4),g(5,Es,1,1,"ss-icon",5),g(6,Vs,1,1,"ss-icon",6),l(7,"strong"),f(8),c()(),l(9,"div",7)(10,"div",8)(11,"div",9),_("click",function(){return h(d),m(i.showAboutPanel())}),v(12,"ss-icon",10),l(13,"small"),f(14,"About"),c()(),l(15,"div",11),_("click",function(){return h(d),m(i.toggleMutedState())}),v(16,"ss-icon",12),l(17,"small"),f(18),c()(),l(19,"div",11),_("click",function(){return h(d),m(i.leaveChannelModal())}),v(20,"ss-icon",13),l(21,"small"),f(22,"Leave"),c()()(),g(23,Bs,8,1,"div",14),g(24,Ns,2,1,"strong",15),l(25,"div",16)(26,"ss-input",17,0),ve("ngModelChange",function(x){return h(d),fe(i.searchTerm,x)||(i.searchTerm=x),m(x)}),_("ngModelChange",function(x){return h(d),m(i.onSearchChange(x))}),c(),g(29,zs,2,0,"div",18),c(),g(30,Fs,6,2,"div",19),l(31,"div",20)(32,"div",21),Q(33,js,1,13,"ss-user-list-item",22,Qn),l(35,"div",23,1),g(37,Hs,1,0,"mat-spinner",24),c()()()()}t&2&&(a(2),u("size",24),a(),u("size",24),a(2),p(i.channel.isPrivate?5:-1),a(),p(i.channel.isPrivate?-1:6),a(2),U(i.channel.name),a(4),u("size",20),a(4),u("iconName",i.channel.isMuted?"mic":"mic_off")("size",20),a(2),U(i.channel.isMuted?"Unmute":"Mute"),a(2),u("size",20),a(3),p(i.attachments.length?23:-1),a(),p(i.shouldShowMembersCount()?24:-1),a(2),u("noMargin",!0),_e("ngModel",i.searchTerm),a(3),p(i.usersLoading?29:-1),a(),p(i.channel.readOnly?-1:30),a(3),$(i.displayedUsers),a(4),p(!i.loadedAllUsers&&!i.hideInfiniteLoader?37:-1))},dependencies:[Re,Ee,Ve,ie,xt,D,Xe],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;width:332px;padding-top:25px;background:var(--grayscale)}h3[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}.back-button[_ngcontent-%COMP%]{position:absolute;top:25px;left:28px;z-index:1}.close-button[_ngcontent-%COMP%]{position:absolute;top:25px;right:28px;z-index:1;width:24px;height:24px;cursor:pointer}.name-wrapper[_ngcontent-%COMP%]{display:-webkit-box;overflow:hidden;margin:0 25px 20px;font-weight:700;color:var(--default);text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical;text-align:center}.name-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{position:relative;top:1px;margin-right:3px}.name-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]     i:before{font-weight:700}.name-wrapper[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{outline:none}.name-wrapper[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]:empty:before{content:attr(placeholder);font-style:italic;color:var(--default-60)}.scroll-holder[_ngcontent-%COMP%]{height:calc(100vh - 170px);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.scroll-holder[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.scroll-holder[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.scroll-holder[_ngcontent-%COMP%]::-webkit-scrollbar, .scroll-holder[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.scroll-holder[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.search[_ngcontent-%COMP%]{position:relative;padding:1px 20px 0;margin-bottom:21px}.search[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]  .mat-form-field-infix input{padding-right:32px}.search[_ngcontent-%COMP%]   .loader-wrapper[_ngcontent-%COMP%]{position:absolute;top:calc(50% - 10px);right:30px;display:flex;justify-content:center;align-items:center}.add-member-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:43px;padding:7px 27px 7px 20px;border:1px solid var(--alt-40);background:var(--alt-80)}.add-member-wrapper[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;align-items:center}.add-member-wrapper[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:15px}.group-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:0 25px 20px}.group-actions[_ngcontent-%COMP%]   div[role=button][_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;width:90px;height:50px;border:1px solid var(--alt);border-radius:10px;background:var(--alt-80);text-align:center}.group-actions[_ngcontent-%COMP%]   div[role=button][_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-20)}.group-actions[_ngcontent-%COMP%]   div[role=button][_ngcontent-%COMP%]:hover{background:var(--alt-60);border-color:var(--accent-blurple-60)}.group-actions[_ngcontent-%COMP%]   div[role=button][disabled][_ngcontent-%COMP%]{cursor:not-allowed}.group-actions[_ngcontent-%COMP%]   div[role=button][disabled][_ngcontent-%COMP%]:hover{background:var(--alt-80);border-color:var(--alt)}.group-actions[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block;width:20px;height:20px;margin:0 auto}.shared-files[_ngcontent-%COMP%]{padding:10px 19px 15px;margin:0 25px 25px;border:1px solid var(--alt);border-radius:10px;background:var(--alt-80)}.shared-files[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:0 10px;margin-bottom:10px}.shared-files[_ngcontent-%COMP%]   .image-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center}.shared-files[_ngcontent-%COMP%]   .image-wrapper[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:56px;height:56px;margin-right:6px;border-radius:2.5px;background-size:contain}.shared-files[_ngcontent-%COMP%]   .image-wrapper[_ngcontent-%COMP%]   .image.is-file[_ngcontent-%COMP%]{padding:3px;border:1px solid var(--alt);background:var(--alt-40)}.shared-files[_ngcontent-%COMP%]   .image-wrapper[_ngcontent-%COMP%]   .image.is-file[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:53px;height:53px}.shared-files[_ngcontent-%COMP%]   .image-wrapper[_ngcontent-%COMP%]   .image.is-file[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-bottom:3px}.shared-files[_ngcontent-%COMP%]   .image-wrapper[_ngcontent-%COMP%]   .image.is-file[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:56px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.shared-files[_ngcontent-%COMP%]   .image-wrapper[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]:last-of-type{margin-right:0}.members-count[_ngcontent-%COMP%]{display:block;text-align:center;margin-bottom:10px}.list-wrapper[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1;padding-top:10px}.list-wrapper.collapsed[_ngcontent-%COMP%]{padding-top:20px}.list-holder[_ngcontent-%COMP%]{height:100%;padding-bottom:40px;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.list-holder[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.list-holder[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.list-holder[_ngcontent-%COMP%]::-webkit-scrollbar, .list-holder[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.list-holder[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.older-attachments-loader[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:50px}"]});let s=o;return s})();function Gs(s,o){if(s&1&&v(0,"ss-icon",0),s&2){let n=r();u("color",n.hasUnread?"default":"default-40")("size",16)}}function Ws(s,o){if(s&1&&v(0,"i",10),s&2){let n=r(2);We("background-image","url(/assets/images/logo-"+(n.settingsService.isB2BApp()||n.settingsService.isCoWork()?"cw":"badge-color")+".svg)")}}function Qs(s,o){if(s&1&&v(0,"ss-icon",9),s&2){let n=r(2);u("color",n.hasUnread?"default":"default-40")("size",16)}}function $s(s,o){if(s&1&&(g(0,Ws,1,2,"i",8),g(1,Qs,1,2,"ss-icon",9)),s&2){let n=r();p(n.channelListItem.type===n.ChannelTypeRef.TeamPostingOnly?0:-1),a(),p(n.channelListItem.type!==n.ChannelTypeRef.TeamPostingOnly?1:-1)}}function Js(s,o){s&1&&v(0,"ss-icon",1),s&2&&u("size",16)}function Ks(s,o){if(s&1){let n=b();l(0,"ss-icon",11),_("click",function(t){h(n);let i=r();return m(i.markAsRead(t))}),c()}s&2&&u("size",16)("iconVariant",16)}function Ys(s,o){if(s&1){let n=b();l(0,"ss-icon",12),_("click",function(t){h(n);let i=r();return m(i.markAsUnread(t))}),c()}s&2&&u("size",16)("iconVariant",16)}function Zs(s,o){s&1&&v(0,"div",7)}var vi=(()=>{let o=class o{get hasUnread(){return this.channelListItem&&(this.channelListItem.hasUnreadMessages||this.channelListItem.markedAsUnread)}get muted(){return this.channelListItem.isMuted}constructor(e,t,i,d){this.channelService=e,this.settingsService=t,this.toastService=i,this.signalRService=d,this.active=!1,this.collapsed=!1,this.ChannelTypeRef=Jt,this.menuOpened=!1}ngOnInit(){this.channelMessagesReadSubscription=this.signalRService.channelMessageRead.subscribe(e=>this.onChannelMessagesRead(e)),this.channelsAllReadSubscription=this.signalRService.channelsAllRead.subscribe(e=>this.onChannelsAllRead())}ngOnDestroy(){this.channelMessagesReadSubscription.unsubscribe(),this.channelsAllReadSubscription.unsubscribe()}markAsRead(e){e.stopPropagation(),this.channelService.markChannelAsRead(this.channelListItem.id).subscribe({next:()=>{this.channelListItem.hasUnreadMessages=!1,this.channelListItem.markedAsUnread=!1},error:t=>this.handleErrors(t)})}markAsUnread(e){e.stopPropagation(),this.channelService.markChannelAsUnread(this.channelListItem.id).subscribe({next:()=>{this.channelListItem.markedAsUnread=!0},error:t=>this.handleErrors(t)})}toggleMutedState(e){e.stopPropagation(),this.channelService.toggleMutedState(this.channelListItem.id).subscribe({error:t=>this.handleErrors(t)})}onChannelsAllRead(){this.channelListItem.markedAsUnread=!1}onChannelMessagesRead(e){this.channelListItem.id===e.channelId&&(this.channelListItem.markedAsUnread=!1)}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(ce),C(Le),C(N),C(G))},o.\u0275cmp=k({type:o,selectors:[["ss-channel-list-item"]],hostVars:8,hostBindings:function(t,i){t&2&&V("active",i.active)("collapsed",i.collapsed)("has-unread",i.hasUnread)("muted",i.muted)},inputs:{channelListItem:"channelListItem",active:"active",collapsed:"collapsed"},standalone:!1,decls:10,vars:13,consts:[["iconName","lock_closed",1,"private-icon",3,"color","size"],["iconName","speaker_mute","color","default-80",1,"mute-icon",3,"size"],[1,"channel-name","interactable"],[1,"actions"],["role","button","iconName","mail_read","color","default-60","matTooltip","Mark as read",1,"action-menu",3,"size","iconVariant"],["role","button","iconName","mail_unread","color","default-60","matTooltip","Mark as unread",1,"action-menu",3,"size","iconVariant"],["role","button","color","default-60",1,"action-menu",3,"click","iconName","size","iconVariant","matTooltip"],[1,"unread-messages"],[1,"custom-channel-icon",3,"backgroundImage"],["iconName","number_symbol",1,"public-icon",3,"color","size"],[1,"custom-channel-icon"],["role","button","iconName","mail_read","color","default-60","matTooltip","Mark as read",1,"action-menu",3,"click","size","iconVariant"],["role","button","iconName","mail_unread","color","default-60","matTooltip","Mark as unread",1,"action-menu",3,"click","size","iconVariant"]],template:function(t,i){t&1&&(g(0,Gs,1,2,"ss-icon",0),g(1,$s,2,2),g(2,Js,1,1,"ss-icon",1),l(3,"div",2),f(4),c(),l(5,"div",3),g(6,Ks,1,2,"ss-icon",4),g(7,Ys,1,2,"ss-icon",5),l(8,"ss-icon",6),_("click",function(M){return i.toggleMutedState(M)}),c()(),g(9,Zs,1,0,"div",7)),t&2&&(p(!i.channelListItem.isMuted&&i.channelListItem.isPrivate?0:-1),a(),p(!i.channelListItem.isMuted&&!i.channelListItem.isPrivate?1:-1),a(),p(i.channelListItem.isMuted?2:-1),a(),V("muted",i.channelListItem.isMuted),a(),P(" ",i.channelListItem.name,`
`),a(2),p(i.channelListItem.markedAsUnread||i.channelListItem.hasUnreadMessages?6:-1),a(),p(!i.channelListItem.markedAsUnread&&!i.channelListItem.hasUnreadMessages?7:-1),a(),u("iconName",i.channelListItem.isMuted?"speaker_2":"speaker_mute")("size",16)("iconVariant",16)("matTooltip",i.channelListItem.isMuted?"Unmute":"Mute"),a(),p(i.channelListItem.markedAsUnread?9:-1))},dependencies:[ie,D],styles:["[_nghost-%COMP%]{position:relative;display:flex;align-items:center;height:32px;padding:0 16px;color:var(--default-40);background:var(--grayscale);cursor:pointer}[_nghost-%COMP%]:hover{background:var(--alt-80)}[_nghost-%COMP%]:hover   .action-menu[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]:hover   .unread-messages[_ngcontent-%COMP%]{display:none}.active[_nghost-%COMP%]{background:var(--accent-gradient-90)}.has-unread[_nghost-%COMP%]   .channel-name[_ngcontent-%COMP%]{font-weight:500;color:var(--default)}.muted[_nghost-%COMP%]:hover   .channel-name[_ngcontent-%COMP%]{color:var(--default-60)}.muted[_nghost-%COMP%]:before{background-color:var(--default-80)}.muted[_nghost-%COMP%]   .channel-name[_ngcontent-%COMP%]{color:var(--default-80)}.muted[_nghost-%COMP%]   .unread-messages[_ngcontent-%COMP%]{background-color:var(--default-80)}.muted.active[_nghost-%COMP%]:before{background-color:var(--accent-blue-20)}.muted.active[_nghost-%COMP%]   ss-icon.mute-icon[_ngcontent-%COMP%]{color:var(--default-20)}.muted.active[_nghost-%COMP%]   ss-icon.mute-icon[_ngcontent-%COMP%]     i{color:var(--default-20)}.muted.active[_nghost-%COMP%]   .channel-name[_ngcontent-%COMP%]{color:var(--default-20)}.collapsed[_nghost-%COMP%]   .channel-name[_ngcontent-%COMP%], .collapsed[_nghost-%COMP%]   .action-menu.action-menu[_ngcontent-%COMP%]{display:none}.collapsed[_nghost-%COMP%]   .unread-messages[_ngcontent-%COMP%]{position:absolute;top:14px;left:-6px;min-width:12px;height:12px}.private-icon[_ngcontent-%COMP%], .public-icon[_ngcontent-%COMP%], .custom-channel-icon[_ngcontent-%COMP%], .mute-icon[_ngcontent-%COMP%]{margin-right:7px}.custom-channel-icon[_ngcontent-%COMP%]{width:16px;height:16px;background:url(/assets/images/logo-badge-color.svg) center no-repeat;background-size:contain}.channel-name[_ngcontent-%COMP%]{overflow:hidden;color:var(--default-40);text-overflow:ellipsis;white-space:nowrap}.actions[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:auto}.action-menu[_ngcontent-%COMP%]{display:none;margin-left:10px}.action-menu.visible[_ngcontent-%COMP%]{display:block}.unread-messages[_ngcontent-%COMP%]{min-width:16px;height:16px;padding:0 5px;margin-left:auto;border-radius:50%;font-weight:500;background-color:var(--accent-blue);text-align:center}"]});let s=o;return s})();function to(s,o){s&1&&v(0,"ss-icon",2),s&2&&u("size",13)}function io(s,o){s&1&&(l(0,"span",3),f(1,"#"),c())}function no(s,o){s&1&&v(0,"span")}function so(s,o){if(s&1&&(l(0,"small",7),f(1),c()),s&2){let n=r();a(),me("",n.channel.totalMembers," member",n.channel.totalMembers===1?"":"s")}}function oo(s,o){if(s&1){let n=b();l(0,"ss-button-small",9),_("buttonClick",function(){h(n);let t=r();return m(t.joinChannel())}),f(1," Join "),c()}if(s&2){let n=r();u("isLoading",n.loadingChannel)}}function ao(s,o){if(s&1){let n=b();l(0,"ss-button-small",9),_("buttonClick",function(){h(n);let t=r();return m(t.leaveChannel())}),f(1," Leave "),c()}if(s&2){let n=r();u("isLoading",n.loadingChannel)}}var ro=(()=>{let o=class o{constructor(e,t,i,d){this.channelService=e,this.dialog=t,this.toastService=i,this.accountService=d,this.channelJoined=new I,this.channelLeft=new I,this.loadingChannel=!1}joinChannel(){this.loadingChannel=!0,this.channelService.joinChannel(this.channel.id).subscribe({next:e=>{this.channel.hasJoined=!0,this.loadingChannel=!1,this.channelJoined.emit(this.channel)},error:e=>this.handleErrors(e)})}leaveChannel(){this.channel.isPrivate?this.dialog.open(re,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"LeavePrivateChannel",confirmButtonLabel:"Leave Channel"}}).afterClosed().subscribe(t=>{t&&this.onLeaveChannelConfirmed()}):this.onLeaveChannelConfirmed()}shouldShowMembersCount(){return!(this.accountService.isInRole(j.RegularUser)&&this.channel.totalMembers>1e3&&!this.channel.isPrivate)}onLeaveChannelConfirmed(){this.loadingChannel=!0,this.channelService.leaveChannel(this.channel.id).subscribe({next:()=>{this.channel.hasJoined=!1,this.loadingChannel=!1,this.channelLeft.emit(this.channel)},error:e=>this.handleErrors(e)})}handleErrors(e){this.loadingChannel=!1,this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(ce),C(Z),C(N),C(B))},o.\u0275cmp=k({type:o,selectors:[["ss-channel-search-list-item"]],inputs:{channel:"channel"},outputs:{channelJoined:"channelJoined",channelLeft:"channelLeft"},standalone:!1,decls:13,vars:8,consts:[[1,"channel"],[1,"name-wrapper"],["iconName","lock_closed","color","default",1,"private-icon",3,"size"],[1,"public-icon"],[1,"name"],[1,"description"],[1,"action-wrapper"],[1,"members"],[3,"isLoading"],[3,"buttonClick","isLoading"]],template:function(t,i){t&1&&(l(0,"div",0)(1,"div",1),g(2,to,1,1,"ss-icon",2),g(3,io,2,0,"span",3),l(4,"strong",4),g(5,no,1,0,"span"),f(6),c()(),l(7,"small",5),f(8),c()(),l(9,"div",6),g(10,so,2,2,"small",7),g(11,oo,2,1,"ss-button-small",8),g(12,ao,2,1,"ss-button-small",8),c()),t&2&&(a(2),p(i.channel.isPrivate?2:-1),a(),p(i.channel.isPrivate?-1:3),a(2),p(i.channel.isPrivate?5:-1),a(),P(" ",i.channel.name," "),a(2),U(i.channel.description),a(2),p(i.shouldShowMembersCount()?10:-1),a(),p(i.channel.hasJoined?-1:11),a(),p(i.channel.hasJoined?12:-1))},dependencies:[D,qt],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:space-between;align-items:center;padding:9px 20px;box-shadow:var(--elevation-s1);background:var(--grayscale)}.channel[_ngcontent-%COMP%]{flex:1;padding-right:10px}.name-wrapper[_ngcontent-%COMP%]{-webkit-line-clamp:1}.name-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{position:relative;top:1px;margin-right:3px}.public-icon[_ngcontent-%COMP%]{font-weight:700}.name-wrapper[_ngcontent-%COMP%], .description[_ngcontent-%COMP%]{display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.description[_ngcontent-%COMP%]{-webkit-line-clamp:2;color:var(--default-20)}.action-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.members[_ngcontent-%COMP%]{flex-shrink:0;margin-right:30px;font-weight:700;align-self:center;color:var(--default-20)}@media only screen and (max-width: 767px){.members[_ngcontent-%COMP%]{display:none}}ss-button-small[_ngcontent-%COMP%]{width:71.5px}"]});let s=o;return s})();var ei=(()=>{let o=class o{constructor(){this.shortcutHit=new Pe,this.supportedShortcuts=[{key:"f",shortcut:F.ToggleLivekitRoomSortFreeze},{key:"a",shortcut:F.MessageArchive},{key:"u",shortcut:F.MessageMarkUnread},{key:"j",shortcut:F.NextChatListItem},{key:"k",shortcut:F.PreviousChatListItem},{key:"arrowup",shortcut:F.MessageSelectPrevious},{key:"arrowdown",shortcut:F.MessageSelectNext},{key:"e",shortcut:F.MessageEdit},{key:"r",shortcut:F.MessageEmoji}],document.addEventListener("keydown",e=>this.checkForShortcuts(e))}checkForShortcuts(e){if(e.repeat||e.target!==document.body)return;let t=e.key.toLocaleLowerCase(),i=this.supportedShortcuts.find(d=>d.key===t&&(!!d.commandKey===e.ctrlKey||!!d.commandKey===e.metaKey)&&!!d.altKey===e.altKey&&!!d.shiftKey===e.shiftKey);i&&this.shortcutHit.next({shortcut:i.shortcut,event:e})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=Fi({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})(),F=function(s){return s.ToggleLivekitRoomSortFreeze="LivekitRoomSortFreeze",s.MessageArchive="MessageArchive",s.MessageMarkUnread="MessageMarkUnread",s.NextChatListItem="NextChatListItem",s.PreviousChatListItem="PreviousChatListItem",s.MessageSelectPrevious="MessageSelectPrevious",s.MessageSelectNext="MessageSelectNext",s.MessageEdit="MessageEdit",s.MessageEmoji="MessageEmoji",s}(F||{});var lo=(s,o)=>o.id;function co(s,o){if(s&1&&(l(0,"small",0),f(1),c()),s&2){let n=r();u("matTooltip",n.getOtherUsersReadMessage()),a(),P(" +",n.lastReadBy.length-3," ")}}function ho(s,o){if(s&1&&v(0,"ss-user-avatar",1),s&2){let n=o.$implicit,e=r();u("avatarColor",n.avatarColor)("avatarThumbUrl",n.avatarThumbUrl)("initials",n.initials)("matTooltip",e.dateReadMessage(n))("size",16)("showOnlineStatus",!1)}}var xi=(()=>{let o=class o{constructor(e){this.datePipe=e}ngOnInit(){this.setLastReadByShown()}ngOnChanges(e){e.lastReadBy&&!e.lastReadBy.firstChange&&this.setLastReadByShown()}setLastReadByShown(){this.lastReadByShown=this.lastReadBy?.filter((e,t)=>t<3)||[]}dateReadMessage(e){if(e){let t=this.datePipe.transform(e.lastReadMessageDateRead,"medium");return` ${e.displayName} - Seen at ${t}`}return""}getOtherUsersReadMessage(){let e=this.lastReadBy?.filter(i=>!this.lastReadByShown.find(d=>d.id===i.id)),t="";if(e)for(let i of e)t+=`${this.dateReadMessage(i)}
`;return t}};o.\u0275fac=function(t){return new(t||o)(C(ge))},o.\u0275cmp=k({type:o,selectors:[["ss-message-read-info"]],inputs:{lastReadBy:"lastReadBy"},standalone:!1,features:[Bt([ge]),qe],decls:3,vars:1,consts:[["matTooltipShowDelay","500",3,"matTooltip"],["matTooltipClass","message-read-tooltip",3,"avatarColor","avatarThumbUrl","initials","matTooltip","size","showOnlineStatus"]],template:function(t,i){t&1&&(g(0,co,2,2,"small",0),Q(1,ho,1,6,"ss-user-avatar",1,lo)),t&2&&(p(i.lastReadBy&&i.lastReadBy.length>3?0:-1),a(),$(i.lastReadByShown))},dependencies:[ie,le],styles:["[_nghost-%COMP%]{display:flex;justify-content:flex-end;align-items:center;width:55px;margin-bottom:4px;align-self:flex-end}[_nghost-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{margin-left:1px}small[_ngcontent-%COMP%]{margin-right:3px}"]});let s=o;return s})();var po=(s,o)=>o.user.id;function uo(s,o){if(s&1&&v(0,"ss-user-avatar",1),s&2){let n=o.$implicit;u("avatarColor",n.user.avatarColor)("avatarThumbUrl",n.user.avatarThumbUrl)("initials",n.user.initials)("size",16)("showOnlineStatus",!1)}}function Co(s,o){if(s&1&&(l(0,"small"),f(1),T(2,"timeAgo"),c()),s&2){let n=r();a(),U(L(2,1,n.threadMessageStart.threadLastMessageDate))}}var bi=(()=>{let o=class o{getThreadUsersToDisplay(){return this.threadMessageStart.threadUsers?.filter(e=>e.sentMessagesCount>0).filter((e,t)=>t<2)||[]}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=k({type:o,selectors:[["ss-thread-replies-preview"]],inputs:{threadMessageStart:"threadMessageStart"},standalone:!1,decls:12,vars:3,consts:[[1,"replied-by-wrapper"],[3,"avatarColor","avatarThumbUrl","initials","size","showOnlineStatus"],[1,"text-wrapper"],[1,"time-ago"],[1,"view-thread"]],template:function(t,i){t&1&&(l(0,"div",0),Q(1,uo,1,5,"ss-user-avatar",1,po),c(),l(3,"div",2)(4,"strong"),f(5),c(),l(6,"span",3)(7,"small"),f(8,"Last reply "),c(),g(9,Co,3,3,"small"),c(),l(10,"small",4),f(11,"View thread"),c()()),t&2&&(a(),$(i.getThreadUsersToDisplay()),a(4),me("",i.threadMessageStart.threadMessagesCount," repl",i.threadMessageStart.threadMessagesCount===1?"y":"ies"),a(4),p(i.threadMessageStart.threadLastMessageDate?9:-1))},dependencies:[le,Qt],styles:["[_nghost-%COMP%]{display:flex;align-items:center;max-width:300px;height:32px;padding:6px 8px 6px 7px;margin-top:8px;border-radius:8px;background-color:var(--alt-20);cursor:pointer}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{height:56px}}[_nghost-%COMP%]:hover{background-color:var(--alt)}[_nghost-%COMP%]:hover   .view-thread[_ngcontent-%COMP%]{display:initial}[_nghost-%COMP%]:hover   .time-ago[_ngcontent-%COMP%]{display:none}.time-ago[_ngcontent-%COMP%]{display:flex;align-items:center;height:20px}.text-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:3px}@media only screen and (max-width: 767px){.text-wrapper[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}strong[_ngcontent-%COMP%]{margin-right:8px}.replied-by-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;margin-right:4px}.replied-by-wrapper[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{position:relative;margin-left:1px}.replied-by-wrapper[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]:first-child{margin:0}.view-thread[_ngcontent-%COMP%]{display:none;line-height:19.5px}@media only screen and (max-width: 767px){.view-thread[_ngcontent-%COMP%]{line-height:16.5px}}"]});let s=o;return s})();function vo(s,o){s&1&&(l(0,"div",2),v(1,"ss-icon",15),l(2,"small"),f(3,"Added to your saved items"),c()()),s&2&&(a(),u("size",13))}function Mo(s,o){if(s&1&&(v(0,"ss-user-avatar",21),l(1,"strong",22),f(2),c()),s&2){let n=r(2);u("avatarColor",n.message.replyingToMessage.avatarColor)("avatarThumbUrl",n.message.replyingToMessage.avatarThumbUrl)("initials",n.message.replyingToMessage.initials)("userId",n.message.replyingToMessage.userId)("showOnlineStatus",!1)("size",16),a(2),U(n.message.replyingToMessage.displayName)}}function xo(s,o){s&1&&(l(0,"span"),f(1,"Attachment Message"),c())}function bo(s,o){s&1&&v(0,"ss-icon",23),s&2&&u("size",12)}function wo(s,o){s&1&&v(0,"ss-icon",24),s&2&&u("size",12)}function yo(s,o){if(s&1&&(l(0,"div"),g(1,xo,2,0,"span"),g(2,bo,1,1,"ss-icon",23),g(3,wo,1,1,"ss-icon",24),c()),s&2){let n=r(2);a(),p(n.message.replyingToMessage.text?-1:1),a(),p(n.utilityService.isImage(n.message.replyingToMessage.attachments[0].originalFileName)?2:-1),a(),p(n.utilityService.isImage(n.message.replyingToMessage.attachments[0].originalFileName)?-1:3)}}function So(s,o){s&1&&v(0,"ss-giphy-sunset"),s&2&&We("width",250,"px")}function Io(s,o){if(s&1&&v(0,"ss-tenor-image",25),s&2){let n=r(2);We("height",100,"px"),u("gifUrl",n.message.replyingToMessage.tenorGifUrl)}}function Oo(s,o){if(s&1){let n=b();l(0,"div",16),_("click",function(){h(n);let t=r();return m(t.goToReplyToMessage(t.message))}),v(1,"div",17),g(2,Mo,3,7),v(3,"small",18),T(4,"lineEndings"),T(5,"stripParagraphs"),T(6,"emoji"),g(7,yo,4,3,"div"),g(8,So,1,2,"ss-giphy-sunset",19),g(9,Io,1,3,"ss-tenor-image",20),c()}if(s&2){let n=r();a(2),p(n.message.replyingToMessage.isDeleted?-1:2),a(),V("deleted",n.message.replyingToMessage.isDeleted),u("innerHTML",ae(6,11,L(5,9,L(4,7,n.message.replyingToMessage.text)),!0),ke),a(4),p(n.message.replyingToMessage.attachments.length>0?7:-1),a(),p(n.message.replyingToMessage.giphyResourceId?8:-1),a(),p(n.message.replyingToMessage.tenorGifUrl?9:-1)}}function To(s,o){if(s&1){let n=b();l(0,"ss-user-avatar",26),_("click",function(){h(n);let t=r();return m(t.openPopup(null))}),c()}if(s&2){let n=r();u("matTooltip",n.message.notAMember?"Left the "+(n.conversationType===n.ConversationTypeRef.Channel?"Channel":"Chat"):"")("avatarColor",n.message.avatarColor)("avatarThumbUrl",n.message.avatarThumbUrl)("initials",n.message.initials)("userId",n.message.userId)("showOnlineStatus",!1)("size",40)}}function Po(s,o){if(s&1){let n=b();l(0,"ss-user-popup",28),_("closePopup",function(){h(n);let t=r(2);return m(t.closePopup())}),c()}if(s&2){let n=r(2);u("userId",n.userPopupId)("openedFromSource",n.getOpenedFromSource())}}function ko(s,o){if(s&1&&g(0,Po,1,2,"ss-user-popup",27),s&2){let n=r();p(n.userPopupId?0:-1)}}function Uo(s,o){if(s&1&&(l(0,"small",8),T(1,"date"),T(2,"lowercase"),f(3),T(4,"timeAgo"),T(5,"date"),T(6,"lowercase"),c()),s&2){let n=r();u("matTooltip",L(2,5,ae(1,2,n.message.dateCreated,"dd/MM/yyyy hh:mm a"))||""),a(3),P(" ",n.isThread?L(4,7,n.message.dateCreated):L(6,12,ae(5,9,n.message.dateCreated,"hh:mm"))," ")}}function Lo(s,o){s&1&&v(0,"ss-premium-tick")}function Ro(s,o){if(s&1&&v(0,"ss-badge",37),s&2){let n=r(3);u("badge",n.message.userBadge)}}function Eo(s,o){if(s&1&&v(0,"ss-icon",40),s&2){let n=r(4);u("matTooltip",(n.conversationType===n.ConversationTypeRef.Channel?"Channel":"Group")+" Admin")("size",20)("iconVariant",20)}}function Vo(s,o){if(s&1&&v(0,"ss-icon",41),s&2){let n=r(4);u("matTooltip",(n.conversationType===n.ConversationTypeRef.Channel?"Channel":"Group")+" Moderator")("size",20)("iconVariant",20)}}function Ao(s,o){if(s&1&&(g(0,Eo,1,3,"ss-icon",40),g(1,Vo,1,3,"ss-icon",41)),s&2){let n=r(3);p(n.message.isAdmin?0:-1),a(),p(n.message.isModerator?1:-1)}}function Do(s,o){s&1&&(l(0,"small",38),f(1,"Failed"),c())}function Bo(s,o){if(s&1){let n=b();l(0,"div",30),g(1,Lo,1,0,"ss-premium-tick"),l(2,"strong",36),T(3,"emoji"),_("click",function(){h(n);let t=r(2);return m(t.openPopup(null))}),c(),g(4,Ro,1,1,"ss-badge",37),g(5,Ao,2,2),g(6,Do,2,0,"small",38),l(7,"small",39),T(8,"date"),T(9,"lowercase"),f(10),T(11,"timeAgo"),T(12,"date"),T(13,"lowercase"),c()()}if(s&2){let n=r(2);a(),p(!n.settingsService.isB2BApp()&&n.message.showPremiumTick?1:-1),a(),u("matTooltip",n.message.notAMember?"Left the "+(n.conversationType===n.ConversationTypeRef.Channel?"Channel":"Chat"):"")("innerHTML",L(3,8,n.message.displayName||n.message.initials),ke),a(2),p(n.message.userBadge?4:-1),a(),p(n.message.userBadge?-1:5),a(),p(n.failed?6:-1),a(),u("matTooltip",L(9,13,ae(8,10,n.message.dateCreated,"dd/MM/yyyy hh:mm a"))||""),a(3),U(n.isThread?L(11,15,n.message.dateCreated):L(13,20,ae(12,17,n.message.dateCreated,"hh:mm a")))}}function No(s,o){if(s&1){let n=b();l(0,"div",42),T(1,"privateSpaceLinkify"),T(2,"lineEndings"),T(3,"emoji"),_("click",function(){h(n);let t=r(2);return m(t.joinPrivateGroup(t.message.text))}),c()}if(s&2){let n=r(2);u("innerHTML",ae(3,5,L(2,3,L(1,1,n.message.text)),!0),ke)}}function zo(s,o){if(s&1&&(v(0,"div",31),T(1,"linkify"),T(2,"lineEndings"),T(3,"emoji")),s&2){let n=r(2);u("innerHTML",ae(3,5,L(2,3,L(1,1,n.message.text)),!0),ke)}}function Fo(s,o){s&1&&(l(0,"small",32),f(1,"Edited"),c())}function jo(s,o){if(s&1&&v(0,"ss-message-attachments",33),s&2){let n=r(2);u("message",n.message)("conversationId",n.conversationId)("conversationType",n.conversationType)("readOnly",n.readOnly)("isThread",n.isThread)}}function Ho(s,o){s&1&&v(0,"ss-giphy-sunset"),s&2&&We("width",250,"px")}function qo(s,o){if(s&1&&v(0,"ss-tenor-image",25),s&2){let n=r(2);u("gifUrl",n.message.tenorGifUrl)}}function Go(s,o){if(s&1){let n=b();l(0,"div",34)(1,"ss-message-reactions",43),_("reactToMessage",function(t){h(n);let i=r(2);return m(i.onReactionChanged(t))}),c()()}if(s&2){let n=r(2);a(),u("isMobile",n.isMobile)("reactions",n.message.reactions)("relatedElementId",n.message.uiIdentifier)}}function Wo(s,o){if(s&1){let n=b();l(0,"ss-thread-replies-preview",44),_("click",function(){h(n);let t=r(2);return m(t.navigateToThread())}),c()}if(s&2){let n=r(2);u("threadMessageStart",n.message)}}function Qo(s,o){if(s&1&&(l(0,"div",29),g(1,Bo,14,22,"div",30),g(2,No,4,8,"div",31),g(3,zo,4,8,"div",31),g(4,Fo,2,0,"small",32),g(5,jo,1,5,"ss-message-attachments",33),g(6,Ho,1,2,"ss-giphy-sunset",19),g(7,qo,1,1,"ss-tenor-image",25),g(8,Go,2,3,"div",34),g(9,Wo,1,1,"ss-thread-replies-preview",35),c()),s&2){let n=r();V("short",n.isShortFormat),a(),p(n.isShortFormat?-1:1),a(),p(n.message.text&&n.message.containsPrivateSpaceLink?2:-1),a(),p(n.message.text&&!n.message.containsPrivateSpaceLink?3:-1),a(),p(n.message.isEdited?4:-1),a(),p(n.message.attachments.length?5:-1),a(),p(n.message.giphyResourceId?6:-1),a(),p(n.message.tenorGifUrl?7:-1),a(),p(n.message.reactions.length?8:-1),a(),p(!n.standaloneThreadParentMessage&&n.message.threadMessagesCount>0?9:-1)}}function $o(s,o){if(s&1&&(l(0,"small",39),T(1,"date"),T(2,"lowercase"),f(3),T(4,"timeAgo"),T(5,"date"),T(6,"lowercase"),c()),s&2){let n=r(2);u("matTooltip",L(2,5,ae(1,2,n.message.dateCreated,"dd/MM/yyyy hh:mm a"))||""),a(3),P(" ",n.isThread?L(4,7,n.message.dateCreated):L(6,12,ae(5,9,n.message.dateCreated,"hh:mm a"))," ")}}function Jo(s,o){if(s&1&&(l(0,"div",10)(1,"div",45),v(2,"ss-icon",46),c(),l(3,"div",47),f(4),c(),g(5,$o,7,14,"small",39),c()),s&2){let n=r();a(2),u("size",14),a(2),U(n.message.text),a(),p(n.message.isDeleted?-1:5)}}function Ko(s,o){if(s&1&&v(0,"ss-message-read-info",11),s&2){let n=r();u("lastReadBy",n.message.lastReadBy)}}function Yo(s,o){if(s&1){let n=b();l(0,"div",48),_("click",function(){h(n);let t=r();return m(t.navigateToMessage())}),c()}}function Zo(s,o){if(s&1){let n=b();l(0,"ss-icon",54),_("click",function(){h(n);let t=r(2);return m(t.onEditMessageClicked())}),c()}s&2&&u("size",16)}function Xo(s,o){if(s&1){let n=b();l(0,"div",13)(1,"div",49)(2,"ss-icon",50),_("click",function(){h(n);let t=r();return m(t.onDeleteUnsentMessageClicked())}),c(),l(3,"ss-icon",51),_("click",function(){h(n);let t=r();return m(t.retrySendingClicked())}),c(),g(4,Zo,1,1,"ss-icon",52),c(),v(5,"ss-icon",53),c()}if(s&2){let n=r();a(2),u("size",15),a(),u("size",16),a(),p(n.isMine()&&n.message.messageType===n.MessageTypeRef.Regular&&n.currentUser.conversationsEnabled&&!n.message.giphyResourceId&&!n.message.tenorGifUrl?4:-1),a(),u("size",8)}}function ea(s,o){if(s&1){let n=b();l(0,"ss-icon",63),_("click",function(){h(n);let t=r(3);return m(t.navigateToThread())}),c()}if(s&2){let n=r(3);u("matTooltip","Reply "+(n.message.threadMessagesCount===0?"in":"to")+" thread")("iconVariant",16)("size",16)}}function ta(s,o){if(s&1){let n=b();l(0,"ss-icon",64),_("click",function(){h(n);let t=r(3);return m(t.reply())}),c()}s&2&&u("iconVariant",16)("size",16)}function ia(s,o){if(s&1){let n=b();l(0,"ss-emoji-picker",59),_("emojiSelected",function(t){h(n);let i=r(2);return m(i.onReactionChanged(t))}),c(),g(1,ea,1,3,"ss-icon",60),g(2,ta,1,2,"ss-icon",61),l(3,"ss-icon",62),_("click",function(){h(n);let t=r(2);return m(t.onMessageBookmarked())}),c()}if(s&2){let n=r(2);u("relatedElementId",n.message.uiIdentifier)("isMobile",n.isMobile)("showEmojiPopup",n.showEmojiPopup)("isReaction",!0),a(),p(n.message.threadStartMessageId===null&&n.currentUser.conversationsEnabled&&(!n.teamMembersOnly||n.isAdminOrModerator())&&!n.isDmTray&&!n.isRoomChannel?1:-1),a(),p(n.currentUser.conversationsEnabled&&(!n.teamMembersOnly||n.isAdminOrModerator())?2:-1),a(),u("matTooltip",n.message.isBookmarked?"Remove from saved items":"Add to saved items")("iconVariant",16)("size",16)("color",n.message.isBookmarked?"negative":"gradient-40")}}function na(s,o){if(s&1){let n=b();l(0,"ss-icon",65),_("menuOpened",function(){h(n);let t=r(2);return m(t.onMenuOpened())})("menuClosed",function(){h(n);let t=r(2);return m(t.onClosedOpened())}),c()}if(s&2){r();let n=Ce(4);u("size",16)("matMenuTriggerFor",n)}}function sa(s,o){if(s&1){let n=b();l(0,"button",66),_("click",function(){h(n);let t=r(3);return m(t.onToggleThreadUser())}),v(1,"ss-icon",67),l(2,"span"),f(3),c()()}if(s&2){let n=r(3);a(),u("iconName",n.isThreadUser()?"alert_off":"alert")("size",16),a(2),U(n.isThreadUser()?"Turn off notifications for replies":"Get notified about new replies")}}function oa(s,o){if(s&1){let n=b();l(0,"button",66),_("click",function(){h(n);let t=r(3);return m(t.onEditMessageClicked())}),v(1,"ss-icon",68),l(2,"span"),f(3),c()()}if(s&2){let n=r(3);a(),u("size",16),a(2),U(n.isThread?"Edit":"Edit message")}}function aa(s,o){if(s&1&&(g(0,sa,4,3,"button",58),g(1,oa,4,2,"button",58)),s&2){let n=r(2);p(n.message.threadMessagesCount>0?0:-1),a(),p(n.isMine()&&n.message.messageType===n.MessageTypeRef.Regular&&n.currentUser.conversationsEnabled&&!n.message.giphyResourceId&&!n.message.tenorGifUrl?1:-1)}}function ra(s,o){if(s&1&&v(0,"ss-message-and-feed-submenu",57),s&2){let n=r(2);u("userId",n.message.userId)("conversationId",n.conversationId)("openedFromSource",n.getOpenedFromSource())("reactionParentObjectId",n.message.id)("hasAnyReactions",n.message.reactions.length>0)("testimonialSource",n.conversationType===n.ConversationTypeRef.Channel?n.TestimonialSourceRef.ChannelMessage:n.TestimonialSourceRef.ChatMessage)("testimonialSourceObjectId",n.message.id)}}function la(s,o){if(s&1){let n=b();l(0,"button",66),_("click",function(){h(n);let t=r(2);return m(t.onDeleteMessageClicked())}),v(1,"ss-icon",69),l(2,"span"),f(3),c()()}if(s&2){let n=r(2);a(),u("size",16),a(2),U(n.isThread?"Delete":"Delete message")}}function ca(s,o){if(s&1&&(l(0,"div",14),g(1,ia,4,10),g(2,na,1,2,"ss-icon",55),l(3,"mat-menu",56,1),g(5,aa,2,2),g(6,ra,1,7,"ss-message-and-feed-submenu",57),g(7,la,4,2,"button",58),c()()),s&2){let n=r();a(),p(n.message.notAMember?-1:1),a(),p(n.shouldShowVerticalMenu()?2:-1),a(3),p(n.message.notAMember?-1:5),a(),p(n.subHoverMenuOpened?6:-1),a(),p(n.showDelete&&(n.isMine()||n.deleteOtherUserMessages||n.isAdminOrModerator())&&n.message.messageType===n.MessageTypeRef.Regular?7:-1)}}var yi=(()=>{let o=class o{get sending(){return!!this.message.sending}get collapsed(){return!!this.message.collapsedIntoPrevious}get failed(){return!!this.message.failed}get activeState(){return this.subHoverMenuOpened}get bookmarked(){return this.message.isBookmarked}get id(){return this.message.uiIdentifier}get disabled(){return this.message.notAMember||this.message.isDeleted}get disabledHoverMenu(){return this.message.notAMember&&!this.isAdminOrModerator()||this.message.isDeleted}get systemMessage(){return this.message.messageType!==De.Regular}constructor(e,t,i,d,M,x,E,A,R){this.utilityService=e,this.settingsService=t,this.livekit=i,this.accountService=d,this.elRef=M,this.router=x,this.dialog=E,this.channelService=A,this.toastService=R,this.conversationUsers=[],this.deleteOtherUserMessages=!1,this.showDelete=!0,this.isThread=!1,this.isRoomChannel=!1,this.teamMembersOnly=!1,this.readOnly=!1,this.standaloneThreadParentMessage=!1,this.isMobile=!1,this.showEmojiPopup=!1,this.isShortFormat=!1,this.disableEdit=!1,this.bookmarksPageMessage=!1,this.isDmTray=!1,this.replyToMessage=new I,this.reactToMessage=new I,this.retrySending=new I,this.deleteUnsentMessage=new I,this.editMessage=new I,this.toggleThreadUser=new I,this.deleteMessage=new I,this.bookmarkMessage=new I,this.scrollToMessage=new I,this.previousValue=!1,this.userPopupId=null,this.popupOpened=!1,this.subHoverMenuOpened=!1,this.ConversationTypeRef=ne,this.MessageTypeRef=De,this.TestimonialSourceRef=En,this.subscriptions=[]}ngOnInit(){this.currentUser=this.accountService.currentUser,this.setMessageInformation(),this.subscriptions.push(this.utilityService.messageUpdated.subscribe(e=>{e.id===this.message.id?(this.setMessageInformation(),setTimeout(()=>{this.bindUserMentionElementEvents(),this.bindChannelMentionElementEvents(),this.bindOtherUsersElementEvents()})):e.id===this.message.replyingToMessage?.id&&(this.message.replyingToMessage.text=e.text,this.message.replyingToMessage.isDeleted=e.isDeleted,setTimeout(()=>{this.bindUserMentionElementEvents(),this.bindChannelMentionElementEvents(),this.bindOtherUsersElementEvents()}))}),this.utilityService.conversationUserUpdated.subscribe(e=>{this.conversationUsers.find(i=>i.id===e)&&this.setMessageInformation()}))}ngAfterViewInit(){this.bindUserMentionElementEvents(),this.bindChannelMentionElementEvents(),this.bindOtherUsersElementEvents()}ngOnChanges(e){e.conversationUsers&&!e.conversationUsers.firstChange&&this.setLastReadBy()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}setMessageInformation(){this.setLastReadBy()}setLastReadBy(){this.message.lastReadBy=this.conversationUsers.filter(e=>e.userId!==this.currentUser.id&&e.userId!==this.message.userId&&e.lastReadMessageId===this.message.id)}reply(){this.replyToMessage.emit(this.message)}isMine(){return this.message.userId===this.currentUser.id}isAdminOrModerator(){return this.accountService.isInRole(j.Administrator)||this.accountService.isInRole(j.Moderator)}isThreadUser(){return!!this.message.threadUsers.find(e=>e.user.id===this.currentUser.id)}openPopup(e){this.popupOpened=!0,this.userPopupId=e??this.message.userId}closePopup(){this.popupOpened=!1,this.userPopupId=null}openUserListModal(){let e=this.message.tokens.filter(t=>!!t.userId).map(t=>t.userId);e.unshift(this.message.userId),this.dialog.open(zn,{panelClass:"fullscreen-dialog",width:"600px",data:e})}onReactionChanged(e){this.readOnly||!this.currentUser.conversationsEnabled||this.reactToMessage.emit({message:this.message,emoji:e})}onDeleteUnsentMessageClicked(){this.deleteUnsentMessage.emit(this.message)}retrySendingClicked(){this.retrySending.emit(this.message)}onEditMessageClicked(){this.editMessage.emit(this.message)}onToggleThreadUser(){this.toggleThreadUser.next({isThreadUser:this.isThreadUser(),message:this.message})}onDeleteMessageClicked(){this.dialog.open(re,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"DeleteMessage",confirmButtonLabel:"Delete"}}).afterClosed().subscribe(t=>{t&&this.deleteMessage.emit(this.message)})}onViewReactionsClicked(){this.dialog.open(Fn,{width:"492px",panelClass:"small-header",data:this.message.reactions})}goToReplyToMessage(e){this.scrollToMessage.emit(e?.replyingToMessage?.id)}navigateToThread(){let e=this.isDmTray||this.router.url.indexOf("conversations/chats")!==-1?"chats":"channels",t=`/conversations/${e}/${this.conversationId}`,i={sidePanel:pe.Thread,threadStartMessageId:this.message.id,conversationType:e==="channels"?ne.Channel:ne.Chat,conversationId:this.conversationId};this.router.navigate([t],{queryParams:i})}onMessageBookmarked(){this.bookmarkMessage.emit(this.message)}navigateToMessage(){let e={conversationType:this.conversationType,conversationId:this.conversationId,messageId:this.message.id};this.message.threadStartMessageId?(e.sidePanel=pe.Thread,e.threadStartMessageId=this.message.threadStartMessageId,this.router.navigate([],{queryParams:e})):this.router.navigate([`/conversations/${this.conversationType.toLocaleLowerCase()}s/${this.conversationId}`],{queryParams:e,queryParamsHandling:"merge"})}getOpenedFromSource(){switch(this.conversationType){case ne.Chat:return gt.DirectMessage;case ne.GroupChat:return gt.GroupChat;case ne.Channel:return gt.Channel;default:return null}}shouldShowVerticalMenu(){return!(this.message.messageType===De.UserJoined&&this.message.userId===this.currentUser.id&&this.message.reactions.length===0)}onMenuOpened(){this.subHoverMenuOpened=!0}onClosedOpened(){this.subHoverMenuOpened=!1}joinPrivateGroup(e){let t=e.substring(e.indexOf("=")+1,e.lastIndexOf("&")),M=e.split("=")[2].split(/\s+/)[0];if(this.utilityService.isOnFocusRoomPage())this.livekit.joinPrivateGroup(t,M).subscribe({next:()=>this.livekit.room.privateGroupMinimized=!1,error:x=>{if(x[0].errorCode==="LivekitRoomMaxSamePeerSessionsReached"){this.toastService.info({exceptionDetail:x[0]});return}this.handleErrors(x)}});else{let x=`/focus/${t}`;this.router.navigate([x],{queryParams:{roomName:t,privateSpaceId:M}})}}bindUserMentionElementEvents(){let e=this.elRef.nativeElement.querySelectorAll(`.mention[data-type="${gi.UserMention}"]`);for(let t of e){let i=t.getAttribute("data-id")||"";t.addEventListener("click",this.openPopup.bind(this,i))}}bindChannelMentionElementEvents(){let e=this.elRef.nativeElement.querySelectorAll(`.mention[data-type="${gi.ChannelMention}"]`);for(let t of e){let i=t.getAttribute("data-id")||"";t.addEventListener("click",this.navigateToChannel.bind(this,i))}}bindOtherUsersElementEvents(){let e=this.elRef.nativeElement.querySelector(".other-users");e&&e.addEventListener("click",this.openUserListModal.bind(this))}mapConversationUserToUser(e){return{id:e.userId,displayName:e.displayName,initials:e.initials,avatarColor:e.avatarColor,avatarThumbUrl:e.avatarThumbUrl,avatarUrl:e.avatarUrl,lastActive:e.lastActive,followsMe:e.followsMe,following:e.following,blocked:e.blocked,blockedMe:e.blockedMe}}navigateToChannel(e){this.channelService.getChannelInfo(e).subscribe({next:t=>{t.isMember?this.router.navigate([`/conversations/channels/${e}`]):t.isPrivate||this.joinChannel(e,t.name)},error:t=>{this.toastService.error({exceptionDetail:t[0]})}})}joinChannel(e,t){this.dialog.open(re,{panelClass:"fullscreen-dialog",data:{modalTitle:"Join channel?",description:"NotPublicChannelMember",descriptionParams:{channelName:t},confirmButtonLabel:"Join & view"}}).afterClosed().subscribe(d=>{d&&this.channelService.joinChannel(e).subscribe({next:()=>{this.router.navigate([`/conversations/channels/${e}`])},error:M=>{this.toastService.error({exceptionDetail:M[0]})}})})}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(X),C(Le),C(xn),C(B),C(Vt),C(te),C(Z),C(ce),C(N))},o.\u0275cmp=k({type:o,selectors:[["ss-message"]],hostVars:27,hostBindings:function(t,i){t&2&&(Gi("id",i.id),V("short-format",i.isShortFormat)("disable-edit",i.disableEdit)("selected",i.selectedForEdit)("bookmark-format",i.bookmarksPageMessage)("dm-tray-format",i.isDmTray)("sending",i.sending)("collapsed",i.collapsed)("failed",i.failed)("active",i.activeState)("bookmarked",i.bookmarked)("disabled",i.disabled)("disabled-hover-menu",i.disabledHoverMenu)("system-message",i.systemMessage))},inputs:{message:"message",conversationId:"conversationId",conversationType:"conversationType",conversationUsers:"conversationUsers",deleteOtherUserMessages:"deleteOtherUserMessages",showDelete:"showDelete",isThread:"isThread",isRoomChannel:"isRoomChannel",teamMembersOnly:"teamMembersOnly",readOnly:"readOnly",standaloneThreadParentMessage:"standaloneThreadParentMessage",isMobile:"isMobile",showEmojiPopup:"showEmojiPopup",isShortFormat:"isShortFormat",disableEdit:"disableEdit",selectedForEdit:"selectedForEdit",bookmarksPageMessage:"bookmarksPageMessage",isDmTray:"isDmTray"},outputs:{replyToMessage:"replyToMessage",reactToMessage:"reactToMessage",retrySending:"retrySending",deleteUnsentMessage:"deleteUnsentMessage",editMessage:"editMessage",toggleThreadUser:"toggleThreadUser",deleteMessage:"deleteMessage",bookmarkMessage:"bookmarkMessage",scrollToMessage:"scrollToMessage"},standalone:!1,features:[qe],decls:14,vars:18,consts:[["trigger","cdkOverlayOrigin"],["menu","matMenu"],[1,"bookmark-header"],[1,"reply-message-wrapper"],[1,"message-content"],["cdkOverlayOrigin","",1,"left"],["role","button",3,"matTooltip","avatarColor","avatarThumbUrl","initials","userId","showOnlineStatus","size"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],["matTooltipPosition","above","matTooltipShowDelay","500",1,"date-short",3,"matTooltip"],[1,"content-wrapper",3,"short"],[1,"deleted-content-wrapper"],[3,"lastReadBy"],[1,"bookmark-overlay"],[1,"failed-message-wrapper"],[1,"hover-menu"],["iconName","bookmark","color","negative",1,"bookmark-icon",3,"size"],[1,"reply-message-wrapper",3,"click"],[1,"line"],[1,"reply-text",3,"innerHTML"],[3,"width"],[3,"gifUrl","height"],[3,"avatarColor","avatarThumbUrl","initials","userId","showOnlineStatus","size"],[1,"reply-name"],["iconName","image","color","default-40",3,"size"],["iconName","paperclip","color","default-40",3,"size"],[3,"gifUrl"],["role","button",3,"click","matTooltip","avatarColor","avatarThumbUrl","initials","userId","showOnlineStatus","size"],["cssClass","margin-horizontal",3,"userId","openedFromSource"],["cssClass","margin-horizontal",3,"closePopup","userId","openedFromSource"],[1,"content-wrapper"],[1,"name-date-wrapper"],[1,"input-text","emoji-container",3,"innerHTML"],[1,"edited"],[3,"message","conversationId","conversationType","readOnly","isThread"],[1,"reactions-wrapper"],[3,"threadMessageStart"],["role","button",1,"interactable-bold",3,"click","matTooltip","innerHTML"],[3,"badge"],[1,"fail-message"],["matTooltipPosition","above","matTooltipShowDelay","500",3,"matTooltip"],["iconName","star","color","accent-blue-20",3,"matTooltip","size","iconVariant"],["iconName","shield_person","color","accent-blue-20",3,"matTooltip","size","iconVariant"],[1,"input-text","emoji-container",3,"click","innerHTML"],[3,"reactToMessage","isMobile","reactions","relatedElementId"],[3,"click","threadMessageStart"],[1,"delete-mark"],["iconName","delete","color","default-60",1,"delete-icon",3,"size"],[1,"input-text"],[1,"bookmark-overlay",3,"click"],[1,"actions"],["role","button","iconName","delete","color","negative-60","matTooltipPosition","above","matTooltip","Remove Message",3,"click","size"],["role","button","matTooltipPosition","above","matTooltip","Retry Sending","iconName","arrow_clockwise","color","negative-60",1,"retry-icon",3,"click","size"],["matTooltip","Edit","matTooltipPosition","above","role","button","iconName","edit","color","negative-60",1,"edit-icon",3,"size"],["iconName","dismiss","color","contrast",1,"failed-status-icon",3,"size"],["matTooltip","Edit","matTooltipPosition","above","role","button","iconName","edit","color","negative-60",1,"edit-icon",3,"click","size"],["role","button","iconName","more_vertical","color","gradient-40",1,"more-icon",3,"size","matMenuTriggerFor"],[1,"sub-menu"],[3,"userId","conversationId","openedFromSource","reactionParentObjectId","hasAnyReactions","testimonialSource","testimonialSourceObjectId"],["mat-menu-item",""],["matTooltip","Emoji React","matTooltipPosition","above","iconName","emoji",3,"emojiSelected","relatedElementId","isMobile","showEmojiPopup","isReaction"],["matTooltipPosition","above","role","button","iconName","chat_arrow_back","color","gradient-40",1,"thread-icon",3,"matTooltip","iconVariant","size"],["matTooltip","Quote message","matTooltipPosition","above","role","button","iconName","text_quote","color","gradient-40",1,"reply-icon",3,"iconVariant","size"],["matTooltipPosition","above","role","button","iconName","bookmark",1,"bookmark-icon",3,"click","matTooltip","iconVariant","size","color"],["matTooltipPosition","above","role","button","iconName","chat_arrow_back","color","gradient-40",1,"thread-icon",3,"click","matTooltip","iconVariant","size"],["matTooltip","Quote message","matTooltipPosition","above","role","button","iconName","text_quote","color","gradient-40",1,"reply-icon",3,"click","iconVariant","size"],["role","button","iconName","more_vertical","color","gradient-40",1,"more-icon",3,"menuOpened","menuClosed","size","matMenuTriggerFor"],["mat-menu-item","",3,"click"],["role","button","color","contrast",1,"notify-icon",3,"iconName","size"],["matTooltip","Edit","matTooltipPosition","above","role","button","iconName","edit","color","contrast",1,"edit-icon",3,"size"],["role","button","iconName","delete","color","contrast",1,"delete-icon",3,"size"]],template:function(t,i){if(t&1){let d=b();g(0,vo,4,1,"div",2),g(1,Oo,10,14,"div",3),l(2,"div",4)(3,"div",5,0),g(5,To,1,7,"ss-user-avatar",6),Ge(6,ko,1,1,"ng-template",7),_("backdropClick",function(){return h(d),m(i.closePopup())}),g(7,Uo,7,14,"small",8),c(),g(8,Qo,10,11,"div",9),g(9,Jo,6,3,"div",10),g(10,Ko,1,1,"ss-message-read-info",11),g(11,Yo,1,0,"div",12),c(),g(12,Xo,6,4,"div",13),g(13,ca,8,5,"div",14)}if(t&2){let d=Ce(4);p(i.message.isBookmarked&&!i.message.isDeleted?0:-1),a(),p(i.message.replyingToMessage?1:-1),a(),V("has-attachments",i.message.attachments.length>0)("has-text",!!i.message.text),a(3),p(!i.isShortFormat&&!i.message.isDeleted?5:-1),a(),u("cdkConnectedOverlayOrigin",d)("cdkConnectedOverlayOpen",i.popupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0),a(),p(i.isShortFormat&&!i.message.isDeleted?7:-1),a(),p(i.message.isDeleted?-1:8),a(),p(i.message.isDeleted?9:-1),a(),p(i.message.id&&(i.message.lastReadBy!=null&&i.message.lastReadBy.length)?10:-1),a(),p(i.bookmarksPageMessage?11:-1),a(),p(i.failed?12:-1),a(),p(!i.message.isDeleted&&!i.readOnly&&i.currentUser.conversationsEnabled?13:-1)}},dependencies:[Je,$e,Ke,ie,mt,ht,Un,Bn,Dn,Ln,Rn,Vn,D,le,ft,Ct,vt,xi,bi,Nt,ge,Mt,An,jn,$t,Hn,Qt],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;justify-content:space-between;width:100%;padding:10px 20px}.short-format[_nghost-%COMP%]{padding-top:8px}.short-format[_nghost-%COMP%]   .date-short[_ngcontent-%COMP%]{top:2px;left:0}@media only screen and (max-width: 1024px){.short-format[_nghost-%COMP%]   .date-short[_ngcontent-%COMP%]{left:16px;max-width:initial}}.short-format[_nghost-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .input-text[_ngcontent-%COMP%]{line-height:20px}.short-format[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]{top:-4px}.disabled[_nghost-%COMP%]{opacity:.6}.disabled[_nghost-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .input-text[_ngcontent-%COMP%]{font-style:italic;color:var(--default-40)}.disabled-hover-menu[_nghost-%COMP%]:hover{background:initial}.disabled-hover-menu[_nghost-%COMP%]:hover   .hover-menu[_ngcontent-%COMP%]{display:none}.system-message[_nghost-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .input-text[_ngcontent-%COMP%]{color:var(--default-40)}.disable-edit[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   .edit-icon[_ngcontent-%COMP%]{display:none}.disable-edit[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   .more-icon[_ngcontent-%COMP%]{margin-left:5px}[_nghost-%COMP%]:hover   .reactions-wrapper[_ngcontent-%COMP%]     ss-message-reactions ss-emoji-picker{display:flex}[_nghost-%COMP%]:hover, .active[_nghost-%COMP%]{background:var(--alt-40)}[_nghost-%COMP%]:hover   .hover-menu[_ngcontent-%COMP%], .active[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]:hover   .date-short[_ngcontent-%COMP%], .active[_nghost-%COMP%]   .date-short[_ngcontent-%COMP%]{display:block;cursor:pointer}[_nghost-%COMP%]:hover   .date-short[_ngcontent-%COMP%]:hover, .active[_nghost-%COMP%]   .date-short[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]:hover   .reply[_ngcontent-%COMP%]   .reply-arrow[_ngcontent-%COMP%], .active[_nghost-%COMP%]   .reply[_ngcontent-%COMP%]   .reply-arrow[_ngcontent-%COMP%]{display:flex}.selected[_nghost-%COMP%]{background:var(--alt-40)}.selected[_nghost-%COMP%]:hover   .hover-menu[_ngcontent-%COMP%]{display:none}.failed[_nghost-%COMP%]{background-color:var(--negative-90)}.failed[_nghost-%COMP%]:hover   .hover-menu[_ngcontent-%COMP%]{display:none}.failed[_nghost-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:7px}.failed[_nghost-%COMP%]   ss-icon[_ngcontent-%COMP%]     i{line-height:15px}.sending[_nghost-%COMP%]:hover   .hover-menu[_ngcontent-%COMP%]{display:none}.highlighted[_nghost-%COMP%], .bookmarked[_nghost-%COMP%]:not(.bookmark-format){background:var(--accent-gradient-90)}.bookmarked[_nghost-%COMP%]:not(.bookmark-format)   .bookmark-header[_ngcontent-%COMP%]{display:flex}.bookmark-format[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   ss-emoji-picker[_ngcontent-%COMP%], .bookmark-format[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   .thread-icon[_ngcontent-%COMP%], .bookmark-format[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   .reply-icon[_ngcontent-%COMP%], .bookmark-format[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   .edit-icon[_ngcontent-%COMP%], .bookmark-format[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   .more-icon[_ngcontent-%COMP%]{display:none}.bookmark-format[_nghost-%COMP%]   .hover-menu[_ngcontent-%COMP%]   .bookmark-icon[_ngcontent-%COMP%]{margin-left:0}.bookmark-format[_nghost-%COMP%]   .reply[_ngcontent-%COMP%]   .reply-arrow[_ngcontent-%COMP%]{display:none}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{padding:10px 5px}}.collapsed[_nghost-%COMP%]{display:none}.dm-tray-format[_nghost-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{max-width:calc(100% - 75px)}.date-short[_ngcontent-%COMP%]{position:absolute;top:12px;left:30px;display:none;color:var(--default-60)}.bookmark-header[_ngcontent-%COMP%]{display:none;margin:0 0 5px 52px}.bookmark-header[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:5px}.bookmark-header[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-60)}.message-content[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:flex-start;align-items:flex-start;width:100%;padding-right:4px}.message-content.has-attachments.has-text[_ngcontent-%COMP%]   .input-text[_ngcontent-%COMP%]{margin-bottom:8px}.message-content.has-attachments[_ngcontent-%COMP%]:not(.has-text)   ss-message-attachments[_ngcontent-%COMP%]{margin-top:8px}.message-content[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{margin-right:12px}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;width:100%;word-break:break-word;white-space:pre}.message-content[_ngcontent-%COMP%]   .content-wrapper.short[_ngcontent-%COMP%]{max-width:calc(100% - 52px);margin-left:52px}@media only screen and (max-width: 767px){.message-content[_ngcontent-%COMP%]   .content-wrapper.short[_ngcontent-%COMP%]{max-width:initial}}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .input-text[_ngcontent-%COMP%]{overflow:hidden;line-height:20px;word-wrap:break-word;white-space:pre-wrap}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     .mention[data-type=UserMention], .message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     .mention[data-type=ChannelMention], .message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     .mention[data-type=NotifierKeywordMention]{color:var(--accent-blurple)}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     .mention[data-type=UserMention], .message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     .mention[data-type=ChannelMention]{cursor:pointer}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     a{color:var(--accent-blurple)}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     a:hover{text-decoration:underline}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     .other-users{color:var(--accent-blurple);cursor:pointer}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]     .other-users:hover{text-decoration:underline}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .edited[_ngcontent-%COMP%]{margin-top:6px;color:var(--default-60)}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .edited[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer}.message-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .edited[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration:underline}.message-content[_ngcontent-%COMP%]   .deleted-content-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;width:calc(100% - 55px)}.message-content[_ngcontent-%COMP%]   .deleted-content-wrapper[_ngcontent-%COMP%]   .delete-mark[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:24px;height:24px;margin:0 20px 0 8px;border-radius:10px;background-color:var(--base-100)}.message-content[_ngcontent-%COMP%]   .deleted-content-wrapper[_ngcontent-%COMP%]   .input-text[_ngcontent-%COMP%]{max-width:calc(100% - 52px);font-style:italic;color:var(--default-40)}.message-content[_ngcontent-%COMP%]   .deleted-content-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{margin-left:15px;line-height:21px;color:var(--default-60);cursor:pointer}.message-content[_ngcontent-%COMP%]   .deleted-content-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]:hover{text-decoration:underline}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center;margin-bottom:2px}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   ss-badge[_ngcontent-%COMP%], .message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-left:4px;cursor:pointer}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:inline-block;align-items:center;overflow:hidden;text-overflow:ellipsis}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]:hover{text-decoration:underline}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{margin-left:12px;color:var(--default-60);cursor:pointer}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]:hover{text-decoration:underline}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   small.fail-message[_ngcontent-%COMP%]{display:inline-block;color:var(--negative)}.message-content[_ngcontent-%COMP%]   .name-date-wrapper[_ngcontent-%COMP%]   small.fail-message[_ngcontent-%COMP%]:hover{text-decoration:none}.message-content[_ngcontent-%COMP%]   .reply-text[_ngcontent-%COMP%]{max-width:100%;word-wrap:break-word;white-space:pre-wrap}.message-content[_ngcontent-%COMP%]   .reply-text.deleted[_ngcontent-%COMP%]{padding:4px 0;font-style:italic;color:var(--default-40);opacity:.6}.reply-message-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;padding-left:19px;margin-bottom:8px;cursor:pointer}.reply-message-wrapper[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{align-self:normal;min-width:26px;width:26px;margin:7px 7px 0 0;border-radius:8px 0 0;border-width:2px 0 0 2px;border-style:solid;border-color:var(--accent-blue-20)}.reply-message-wrapper[_ngcontent-%COMP%]   .reply-name[_ngcontent-%COMP%]{flex-shrink:0;margin:0 8px;font-weight:400;color:var(--accent-blue-20)}.reply-message-wrapper[_ngcontent-%COMP%]   .reply-text[_ngcontent-%COMP%]{overflow:hidden;color:var(--default-40);text-overflow:ellipsis;white-space:nowrap}.reply-message-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{display:inline-block;margin-left:10px}.attachments-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.attachments-list[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:150px;max-height:104px;margin:0 10px 10px 0;border:1px solid var(--default-60);border-radius:5px}.attachments-list[_ngcontent-%COMP%]   .other-file-type[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;padding:7.5px 16px;margin:0 10px 10px 0;border:1px solid var(--alt);border-radius:5px;background:var(--alt-80)}.attachments-list[_ngcontent-%COMP%]   .other-file-type[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:16px}.attachments-list[_ngcontent-%COMP%]   .other-file-type[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.hover-menu[_ngcontent-%COMP%]{position:absolute;top:0;right:20px;display:none;justify-content:center;align-items:center;padding:4px 10px;border:1px solid var(--alt);border-radius:10px;box-shadow:var(--elevation-s1);background-color:var(--grayscale);transform:translateY(-50%)}.hover-menu[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block;width:16px;height:16px;cursor:pointer}.hover-menu[_ngcontent-%COMP%]   ss-icon.edit-icon[_ngcontent-%COMP%], .hover-menu[_ngcontent-%COMP%]   ss-icon.more-icon[_ngcontent-%COMP%], .hover-menu[_ngcontent-%COMP%]   ss-icon.delete-icon[_ngcontent-%COMP%], .hover-menu[_ngcontent-%COMP%]   ss-icon.notify-icon[_ngcontent-%COMP%]{margin-left:10px}.hover-menu[_ngcontent-%COMP%]   ss-icon.reply-icon[_ngcontent-%COMP%], .hover-menu[_ngcontent-%COMP%]   ss-icon.thread-icon[_ngcontent-%COMP%]{margin-right:10px}ss-tenor-image[_ngcontent-%COMP%]{margin-top:6px}.reactions-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.failed-message-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:flex-end;height:calc(100% - 24px)}.failed-message-wrapper[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;margin-bottom:10px}.failed-message-wrapper[_ngcontent-%COMP%]   .retry-icon[_ngcontent-%COMP%]{display:block;width:15px;height:15px}.failed-message-wrapper[_ngcontent-%COMP%]   .failed-status-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:13px;height:13px;border-radius:50%;background:var(--negative-40)}.failed-message-wrapper[_ngcontent-%COMP%]   .failed-status-icon[_ngcontent-%COMP%]     i{width:12px;line-height:13px;text-align:center}mat-spinner[_ngcontent-%COMP%]{position:absolute;right:28px;bottom:14px}mat-spinner[_ngcontent-%COMP%]     circle{stroke:var(--accent-blurple-20)}.bookmark-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;cursor:pointer}"]});let s=o;return s})();function ha(s,o){s&1&&v(0,"mat-spinner",1)}function ma(s,o){if(s&1){let n=b();l(0,"ss-user-popup",11),_("closePopup",function(){h(n);let t=r(2);return m(t.closePopup())}),c()}if(s&2){let n=r(2);u("userId",n.userId)}}function ga(s,o){if(s&1){let n=b();l(0,"ss-button-small",12),_("buttonClick",function(){h(n);let t=r(2);return m(t.handleMessageRequest())}),f(1,"Accept"),c(),l(2,"ss-button-small",12),_("buttonClick",function(){h(n);let t=r(2);return m(t.ignoreMessageRequest())}),f(3,"Ignore"),c()}}function pa(s,o){if(s&1){let n=b();l(0,"ss-button-small",14),_("buttonClick",function(){h(n);let t=r(3);return m(t.followUser())}),f(1," Follow "),c()}if(s&2){let n=r(3);u("isLoading",n.followingUser)}}function ua(s,o){if(s&1){let n=b();l(0,"ss-button-small",14),_("buttonClick",function(){h(n);let t=r(3);return m(t.onUnfollowUser())}),f(1," Unfollow "),c()}if(s&2){let n=r(3);u("isLoading",n.unfollowingUser)}}function Ca(s,o){if(s&1){let n=b();g(0,pa,2,1,"ss-button-small",13),g(1,ua,2,1,"ss-button-small",13),l(2,"ss-button-small",9),_("buttonClick",function(){h(n);let t=r(2);return m(t.onBlockModalClicked())}),f(3),c()}if(s&2){let n=r(2);p(!n.userInfo.following&&!n.userInfo.blocked&&!n.userInfo.blockedMe?0:-1),a(),p(n.userInfo.following?1:-1),a(),u("color",n.ButtonColorRef.Moody),a(),P(" ",n.userInfo.blocked?"Unblock":"Block"," ")}}function _a(s,o){if(s&1&&f(0),s&2){let n=r(2);P(" Our smart filter has included this in your main chat list because you and ",n.userInfo.firstName," have mutual connections. ")}}function fa(s,o){if(s&1){let n=b();l(0,"div",2,0)(2,"ss-user-avatar",3),_("click",function(){h(n);let t=r();return m(t.openPopup(t.userInfo,!0))}),c()(),Ge(3,ma,1,1,"ng-template",4),_("backdropClick",function(){h(n);let t=r();return m(t.closePopup())}),l(4,"h2",5),f(5),c(),l(6,"div",6),v(7,"ss-followed-by-users",7),l(8,"div",8),g(9,ga,4,0),g(10,Ca,4,4),l(11,"ss-button-small",9),_("buttonClick",function(){h(n);let t=r();return m(t.onReportClicked())}),f(12," Report "),c()()(),l(13,"small"),g(14,_a,1,1),f(15,"If you want all new messages to go to your message requests tray for approval, update your "),l(16,"span",10),_("click",function(){h(n);let t=r();return m(t.openPrivacySettingsModal())}),f(17," Privacy Settings"),c(),f(18,". "),c()}if(s&2){let n=Ce(1),e=r();a(2),u("avatarColor",e.userInfo.avatarColor)("avatarThumbUrl",e.userInfo.avatarThumbUrl)("initials",e.userInfo.initials)("userId",e.userInfo.id)("size",60)("showOnlineStatus",!1),a(),u("cdkConnectedOverlayOrigin",n)("cdkConnectedOverlayOpen",e.avatarPopupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0),a(2),U(e.userInfo.displayName),a(2),u("userId",e.userInfo.id)("followerInfo",e.userInfo.followerInfo),a(2),p(e.isMessageRequest&&e.createdByUserId!==e.currentUser.id?9:-1),a(),p(e.isMessageRequest&&e.createdByUserId!==e.currentUser.id?-1:10),a(),u("color",e.ButtonColorRef.Negative),a(3),p(!(e.userInfo.followerInfo==null||e.userInfo.followerInfo.commonFollowers==null)&&e.userInfo.followerInfo.commonFollowers.length?14:-1)}}var Si=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A,R){this.accountService=e,this.router=t,this.dialog=i,this.toastService=d,this.userService=M,this.signalRService=x,this.chatService=E,this.userFollowService=A,this.onlineStatusService=R,this.followingUser=!1,this.unfollowingUser=!1,this.mainLoading=!1,this.ButtonColorRef=fn,this.subscriptions=[],this.currentUser=this.accountService.currentUser}ngOnInit(){this.fetchUserInfo(),this.subscriptions.push(this.onlineStatusService.profilesInfoUpdated.subscribe(e=>{let t=e.find(i=>i.id===this.userId&&i.firstName);t&&(this.userInfo=t)}),this.signalRService.userFollowed.subscribe(e=>this.onUserFollowed(e)),this.signalRService.userUnfollowed.subscribe(e=>this.onUserUnfollowed(e)),this.signalRService.userBlocked.subscribe(e=>this.onUserBlocked(e)),this.signalRService.userUnblocked.subscribe(e=>this.onUserUnblocked(e)))}openPrivacySettingsModal(){this.router.navigate([],{queryParams:{activeModal:pi.PrivacySettings},queryParamsHandling:"merge"}),this.router.navigate(["/profile"],{queryParams:{activeModal:pi.PrivacySettings}})}onBlockModalClicked(){this.dialog.open(xe,{panelClass:"fullscreen-dialog",width:"414px",data:{user:this.userInfo}})}onReportClicked(){this.dialog.open(Ye,{panelClass:"fullscreen-dialog",width:"480px",disableClose:!0,data:{reportedUser:this.userInfo,roomName:null,reportSource:_t.DirectMessage,elementToScreenshotSelector:"ss-dashboard"}})}followUser(){this.followingUser||(this.followingUser=!0,this.userFollowService.followUser(this.userId).subscribe({next:()=>{this.followingUser=!1,this.userInfo.following=!0,this.userService.getUserProfileShort(this.userId).subscribe({next:e=>this.userInfo=e,error:e=>this.handleErrors(e)})},error:e=>this.handleErrors(e)}))}onUnfollowUser(){this.unfollowingUser=!0,yn.showUnfollowModalForFeedParticipants(this.dialog,this.userId,this.userFollowService).subscribe({next:e=>{this.unfollowingUser=!1,e!==!1&&(this.userInfo.following=!1,this.userService.getUserProfileShort(this.userId).subscribe({next:t=>this.userInfo=t,error:t=>this.handleErrors(t)}))},error:e=>this.handleErrors(e)})}isMine(){return this.userId===this.currentUser.id}openPopup(e,t=!1){t?this.avatarPopupOpened=!0:this.userPopupOpened=!0,this.userPopupInfo={id:e.id,displayName:e.displayName,initials:e.initials,avatarColor:e.avatarColor,avatarUrl:e.avatarUrl,avatarThumbUrl:e.avatarThumbUrl}}closePopup(){this.avatarPopupOpened=!1,this.userPopupOpened=!1,this.userPopupInfo={}}handleMessageRequest(e=!0){(e?this.chatService.messageRequestAccept(this.chatId):this.chatService.messageRequestIgnore(this.chatId)).subscribe({error:i=>this.handleErrors(i)})}ignoreMessageRequest(){this.dialog.open(re,{panelClass:"fullscreen-dialog",width:"400px",data:{modalTitle:"Are you sure?",description:"MessageRequestIgnore",confirmButtonLabel:"Confirm"}}).afterClosed().subscribe(t=>{t&&this.handleMessageRequest(!1)})}fetchUserInfo(){this.mainLoading=!0;let e=this.onlineStatusService.getProfileInfo(this.userId);e?(this.userInfo=e,this.userInfo.followerInfo?this.mainLoading=!1:this.fetchFollowerInfo()):this.accountService.isFullyVerifiedUser()?this.userService.getUserProfileShort(this.userId).subscribe({next:t=>this.handleUserInfo(t,!0),error:t=>this.handleErrors(t)}):this.userService.getUserProfileShortPublic(this.userId).subscribe({next:t=>this.handleUserInfo(t,!1),error:t=>this.handleErrors(t)})}handleUserInfo(e,t){this.userInfo=e,this.onlineStatusService.upsertGottenInfo(this.userInfo),t?this.fetchFollowerInfo():this.mainLoading=!1}fetchFollowerInfo(){this.userService.getFollowers(this.userInfo.id).subscribe({next:e=>{this.userInfo.followerInfo=e,this.onlineStatusService.upsertGottenFollowersInfo(this.userInfo.id,e),this.mainLoading=!1},error:e=>this.handleErrors(e)})}onUserFollowed(e){this.currentUser.id===e.followerId&&this.userId===e.followedUserId?this.userInfo.following=!0:this.currentUser.id===e.followedUserId&&this.userId===e.followerId&&(this.userInfo.followsMe=!0)}onUserUnfollowed(e){this.currentUser.id===e.followerId&&this.userId===e.followedUserId?this.userInfo.following=!1:this.currentUser.id===e.followedUserId&&this.userId===e.followerId&&(this.userInfo.followsMe=!1)}onUserBlocked(e){this.currentUser.id===e.userBlockingId&&this.userId===e.blockedUserId?(this.userInfo.following=!1,this.userInfo.followsMe=!1,this.userInfo.blocked=!0):this.currentUser.id===e.blockedUserId&&this.userId===e.userBlockingId&&(this.userInfo.following=!1,this.userInfo.followsMe=!1,this.userInfo.blockedMe=!0)}onUserUnblocked(e){this.currentUser.id===e.userUnblockingId&&this.userId===e.unblockedUserId?this.userInfo.blocked=!1:this.currentUser.id===e.unblockedUserId&&this.userId===e.userUnblockingId&&(this.userInfo.blockedMe=!1)}handleErrors(e){this.followingUser=!1,this.unfollowingUser=!1,this.mainLoading=!1,e[0].errorCode==="UserProfileShortModelNotFound"?this.toastService.info({message:"This user is either not active or has not confirmed some of their information."}):this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(B),C(te),C(Z),C(N),C(Ae),C(G),C(se),C(Ze),C(bn))},o.\u0275cmp=k({type:o,selectors:[["ss-message-list-header"]],inputs:{userId:"userId",chatId:"chatId",createdByUserId:"createdByUserId",isMessageRequest:"isMessageRequest"},standalone:!1,decls:2,vars:2,consts:[["triggerFirst","cdkOverlayOrigin"],["diameter","20","strokeWidth","2",1,"main-loader"],["cdkOverlayOrigin",""],[1,"main-avatar",3,"click","avatarColor","avatarThumbUrl","initials","userId","size","showOnlineStatus"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],[1,"user-name"],[1,"actions"],["styleClass","message-header",3,"userId","followerInfo"],[1,"button-wrapper"],[3,"buttonClick","color"],[3,"click"],["cssClass","margin-horizontal",3,"closePopup","userId"],[3,"buttonClick"],[3,"isLoading"],[3,"buttonClick","isLoading"]],template:function(t,i){t&1&&(g(0,ha,1,0,"mat-spinner",1),g(1,fa,19,17)),t&2&&(p(i.mainLoading?0:-1),a(),p(!i.mainLoading&&i.userInfo?1:-1))},dependencies:[Ve,mt,ht,le,ft,qt,Sn],styles:["[_nghost-%COMP%]{max-width:100%;margin:50px 24px 10px}.main-loader[_ngcontent-%COMP%]{margin:0 auto}.main-avatar[_ngcontent-%COMP%]{display:inline-flex;margin-bottom:8px;cursor:pointer}.actions[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.button-wrapper[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]{display:inline-block;margin:0 12px 8px 0}.button-wrapper[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]     button{min-width:84px}small[_ngcontent-%COMP%]{color:var(--default-20)}small[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700;color:var(--accent-blue-20);text-decoration:underline;cursor:pointer}.user-name[_ngcontent-%COMP%]{max-width:90%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}"]});let s=o;return s})();var xa=["messagesWrapper"],ba=["messagesContainer"],wa=["olderMessagesLoader"],ya=["newerMessagesLoader"],Sa=(s,o)=>o.uiIdentifier;function Ia(s,o){if(s&1&&v(0,"ss-message-list-header",6),s&2){let n=r();u("chatId",n.conversationId)("createdByUserId",n.createdByUserId)("isMessageRequest",n.isMessageRequest())("userId",n.getOtherUserId())}}function Oa(s,o){s&1&&v(0,"mat-spinner",8)}function Ta(s,o){if(s&1&&f(0),s&2){let n=r(2);P(" ",n.beginningMessage," ")}}function Pa(s,o){if(s&1&&(l(0,"div",9),g(1,Ta,1,1),c()),s&2){let n=r();a(),p(n.isThread?-1:1)}}function ka(s,o){if(s&1&&(l(0,"div",18)(1,"small"),f(2),c(),v(3,"mat-divider"),c()),s&2){let n=r(2);a(2),me("",n.threadStartMessage.threadMessagesCount," ",n.threadStartMessage.threadMessagesCount===1?"reply":"replies")}}function Ua(s,o){if(s&1){let n=b();l(0,"div",10)(1,"ss-message",17),_("replyToMessage",function(t){h(n);let i=r();return m(i.onReplyToMessage(t,i.isThread))})("reactToMessage",function(t){h(n);let i=r();return m(i.onReactToMessage(t))})("toggleThreadUser",function(t){h(n);let i=r();return m(i.onToggleThreadUser(t))})("deleteMessage",function(t){h(n);let i=r();return m(i.onDeleteMessage(t))})("bookmarkMessage",function(t){h(n);let i=r();return m(i.onMessageBookmarked(t))})("deleteUnsentMessage",function(t){h(n);let i=r();return m(i.onDeleteUnsentMessage(t))})("retrySending",function(t){h(n);let i=r();return m(i.onRetrySending(t))})("editMessage",function(t){h(n);let i=r();return m(i.onEditMessage(t))}),c(),g(2,ka,4,2,"div",18),c()}if(s&2){let n=r();a(),u("message",n.threadStartMessage)("conversationId",n.conversationId)("readOnly",n.readOnly)("isThread",n.isThread)("standaloneThreadParentMessage",!0)("conversationUsers",n.conversationUsers)("conversationType",n.conversationType)("selectedForEdit",(n.messageToEdit==null?null:n.messageToEdit.id)===n.threadStartMessage.id)("deleteOtherUserMessages",n.deleteOtherUserMessages)("isMobile",n.isMobile)("teamMembersOnly",n.inputDisableMode==="team-members-only"),ci("data-id",n.threadStartMessage.id),a(),p(n.threadStartMessage.threadMessagesCount?2:-1)}}function La(s,o){if(s&1&&(l(0,"div",19),v(1,"div"),l(2,"strong"),f(3),T(4,"shortDate"),c(),v(5,"div"),c()),s&2){let n=r().$implicit;a(3),U(L(4,1,n.dateCreated))}}function Ra(s,o){s&1&&(l(0,"div",20),v(1,"hr"),l(2,"span"),f(3,"New"),c()())}function Ea(s,o){if(s&1){let n=b();g(0,La,6,3,"div",19),g(1,Ra,4,0,"div",20),l(2,"ss-message",21),_("replyToMessage",function(t){h(n);let i=r();return m(i.onReplyToMessage(t,i.isThread))})("reactToMessage",function(t){h(n);let i=r();return m(i.onReactToMessage(t))})("deleteUnsentMessage",function(t){h(n);let i=r();return m(i.onDeleteUnsentMessage(t))})("bookmarkMessage",function(t){h(n);let i=r();return m(i.onMessageBookmarked(t))})("retrySending",function(t){h(n);let i=r();return m(i.onRetrySending(t))})("editMessage",function(t){h(n);let i=r();return m(i.onEditMessage(t))})("toggleThreadUser",function(t){h(n);let i=r();return m(i.onToggleThreadUser(t))})("deleteMessage",function(t){h(n);let i=r();return m(i.onDeleteMessage(t))})("scrollToMessage",function(t){h(n);let i=r();return m(i.onScrollToMessage(t))}),c()}if(s&2){let n=o.$implicit,e=o.$index,t=r();p(!t.threadStartMessage&&t.shouldShowDateBreak(n,e)?0:-1),a(),p(t.firstUnreadMessageId===n.id?1:-1),a(),V("active",t.selectedMessage===n),u("message",n)("readOnly",t.readOnly)("isThread",t.isThread)("isDmTray",t.isDmTray)("isRoomChannel",t.isRoomChannel)("teamMembersOnly",t.inputDisableMode==="team-members-only")("conversationUsers",t.conversationUsers)("conversationType",t.conversationType)("conversationId",t.conversationId)("selectedForEdit",(t.messageToEdit==null?null:t.messageToEdit.id)===n.id)("deleteOtherUserMessages",t.deleteOtherUserMessages)("isShortFormat",!t.threadStartMessage&&e>0&&!n.replyingToMessage&&t.isShortFormat(n,e))("isMobile",t.isMobile)("showEmojiPopup",t.isEmojiPopupVisible(n)),ci("data-id",n.id)}}function Va(s,o){s&1&&v(0,"mat-spinner",12)}function Aa(s,o){if(s&1){let n=b();l(0,"div",22),_("click",function(){h(n);let t=r();return m(t.scrollToBottom())}),v(1,"ss-icon",23),l(2,"span"),f(3),c()()}if(s&2){let n=r();a(),u("size",13),a(2),me("",n.unseenMessagesCount," new ",n.unseenMessagesCount===1?"message":"messages")}}function Da(s,o){if(s&1){let n=b();l(0,"div",24),_("click",function(){h(n);let t=r();return m(t.reloadConversation.emit(t.conversationId))}),l(1,"div",25),v(2,"ss-icon",23),l(3,"span"),f(4),T(5,"date"),T(6,"date"),c()(),l(7,"div",26)(8,"span"),f(9,"Mark as Read"),c(),v(10,"ss-icon",27),c()()}if(s&2){let n=r();a(2),u("size",13),a(2),Wi("",n.initialUnreadMessagesCount," new ",n.initialUnreadMessagesCount===1?"message":"messages"," since ",ae(5,7,n.lastReadMessageDateRead,"hh:mm a")," on ",ae(6,10,n.lastReadMessageDateRead,"dd MMM yyyy")),a(6),u("iconVariant",20)("size",14)}}function Ba(s,o){if(s&1){let n=b();l(0,"ss-message-input-block",28),_("editMessage",function(t){h(n);let i=r();return m(i.onMessageEdited(t))})("editMessageCancel",function(){h(n);let t=r();return m(t.onMessageEditCancelled())})("debouncedKeyPress",function(){h(n);let t=r();return m(t.onDebouncedKeyPress())})("selectLastMessage",function(){h(n);let t=r();return m(t.setLastMessageAsActive())})("replyMessageCancel",function(){h(n);let t=r();return m(t.onReplyToMessageCancelled())})("retrySending",function(t){h(n);let i=r();return m(i.onRetrySending(t))})("messageSubmit",function(t){h(n);let i=r();return m(i.onMessageSubmit(t))}),c()}if(s&2){let n=r();u("isMobile",n.isMobile)("messageInputBlockLocation",n.getMessageInputBlockLocation())("inputDisableMode",n.inputDisableMode)("conversationId",n.conversationId)("conversationType",n.conversationType)("conversationUsers",n.conversationUsers)("replyMessage",n.replyMessage)("messageToEdit",n.messageToEdit)}}function Na(s,o){if(s&1&&v(0,"ss-upgrade-cta",16),s&2){let n=r();u("openedFromSource",n.TriggeredUpgradeFromSourceRef.Channels)}}var Ot=(()=>{let o=class o{get inputDisableMode(){if(this.readOnly)return"read-only";if(this.threadDeleted)return"thread-deleted";if(this.channelType===Jt.TeamPostingOnly&&!this.isAdminOrModerator())return"team-members-only";let e=this.getMyChatUser();if(e?.isMessageRequest)return this.createdByUserId===e.userId?"pending-request-sender":"pending-request-receiver";if(this.channelType&&(this.conversationId===an||this.conversationId===rn)){let t=mi.fromISO(this.currentUser.dateCreated,{zone:"utc"}).startOf("day");return mi.utc().startOf("day").diff(t,"days").days<5?"new-account":null}return null}handleKeyboardEvent(e){e.key==="Escape"&&(this.selectedMessage=null)}handleClickOutsideEvent(e){this.elementRef.nativeElement.contains(e.target)||(this.selectedMessage=null)}constructor(e,t,i,d,M,x,E,A,R){this.accountService=e,this.utilityService=t,this.settingsService=i,this.subscriptionService=d,this.elementRef=M,this.ngZone=x,this.activatedRoute=E,this.signalRService=A,this.keyboardService=R,this.conversationUsers=[],this.readOnly=!1,this.channelType=null,this.threadDeleted=!1,this.isDmTray=!1,this.isRoomChannel=!1,this.initialUnreadMessagesCount=0,this.messages=[],this.loadingOlderMessages=!1,this.loadingNewerMessages=!1,this.isThread=!1,this.loadMoreOlder=new I,this.loadMoreNewer=new I,this.typing=new I,this.messageSubmit=new I,this.retrySending=new I,this.reactToMessage=new I,this.editMessage=new I,this.toggleThreadUser=new I,this.deleteMessage=new I,this.reloadConversation=new I,this.loadReferencedMessage=new I,this.bookmarkMessage=new I,this.MessageInputBlockLocationRef=at,this.TriggeredUpgradeFromSourceRef=Ht,this.isScrolledToBottom=!1,this.isMobile=!1,this.showEmojiPopup=!1,this.unseenMessagesCount=0,this.ConversationTypeRef=ne,this.lastMessageWrapperScrollHeight=0,this.lastListUpdateReason=null,this.olderMessagesIntersectionObserver=new IntersectionObserver(z=>this.onOlderMessagesLoaderRenderedInView(z),{threshold:[0]}),this.newerMessagesIntersectionObserver=new IntersectionObserver(z=>this.onNewerMessagesLoaderRenderedInView(z),{threshold:[0]}),this.messageContainerResizeObserver=new ResizeObserver(z=>requestAnimationFrame(()=>this.onMessagesContainerResized(z[0].target))),this.inputBlockResizeObserver=new ResizeObserver(()=>requestAnimationFrame(()=>this.onInputBlockResized())),this.subscriptions=[]}ngOnInit(){this.currentUser=this.accountService.currentUser,this.jumpedToFirstUnreadMessage=this.firstUnreadMessageId===null,this.subscriptions.push(this.utilityService.messageListUpdated.subscribe(e=>this.lastListUpdateReason=e),this.utilityService.onReplyToMessage.subscribe(e=>this.onReplyToMessage(e.message,e.emittedFromThread)),this.utilityService.conversationMessagesReloaded.subscribe(e=>this.onConversationMessagesReloaded(e)),this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.signalRService.chatLeft.subscribe(e=>this.onChatLeft(e)),this.signalRService.channelLeft.subscribe(e=>this.onChannelLeft(e)),this.signalRService.chatMessageReceived.subscribe(e=>this.onMessageReceived(e)),this.signalRService.channelMessageReceived.subscribe(e=>this.onMessageReceived(e)),this.signalRService.chatMessageRequestAccepted.subscribe(e=>this.onChatMessageRequestAccepted(e)),this.keyboardService.shortcutHit.subscribe(e=>this.handleShortcutHit(e)))}ngOnChanges(e){e.conversationId&&!e.conversationId.firstChange?(this.lastListUpdateReason=null,this.unseenMessagesCount=0,this.selectedMessage=null):e.firstUnreadMessageId&&!e.firstUnreadMessageId.firstChange&&(this.jumpedToFirstUnreadMessage=this.firstUnreadMessageId===null)}ngAfterViewInit(){this.activatedRoute.queryParams.subscribe(e=>{e.messageId&&this.onScrollToMessage(e.messageId)}),this.olderMessagesIntersectionObserver.observe(this.olderMessagesLoader.nativeElement),this.newerMessagesIntersectionObserver.observe(this.newerMessagesLoader.nativeElement),this.ngZone.runOutsideAngular(()=>{this.messageContainerResizeObserver.observe(this.messagesContainer.nativeElement),this.onMessageWrapperScrolled=this.onMessageWrapperScrolled.bind(this),this.messagesWrapper.nativeElement.addEventListener("scroll",this.onMessageWrapperScrolled);let t=this.elementRef.nativeElement.querySelector("ss-message-input-block");t&&this.inputBlockResizeObserver.observe(t)})}ngOnDestroy(){ot(this.olderMessagesIntersectionObserver,this.olderMessagesLoader?.nativeElement),ot(this.newerMessagesIntersectionObserver,this.newerMessagesLoader?.nativeElement),ot(this.messageContainerResizeObserver,this.messagesContainer?.nativeElement),ot(this.inputBlockResizeObserver,this.elementRef?.nativeElement?.querySelector("ss-message-input-block")),this.lastReadMessageDateRead=null,this.subscriptions.forEach(e=>e.unsubscribe()),this.messagesWrapper.nativeElement?.removeEventListener("scroll",this.onMessageWrapperScrolled),window.clearTimeout(this.highlightTimeoutRef)}onDebouncedKeyPress(){this.typing.emit()}onMessageSubmit(e){this.messageSubmit.emit(e)}onReplyToMessage(e,t){(this.isThread&&t||!this.isThread&&!t)&&(this.replyMessage=e)}onReplyToMessageCancelled(){this.replyMessage=null}onReactToMessage(e){this.lastListUpdateReason===H.FirstLoad&&(this.lastListUpdateReason=H.MessageInteraction),this.reactToMessage.emit(e)}onDeleteUnsentMessage(e){this.messages.splice(this.messages.indexOf(e),1)}onEditMessage(e){this.utilityService.editMessageClicked.next(),this.messageToEdit=e}onMessageEdited(e){this.editMessage.emit(e),this.messageToEdit=null}onMessageEditCancelled(){this.messageToEdit=null}onDeleteMessage(e){this.deleteMessage.emit(e)}onMessageBookmarked(e){this.lastListUpdateReason===H.FirstLoad&&(this.lastListUpdateReason=H.MessageInteraction),this.bookmarkMessage.emit(e)}onToggleThreadUser(e){this.toggleThreadUser.emit(e)}onScrollToMessage(e){let t=document.querySelector(`[data-id="${e}"]`);if(t){let i=this.messagesWrapper.nativeElement;i.scrollTop=t.offsetTop-50,this.highlightMessage(e)}else this.loadReferencedMessage.emit(e)}onRetrySending(e){this.retrySending.emit(e)}isShortFormat(e,t){let i=this.messages[t-1];if(i.isDeleted||i.userId!==e.userId||i.messageType!==e.messageType)return!1;let d=new Date(e.dateCreated),M=new Date(i.dateCreated);return d.getTime()-M.getTime()<on.messageShortFormatSeconds*1e3}shouldShowDateBreak(e,t){if(t===0)return!0;let i=this.messages[t-1],d=new Date(e.dateCreated),M=new Date(i.dateCreated);return d.getDay()!==M.getDay()||d.getMonth()!==M.getMonth()||d.getFullYear()!==M.getFullYear()}scrollToBottom(){let e=this.messagesWrapper.nativeElement,t=this.messagesContainer.nativeElement;e.scrollTop=t.clientHeight-e.clientHeight}onMessageWrapperScrolled(){window.requestAnimationFrame(()=>{let e=this.messagesWrapper.nativeElement;this.lastMessageWrapperScrollHeight=e.scrollHeight;let t=Math.floor(Math.abs(this.lastMessageWrapperScrollHeight-e.scrollTop-e.clientHeight));this.isScrolledToBottom=t===0,this.isScrolledToBottom&&(this.unseenMessagesCount=0)})}getOtherUserId(){return this.conversationUsers.find(t=>t.userId!==this.currentUser.id)?.userId||""}getMyChatUser(){return this.conversationUsers.find(e=>e.userId===this.currentUser.id)}isMessageRequest(){return this.getMyChatUser()?.isMessageRequest||null}isAdminOrModerator(){return this.accountService.isInRole(j.Administrator)||this.accountService.isInRole(j.Moderator)||this.deleteOtherUserMessages}getMessageInputBlockLocation(){return this.isThread?at.Thread:this.isDmTray?at.DMTray:at.Conversations}setLastMessageAsActive(){this.selectedMessage=this.messages[this.messages.length-1]}isEmojiPopupVisible(e){return this.showEmojiPopup&&e.uiIdentifier===this.selectedMessage?.uiIdentifier}hideInputBlock(){return this.accountService.isInRole(j.Administrator)||this.accountService.isInRole(j.Moderator)||this.subscriptionService.hasActiveSubscription?!1:this.conversationType===ne.Channel&&this.inputDisableMode===null}handleShortcutHit(e){let t=[F.MessageSelectPrevious,F.MessageSelectNext,F.MessageEdit,F.MessageEmoji],i=e.shortcut;if(t.includes(i))switch(e.event.preventDefault(),i){case F.MessageSelectPrevious:this.setPreviousMessageAsActive();break;case F.MessageSelectNext:this.setNextMessageAsActive();break;case F.MessageEdit:this.selectedMessage&&this.selectedMessage.userId===this.currentUser.id&&this.selectedMessage.messageType===De.Regular&&this.currentUser.conversationsEnabled&&!this.selectedMessage.giphyResourceId&&!this.selectedMessage.tenorGifUrl&&this.onEditMessage(this.selectedMessage);break;case F.MessageEmoji:this.showEmojiPopup=!0;break;default:break}}setPreviousMessageAsActive(){if(!this.selectedMessage){this.setLastMessageAsActive();return}if(this.showEmojiPopup=!1,!this.selectedMessage)return;let e=this.messages.indexOf(this.selectedMessage);e!==0&&this.setActiveMessage(e-1)}setNextMessageAsActive(){if(this.showEmojiPopup=!1,!this.selectedMessage)return;let e=this.messages.indexOf(this.selectedMessage);if(e===this.messages.length-1){this.selectedMessage=null;return}this.setActiveMessage(e+1)}setActiveMessage(e){this.selectedMessage=this.messages[e];let t=this.messagesWrapper.nativeElement,i=this.messagesContainer.nativeElement,d=document.querySelector(`[data-id='${this.selectedMessage.id}']`);t.scrollTop=i.clientHeight,d&&d.offsetTop<t.scrollTop&&(t.scrollTop=d.offsetTop-50)}onMessagesContainerResized(e){let t=this.messagesWrapper.nativeElement,i=e.clientHeight;switch(this.lastListUpdateReason){case null:this.ensureFirstUnreadMessageIsVisible(t,i),this.isScrolledToBottom=t.scrollTop===0,this.lastListUpdateReason=H.FirstLoad;break;case H.LoadedOlder:case H.MessageInteraction:t.scrollTop=t.scrollTop+i-this.lastMessageWrapperScrollHeight;break;case H.LoadedNewer:break;case H.MessageReceived:t.scrollTop+t.clientHeight>=this.lastMessageWrapperScrollHeight-40&&(t.scrollTop=i);break;case H.MessageSent:case H.FirstLoad:t.scrollTop=i;break}}ensureFirstUnreadMessageIsVisible(e,t){this.firstUnreadMessageId?this.ensureMessageIsVisible(e,t,this.firstUnreadMessageId):e.scrollTop=t}ensureMessageIsVisible(e,t,i,d=!1){let M=document.querySelector(`[data-id='${i}']`);e.scrollTop=t,(!this.jumpedToFirstUnreadMessage||d)&&M&&M.offsetTop<e.scrollTop&&(e.scrollTop=M.offsetTop-50,this.jumpedToFirstUnreadMessage=!0)}onInputBlockResized(){let e=this.messagesWrapper.nativeElement;this.isScrolledToBottom&&(e.scrollTop=e.scrollHeight)}onOlderMessagesLoaderRenderedInView(e){e[0].isIntersecting&&this.loadMoreOlder.emit()}onNewerMessagesLoaderRenderedInView(e){e[0].isIntersecting&&this.loadMoreNewer.emit()}onConversationMessagesReloaded(e){setTimeout(()=>{let t=this.messagesWrapper.nativeElement,i=this.messagesContainer.nativeElement;this.ensureMessageIsVisible(t,i.clientHeight,e,!0),this.highlightMessage(e)})}highlightMessage(e){let t=document.querySelector(`[data-id="${e}"]`);t!==null&&(t.classList.add("highlighted"),this.highlightTimeoutRef=window.setTimeout(()=>{t.classList.remove("highlighted")},2e3))}onMessageReceived(e){let t=e.chatId||e.channelId;!e.threadStartMessageId&&t===this.conversationId&&(this.unseenMessagesCount=this.isScrolledToBottom?0:this.unseenMessagesCount+1)}onChatLeft(e){if(e.chatId===this.conversationId)for(let t of this.messages){let i=t.userId===e.userLeavingId,d=t.lastReadBy?.find(M=>M.userId===e.userLeavingId);d&&(t.lastReadBy?.splice(t.lastReadBy.indexOf(d),1),i=!0),i&&this.utilityService.messageUpdated.next(t)}}onChatMessageRequestAccepted(e){if(e.chatId!==this.conversationId)return;let t=this.getMyChatUser(),i=this.getOtherUserId();(e.userAcceptedId===t?.userId&&e.createdByUserId===i||e.createdByUserId===t?.userId&&e.userAcceptedId===i)&&(t.isMessageRequest=!1)}onChannelLeft(e){if(e.channelId===this.conversationId)for(let t of this.messages)t.userId===e.userLeavingId&&this.utilityService.messageUpdated.next(t)}};o.\u0275fac=function(t){return new(t||o)(C(B),C(X),C(Le),C(ut),C(Vt),C(Dt),C(Ue),C(G),C(ei))},o.\u0275cmp=k({type:o,selectors:[["ss-message-list"]],viewQuery:function(t,i){if(t&1&&(J(xa,5),J(ba,5),J(wa,5),J(ya,5)),t&2){let d;K(d=Y())&&(i.messagesWrapper=d.first),K(d=Y())&&(i.messagesContainer=d.first),K(d=Y())&&(i.olderMessagesLoader=d.first),K(d=Y())&&(i.newerMessagesLoader=d.first)}},hostVars:2,hostBindings:function(t,i){t&1&&_("keydown",function(M){return i.handleKeyboardEvent(M)},At)("click",function(M){return i.handleClickOutsideEvent(M)},dt),t&2&&V("thread-format",i.isThread)},inputs:{conversationId:"conversationId",conversationType:"conversationType",conversationUsers:"conversationUsers",readOnly:"readOnly",channelType:"channelType",threadDeleted:"threadDeleted",isDmTray:"isDmTray",isRoomChannel:"isRoomChannel",beginningMessage:"beginningMessage",firstUnreadMessageId:"firstUnreadMessageId",lastReadMessageDateRead:"lastReadMessageDateRead",initialUnreadMessagesCount:"initialUnreadMessagesCount",createdByUserId:"createdByUserId",messages:"messages",threadStartMessage:"threadStartMessage",deleteOtherUserMessages:"deleteOtherUserMessages",loadingOlderMessages:"loadingOlderMessages",loadingNewerMessages:"loadingNewerMessages",loadedAllOlderMessages:"loadedAllOlderMessages",loadedAllNewerMessages:"loadedAllNewerMessages",isThread:"isThread"},outputs:{loadMoreOlder:"loadMoreOlder",loadMoreNewer:"loadMoreNewer",typing:"typing",messageSubmit:"messageSubmit",retrySending:"retrySending",reactToMessage:"reactToMessage",editMessage:"editMessage",toggleThreadUser:"toggleThreadUser",deleteMessage:"deleteMessage",reloadConversation:"reloadConversation",loadReferencedMessage:"loadReferencedMessage",bookmarkMessage:"bookmarkMessage"},standalone:!1,features:[qe],decls:19,vars:9,consts:[["messagesWrapper",""],["messagesContainer",""],["olderMessagesLoader",""],["newerMessagesLoader",""],[1,"messages-wrapper"],[1,"messages"],[3,"chatId","createdByUserId","isMessageRequest","userId"],[1,"messages-loader"],["diameter","30","strokeWidth","3"],[1,"beginning-message"],[1,"thread-start-message-wrapper"],[1,"messages-loader","bottom"],["diameter","16","strokeWidth","2"],[1,"scroll-to-button"],[1,"scroll-to-button","top"],[3,"isMobile","messageInputBlockLocation","inputDisableMode","conversationId","conversationType","conversationUsers","replyMessage","messageToEdit"],["paidFeatureText","Upgrade to post in channels",3,"openedFromSource"],[1,"thread-start-message",3,"replyToMessage","reactToMessage","toggleThreadUser","deleteMessage","bookmarkMessage","deleteUnsentMessage","retrySending","editMessage","message","conversationId","readOnly","isThread","standaloneThreadParentMessage","conversationUsers","conversationType","selectedForEdit","deleteOtherUserMessages","isMobile","teamMembersOnly"],[1,"replies-separator"],[1,"date-split"],[1,"new-messages-line"],[3,"replyToMessage","reactToMessage","deleteUnsentMessage","bookmarkMessage","retrySending","editMessage","toggleThreadUser","deleteMessage","scrollToMessage","message","readOnly","isThread","isDmTray","isRoomChannel","teamMembersOnly","conversationUsers","conversationType","conversationId","selectedForEdit","deleteOtherUserMessages","isShortFormat","isMobile","showEmojiPopup"],[1,"scroll-to-button",3,"click"],["iconName","arrow_down","color","contrast",3,"size"],[1,"scroll-to-button","top",3,"click"],[1,"left"],[1,"right"],["iconName","mail_checkmark","color","contrast",3,"iconVariant","size"],[3,"editMessage","editMessageCancel","debouncedKeyPress","selectLastMessage","replyMessageCancel","retrySending","messageSubmit","isMobile","messageInputBlockLocation","inputDisableMode","conversationId","conversationType","conversationUsers","replyMessage","messageToEdit"]],template:function(t,i){t&1&&(l(0,"div",4,0)(2,"div",5,1),g(4,Ia,1,4,"ss-message-list-header",6),l(5,"div",7,2),g(7,Oa,1,0,"mat-spinner",8),g(8,Pa,2,1,"div",9),g(9,Ua,3,13,"div",10),c(),Q(10,Ea,3,19,null,null,Sa),l(12,"div",11,3),g(14,Va,1,0,"mat-spinner",12),c()()(),g(15,Aa,4,3,"div",13),g(16,Da,11,13,"div",14),g(17,Ba,1,8,"ss-message-input-block",15),g(18,Na,1,1,"ss-upgrade-cta",16)),t&2&&(a(4),p(i.conversationType===i.ConversationTypeRef.Chat&&!i.isThread&&i.loadedAllOlderMessages?4:-1),a(3),p(i.loadingOlderMessages?7:-1),a(),p(i.conversationType!==i.ConversationTypeRef.Chat&&i.loadedAllOlderMessages?8:-1),a(),p(i.threadStartMessage&&i.isThread&&i.loadedAllOlderMessages?9:-1),a(),$(i.messages),a(4),p(i.loadingNewerMessages?14:-1),a(),p(i.loadedAllNewerMessages&&!i.isScrolledToBottom&&i.unseenMessagesCount>0?15:-1),a(),p(i.lastReadMessageDateRead&&!i.loadedAllNewerMessages&&i.initialUnreadMessagesCount>0?16:-1),a(),p(i.hideInputBlock()?-1:17),a(),p(i.hideInputBlock()?18:-1))},dependencies:[Ve,gn,Gt,kn,D,yi,Si,ge,Nn],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}.page-content-wrapper[_ngcontent-%COMP%]{height:calc(100vh - 56px)}@media only screen and (max-width: 1024px){.page-content-wrapper[_ngcontent-%COMP%]{height:100%}}.page-content[_ngcontent-%COMP%]{max-width:1340px;width:100%;padding:50px 70px;margin:0 auto}@media only screen and (max-width: 1024px){.page-content[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end;height:calc(100vh - 129px);background-color:var(--grayscale)}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{height:calc(100vh - 236px)}}.thread-format[_nghost-%COMP%]{justify-content:space-between;height:calc(100vh - 113px);background-color:var(--alt-90)}@media only screen and (max-width: 1024px){.thread-format[_nghost-%COMP%]{height:calc(100vh - 205px)}}.thread-format[_nghost-%COMP%]   .messages[_ngcontent-%COMP%]{justify-content:flex-start}.thread-format[_nghost-%COMP%]   .messages-loader[_ngcontent-%COMP%]{height:auto}.thread-format[_nghost-%COMP%]   .beginning-message[_ngcontent-%COMP%]{display:none}.thread-format[_nghost-%COMP%]   .thread-start-message[_ngcontent-%COMP%]{padding-top:23px}.thread-format[_nghost-%COMP%]   .thread-start-message[_ngcontent-%COMP%]     .hover-menu{top:13px;right:0}.thread-format[_nghost-%COMP%]   ss-message[_ngcontent-%COMP%]  .message-content .content-wrapper{width:calc(100% - 52px)}[_nghost-%COMP%]   ss-upgrade-cta[_ngcontent-%COMP%]{width:calc(100% - 16px);margin:12px 8px 16px}@media only screen and (max-width: 1024px){.safari   [_nghost-%COMP%]{height:calc(100vh - 260px)}}@media only screen and (max-width: 1024px){.safari   .thread-format[_nghost-%COMP%]{height:calc(100vh - 230px)}}@media only screen and (max-width: 1024px){  .ios.chrome-ios ss-message-list{height:calc(100vh - 296px)}}@media only screen and (max-width: 1024px){  body.emulator ss-message-list{height:calc(100vh - 185px)}}@media only screen and (max-width: 1024px){  body.emulator ss-message-list.thread-format{height:calc(100vh - 155px)}}.messages-loader[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:50px}.messages-loader.bottom[_ngcontent-%COMP%]{height:16px}.messages-loader[_ngcontent-%COMP%]   .beginning-message[_ngcontent-%COMP%]{overflow:hidden;padding:0 25px;font-size:12px;text-overflow:ellipsis;white-space:nowrap}.messages-wrapper[_ngcontent-%COMP%]{position:relative;width:100%;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.messages-wrapper[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.messages-wrapper[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.messages-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar, .messages-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.messages-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.thread-start-message-wrapper[_ngcontent-%COMP%]{display:block;width:100%}.thread-start-message-wrapper[_ngcontent-%COMP%]   .replies-separator[_ngcontent-%COMP%]{display:flex;align-items:center;padding:14px 20px}.thread-start-message-wrapper[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{margin-right:12px;color:var(--default-60)}.thread-start-message-wrapper[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{position:relative;top:1px;flex:1;border-top-color:var(--default-80)}.thread-start-message[_ngcontent-%COMP%]{background-color:var(--alt-80)}.messages[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-end;flex-wrap:wrap;overflow-x:hidden}@media only screen and (max-width: 1024px){.messages[_ngcontent-%COMP%]{min-height:auto}}.date-split[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;padding:10px 25px}.date-split[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1;height:1px;background:var(--alt)}.date-split[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{padding:0 15px;color:var(--default-20)}.new-messages-line[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;padding-right:15px;color:var(--negative-40)}.new-messages-line[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:100%;margin-right:5px;border:0;border-top:1px solid var(--negative-40)}.scroll-to-button[_ngcontent-%COMP%]{position:absolute;bottom:90px;left:50%;z-index:1;padding:2px 10px;border-radius:16px;color:var(--contrast);background:var(--accent-blurple-40);cursor:pointer;transform:translate(-50%)}.scroll-to-button[_ngcontent-%COMP%]:hover{opacity:.9}.scroll-to-button.top[_ngcontent-%COMP%]{top:73px;bottom:auto;display:flex;justify-content:space-between;align-items:center;width:100%;padding:2px 12px;border-top-left-radius:0;border-top-right-radius:0}.scroll-to-button[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:5px}.scroll-to-button[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .scroll-to-button[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;align-items:center}.scroll-to-button[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:0;margin-left:5px}"]});let s=o;return s})();function za(s,o){if(s&1&&v(0,"ss-channel-header",0),s&2){let n=r();u("channel",n.channel)}}function Fa(s,o){if(s&1){let n=b();l(0,"div",1)(1,"div",4),v(2,"ss-icon",5),l(3,"h4"),f(4,"Focus Room Chat"),c()(),l(5,"ss-icon",6),_("click",function(){h(n);let t=r();return m(t.closeRoomChatClicked.emit())}),c()()}s&2&&(a(2),u("size",28),a(3),u("size",20)("iconVariant",20))}function ja(s,o){s&1&&v(0,"div",2)}function Ha(s,o){if(s&1){let n=b();l(0,"ss-message-list",7),_("loadMoreOlder",function(){h(n);let t=r();return m(t.loadOlderMessages())})("loadMoreNewer",function(){h(n);let t=r();return m(t.loadNewerMessages())})("typing",function(){h(n);let t=r();return m(t.onTyping())})("messageSubmit",function(t){h(n);let i=r();return m(i.onMessageSubmit(t))})("editMessage",function(t){h(n);let i=r();return m(i.onEditMessage(t))})("toggleThreadUser",function(t){h(n);let i=r();return m(i.onToggleThreadUser(t))})("deleteMessage",function(t){h(n);let i=r();return m(i.onDeleteMessage(t))})("bookmarkMessage",function(t){h(n);let i=r();return m(i.onMessageBookmarked(t))})("reactToMessage",function(t){h(n);let i=r();return m(i.onReactToMessage(t))})("retrySending",function(t){h(n);let i=r();return m(i.onRetrySending(t))})("reloadConversation",function(t){h(n);let i=r();return m(i.onReloadConversation(t))})("loadReferencedMessage",function(t){h(n);let i=r();return m(i.onLoadReferencedMessage(t))}),c()}if(s&2){let n=r();u("beginningMessage",Me("This is the very beginning of the #",n.channel.name," channel."))("conversationType",n.ConversationTypeRef.Channel)("conversationId",n.channel.id)("messages",n.channel.messages)("readOnly",n.channel.readOnly)("firstUnreadMessageId",n.channel.firstUnreadMessageId)("loadingOlderMessages",n.loadingOlderMessages)("loadingNewerMessages",n.loadingNewerMessages)("loadedAllOlderMessages",n.loadedAllOlderMessages)("loadedAllNewerMessages",n.loadedAllNewerMessages)("lastReadMessageDateRead",n.channel.lastMessageReadDate)("initialUnreadMessagesCount",n.channel.initialUnreadMessagesCount)("deleteOtherUserMessages",n.channel.currentUserRole===n.ChannelRoleRef.Admin||n.channel.currentUserRole===n.ChannelRoleRef.Moderator)("channelType",n.channel.type)("isRoomChannel",!!n.roomChannelId)}}var qa=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A){this.utilityService=e,this.accountService=t,this.channelService=i,this.signalRService=d,this.toastService=M,this.router=x,this.loaderService=E,this.activatedRoute=A,this.closeRoomChatClicked=new I,this.channel={messages:[]},this.loadingOlderMessages=!1,this.loadingNewerMessages=!1,this.loadedAllOlderMessages=!0,this.loadedAllNewerMessages=!0,this.processingBookmarksIds=[],this.ConversationTypeRef=ne,this.ChannelRoleRef=et,this.subscriptions=[],this.messagesSendingQueue={queue:[],push:R=>{this.messagesSendingQueue.queue.push(R),this.messagesSendingQueue.queue.length===1&&this.messagesSendingQueue.execute()},execute:()=>{this.messagesSendingQueue.queue.length!==0&&this.messagesSendingQueue.queue[0].subscribe({next:R=>{this.updateMessageList(R),this.messagesSendingQueue.next()},error:R=>{this.channel.messages.filter(z=>z.sending).forEach(z=>{z.failed=!0,z.sending=!1}),this.handleErrors(R),this.messagesSendingQueue.next()}})},next:()=>{this.messagesSendingQueue.queue.shift(),this.messagesSendingQueue.execute()}}}ngOnInit(){this.currentUser=this.accountService.currentUser,this.activatedRoute.params.subscribe(e=>{this.loaderService.start();let t=this.roomChannelId??e.channelId;this.utilityService.conversationId.next(t),t&&t!==this.previousChannelId?(this.previousChannelId=e.channelId,this.loadChannel(t)):this.loaderService.stop()}),this.subscriptions.push(this.signalRService.channelMessageReceived.subscribe(e=>this.onNewMessageReceived(e)),this.signalRService.channelMessageUpdate.subscribe(e=>this.onMessageUpdated(e)),this.signalRService.channelMessageRead.subscribe(e=>this.onMessageRead(e)),this.signalRService.channelsAllRead.subscribe(e=>this.onChannelsAllRead(e)),this.signalRService.channelLeft.subscribe(e=>this.onChannelLeft(e)),this.signalRService.channelJoined.subscribe(e=>this.onChannelJoined(e)),this.signalRService.channelUserUpdated.subscribe(e=>this.onChannelUserUpdated(e)),this.signalRService.channelUpdated.subscribe(e=>this.onChannelUpdated(e)),this.signalRService.channelMessageBookmarkStateUpdated.subscribe(e=>this.onChannelMessageBookmarkStateUpdated(e)),this.signalRService.channelThreadUserAdded.subscribe(e=>this.onChannelThreadUserAdded(e)),this.signalRService.channelThreadUserRemoved.subscribe(e=>this.onChannelThreadUserRemoved(e)))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.channelLoadInProgress?.unsubscribe()}loadChannel(e,t=!1){t||(this.channel={messages:[]},this.utilityService.conversationLoaded.next({channel:null,chat:null})),this.channelLoadInProgress?.unsubscribe(),this.channelLoadInProgress=this.channelService.getMyChannel(e).subscribe({next:i=>{this.loaderService.stop(),t?(this.channel.messages=i.messages,this.channel.totalMessages=i.totalMessages,this.channel.totalMembers=i.totalMembers,this.channel.firstUnreadMessageId=i.firstUnreadMessageId,this.channel.lastMessageReadDate=i.lastMessageReadDate,this.channel.latestMessageId=i.latestMessageId,this.channel.currentUserRole=i.currentUserRole):(this.channel=i,this.utilityService.conversationLoaded.next({channel:this.channel,chat:null})),this.loadedAllOlderMessages=this.channel.totalMessages===this.channel.messages.length,this.loadedAllNewerMessages=this.channel.messages.length>0?this.channel.messages[this.channel.messages.length-1].id===this.channel.latestMessageId:!0,this.channel.messages.length>0&&this.channel.lastMessageReadDate===this.channel.messages[this.channel.messages.length-1].dateCreated?this.markAsRead():this.updateLastReadMessage(),this.groupDeletedMessages(),setTimeout(()=>{this.loaderService.stop()},50)},error:i=>this.handleErrors(i)})}loadOlderMessages(){this.loadedAllOlderMessages||this.loadingOlderMessages||this.loadingNewerMessages||(this.loadingOlderMessages=!0,this.channelService.getOlderMessages(this.channel.id,this.channel.messages[0].id).subscribe({next:e=>{e.messages.length>0&&this.channel.messages.unshift(...e.messages),this.channel.totalMessages=e.totalMessages,this.channel.messages.length>0&&(this.loadedAllOlderMessages=this.channel.messages[0].id===e.firstMessageId),this.groupDeletedMessages(),this.loadingOlderMessages=!1,this.utilityService.messageListUpdated.next(H.LoadedOlder)},error:e=>this.handleErrors(e)}))}loadNewerMessages(){if(this.loadedAllNewerMessages||this.loadingOlderMessages||this.loadingNewerMessages)return;this.loadingNewerMessages=!0;let e=this.getNewestMessageId();e&&this.channelService.getNewerMessages(this.channel.id,e).subscribe({next:t=>{if(t.messages.length>0&&this.channel.messages.push(...t.messages),this.channel.totalMessages=t.totalMessages,this.channel.messages.length>0){let i=this.getNewestMessageId();i&&(this.loadedAllNewerMessages=i===t.lastMessageId),this.loadedAllNewerMessages&&this.markAsRead()}this.updateLastReadMessage(),this.groupDeletedMessages(),this.loadingNewerMessages=!1,this.utilityService.messageListUpdated.next(H.LoadedNewer)},error:t=>this.handleErrors(t)})}markAsRead(){this.channelService.markChannelAsRead(this.channel.id).subscribe({error:e=>this.handleErrors(e)})}updateLastReadMessage(){let e=this.channel.messages.find(i=>i.id===this.getNewestMessageId());!e||this.channel.lastMessageReadDate&&this.channel.lastMessageReadDate===e.dateCreated||this.lastMessageToReadIdSent!==e.id&&(this.lastMessageToReadIdSent=e.id,this.channelService.updateLastReadMessage(this.channel.id,e.id).subscribe())}onNewMessageReceived(e){this.channel.id!==e.channelId||this.channel.messages.find(i=>i.id===e.messageId)||this.channelService.getMessages(e.channelId,this.getNewestMessageId()).subscribe(i=>{this.updateMessageList(i),this.updateLastReadMessage()})}onMessageUpdated(e){this.channel.id===e.channelId&&this.channelService.getMessageById(e.channelId,e.messageId).subscribe(t=>{let i=this.channel.messages.find(d=>d.id===t.id);i&&(this.utilityService.mapMessage(i,t),this.utilityService.messageUpdated.next(i))})}onMessageRead(e){this.channel.id===e.channelId&&(this.channel.lastMessageReadDate=e.lastMessageReadDate)}onChannelsAllRead(e){this.channel.lastMessageReadDate=e.lastMessageReadDate}onChannelLeft(e){e.channelId===this.channel.id&&this.channel.totalMembers--}onChannelJoined(e){e.channelId===this.channel.id&&this.channel.totalMembers++}onTyping(){this.channelService.typingMessage(this.channel.id).subscribe({error:e=>{this.handleErrors(e)}})}onMessageSubmit(e){let t=e.sendMessageModel;t.uiIdentifier=Qe(),t.newestMessageId=this.getNewestMessageId();let i={text:t.text,dateCreated:new Date().toISOString(),sending:!0,userId:this.currentUser.id,displayName:this.currentUser.displayName,avatarColor:this.currentUser.avatarColor,avatarUrl:this.currentUser.avatarUrl,avatarThumbUrl:this.currentUser.avatarThumbUrl,uiIdentifier:t.uiIdentifier,replyingToMessage:e.replyingToMessage,initials:this.currentUser.initials,messageType:De.Regular,userBadge:this.currentUser.userBadge,showPremiumTick:this.currentUser.showPremiumTick,lastActive:this.currentUser.lastActive,isAdmin:this.channel.currentUserRole===et.Admin,isModerator:this.channel.currentUserRole===et.Moderator,tenorGifUrl:t.tenorGifUrl,giphyResourceId:null,giphyResourceType:null,attachments:t.files.map(d=>{let M=URL.createObjectURL(d);return{thumbUrl:M,url:M,originalFileName:d.name,file:d,isAudioOnly:this.utilityService.isAudioFileType(d)}}),reactions:[]};this.channel.messages.push(i),this.utilityService.messageListUpdated.next(H.MessageSent),this.sendMessage(t)}onRetrySending(e){e.failed=!1,e.sending=!0,e.dateCreated=new Date().toISOString();let t={files:e.attachments.map(i=>i.file),uiIdentifier:e.uiIdentifier,newestMessageId:this.getNewestMessageId(),text:e.text,replyingToMessageId:e.replyingToMessage?.id??null};this.sendMessage(t)}sendMessage(e){let t=this.channelService.sendMessage(this.channel.id,e);this.messagesSendingQueue.push(t)}onReactToMessage(e){this.channelService.reactToMessage(this.channel.id,e.message.id,e.emoji.native||"").subscribe({next:t=>{if(t===null){let i=e.message.reactions.find(d=>d.userId===this.currentUser.id&&d.reactionCharCode===e.emoji.native);i&&e.message.reactions.splice(e.message.reactions.indexOf(i),1)}else e.message.reactions.push(t);e.message.reactions=[...e.message.reactions]},error:t=>this.handleErrors(t)})}onEditMessage(e){let t={text:e.text??"",tokens:e.tokens};this.channelService.editMessage(this.channel.id,e.id,t).subscribe({error:i=>this.handleErrors(i)})}onToggleThreadUser(e){(e.isThreadUser?this.channelService.removeThreadUser(this.channel.id,e.message.id):this.channelService.addThreadUser(this.channel.id,e.message.id)).subscribe({error:i=>this.handleErrors(i)})}onDeleteMessage(e){this.channelService.deleteMessage(this.channel.id,e.id).subscribe({error:t=>this.handleErrors(t)})}onReloadConversation(e){this.channelService.markChannelAsRead(e).subscribe({next:()=>{this.loadChannel(e,!0)},error:t=>this.handleErrors(t)})}onLoadReferencedMessage(e){this.channelService.getMessagesForMessageContext(this.channel.id,e).subscribe({next:t=>{this.channel.messages=t,this.loadedAllOlderMessages=this.channel.totalMessages===this.channel.messages.length,this.loadedAllNewerMessages=this.channel.messages.length>0?this.channel.messages[this.channel.messages.length-1].id===this.channel.latestMessageId:!0,this.utilityService.conversationMessagesReloaded.next(e)},error:t=>this.handleErrors(t)})}onMessageBookmarked(e){if(this.processingBookmarksIds.find(d=>d===e.id))return;this.processingBookmarksIds.push(e.id);let t=e.isBookmarked,i=e.isBookmarked?this.channelService.removeBookmark(this.channel.id,e.id):this.channelService.addBookmark(this.channel.id,e.id);e.isBookmarked=!e.isBookmarked,i.subscribe({next:()=>this.processingBookmarksIds.splice(this.processingBookmarksIds.indexOf(e.id),1),error:d=>{this.processingBookmarksIds.splice(this.processingBookmarksIds.indexOf(e.id),1),e.isBookmarked=t,this.handleErrors(d)}})}groupDeletedMessages(){if(this.channel.messages.length<1)return;let e=null;for(let t=1;t<this.channel.messages.length;t++){let i=this.channel.messages[t],d=this.channel.messages[t-1];if(!i.isDeleted||!d.isDeleted){e=null;continue}i.collapsedIntoPrevious=!0,e!==null?(e.collapsedMessagesCount+=1,e.text=`Deleted messages (${e.collapsedMessagesCount+1})`):(d.collapsedMessagesCount=1,d.text=`Deleted messages (${d.collapsedMessagesCount+1})`,e=d)}}onChannelUserUpdated(e){e.userId!==this.currentUser.id||e.channelId!==this.channel.id||(this.channel.isMuted=e.isMuted,e.userIdMakingTheChange!==this.currentUser.id&&(this.channel.readOnly=e.readOnly,this.channel.currentUserRole=e.role))}onChannelUpdated(e){e.id===this.channel.id&&(this.channel.name=e.name,this.channel.description=e.description,this.channel.isPrivate=e.isPrivate,this.channel.type=e.type,this.channel.rules=e.rules,e.archived&&(this.toastService.info({message:"This channel just got archived."}),this.router.navigate(["/conversations"])))}onChannelThreadUserAdded(e){if(e.conversationId!==this.channel.id)return;let t=this.channel.messages.find(i=>i.id===e.threadStartMessageId);!t||t.threadUsers.find(i=>i.user.id===e.threadUser.user.id)||t.threadUsers.push(e.threadUser)}onChannelThreadUserRemoved(e){if(e.conversationId!==this.channel.id)return;let t=this.channel.messages.find(d=>d.id===e.threadStartMessageId);if(!t)return;let i=t.threadUsers.findIndex(d=>d.user.id===e.userId);i<0||t.threadUsers.splice(i,1)}onChannelMessageBookmarkStateUpdated(e){if(this.channel.id!==e.channelId)return;let t=this.channel.messages.find(i=>i.id===e.messageId);t&&(t.isBookmarked=!e.isRemoved)}updateMessageList(e){for(let t of e){if(this.channel.messages.find(M=>M.id===t.id)||t.threadStartMessageId)continue;if(t.uiIdentifier){let M=this.channel.messages.find(x=>x.uiIdentifier===t.uiIdentifier);if(M){Object.assign(M,t),M.sending=!1,M.failed=!1,this.utilityService.messageUpdated.next(M);continue}}let d=this.channel.messages.find(M=>M.dateCreated>t.dateCreated);d?this.channel.messages.splice(this.channel.messages.indexOf(d),0,t):this.channel.messages.push(t),this.utilityService.messageListUpdated.next(H.MessageReceived)}}getNewestMessageId(){let e=this.channel?.messages.filter(t=>!!t.id);return e&&e.length===0?null:e[e.length-1].id}handleErrors(e){this.loadingOlderMessages=!1,this.loadingNewerMessages=!1,this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(X),C(B),C(ce),C(G),C(N),C(te),C(pt),C(Ue))},o.\u0275cmp=k({type:o,selectors:[["ss-channel"]],inputs:{roomChannelId:"roomChannelId"},outputs:{closeRoomChatClicked:"closeRoomChatClicked"},standalone:!1,decls:4,vars:4,consts:[[3,"channel"],[1,"room-header"],[1,"loading-placeholder"],[3,"beginningMessage","conversationType","conversationId","messages","readOnly","firstUnreadMessageId","loadingOlderMessages","loadingNewerMessages","loadedAllOlderMessages","loadedAllNewerMessages","lastReadMessageDateRead","initialUnreadMessagesCount","deleteOtherUserMessages","channelType","isRoomChannel"],[1,"name-wrapper"],["color","accent-blue-40","iconName","chat_multiple",3,"size"],["role","button","iconName","dismiss","color","default-20",3,"click","size","iconVariant"],[3,"loadMoreOlder","loadMoreNewer","typing","messageSubmit","editMessage","toggleThreadUser","deleteMessage","bookmarkMessage","reactToMessage","retrySending","reloadConversation","loadReferencedMessage","beginningMessage","conversationType","conversationId","messages","readOnly","firstUnreadMessageId","loadingOlderMessages","loadingNewerMessages","loadedAllOlderMessages","loadedAllNewerMessages","lastReadMessageDateRead","initialUnreadMessagesCount","deleteOtherUserMessages","channelType","isRoomChannel"]],template:function(t,i){t&1&&(g(0,za,1,1,"ss-channel-header",0),g(1,Fa,6,3,"div",1),g(2,ja,1,0,"div",2),g(3,Ha,1,16,"ss-message-list",3)),t&2&&(p(i.channel.id&&!i.roomChannelId?0:-1),a(),p(i.roomChannelId?1:-1),a(),p(i.channel.id?-1:2),a(),p(i.channel.id?3:-1))},dependencies:[D,Ot,Ci],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}.page-content-wrapper[_ngcontent-%COMP%]{height:calc(100vh - 56px)}@media only screen and (max-width: 1024px){.page-content-wrapper[_ngcontent-%COMP%]{height:100%}}.page-content[_ngcontent-%COMP%]{max-width:1340px;width:100%;padding:50px 70px;margin:0 auto}@media only screen and (max-width: 1024px){.page-content[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]{position:relative;width:100%;height:100%;border-radius:20px}.loading-placeholder[_ngcontent-%COMP%]{height:100%;background:var(--alt-60)}.room-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:40px;border-bottom:1px solid var(--alt);border-top-left-radius:16px;border-top-right-radius:16px;background:var(--grayscale)}.room-header[_ngcontent-%COMP%]   .name-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.room-header[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin:10px}"]});let s=o;return s})();function Wa(s,o){if(s&1){let n=b();l(0,"ss-icon",9),_("click",function(){h(n);let t=r(2);return m(t.backToMessageList.emit())}),c()}s&2&&u("size",24)}function Qa(s,o){s&1&&v(0,"ss-premium-tick")}function $a(s,o){if(s&1&&v(0,"ss-badge",7),s&2){let n=r(2);u("badge",n.userInfo.userBadge)}}function Ja(s,o){if(s&1){let n=b();l(0,"ss-user-popup",10),_("closePopup",function(){h(n);let t=r(2);return m(t.togglePopup())}),c()}if(s&2){let n=r(2);u("userId",n.userInfo.id)("openedFromSource",n.OpenedFromSourceRef.DirectMessage)}}function Ka(s,o){if(s&1){let n=b();l(0,"div",2,0),g(2,Wa,1,1,"ss-icon",4),l(3,"ss-user-avatar",5),_("click",function(){h(n);let t=r();return m(t.onAvatarClick())}),c(),g(4,Qa,1,0,"ss-premium-tick"),l(5,"div",6),T(6,"emoji"),_("click",function(){h(n);let t=r();return m(t.onAvatarClick())}),c(),g(7,$a,1,1,"ss-badge",7),Ge(8,Ja,1,2,"ng-template",8),_("backdropClick",function(){h(n);let t=r();return m(t.togglePopup())}),c()}if(s&2){let n=Ce(1),e=r();a(2),p(e.isDmTray?2:-1),a(),u("size",40)("avatarColor",e.getChatAvatarColor())("avatarThumbUrl",e.getChatAvatarUrl())("initials",e.getChatInitials())("users",e.chat.chatUsers)("isGroup",e.chat.isGroup)("lastOnline",e.getChatLastActive())("showOnlineStatus",!e.chat.readOnly)("isChatAvatar",!!e.chat.avatarThumbUrl)("userId",e.chat.isGroup?null:e.getOtherUsers()[0].userId),a(),p(!e.settingsService.isB2BApp()&&e.userInfo&&e.userInfo.showPremiumTick?4:-1),a(),u("innerHTML",L(6,18,e.getChatTitle()),ke),a(2),p(e.userInfo&&e.userInfo.userBadge?7:-1),a(),u("cdkConnectedOverlayOrigin",n)("cdkConnectedOverlayOpen",e.popupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0)}}function Ya(s,o){if(s&1){let n=b();l(0,"button",12),_("click",function(){h(n);let t=r(2);return m(t.onInfoClicked())}),v(1,"ss-icon",18),l(2,"span"),f(3,"Group Info"),c()()}s&2&&(a(),u("size",24))}function Za(s,o){if(s&1){let n=b();l(0,"button",12),_("click",function(){h(n);let t=r(2);return m(t.addParticipant())}),v(1,"ss-icon",19),l(2,"span"),f(3,"Add Participant"),c()()}s&2&&(a(),u("size",24))}function Xa(s,o){if(s&1){let n=b();l(0,"button",12),_("click",function(){h(n);let t=r(2);return m(t.openConfirmDeletionModal())}),v(1,"ss-icon",20),l(2,"span"),f(3,"Delete Chat"),c()()}s&2&&(a(),u("size",24))}function er(s,o){if(s&1){let n=b();l(0,"button",12),_("click",function(){h(n);let t=r(2);return m(t.leaveGroup())}),v(1,"ss-icon",21),l(2,"span"),f(3),c()()}if(s&2){let n=r(2);a(),u("size",24),a(2),P("Leave ",n.chat.isGroup?"Group":"Chat")}}function tr(s,o){if(s&1){let n=b();l(0,"button",22),_("click",function(){h(n);let t=r(2);return m(t.reportUser())}),v(1,"ss-icon",23),l(2,"span"),f(3,"Report User"),c()()}if(s&2){let n=r(2);V("not-active",n.optionsDisabled),u("matTooltip",di(n.disableOptionsTooltip)),a(),u("size",24)}}function ir(s,o){s&1&&v(0,"ss-info-tooltip",25),s&2&&u("isSmall",!0)}function nr(s,o){if(s&1){let n=b();l(0,"button",22),_("click",function(){h(n);let t=r(2);return m(t.toggleBlock())}),v(1,"ss-icon",24),l(2,"span"),f(3),c(),g(4,ir,1,1,"ss-info-tooltip",25),c()}if(s&2){let n=r(2);V("not-active",n.optionsDisabled),u("matTooltip",di(n.disableOptionsTooltip)),a(),u("size",24),a(2),P("",n.chat.readOnly?"Unblock":"Block"," User"),a(),p(!n.chat.readOnly&&!n.optionsDisabled?4:-1)}}function sr(s,o){if(s&1){let n=b();l(0,"div",3)(1,"ss-icon",11),_("menuOpened",function(){h(n);let t=r();return m(t.onMenuOpened())}),c(),l(2,"mat-menu",null,1)(4,"button",12),_("click",function(){h(n);let t=r();return m(t.onSharedFilesClicked())}),v(5,"ss-icon",13),l(6,"span"),f(7,"Shared Files"),c()(),g(8,Ya,4,1,"button",14),g(9,Za,4,1,"button",14),l(10,"button",12),_("click",function(){h(n);let t=r();return m(t.toggleMutedState())}),v(11,"ss-icon",15),l(12,"span"),f(13),c()(),l(14,"button",12),_("click",function(){h(n);let t=r();return m(t.toggleArchivedState())}),v(15,"ss-icon",16),l(16,"span"),f(17),c()(),g(18,Xa,4,1,"button",14),g(19,er,4,2,"button",14),g(20,tr,4,5,"button",17),g(21,nr,5,7,"button",17),c()()}if(s&2){let n=Ce(3),e=r();a(),u("size",24)("matMenuTriggerFor",n),a(4),u("size",24),a(3),p(e.chat.isGroup?8:-1),a(),p(e.chat.isGroup&&e.isAdmin(e.currentUserId)?9:-1),a(2),u("iconName",e.chat.isMuted?"mic":"mic_off")("size",24),a(2),me("",e.chat.isMuted?"Unmute":"Mute"," ",e.chat.isGroup?"Group":"Chat"),a(2),u("size",24),a(2),P("",e.chat.archived?"Unarchive":"Archive"," Chat"),a(),p(e.chat.isGroup?-1:18),a(),p(e.chat.isGroup?19:-1),a(),p(e.chat.isGroup?-1:20),a(),p(!e.chat.isGroup&&!e.userInfo.blockedMe?21:-1)}}var Ii=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A,R){this.utilityService=e,this.settingsService=t,this.accountService=i,this.chatService=d,this.userService=M,this.dialog=x,this.router=E,this.toastService=A,this.signalRService=R,this.isDmTray=!1,this.backToMessageList=new I,this.closeDmTray=new I,this.addParticipantDmTray=new I,this.popupOpened=!1,this.optionsDisabled=!1,this.disableOptionsTooltip="",this.OpenedFromSourceRef=gt}ngOnInit(){if(this.currentUserId=this.accountService.currentUser.id||"",this.chat.isGroup)return;let e=this.chat.chatUsers.filter(t=>t.userId!==this.currentUserId)[0];this.userInfo={avatarColor:e.avatarColor,avatarUrl:e.avatarUrl,avatarThumbUrl:e.avatarThumbUrl,displayName:e.displayName,firstName:e.displayName,initials:e.initials,id:e.userId,followsMe:e.followsMe,following:e.following,blocked:e.blocked,blockedMe:e.blockedMe,userBadge:e.userBadge,showPremiumTick:e.showPremiumTick},this.userBlockedSubscription=this.signalRService.userBlocked.subscribe(t=>this.onUserBlocked(t)),this.userUnblockedSubscription=this.signalRService.userUnblocked.subscribe(t=>this.onUserUnblocked(t)),this.chatService.reportUser.next(this.userInfo)}ngOnDestroy(){this.userBlockedSubscription?.unsubscribe(),this.userUnblockedSubscription?.unsubscribe()}getChatTitle(){if(this.chat.isGroup)return this.chat.name||`${this.chat.chatUsers.map(e=>e.displayName).join(", ")}`;{let e=this.accountService.currentUser.id;return this.chat.chatUsers.filter(t=>t.userId!==e)[0].displayName}}getChatAvatarUrl(){if(this.chat.avatarThumbUrl)return this.chat.avatarThumbUrl;if(this.chat.isGroup)return null;let e=this.getOtherUsers();return e.length===1?e[0]?.avatarThumbUrl:null}getChatAvatarColor(){let e=this.getOtherUsers();return e.length===1?e[0]?.avatarColor:this.chat.avatarColor}getChatLastActive(){let e=this.getOtherUsers();return e.length===1?e[0]?.lastActive:null}getChatInitials(){return this.getOtherUsers()[0]?.initials}onInfoClicked(){this.closeIfDmTray(),this.router.navigate([`/conversations/chats/${this.chat.id}`],{queryParams:{sidePanel:pe.ChatInfo}})}onSharedFilesClicked(){this.closeIfDmTray(),this.router.navigate([`/conversations/chats/${this.chat.id}`],{queryParams:{sidePanel:pe.SharedFiles}})}onMenuOpened(){this.userInfo&&this.userService.getUserProfileShort(this.userInfo.id).subscribe({error:()=>{this.optionsDisabled=!0,this.disableOptionsTooltip="This user is currently not active so you can't perform this action."}})}addParticipant(){if(this.isDmTray){this.addParticipantDmTray.emit();return}this.router.navigate([`/conversations/chats/${this.chat.id}`],{queryParams:{sidePanel:pe.ChatManageGroupUsers}})}leaveGroup(){this.dialog.open(re,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"LeaveGroup",confirmButtonLabel:"Leave Group"}}).afterClosed().subscribe(t=>{t&&this.chatService.leaveChat(this.chat.id).subscribe({next:()=>this.goBackIfDmTray(),error:i=>this.handleErrors(i)})})}onAvatarClick(){this.chat.isGroup?this.onInfoClicked():this.togglePopup()}togglePopup(){this.popupOpened=!this.popupOpened,this.popupOpened&&this.userInfo.id&&!this.userInfo.firstName&&this.userService.getUserProfileShort(this.userInfo.id).subscribe(e=>{this.userInfo=e})}getOtherUsers(){let e=this.accountService.currentUser.id;return this.chat.chatUsers.filter(t=>t.userId!==e)}reportUser(){this.optionsDisabled||this.dialog.open(Ye,{panelClass:"fullscreen-dialog",width:"480px",disableClose:!0,data:{reportedUser:this.userInfo,roomName:null,reportSource:_t.DirectMessage,elementToScreenshotSelector:"ss-dashboard"}})}openConfirmDeletionModal(){this.utilityService.openConfirmDeletionModal(()=>{this.chatService.markChatAsDeletedForUser(this.chat.id).subscribe({next:()=>this.goBackIfDmTray(),error:e=>this.handleErrors(e)})})}toggleMutedState(){this.chatService.toggleMutedState(this.chat.id).subscribe({error:e=>this.handleErrors(e)})}toggleArchivedState(){this.chatService.toggleArchivedState(this.chat.id).subscribe({next:()=>this.goBackIfDmTray(),error:e=>this.handleErrors(e)})}toggleBlock(){if(this.optionsDisabled)return;this.dialog.open(xe,{panelClass:"fullscreen-dialog",width:"414px",data:{user:this.userInfo}}).afterClosed().subscribe(t=>{this.chat.readOnly=t})}isAdmin(e){return!!this.chat.chatUsers.find(t=>t.userId===e)?.isAdmin}onUserBlocked(e){this.currentUserId===e.userBlockingId&&this.userInfo.id===e.blockedUserId?(this.userInfo.following=!1,this.userInfo.followsMe=!1,this.userInfo.blocked=!0):this.currentUserId===e.blockedUserId&&this.userInfo.id===e.userBlockingId&&(this.userInfo.following=!1,this.userInfo.followsMe=!1,this.userInfo.blockedMe=!0)}onUserUnblocked(e){this.currentUserId===e.userUnblockingId&&this.userInfo.id===e.unblockedUserId?this.userInfo.blocked=!1:this.currentUserId===e.unblockedUserId&&this.userInfo.id===e.userUnblockingId&&(this.userInfo.blockedMe=!1)}goBackIfDmTray(){this.isDmTray&&this.backToMessageList.emit()}closeIfDmTray(){this.isDmTray&&this.closeDmTray.emit()}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(X),C(Le),C(B),C(se),C(Ae),C(Z),C(te),C(N),C(G))},o.\u0275cmp=k({type:o,selectors:[["ss-chat-header"]],hostVars:2,hostBindings:function(t,i){t&2&&V("dm-tray-format",i.isDmTray)},inputs:{chat:"chat",isDmTray:"isDmTray"},outputs:{backToMessageList:"backToMessageList",closeDmTray:"closeDmTray",addParticipantDmTray:"addParticipantDmTray"},standalone:!1,decls:2,vars:2,consts:[["trigger","cdkOverlayOrigin"],["chatHeaderMenu","matMenu"],["cdkOverlayOrigin","",1,"user"],[1,"action-wrapper"],["role","button","iconName","chevron_left","color","default-60",1,"back-button",3,"size"],["role","button",3,"click","size","avatarColor","avatarThumbUrl","initials","users","isGroup","lastOnline","showOnlineStatus","isChatAvatar","userId"],["role","button",1,"name","interactable-bold",3,"click","innerHTML"],[3,"badge"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],["role","button","iconName","chevron_left","color","default-60",1,"back-button",3,"click","size"],["cssClass","margin-horizontal",3,"closePopup","userId","openedFromSource"],["role","button","iconName","more_vertical","color","default-60",3,"menuOpened","size","matMenuTriggerFor"],["mat-menu-item","",3,"click"],["iconName","document",3,"size"],["mat-menu-item",""],[3,"iconName","size"],["iconName","archive",3,"size"],["mat-menu-item","","matTooltipPosition","right",3,"not-active","matTooltip"],["iconName","info",3,"size"],["iconName","person_add",3,"size"],["iconName","delete",3,"size"],["iconName","sign_out",3,"size"],["mat-menu-item","","matTooltipPosition","right",3,"click","matTooltip"],["iconName","shield_error",3,"size"],["iconName","dismiss_square",3,"size"],["matTooltip","This user will not be notified that you have blocked them. They won't be able to message or search for you. Note: Group chats or channels with this user will remain as normal.",3,"isSmall"]],template:function(t,i){t&1&&(g(0,Ka,9,20,"div",2),g(1,sr,22,15,"div",3)),t&2&&(p(i.chat.chatUsers.length?0:-1),a(),p(i.chat.chatUsers.length?1:-1))},dependencies:[Je,$e,Ke,ie,mt,ht,D,le,Ft,ft,Ct,vt,Mt],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:space-between;align-items:center;min-height:73px;padding:14px 33px 14px 20px;box-shadow:var(--elevation-s1-bottom-only);background:var(--alt-60)}.is-channel[_nghost-%COMP%]{padding-left:30px;background:var(--accent-gradient-90)}.is-channel[_nghost-%COMP%]   .user[_ngcontent-%COMP%]{display:none}.is-channel[_nghost-%COMP%]   .channel[_ngcontent-%COMP%]{display:block}.dm-tray-format[_nghost-%COMP%]{padding:14px 20px;border-top-left-radius:16px;border-top-right-radius:16px}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{padding:10px}}.user[_ngcontent-%COMP%]{display:flex;align-items:center}.user[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{margin-right:16px}.user[_ngcontent-%COMP%]   ss-badge[_ngcontent-%COMP%]{margin-left:3px}.user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{display:-webkit-box;overflow:hidden;word-break:break-word;text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}.user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]:hover{text-decoration:underline}.back-button[_ngcontent-%COMP%]{margin-right:5px}.user-list-wrapper[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;z-index:1;width:100%;background:#fff}.channel[_ngcontent-%COMP%]{display:none}.channel[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{color:var(--default)}ss-info-tooltip[_ngcontent-%COMP%]{margin-left:8px}button.not-active[_ngcontent-%COMP%]{cursor:not-allowed;opacity:.3}"]});let s=o;return s})();function rr(s,o){s&1&&v(0,"ss-premium-tick")}function lr(s,o){if(s&1&&(l(0,"small",5),f(1),c()),s&2){let n=r();a(),U(n.chatListItem.name)}}function cr(s,o){if(s&1&&(v(0,"small",6),T(1,"emoji")),s&2){let n=r();u("innerHTML",L(1,1,n.getUserNames()),ke)}}function dr(s,o){if(s&1&&v(0,"ss-badge",7),s&2){let n=r();u("badge",n.chatListItem.userBadge)}}function hr(s,o){if(s&1&&(l(0,"div",17),f(1),c()),s&2){let n=r();V("short",n.chatListItem.unreadMessages===0&&n.chatListItem.markedAsUnread)("long",n.chatListItem.unreadMessages>99),a(),P(" ",n.chatListItem.unreadMessages>0?n.chatListItem.unreadMessages>99?"99+":n.chatListItem.unreadMessages:""," ")}}function mr(s,o){if(s&1&&(l(0,"div",10),v(1,"div",18),l(2,"div",19),f(3),c()()),s&2){let n=r();a(3),U(n.getDateDisplay())}}function gr(s,o){s&1&&(l(0,"small",13),f(1),T(2,"translate"),c()),s&2&&(a(),P(" ",L(2,1,"pages.chat.chatList.isTyping")," "))}function pr(s,o){s&1&&v(0,"ss-icon",22)}function ur(s,o){s&1&&v(0,"ss-icon",23),s&2&&u("size",16)}function Cr(s,o){if(s&1&&(l(0,"small",20),g(1,pr,1,0,"ss-icon",22),g(2,ur,1,1,"ss-icon",23),v(3,"span",24),T(4,"lineEndings"),T(5,"emoji"),c()),s&2){let n=r(2);a(),p(!n.chatListItem.isMuted&&n.chatListItem.totalMessages>0&&!n.chatListItem.lastMessageText?1:-1),a(),p(n.chatListItem.isMuted?2:-1),a(),u("innerHTML",L(5,5,L(4,3,n.getMessagePreviewText())),ke)}}function _r(s,o){s&1&&(l(0,"small",21),v(1,"ss-icon",25),f(2),T(3,"translate"),c()),s&2&&(a(2),P(" ",L(3,1,"pages.chat.chatList.draft")," "))}function fr(s,o){if(s&1&&(g(0,Cr,6,7,"small",20),g(1,_r,4,3,"small",21)),s&2){let n=r();p(!n.draftMessage||n.active&&n.draftMessage?0:-1),a(),p(n.draftMessage&&!n.active?1:-1)}}function vr(s,o){if(s&1){let n=b();l(0,"ss-icon",26),_("click",function(t){return h(n),m(t.stopPropagation())})("menuOpened",function(){h(n);let t=r();return m(t.menuOpened=!0)})("menuClosed",function(){h(n);let t=r();return m(t.menuOpened=!1)}),c()}if(s&2){let n=r(),e=Ce(20);V("visible",n.menuOpened),u("matMenuTriggerFor",e)("color",n.chatListItem.isMuted?"default-60":"default-40")("size",19)}}function Mr(s,o){if(s&1){let n=b();l(0,"div",16),_("click",function(){h(n);let t=r();return m(t.markAsRead())}),f(1," Mark as read "),c()}}function xr(s,o){if(s&1){let n=b();l(0,"div",16),_("click",function(){h(n);let t=r();return m(t.markAsUnread())}),f(1," Mark as unread "),c()}}function br(s,o){if(s&1){let n=b();l(0,"div",16),_("click",function(){h(n);let t=r();return m(t.leaveGroup())}),f(1," Leave Group "),c()}}function wr(s,o){if(s&1){let n=b();l(0,"div",16),_("click",function(){h(n);let t=r();return m(t.openConfirmDeletionModal())}),f(1," Delete Chat "),c()}}function yr(s,o){if(s&1){let n=b();l(0,"div",16),_("click",function(){h(n);let t=r();return m(t.reportUser())}),f(1," Report User "),c()}}function Sr(s,o){s&1&&v(0,"ss-info-tooltip",27),s&2&&u("isSmall",!0)}function Ir(s,o){if(s&1){let n=b();l(0,"div",16),_("click",function(){h(n);let t=r();return m(t.toggleBlock())}),f(1),g(2,Sr,1,1,"ss-info-tooltip",27),c()}if(s&2){let n=r();a(),P(" ",n.chatListItem.readOnly?"Unblock":"Block"," User "),a(),p(n.chatListItem.readOnly?-1:2)}}var Oi=(()=>{let o=class o{get hasUnread(){return this.chatListItem&&(this.chatListItem.unreadMessages>0||this.chatListItem.markedAsUnread)}get muted(){return this.chatListItem.isMuted}constructor(e,t,i,d,M,x,E,A,R){this.chatService=e,this.settingsService=t,this.accountService=i,this.utilityService=d,this.signalRService=M,this.toastService=x,this.messageTextService=E,this.datePipe=A,this.dialog=R,this.messageRequestChatIds=[],this.isMessageRequest=!1,this.active=!1,this.collapsed=!1,this.menuOpened=!1,this.isSomeoneTyping=!1,this.subscriptions=[]}ngOnInit(){this.draftMessage=this.utilityService.getDraft(this.chatListItem.id),this.subscriptions.push(this.utilityService.draftsUpdated.subscribe(()=>{this.draftMessage=this.utilityService.getDraft(this.chatListItem.id)}),this.utilityService.typingUsers.subscribe(e=>{this.isSomeoneTyping=e.filter(t=>t.chatId===this.chatListItem.id).length>0}),this.utilityService.messageUpdated.subscribe(e=>{e.dateCreated===this.chatListItem.lastMessageDate&&(this.chatListItem.lastMessageText=this.messageTextService.stripAllHtmlTags(e.text))}),this.chatService.reportUser.subscribe(e=>{this.userInfo=e}),this.signalRService.chatJoined.subscribe(e=>this.onChatJoined(e)),this.signalRService.chatLeft.subscribe(e=>this.onChatLeft(e)),this.signalRService.chatUpdated.subscribe(e=>this.onChatUpdated(e)),this.signalRService.chatMessagesRead.subscribe(e=>this.onChatMessagesRead(e)),this.signalRService.userBlocked.subscribe(e=>this.onUserBlocked(e)),this.signalRService.userUnblocked.subscribe(e=>this.onUserUnblocked(e)))}ngOnChanges(e){e.chatListItem&&this.chatListItem.lastMessageText&&(this.chatListItem.lastMessageText=this.messageTextService.stripAllHtmlTags(this.chatListItem.lastMessageText))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}getDateDisplay(){return this.isToday(this.chatListItem.lastMessageDate)?this.datePipe.transform(this.chatListItem.lastMessageDate,"hh:mm a"):this.datePipe.transform(this.chatListItem.lastMessageDate,"dd/MM")}getChatListItemAvatarUrl(){if(this.chatListItem.avatarThumbUrl)return this.chatListItem.avatarThumbUrl;if(this.chatListItem.isGroup)return null;let e=this.getOtherUsers();return e.length===1?e[0]?.avatarThumbUrl:null}getChatListItemAvatarColor(){let e=this.getOtherUsers();return e.length===1?e[0]?.avatarColor:this.chatListItem.avatarColor}getChatListItemInitials(){return this.getOtherUsers()[0]?.initials}getOtherUsers(){let e=this.accountService.currentUser.id;return this.chatListItem.users.filter(t=>t.id!==e)}getUserNames(){return this.getOtherUsers().map(e=>e.displayName).join(", ")}markAsRead(){this.chatService.markChatAsRead(this.chatListItem.id).subscribe({next:()=>{this.chatListItem.unreadMessages=0,this.chatListItem.markedAsUnread=!1},error:e=>this.handleErrors(e)})}markAsUnread(){this.chatService.markChatAsUnread(this.chatListItem.id).subscribe({next:()=>{this.chatListItem.markedAsUnread=!0},error:e=>this.handleErrors(e)})}toggleMutedState(){this.chatService.toggleMutedState(this.chatListItem.id).subscribe({error:e=>this.handleErrors(e)})}toggleArchivedState(){this.chatService.toggleArchivedState(this.chatListItem.id).subscribe({error:e=>this.handleErrors(e)})}reportUser(){this.dialog.open(Ye,{panelClass:"fullscreen-dialog",width:"480px",disableClose:!0,data:{reportedUser:this.userInfo,roomName:null,reportSource:_t.DirectMessage,elementToScreenshotSelector:"ss-dashboard"}})}toggleBlock(){this.dialog.open(xe,{panelClass:"fullscreen-dialog",width:"414px",data:{user:this.userInfo}}).afterClosed().subscribe(t=>{this.chatListItem.readOnly=t})}openConfirmDeletionModal(){this.utilityService.openConfirmDeletionModal(()=>{this.chatService.markChatAsDeletedForUser(this.chatListItem.id).subscribe({error:e=>this.handleErrors(e)})})}leaveGroup(){this.dialog.open(re,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"LeaveGroup",confirmButtonLabel:"Leave Group"}}).afterClosed().subscribe(t=>{t&&this.chatService.leaveChat(this.chatListItem.id).subscribe({error:i=>this.handleErrors(i)})})}getMessagePreviewText(){return this.chatListItem.isMuted?"Muted conversation":this.chatListItem.lastMessageText?this.chatListItem.lastMessageText:this.chatListItem.totalMessages===0?"No Messages":"Attachment Message"}isMessageRequestUnread(){return!!this.messageRequestChatIds?.find(t=>t===this.chatListItem.id)}onChatJoined(e){if(e.chatId===this.chatListItem.id)for(let t of e.usersJoining)this.chatListItem.users.find(d=>d.id===t.userId)||this.chatListItem.users.push({id:t.id,userId:t.userId,avatarColor:t.avatarColor,avatarUrl:t.avatarUrl,avatarThumbUrl:t.avatarThumbUrl,initials:t.initials,firstName:t.firstName,fullName:t.fullName,displayName:t.displayName})}onChatLeft(e){if(e.chatId!==this.chatListItem.id)return;let t=this.chatListItem.users.find(i=>i.userId===e.userLeavingId);t&&this.chatListItem.users.splice(this.chatListItem.users.indexOf(t),1)}onChatUpdated(e){this.chatListItem.id===e.id&&(this.chatListItem.name=e.name,this.chatListItem.description=e.description,this.chatListItem.avatarUrl=e.avatarUrl,this.chatListItem.avatarThumbUrl=e.avatarThumbUrl)}onChatMessagesRead(e){this.chatListItem.id===e.chatId&&(this.chatListItem.markedAsUnread=!1)}onUserBlocked(e){this.chatListItem.isGroup||(this.getOtherUsers()[0].id===e.userBlockingId||this.getOtherUsers()[0].id===e.blockedUserId)&&(this.chatListItem.readOnly=!0)}onUserUnblocked(e){this.chatListItem.isGroup||(this.getOtherUsers()[0].id===e.userUnblockingId||this.getOtherUsers()[0].id===e.unblockedUserId)&&(this.chatListItem.readOnly=!1)}isToday(e){let t=new Date,i=new Date(e);return i.getDate()===t.getDate()&&i.getMonth()===t.getMonth()&&i.getFullYear()===t.getFullYear()}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(se),C(Le),C(B),C(X),C(G),C(N),C(vn),C(ge),C(Z))},o.\u0275cmp=k({type:o,selectors:[["ss-chat-list-item"]],hostVars:10,hostBindings:function(t,i){t&2&&V("active",i.active)("collapsed",i.collapsed)("menu-opened",i.menuOpened)("has-unread",i.hasUnread)("muted",i.muted)},inputs:{chatListItem:"chatListItem",messageRequestChatIds:"messageRequestChatIds",isMessageRequest:"isMessageRequest",active:"active",collapsed:"collapsed"},standalone:!1,features:[Bt([ge]),qe],decls:31,vars:34,consts:[["menu","matMenu"],[3,"size","avatarColor","avatarThumbUrl","initials","users","isGroup","lastOnline","showOnlineStatus","userId","isChatAvatar"],[1,"chat-info"],[1,"top-line"],[1,"user-info"],[1,"name"],[1,"name",3,"innerHTML"],[3,"badge"],["matTooltipPosition","right","matTooltipShowDelay","500",1,"date",3,"matTooltip"],[1,"unread-messages","notification",3,"short","long"],[1,"unread-messages-wrapper"],[1,"bottom-line"],[1,"last-message-block"],[1,"is-typing"],["iconName","chevron_down",1,"action-menu",3,"matMenuTriggerFor","color","size","visible"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"unread-messages","notification"],[1,"unread-messages","message-request"],[1,"notification"],[1,"emoji-container"],[1,"draft"],["iconName","document"],["color","default-80","iconName","speaker_mute",1,"mute-icon",3,"size"],[1,"preview-text",3,"innerHTML"],["iconName","edit"],["iconName","chevron_down",1,"action-menu",3,"click","menuOpened","menuClosed","matMenuTriggerFor","color","size"],["matTooltip","This user will not be notified that you have blocked them. They won't be able to message or search for you. Note: Group chats or channels with this user will remain as normal.",3,"isSmall"]],template:function(t,i){if(t&1){let d=b();v(0,"ss-user-avatar",1),l(1,"div",2)(2,"div",3)(3,"div",4),g(4,rr,1,0,"ss-premium-tick"),g(5,lr,2,1,"small",5),g(6,cr,2,3,"small",6),g(7,dr,1,1,"ss-badge",7),c(),l(8,"small",8),T(9,"date"),T(10,"lowercase"),f(11),c(),g(12,hr,2,5,"div",9),g(13,mr,4,1,"div",10),c(),l(14,"div",11)(15,"div",12),g(16,gr,3,3,"small",13),g(17,fr,2,2),c(),g(18,vr,1,5,"ss-icon",14),l(19,"mat-menu",null,0),g(21,Mr,2,0,"div",15),g(22,xr,2,0,"div",15),l(23,"div",16),_("click",function(){return h(d),m(i.toggleMutedState())}),f(24),c(),l(25,"div",16),_("click",function(){return h(d),m(i.toggleArchivedState())}),f(26),c(),g(27,br,2,0,"div",15),g(28,wr,2,0,"div",15),g(29,yr,2,0,"div",15),g(30,Ir,3,2,"div",15),c()()()}t&2&&(u("size",36)("avatarColor",i.getChatListItemAvatarColor())("avatarThumbUrl",i.getChatListItemAvatarUrl())("initials",i.getChatListItemInitials())("users",i.chatListItem.users)("isGroup",i.chatListItem.isGroup)("lastOnline",i.chatListItem.isGroup?null:i.getOtherUsers()[0].lastActive)("showOnlineStatus",!i.chatListItem.isGroup&&!i.chatListItem.readOnly)("userId",i.chatListItem.isGroup?null:i.getOtherUsers()[0].id)("isChatAvatar",!!i.chatListItem.avatarThumbUrl),a(4),p(!i.settingsService.isB2BApp()&&i.chatListItem.showPremiumTick?4:-1),a(),p(i.chatListItem.name?5:-1),a(),p(i.chatListItem.name?-1:6),a(),p(i.chatListItem.userBadge?7:-1),a(),u("matTooltip",L(10,32,ae(9,29,i.chatListItem.lastMessageDate,"dd/MM/yyyy hh:mm a"))||""),a(3),P(" ",i.getDateDisplay()," "),a(),p((i.chatListItem.unreadMessages>0||i.chatListItem.markedAsUnread)&&!i.isMessageRequest?12:-1),a(),p(i.isMessageRequest&&i.isMessageRequestUnread()?13:-1),a(3),p(i.isSomeoneTyping?16:-1),a(),p(i.isSomeoneTyping?-1:17),a(),p(i.isMessageRequestUnread()?-1:18),a(3),p(i.chatListItem.unreadMessages||i.chatListItem.markedAsUnread?21:-1),a(),p(!i.chatListItem.unreadMessages&&!i.chatListItem.markedAsUnread?22:-1),a(2),P(" ",i.chatListItem.isMuted?"Unmute":"Mute"," Chat "),a(2),P(" ",i.chatListItem.archived?"Unarchive":"Archive"," Chat "),a(),p(i.chatListItem.isGroup?27:-1),a(),p(i.chatListItem.isGroup?-1:28),a(),p(!i.chatListItem.isGroup&&i.userInfo?29:-1),a(),p(!i.chatListItem.isGroup&&i.userInfo&&!i.userInfo.blockedMe?30:-1))},dependencies:[Je,$e,Ke,ie,D,le,Ft,Ct,vt,Nt,ge,Mt,$t,zt],styles:['[_nghost-%COMP%]{position:relative;display:flex;align-items:center;height:50px;padding:0 20px;cursor:pointer}[_nghost-%COMP%]:hover, .menu-opened[_nghost-%COMP%]{background:var(--alt-80)}[_nghost-%COMP%]:hover   .top-line[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%], .menu-opened[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]:hover   .top-line[_ngcontent-%COMP%]   small.date[_ngcontent-%COMP%], .menu-opened[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   small.date[_ngcontent-%COMP%]{display:inline}[_nghost-%COMP%]:hover   .top-line[_ngcontent-%COMP%]   .unread-messages-wrapper[_ngcontent-%COMP%], .menu-opened[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   .unread-messages-wrapper[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]:hover   .bottom-line[_ngcontent-%COMP%], .menu-opened[_nghost-%COMP%]   .bottom-line[_ngcontent-%COMP%]{max-height:20px;opacity:1;transition:max-height .1s linear,opacity .1s linear .05s}.active[_nghost-%COMP%]{background:var(--accent-gradient-90)}.has-unread[_nghost-%COMP%]:hover   .top-line[_ngcontent-%COMP%]   small.date[_ngcontent-%COMP%]{display:inline}.has-unread[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .has-unread[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-weight:500;color:var(--default)}.has-unread[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   small.date[_ngcontent-%COMP%]{display:none}.has-unread[_nghost-%COMP%]   .bottom-line[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default)}.muted[_nghost-%COMP%]:hover   .top-line[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .muted[_nghost-%COMP%]:hover   .top-line[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-60)}.muted[_nghost-%COMP%]:before{background-color:var(--default-80)}.muted.active[_nghost-%COMP%]:before{background-color:var(--accent-blue-20)}.muted.active[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .muted.active[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default)}.muted.active[_nghost-%COMP%]   .bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-20)}.muted.active[_nghost-%COMP%]   .bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]   ss-icon.mute-icon[_ngcontent-%COMP%]{color:var(--default-20)}.muted.active[_nghost-%COMP%]   .bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]   ss-icon.mute-icon[_ngcontent-%COMP%]     i{color:var(--default-20)}.muted.active[_nghost-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{opacity:1}.muted[_nghost-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{opacity:.5}.muted[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .muted[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-80)}.muted[_nghost-%COMP%]   .top-line[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{color:var(--contrast);background-color:var(--default-80)}.muted[_nghost-%COMP%]   .bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-60)}.muted[_nghost-%COMP%]   .bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]   .preview-text[_ngcontent-%COMP%]{margin-top:1px}.collapsed[_nghost-%COMP%]{justify-content:center;padding:0}.collapsed[_nghost-%COMP%]   .chat-info[_ngcontent-%COMP%]{display:none}.collapsed.has-unread[_nghost-%COMP%]:before{content:"";position:absolute;top:18px;left:-6px;min-width:12px;height:12px;border-radius:50%;background-color:var(--accent-blue)}.collapsed.has-unread.muted[_nghost-%COMP%]:before{background-color:var(--default-80)}.chat-info[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;justify-content:center;width:calc(100% - 36px);padding-left:10px}.chat-info[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;width:calc(100% - 41px)}.top-line[_ngcontent-%COMP%], .bottom-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.preview-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.top-line[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{overflow:hidden;font-family:Poppins,sans-serif;text-overflow:ellipsis;white-space:nowrap}.top-line[_ngcontent-%COMP%]   ss-badge[_ngcontent-%COMP%]{margin-left:4px;cursor:pointer}.top-line[_ngcontent-%COMP%]   .unread-messages-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.top-line[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{min-width:16px;height:16px;padding:0 5px;border-radius:88px;text-align:center;color:var(--contrast);background-color:var(--accent-blue)}.top-line[_ngcontent-%COMP%]   .unread-messages.short[_ngcontent-%COMP%]{min-width:15px}.top-line[_ngcontent-%COMP%]   .unread-messages.message-request[_ngcontent-%COMP%]{min-width:8px;height:8px;padding:0;margin-right:8px;border-radius:50%}.top-line[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{flex-shrink:0;margin-left:4px;color:var(--default-20);text-transform:lowercase}.top-line[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]:hover{text-decoration:underline}.bottom-line[_ngcontent-%COMP%]{display:flex;max-height:0;opacity:0;transition:max-height .1s linear,opacity .1s linear}.bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-40)}.bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small.is-typing[_ngcontent-%COMP%], .bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small.draft[_ngcontent-%COMP%]{font-style:italic}.bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   small.emoji-container[_ngcontent-%COMP%]{display:flex;align-items:center}.bottom-line[_ngcontent-%COMP%]   .last-message-block[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:3px}ss-info-tooltip[_ngcontent-%COMP%]{margin-left:8px}']});let s=o;return s})();function Pr(s,o){if(s&1){let n=b();l(0,"ss-chat-header",3),_("closeDmTray",function(){h(n);let t=r();return m(t.closeDmTray.emit())})("addParticipantDmTray",function(){h(n);let t=r();return m(t.addParticipantDmTray.emit(t.chat))})("backToMessageList",function(){h(n);let t=r();return m(t.backToMessageList.emit())}),c()}if(s&2){let n=r();u("isDmTray",n.isDmTray)("chat",n.chat)}}function kr(s,o){s&1&&v(0,"div",1)}function Ur(s,o){if(s&1){let n=b();l(0,"ss-message-list",4),_("loadMoreOlder",function(){h(n);let t=r();return m(t.loadOlderMessages())})("loadMoreNewer",function(){h(n);let t=r();return m(t.loadNewerMessages())})("typing",function(){h(n);let t=r();return m(t.onTyping())})("messageSubmit",function(t){h(n);let i=r();return m(i.onMessageSubmit(t))})("reactToMessage",function(t){h(n);let i=r();return m(i.onReactToMessage(t))})("editMessage",function(t){h(n);let i=r();return m(i.onEditMessage(t))})("toggleThreadUser",function(t){h(n);let i=r();return m(i.onToggleThreadUser(t))})("deleteMessage",function(t){h(n);let i=r();return m(i.onDeleteMessage(t))})("bookmarkMessage",function(t){h(n);let i=r();return m(i.onMessageBookmarked(t))})("retrySending",function(t){h(n);let i=r();return m(i.onRetrySending(t))})("reloadConversation",function(t){h(n);let i=r();return m(i.onReloadConversation(t))})("loadReferencedMessage",function(t){h(n);let i=r();return m(i.onLoadReferencedMessage(t))}),c()}if(s&2){let n=r();u("conversationType",n.chat.isGroup?n.ConversationTypeRef.GroupChat:n.ConversationTypeRef.Chat)("readOnly",n.chat.readOnly)("isDmTray",n.isDmTray)("conversationId",n.chat.id)("messages",n.chat.messages)("conversationUsers",n.chat.chatUsers)("beginningMessage",n.getBeginningMessage())("firstUnreadMessageId",n.initialFirstUnreadMessageId)("loadingOlderMessages",n.loadingOlderMessages)("loadingNewerMessages",n.loadingNewerMessages)("loadedAllOlderMessages",n.loadedAllOlderMessages)("loadedAllNewerMessages",n.loadedAllNewerMessages)("lastReadMessageDateRead",n.chat.lastReadMessageDateRead)("initialUnreadMessagesCount",n.chat.initialUnreadMessagesCount)("createdByUserId",n.chat.createdByUserId)}}var Lr=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A){this.utilityService=e,this.accountService=t,this.chatService=i,this.signalRService=d,this.toastService=M,this.loaderService=x,this.activatedRoute=E,this.userNotificationService=A,this.isDmTray=!1,this.backToMessageList=new I,this.closeDmTray=new I,this.addParticipantDmTray=new I,this.chat={chatUsers:[],messages:[]},this.loadingOlderMessages=!1,this.loadingNewerMessages=!1,this.loadedAllOlderMessages=!0,this.loadedAllNewerMessages=!0,this.processingBookmarksIds=[],this.ConversationTypeRef=ne,this.subscriptions=[],this.messagesSendingQueue={queue:[],push:R=>{this.messagesSendingQueue.queue.push(R),this.messagesSendingQueue.queue.length===1&&this.messagesSendingQueue.execute()},execute:()=>{this.messagesSendingQueue.queue.length!==0&&this.messagesSendingQueue.queue[0].subscribe({next:R=>{this.updateMessageList(R,!0),this.messagesSendingQueue.next()},error:R=>{this.chat.messages.filter(z=>z.sending).map(z=>{z.failed=!0,z.sending=!1}),this.handleErrors(R),this.messagesSendingQueue.next()}})},next:()=>{this.messagesSendingQueue.queue.shift(),this.messagesSendingQueue.execute()}}}onVisibilityChange(){document.visibilityState==="visible"&&this.readMessages()}ngOnInit(){this.currentUser=this.accountService.currentUser,this.chatId?(this.loadChat(this.chatId),this.utilityService.conversationId.next(this.chatId)):this.activatedRoute.params.subscribe(e=>{this.loaderService.start();let t=e.chatId;this.utilityService.conversationId.next(t),t&&t!==this.previousChatId?(this.previousChatId=e.chatId,this.loadChat(t)):this.loaderService.stop()}),this.subscriptions.push(this.signalRService.chatMessageReceived.subscribe(e=>this.onNewMessageReceived(e)),this.signalRService.chatMessageUpdate.subscribe(e=>this.onMessageUpdated(e)),this.signalRService.chatMessagesRead.subscribe(e=>this.onMessageRead(e)),this.signalRService.chatUserUpdated.subscribe(e=>this.onChatUserUpdated(e)),this.signalRService.chatMessageBookmarkStateUpdated.subscribe(e=>this.onChatMessageBookmarkStateUpdated(e)),this.signalRService.chatJoined.subscribe(e=>this.onChatJoined(e)),this.signalRService.chatLeft.subscribe(e=>this.onChatLeft(e)),this.signalRService.chatUpdated.subscribe(e=>this.onChatUpdated(e)),this.signalRService.chatThreadUserAdded.subscribe(e=>this.onChatThreadUserAdded(e)),this.signalRService.chatThreadUserRemoved.subscribe(e=>this.onChatThreadUserRemoved(e)),this.signalRService.userBlocked.subscribe(e=>this.onUserBlocked(e)),this.signalRService.userUnblocked.subscribe(e=>this.onUserUnblocked(e)))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.chatLoadInProgress?.unsubscribe()}loadChat(e,t=!1){t||(this.chat={chatUsers:[],messages:[]},this.utilityService.conversationLoaded.next({chat:null,channel:null})),this.chatLoadInProgress?.unsubscribe(),this.chatLoadInProgress=this.chatService.getMyChat(e).subscribe({next:i=>{if(t){this.chat.messages=i.messages,this.chat.totalMessages=i.totalMessages,this.chat.firstUnreadMessageId=i.firstUnreadMessageId,this.chat.latestMessageId=i.latestMessageId;for(let M of this.chat.chatUsers){let x=i.chatUsers.find(E=>E.userId===M.userId);x&&(M.lastReadMessageId=x.lastReadMessageId,M.lastReadMessageDateRead=x.lastReadMessageDateRead,M.markedAsUnread=x.markedAsUnread)}}else this.chat=i,this.initialFirstUnreadMessageId=this.chat.firstUnreadMessageId,this.utilityService.conversationLoaded.next({chat:this.chat,channel:null});let d=this.chat.chatUsers.find(M=>M.userId===this.currentUser.id);d?.isMessageRequest&&this.userNotificationService.updateMessageRequestChatIds(e),this.loadedAllOlderMessages=this.chat.totalMessages===this.chat.messages.length,this.loadedAllNewerMessages=this.chat.messages.length>0?this.chat.messages[this.chat.messages.length-1].id===this.chat.latestMessageId:!0,d&&!d.isMessageRequest&&this.readMessages(!0),setTimeout(()=>{this.loaderService.stop()},50)},error:i=>this.handleErrors(i)})}loadOlderMessages(){this.loadedAllOlderMessages||this.loadingOlderMessages||this.loadingNewerMessages||(this.loadingOlderMessages=!0,this.chatService.getOlderMessages(this.chat.id,this.chat.messages[0].id).subscribe({next:e=>{e.messages.length>0&&this.chat.messages.unshift(...e.messages),this.chat.totalMessages=e.totalMessages,this.chat.messages.length>0&&(this.loadedAllOlderMessages=this.chat.messages[0].id===e.firstMessageId),this.readMessages(),this.loadingOlderMessages=!1,this.utilityService.messageListUpdated.next(H.LoadedOlder)},error:e=>this.handleErrors(e)}))}loadNewerMessages(){if(this.loadedAllNewerMessages||this.loadingOlderMessages||this.loadingNewerMessages)return;this.loadingNewerMessages=!0;let e=this.getNewestMessageId();e&&this.chatService.getNewerMessages(this.chat.id,e).subscribe({next:t=>{t.messages.length>0&&this.chat.messages.push(...t.messages),this.chat.totalMessages=t.totalMessages;let i=this.getNewestMessageId();i&&(this.loadedAllNewerMessages=i===t.lastMessageId),t.messages.length&&this.readMessages(),this.loadingNewerMessages=!1,this.utilityService.messageListUpdated.next(H.LoadedNewer)},error:t=>this.handleErrors(t)})}readMessages(e=!1){let t=this.chat.chatUsers.find(x=>x.userId===this.currentUser.id);if(!t)return;let i=this.chat.messages.find(x=>x.id===this.chat.firstUnreadMessageId),d=this.chat.messages.filter(x=>!x.readStatusSent&&x.userId!==this.currentUser.id&&(i?x.dateCreated>=i.dateCreated:!t.lastReadMessageDateRead||x.dateCreated>t.lastReadMessageDateRead));for(let x of d)x.readStatusSent=!0;if(e&&t.markedAsUnread){this.chatService.markChatAsRead(this.chat.id).subscribe({error:x=>this.handleErrors(x)});return}if(d.length===0)return;let M=d.map(x=>x.id);this.chatService.readMessages(this.chat.id,M).subscribe(()=>{this.onMessageRead({chatId:this.chat.id,userReadId:this.currentUser.id,readMessageCount:M.length,lastReadMessageDate:d.length>0?d[d.length-1].dateCreated:"",lastReadMessageDateRead:new Date().toISOString()})})}onTyping(){this.chatService.typingMessage(this.chat.id).subscribe({error:e=>this.handleErrors(e)})}onMessageSubmit(e){let t=e.sendMessageModel;t.uiIdentifier=Qe(),t.newestMessageId=this.getNewestMessageId();let i=this.chat.chatUsers.find(M=>M.userId===this.currentUser.id),d={text:t.text,dateCreated:new Date().toISOString(),sending:!0,userId:this.currentUser.id,displayName:this.currentUser.displayName,avatarColor:this.currentUser.avatarColor,avatarUrl:this.currentUser.avatarUrl,avatarThumbUrl:this.currentUser.avatarThumbUrl,uiIdentifier:t.uiIdentifier,replyingToMessage:e.replyingToMessage,initials:this.currentUser.initials,messageType:De.Regular,lastActive:this.currentUser.lastActive,userBadge:this.currentUser.userBadge,showPremiumTick:this.currentUser.showPremiumTick,isAdmin:i?.isAdmin,tenorGifUrl:t.tenorGifUrl,giphyResourceId:null,giphyResourceType:null,attachments:t.files.map(M=>{let x=URL.createObjectURL(M);return{thumbUrl:x,url:x,originalFileName:M.name,file:M,isAudioOnly:this.utilityService.isAudioFileType(M)}}),reactions:[]};this.chat.messages.push(d),this.utilityService.messageListUpdated.next(H.MessageSent),this.sendMessage(t)}onRetrySending(e){e.failed=!1,e.sending=!0,e.dateCreated=new Date().toISOString();let t={files:e.attachments.map(i=>i.file),uiIdentifier:e.uiIdentifier,newestMessageId:this.getNewestMessageId(),text:e.text,replyingToMessageId:e.replyingToMessage?.id??null};this.sendMessage(t)}sendMessage(e){let t=this.chatService.sendMessage(this.chat.id,e);this.messagesSendingQueue.push(t)}onReactToMessage(e){this.chatService.reactToMessage(this.chat.id,e.message.id,e.emoji.native||"").subscribe({next:t=>{if(t===null){let i=e.message.reactions.find(d=>d.userId===this.currentUser.id&&d.reactionCharCode===e.emoji.native);i&&e.message.reactions.splice(e.message.reactions.indexOf(i),1)}else e.message.reactions.push(t);e.message.reactions=[...e.message.reactions]},error:t=>this.handleErrors(t)})}onEditMessage(e){let t={text:e.text??"",tokens:e.tokens};this.chatService.editMessage(this.chat.id,e.id,t).subscribe({error:i=>this.handleErrors(i)})}onToggleThreadUser(e){(e.isThreadUser?this.chatService.removeThreadUser(this.chat.id,e.message.id):this.chatService.addThreadUser(this.chat.id,e.message.id)).subscribe({error:i=>this.handleErrors(i)})}onDeleteMessage(e){this.chatService.deleteMessage(this.chat.id,e.id).subscribe({error:t=>this.handleErrors(t)})}getBeginningMessage(){let e=this.accountService.currentUser.id;return`This is the very beginning of your chat message history with ${this.chat.chatUsers.filter(d=>d.userId!==e).map(d=>d.displayName).join(", ")}.`}onReloadConversation(e){this.chatService.markChatAsRead(e).subscribe({next:()=>{this.loadChat(e,!0)},error:t=>this.handleErrors(t)})}onLoadReferencedMessage(e){this.chatService.getMessagesForMessageContext(this.chat.id,e).subscribe({next:t=>{this.chat.messages=t,this.loadedAllOlderMessages=this.chat.totalMessages===this.chat.messages.length,this.loadedAllNewerMessages=this.chat.messages.length>0?this.chat.messages[this.chat.messages.length-1].id===this.chat.latestMessageId:!0,this.utilityService.conversationMessagesReloaded.next(e)},error:t=>this.handleErrors(t)})}onMessageBookmarked(e){if(this.processingBookmarksIds.find(d=>d===e.id))return;this.processingBookmarksIds.push(e.id);let t=e.isBookmarked,i=e.isBookmarked?this.chatService.removeBookmark(this.chat.id,e.id):this.chatService.addBookmark(this.chat.id,e.id);e.isBookmarked=!e.isBookmarked,i.subscribe({next:()=>this.processingBookmarksIds.splice(this.processingBookmarksIds.indexOf(e.id),1),error:d=>{this.processingBookmarksIds.splice(this.processingBookmarksIds.indexOf(e.id),1),e.isBookmarked=t,this.handleErrors(d)}})}onChatJoined(e){if(e.chatId===this.chat.id)for(let t of e.usersJoining)this.chat.chatUsers.find(d=>d.userId===t.userId)||this.chat.chatUsers.push({id:t.id,userId:t.userId,avatarColor:t.avatarColor,avatarUrl:t.avatarUrl,avatarThumbUrl:t.avatarThumbUrl,initials:t.initials,firstName:t.firstName,fullName:t.fullName,displayName:t.displayName})}onChatLeft(e){if(e.chatId!==this.chat.id)return;let t=this.chat.chatUsers.find(i=>i.userId===e.userLeavingId);t&&this.chat.chatUsers.splice(this.chat.chatUsers.indexOf(t),1)}onNewMessageReceived(e){this.chat.id!==e.chatId||this.chat.messages.find(i=>i.id===e.messageId)||this.chatService.getMessages(e.chatId,this.getNewestMessageId()).subscribe(i=>{this.chat.id===e.chatId&&(this.updateMessageList(i),document.visibilityState==="visible"&&this.readMessages())})}onMessageUpdated(e){if(this.chat.id!==e.chatId)return;let t=[];this.chat.messages.find(i=>i.id===e.messageId)!==void 0&&t.push(e.messageId),t.length!==0&&this.chatService.getMessagesByIds(e.chatId,t).subscribe(i=>{for(let d of i){let M=this.chat.messages.find(A=>A.id===d.id);if(!M)continue;let x=null,E=null;this.isDmTray&&i.length===1&&i[0].isDeleted===!0&&(E=document.querySelector("ss-dm-tray .messages-wrapper"),x=E.scrollTop),this.utilityService.mapMessage(M,d),this.utilityService.messageUpdated.next(M),x&&this.scrollAfterDeleteMessage(x,E)}})}scrollAfterDeleteMessage(e,t){setTimeout(()=>{let i=t?.scrollTop;t&&e!==i&&(t.scrollTop=e)},10)}onMessageRead(e){if(!(this.chat.id!==e.chatId||e.readMessageCount===0||!e.lastReadMessageDate))for(let t of this.chat.messages){if(t.dateCreated>e.lastReadMessageDate)continue;let i=this.chat.chatUsers.find(d=>d.userId===e.userReadId);i&&(i.lastReadMessageId=e.lastReadMessageId,i.lastReadMessageDateRead=e.lastReadMessageDateRead,this.utilityService.conversationUserUpdated.next(i.id)),t.lastReadBy=this.chat.chatUsers.filter(d=>d.userId!==this.currentUser.id&&d.userId!==t.userId&&d.lastReadMessageId===t.id)}}onChatUserUpdated(e){if(this.chat.id!==e.chatId)return;let t=this.chat.chatUsers.find(i=>i.id===e.chatUserId);t&&(t.isAdmin=e.isAdmin),this.currentUser.id===e.userId&&(this.chat.isMuted=e.isMuted)}onChatUpdated(e){this.chat.id===e.id&&(this.chat.name=e.name,this.chat.description=e.description,this.chat.avatarThumbUrl=e.avatarThumbUrl,this.chat.avatarUrl=e.avatarUrl)}onChatMessageBookmarkStateUpdated(e){if(this.chat.id!==e.chatId)return;let t=this.chat.messages.find(i=>i.id===e.messageId);t&&(t.isBookmarked=!e.isRemoved)}onUserBlocked(e){let t=this.chat.chatUsers.find(d=>d.userId===e.userBlockingId),i=this.chat.chatUsers.find(d=>d.userId===e.blockedUserId);!this.chat.isGroup&&t&&i&&(this.chat.readOnly=!0),t&&this.currentUser.id===e.blockedUserId&&(t.following=!1,t.followsMe=!1,t.blockedMe=!0),i&&this.currentUser.id===e.userBlockingId&&(i.following=!1,i.followsMe=!1,i.blocked=!0)}onChatThreadUserAdded(e){if(e.conversationId!==this.chat.id)return;let t=this.chat.messages.find(i=>i.id===e.threadStartMessageId);!t||t.threadUsers.find(i=>i.user.id===e.threadUser.user.id)||t.threadUsers.push(e.threadUser)}onChatThreadUserRemoved(e){if(e.conversationId!==this.chat.id)return;let t=this.chat.messages.find(d=>d.id===e.threadStartMessageId);if(!t)return;let i=t.threadUsers.findIndex(d=>d.user.id===e.userId);i<0||t.threadUsers.splice(i,1)}onUserUnblocked(e){let t=this.chat.chatUsers.find(d=>d.userId===e.userUnblockingId),i=this.chat.chatUsers.find(d=>d.userId===e.unblockedUserId);!this.chat.isGroup&&t&&i&&(this.chat.readOnly=!1),t&&this.currentUser.id===e.unblockedUserId&&(t.blockedMe=!1),i&&this.currentUser.id===e.userUnblockingId&&(i.blocked=!1)}updateMessageList(e,t=!1){for(let i of e){if(this.chat.messages.find(x=>x.id===i.id)||i.threadStartMessageId)continue;if(i.uiIdentifier){let x=this.chat.messages.find(E=>E.uiIdentifier===i.uiIdentifier);if(x){Object.assign(x,i),x.sending=!1,x.failed=!1,this.utilityService.messageUpdated.next(x);continue}}let M=this.chat.messages.find(x=>x.dateCreated>i.dateCreated);M?this.chat.messages.splice(this.chat.messages.indexOf(M),0,i):this.chat.messages.push(i)}e.length&&(this.chat.firstUnreadMessageId=e[0].id),this.utilityService.messageListUpdated.next(H.MessageReceived),t&&this.readMessages()}getNewestMessageId(){let e=this.chat?.messages.filter(t=>!!t.id);return e&&e.length===0?null:e[e.length-1].id}handleErrors(e){this.loadingOlderMessages=!1,this.loadingNewerMessages=!1,this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(X),C(B),C(se),C(G),C(N),C(pt),C(Ue),C(Wt))},o.\u0275cmp=k({type:o,selectors:[["ss-chat"]],hostVars:2,hostBindings:function(t,i){t&1&&_("visibilitychange",function(){return i.onVisibilityChange()},dt),t&2&&V("dm-tray",i.isDmTray)},inputs:{chatId:"chatId",isDmTray:"isDmTray"},outputs:{backToMessageList:"backToMessageList",closeDmTray:"closeDmTray",addParticipantDmTray:"addParticipantDmTray"},standalone:!1,decls:3,vars:3,consts:[[3,"isDmTray","chat"],[1,"loading-placeholder"],[3,"conversationType","readOnly","isDmTray","conversationId","messages","conversationUsers","beginningMessage","firstUnreadMessageId","loadingOlderMessages","loadingNewerMessages","loadedAllOlderMessages","loadedAllNewerMessages","lastReadMessageDateRead","initialUnreadMessagesCount","createdByUserId"],[3,"closeDmTray","addParticipantDmTray","backToMessageList","isDmTray","chat"],[3,"loadMoreOlder","loadMoreNewer","typing","messageSubmit","reactToMessage","editMessage","toggleThreadUser","deleteMessage","bookmarkMessage","retrySending","reloadConversation","loadReferencedMessage","conversationType","readOnly","isDmTray","conversationId","messages","conversationUsers","beginningMessage","firstUnreadMessageId","loadingOlderMessages","loadingNewerMessages","loadedAllOlderMessages","loadedAllNewerMessages","lastReadMessageDateRead","initialUnreadMessagesCount","createdByUserId"]],template:function(t,i){t&1&&(g(0,Pr,1,2,"ss-chat-header",0),g(1,kr,1,0,"div",1),g(2,Ur,1,15,"ss-message-list",2)),t&2&&(p(i.chat.id?0:-1),a(),p(i.chat.id?-1:1),a(),p(i.chat.id?2:-1))},dependencies:[Ii,Ot],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}.page-content-wrapper[_ngcontent-%COMP%]{height:calc(100vh - 56px)}@media only screen and (max-width: 1024px){.page-content-wrapper[_ngcontent-%COMP%]{height:100%}}.page-content[_ngcontent-%COMP%]{max-width:1340px;width:100%;padding:50px 70px;margin:0 auto}@media only screen and (max-width: 1024px){.page-content[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]{position:relative;width:100%;height:100%;border-radius:20px}.dm-tray[_nghost-%COMP%]   ss-message-list[_ngcontent-%COMP%]{height:100%;border-bottom-right-radius:16px;border-bottom-left-radius:16px}.dm-tray[_nghost-%COMP%]   .loading-placeholder[_ngcontent-%COMP%]{border-radius:16px}.loading-placeholder[_ngcontent-%COMP%]{height:100%;background:var(--alt-60)}"]});let s=o;return s})();var ye=typeof window<"u"?window:null,Pi=ye===null,Pt=Pi?void 0:ye.document,Se="addEventListener",Ie="removeEventListener",Ti="getBoundingClientRect",Tt="_a",Oe="_b",je="_c",ti="horizontal",Te=function(){return!1},Rr=Pi?"calc":["","-webkit-","-moz-","-o-"].filter(function(s){var o=Pt.createElement("div");return o.style.cssText="width:"+s+"calc(9px)",!!o.style.length}).shift()+"calc",ns=function(s){return typeof s=="string"||s instanceof String},is=function(s){if(ns(s)){var o=Pt.querySelector(s);if(!o)throw new Error("Selector "+s+" did not match a DOM element");return o}return s},oe=function(s,o,n){var e=s[o];return e!==void 0?e:n},ii=function(s,o,n,e){if(o){if(e==="end")return 0;if(e==="center")return s/2}else if(n){if(e==="start")return 0;if(e==="center")return s/2}return s},Er=function(s,o){var n=Pt.createElement("div");return n.className="gutter gutter-"+o,n},Vr=function(s,o,n){var e={};return ns(o)?e[s]=o:e[s]=Rr+"("+o+"% - "+n+"px)",e},Ar=function(s,o){var n;return n={},n[s]=o+"px",n},Dr=function(s,o){if(o===void 0&&(o={}),Pi)return{};var n=s,e,t,i,d,M,x;Array.from&&(n=Array.from(n));var E=is(n[0]),A=E.parentNode,R=getComputedStyle?getComputedStyle(A):null,z=R?R.flexDirection:null,Be=oe(o,"sizes")||n.map(function(){return 100/n.length}),yt=oe(o,"minSize",100),si=Array.isArray(yt)?yt:n.map(function(){return yt}),oi=oe(o,"maxSize",1/0),ls=Array.isArray(oi)?oi:n.map(function(){return oi}),cs=oe(o,"expandToMin",!1),St=oe(o,"gutterSize",10),Ut=oe(o,"gutterAlign","center"),ai=oe(o,"snapOffset",30),ds=Array.isArray(ai)?ai:n.map(function(){return ai}),ri=oe(o,"dragInterval",1),ct=oe(o,"direction",ti),li=oe(o,"cursor",ct===ti?"col-resize":"row-resize"),hs=oe(o,"gutter",Er),ki=oe(o,"elementStyle",Vr),ms=oe(o,"gutterStyle",Ar);ct===ti?(e="width",t="clientX",i="left",d="right",M="clientWidth"):ct==="vertical"&&(e="height",t="clientY",i="top",d="bottom",M="clientHeight");function It(S,w,y,O){var ee=ki(e,w,y,O);Object.keys(ee).forEach(function(q){S.style[q]=ee[q]})}function gs(S,w,y){var O=ms(e,w,y);Object.keys(O).forEach(function(ee){S.style[ee]=O[ee]})}function Lt(){return x.map(function(S){return S.size})}function Ui(S){return"touches"in S?S.touches[0][t]:S[t]}function Li(S){var w=x[this.a],y=x[this.b],O=w.size+y.size;w.size=S/this.size*O,y.size=O-S/this.size*O,It(w.element,w.size,this[Oe],w.i),It(y.element,y.size,this[je],y.i)}function ps(S){var w,y=x[this.a],O=x[this.b];this.dragging&&(w=Ui(S)-this.start+(this[Oe]-this.dragOffset),ri>1&&(w=Math.round(w/ri)*ri),w<=y.minSize+y.snapOffset+this[Oe]?w=y.minSize+this[Oe]:w>=this.size-(O.minSize+O.snapOffset+this[je])&&(w=this.size-(O.minSize+this[je])),w>=y.maxSize-y.snapOffset+this[Oe]?w=y.maxSize+this[Oe]:w<=this.size-(O.maxSize-O.snapOffset+this[je])&&(w=this.size-(O.maxSize+this[je])),Li.call(this,w),oe(o,"onDrag",Te)(Lt()))}function Ri(){var S=x[this.a].element,w=x[this.b].element,y=S[Ti](),O=w[Ti]();this.size=y[e]+O[e]+this[Oe]+this[je],this.start=y[i],this.end=y[d]}function us(S){if(!getComputedStyle)return null;var w=getComputedStyle(S);if(!w)return null;var y=S[M];return y===0?null:(ct===ti?y-=parseFloat(w.paddingLeft)+parseFloat(w.paddingRight):y-=parseFloat(w.paddingTop)+parseFloat(w.paddingBottom),y)}function Ei(S){var w=us(A);if(w===null||si.reduce(function(q,he){return q+he},0)>w)return S;var y=0,O=[],ee=S.map(function(q,he){var st=w*q/100,Rt=ii(St,he===0,he===S.length-1,Ut),Et=si[he]+Rt;return st<Et?(y+=Et-st,O.push(0),Et):(O.push(st-Et),st)});return y===0?S:ee.map(function(q,he){var st=q;if(y>0&&O[he]-y>0){var Rt=Math.min(y,O[he]-y);y-=Rt,st=q-Rt}return st/w*100})}function Cs(){var S=this,w=x[S.a].element,y=x[S.b].element;S.dragging&&oe(o,"onDragEnd",Te)(Lt()),S.dragging=!1,ye[Ie]("mouseup",S.stop),ye[Ie]("touchend",S.stop),ye[Ie]("touchcancel",S.stop),ye[Ie]("mousemove",S.move),ye[Ie]("touchmove",S.move),S.stop=null,S.move=null,w[Ie]("selectstart",Te),w[Ie]("dragstart",Te),y[Ie]("selectstart",Te),y[Ie]("dragstart",Te),w.style.userSelect="",w.style.webkitUserSelect="",w.style.MozUserSelect="",w.style.pointerEvents="",y.style.userSelect="",y.style.webkitUserSelect="",y.style.MozUserSelect="",y.style.pointerEvents="",S.gutter.style.cursor="",S.parent.style.cursor="",Pt.body.style.cursor=""}function _s(S){if(!("button"in S&&S.button!==0)){var w=this,y=x[w.a].element,O=x[w.b].element;w.dragging||oe(o,"onDragStart",Te)(Lt()),S.preventDefault(),w.dragging=!0,w.move=ps.bind(w),w.stop=Cs.bind(w),ye[Se]("mouseup",w.stop),ye[Se]("touchend",w.stop),ye[Se]("touchcancel",w.stop),ye[Se]("mousemove",w.move),ye[Se]("touchmove",w.move),y[Se]("selectstart",Te),y[Se]("dragstart",Te),O[Se]("selectstart",Te),O[Se]("dragstart",Te),y.style.userSelect="none",y.style.webkitUserSelect="none",y.style.MozUserSelect="none",y.style.pointerEvents="none",O.style.userSelect="none",O.style.webkitUserSelect="none",O.style.MozUserSelect="none",O.style.pointerEvents="none",w.gutter.style.cursor=li,w.parent.style.cursor=li,Pt.body.style.cursor=li,Ri.call(w),w.dragOffset=Ui(S)-w.end}}Be=Ei(Be);var nt=[];x=n.map(function(S,w){var y={element:is(S),size:Be[w],minSize:si[w],maxSize:ls[w],snapOffset:ds[w],i:w},O;if(w>0&&(O={a:w-1,b:w,dragging:!1,direction:ct,parent:A},O[Oe]=ii(St,w-1===0,!1,Ut),O[je]=ii(St,!1,w===n.length-1,Ut),z==="row-reverse"||z==="column-reverse")){var ee=O.a;O.a=O.b,O.b=ee}if(w>0){var q=hs(w,ct,y.element);gs(q,St,w),O[Tt]=_s.bind(O),q[Se]("mousedown",O[Tt]),q[Se]("touchstart",O[Tt]),A.insertBefore(q,y.element),O.gutter=q}return It(y.element,y.size,ii(St,w===0,w===n.length-1,Ut),w),w>0&&nt.push(O),y});function Vi(S){var w=S.i===nt.length,y=w?nt[S.i-1]:nt[S.i];Ri.call(y);var O=w?y.size-S.minSize-y[je]:S.minSize+y[Oe];Li.call(y,O)}x.forEach(function(S){var w=S.element[Ti]()[e];w<S.minSize&&(cs?Vi(S):S.minSize=w)});function fs(S){var w=Ei(S);w.forEach(function(y,O){if(O>0){var ee=nt[O-1],q=x[ee.a],he=x[ee.b];q.size=w[O-1],he.size=y,It(q.element,q.size,ee[Oe],q.i),It(he.element,he.size,ee[je],he.i)}})}function vs(S,w){nt.forEach(function(y){if(w!==!0?y.parent.removeChild(y.gutter):(y.gutter[Ie]("mousedown",y[Tt]),y.gutter[Ie]("touchstart",y[Tt])),S!==!0){var O=ki(e,y.a.size,y[Oe]);Object.keys(O).forEach(function(ee){x[y.a].element.style[ee]="",x[y.b].element.style[ee]=""})}})}return{setSizes:fs,getSizes:Lt,collapse:function(w){Vi(x[w])},destroy:vs,parent:A,pairs:nt}},ss=Dr;var ni=class extends Ai{constructor(o){super(n=>{let e=new ResizeObserver(t=>{requestAnimationFrame(()=>n.next(t))});return e.observe(o),function(){o&&e.unobserve(o),e.disconnect()}})}};var Br=["channelListElement"],Nr=["chatListElement"],zr=["chatListScroller"],Fr=["channelListScroller"],jr=["searchInput"],Hr=(s,o)=>o.id;function qr(s,o){if(s&1&&(l(0,"div",16),f(1),c()),s&2){let n=r(2);a(),U(n.threadUnreadCount)}}function Gr(s,o){if(s&1){let n=b();l(0,"div",13),_("click",function(){h(n);let t=r();return m(t.navigateToThreads())}),l(1,"div",14),v(2,"ss-icon",15),l(3,"h4"),f(4,"Threads"),c()(),g(5,qr,2,1,"div",16),c(),l(6,"div",17),_("click",function(){h(n);let t=r();return m(t.navigateToBookmarks())}),l(7,"div",14),v(8,"ss-icon",18),l(9,"h4"),f(10,"Saved items"),c()()()}if(s&2){let n=r();a(2),u("iconVariant",20)("size",20),a(3),p(n.threadUnreadCount?5:-1),a(3),u("iconVariant",20)("size",20)}}function Wr(s,o){s&1&&v(0,"mat-spinner",11)}function Qr(s,o){if(s&1){let n=b();l(0,"ss-channel-list-item",25),_("click",function(){let t=h(n).$implicit,i=r(4);return m(i.navigateToChannel(t.id))}),c()}if(s&2){let n=o.$implicit,e=r(4);u("active",e.activeChannelId===n.id)("collapsed",e.collapsed)("channelListItem",n)("matTooltip",e.collapsed?n.name:"")}}function $r(s,o){if(s&1&&(l(0,"div",23)(1,"em"),f(2),c(),Q(3,Qr,1,4,"ss-channel-list-item",24,Hr),c()),s&2){let n=o.$implicit;a(2),U(n.name),a(),$(n.channels)}}function Jr(s,o){if(s&1&&(l(0,"div",22),Q(1,$r,5,1,"div",23,qi),c()),s&2){let n=r(2);a(),$(n.channelCategories)}}function Kr(s,o){if(s&1){let n=b();l(0,"section",5,1)(2,"div",7)(3,"div",8),v(4,"ss-icon",19),l(5,"h4"),f(6,"Channels"),c()(),l(7,"div",10)(8,"ss-icon",20),_("click",function(){h(n);let t=r();return m(t.markAllChannelsRead())}),c(),l(9,"ss-icon",21),_("click",function(){h(n);let t=r();return m(t.toggleBrowseChannels())}),c()()(),g(10,Wr,1,0,"mat-spinner",11),g(11,Jr,3,0,"div",22),c()}if(s&2){let n=r();a(4),u("iconVariant",20)("size",20),a(4),u("iconVariant",20)("size",20),a(),u("iconVariant",20)("size",20),a(),p(n.loadingChannelList?10:-1),a(),p(n.loadingChannelList?-1:11)}}function Yr(s,o){if(s&1&&(l(0,"div",8),v(1,"ss-icon",26),l(2,"h4",27),f(3,"Chats"),c()()),s&2){let n=r();a(),u("iconVariant",20)("size",20),a(),u("matTooltip",Me("Total: ",n.totalChats))("matTooltipShowDelay",600)}}function Zr(s,o){s&1&&v(0,"ss-icon",29),s&2&&u("iconVariant",20)("size",20)}function Xr(s,o){if(s&1&&(l(0,"div",32),f(1),c()),s&2){let n=r(4);a(),P(" ",n.messageRequestChatIds.length>99?"99+":n.messageRequestChatIds.length," ")}}function el(s,o){if(s&1&&(l(0,"div",30)(1,"h4",27),f(2,"Message Requests"),c(),g(3,Xr,2,1,"div",32),c()),s&2){let n=r(3);a(),u("matTooltip",Me("Total: ",n.totalChats))("matTooltipShowDelay",600),a(2),p(n.messageRequestChatIds&&n.messageRequestChatIds.length>0?3:-1)}}function tl(s,o){if(s&1&&(v(0,"ss-icon",33),l(1,"h4",27),f(2,"Archived Chats"),c()),s&2){let n=r(3);u("iconVariant",20)("size",20),a(),u("matTooltip",Me("Total: ",n.totalChats))("matTooltipShowDelay",600)}}function il(s,o){if(s&1){let n=b();l(0,"ss-input",34,2),ve("ngModelChange",function(t){h(n);let i=r(3);return fe(i.chatSearchTerm,t)||(i.chatSearchTerm=t),m(t)}),_("ngModelChange",function(t){h(n);let i=r(3);return m(i.onSearchChange(t))}),c()}if(s&2){let n=r(3);_e("ngModel",n.chatSearchTerm),u("noMargin",!0)}}function nl(s,o){if(s&1&&(g(0,Zr,1,2,"ss-icon",29),g(1,el,4,4,"div",30),g(2,tl,3,5),g(3,il,2,2,"ss-input",31)),s&2){let n=r(2);p(n.activeChatListPanel===n.ChatListPanelRef.MessageRequests?0:-1),a(),p(n.activeChatListPanel===n.ChatListPanelRef.MessageRequests?1:-1),a(),p(n.activeChatListPanel===n.ChatListPanelRef.Archive?2:-1),a(),p(n.activeChatListPanel===n.ChatListPanelRef.Search?3:-1)}}function sl(s,o){if(s&1){let n=b();l(0,"div",9)(1,"ss-icon",28),_("click",function(){h(n);let t=r();return m(t.setActivePanel(t.ChatListPanelRef.Default))}),c(),g(2,nl,4,4),c()}if(s&2){let n=r();a(),u("iconVariant",20)("size",20),a(),p(n.collapsed?-1:2)}}function ol(s,o){s&1&&v(0,"span",37)}function al(s,o){if(s&1){let n=b();l(0,"div",10)(1,"div",35)(2,"ss-icon",36),_("click",function(){h(n);let t=r();return m(t.setActivePanel(t.ChatListPanelRef.MessageRequests))}),c(),g(3,ol,1,0,"span",37),c(),l(4,"ss-icon",38),_("click",function(){h(n);let t=r();return m(t.setActivePanel(t.ChatListPanelRef.Archive))}),c(),l(5,"ss-icon",39),_("click",function(){h(n);let t=r();return m(t.setActivePanel(t.ChatListPanelRef.Search))}),c(),l(6,"ss-icon",40),_("click",function(){h(n);let t=r();return m(t.startChat())}),c()()}if(s&2){let n=r();a(2),u("size",20)("iconVariant",20),a(),p(n.messageRequestChatIds&&n.messageRequestChatIds.length>0?3:-1),a(),u("size",20)("iconVariant",20),a(),u("iconVariant",20)("size",20),a(),u("iconVariant",20)("size",20)("matTooltip",n.currentUser.conversationsEnabled?"New Chat":"You are blocked from sending messages while we investigate user reports about you.")}}function rl(s,o){s&1&&v(0,"mat-spinner",11)}function ll(s,o){if(s&1){let n=b();l(0,"ss-chat-list-item",47),_("click",function(){let t=h(n).$implicit,i=r(2);return m(i.navigateToChat(t.id))}),c()}if(s&2){let n=o.$implicit,e=r(2);u("chatListItem",n)("active",e.activeChatId===n.id)("collapsed",e.collapsed)("isMessageRequest",e.activeChatListPanel===e.ChatListPanelRef.MessageRequests)("messageRequestChatIds",e.messageRequestChatIds)}}function cl(s,o){s&1&&v(0,"mat-spinner",43)}function dl(s,o){s&1&&(l(0,"div",44),f(1,"You're all caught up"),c())}function hl(s,o){s&1&&(l(0,"div",45),f(1),T(2,"translate"),c()),s&2&&(a(),P(" ",L(2,1,"pages.chat.chatList.emptyMessage")," "))}function ml(s,o){s&1&&(l(0,"div",46)(1,"div"),f(2),T(3,"translate"),c()()),s&2&&(a(2),U(L(3,1,"pages.chat.chatList.emptyChatListAlternateViewMessage")))}function gl(s,o){if(s&1&&(l(0,"cdk-virtual-scroll-viewport",12,3),Ge(2,ll,1,5,"ss-chat-list-item",41),l(3,"div",42),g(4,cl,1,0,"mat-spinner",43),g(5,dl,2,0,"div",44),c(),g(6,hl,3,3,"div",45),g(7,ml,4,3,"div",46),c()),s&2){let n=r();a(2),u("cdkVirtualForOf",n.chatList),a(2),p(n.loadingMoreChats?4:-1),a(),p(!n.loadingMoreChats&&n.chatList.length>20&&n.loadedAllChats&&n.chatListScrolledToBottom?5:-1),a(),p(n.activeChatListPanel===n.ChatListPanelRef.Default&&!n.loadingMoreChats&&n.chatList.length===0?6:-1),a(),p(n.activeChatListPanel!==n.ChatListPanelRef.Default&&!n.loadingMoreChats&&(n.activeChatListPanel!==n.ChatListPanelRef.Search||n.chatSearchTerm)&&n.chatList.length===0?7:-1)}}var pl=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A,R,z,Be,yt){this.chatService=e,this.channelService=t,this.utilityService=i,this.accountService=d,this.activatedRoute=M,this.router=x,this.navigationService=E,this.userNotificationService=A,this.ngZone=R,this.toastService=z,this.signalRService=Be,this.keyboardService=yt,this.collapsed=!1,this.chatId=new I,this.startChatDmTray=new I,this.isDmTray=!1,this.chatList=[],this.channelCategories=[],this.searchTermChange=new Pe,this.loadingChatList=!0,this.loadingChannelList=!0,this.loadedAllChats=!1,this.loadingMoreChats=!1,this.activeChatListPanel=de.Default,this.ChatListPanelRef=de,this.chatSearchTerm=null,this.chatListScrolledToBottom=!1,this.browseChannelsUrl="/conversations/channels/browse",this.subscriptions=[]}beforeNavigatedAway(){this.storePanelDimensions()}handleKeyboardEvent(){this.navigationService.getLatestRoute()===this.browseChannelsUrl&&this.router.navigate(["/conversations"])}ngOnInit(){this.currentUser=this.accountService.currentUser,this.subscriptions.push(this.signalRService.chatMessageReceived.subscribe(e=>this.onChatMessageReceived(e)),this.signalRService.channelMessageReceived.subscribe(e=>this.onChannelMessageReceived(e)),this.signalRService.chatStarted.subscribe(e=>this.onChatStarted(e)),this.signalRService.chatJoined.subscribe(e=>this.onChatJoined(e)),this.signalRService.chatLeft.subscribe(e=>this.onChatLeft(e)),this.signalRService.channelUpdated.subscribe(e=>this.onChannelUpdated(e)),this.signalRService.channelUserUpdated.subscribe(e=>this.onChannelUserUpdated(e)),this.signalRService.chatUserUpdated.subscribe(e=>this.onChatUserUpdated(e)),this.signalRService.channelJoined.subscribe(e=>this.onChannelJoined(e)),this.signalRService.channelLeft.subscribe(e=>this.onChannelLeft(e)),this.utilityService.conversationLoaded.subscribe(e=>this.onConversationChanged(e)),this.userNotificationService.notificationsUpdate.subscribe(e=>this.handleNotificationUpdates(e)),this.signalRService.chatMessageRequestAccepted.subscribe(e=>this.onChatMessageRequestAccepted(e)),this.signalRService.chatMessageRequestIgnored.subscribe(e=>this.onChatMessageRequestIgnored(e)),this.keyboardService.shortcutHit.subscribe(e=>this.handleShortcutHit(e))),this.activatedRoute.queryParams.subscribe(e=>{this.queryParams={sidePanel:e.sidePanel,threadStartMessageId:e.threadStartMessageId,conversationType:e.conversationType,conversationId:e.conversationId}})}ngAfterViewInit(){this.fetchMoreChats({shouldSubscribeToLoadMore:!0});let e=parseFloat(localStorage.getItem(hi)||"50");this.subscriptions.push(this.searchTermChange.pipe(Ne(300),He()).subscribe(()=>{this.loadingChatList&&this.activeChatListPanel!==de.Search||(this.chatList=[],this.loadedAllChats=!1,this.chatSearchTerm&&this.fetchMoreChats({shouldTryToLoadMoreNow:!0,shouldSkipLoadingCheck:!0}))})),!this.isDmTray&&(this.fetchChannels(),this.splitInstance=ss([this.channelListElement.nativeElement,this.chatListElement.nativeElement],{sizes:[e,100-e],direction:"vertical",minSize:42,snapOffset:10,gutterSize:6,onDragEnd:()=>{this.refreshVirtualScroller(this.chatListScroller)}}),this.subscriptions.push(new ni(document.body).pipe(Ne(300)).subscribe(()=>{requestAnimationFrame(()=>{!this.channelListScroller||!this.chatListScroller||this.ngZone.run(()=>{this.refreshVirtualScroller(this.chatListScroller)})})})))}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.fetchChatsSubscription?.unsubscribe(),this.storePanelDimensions(),this.chatListElement.nativeElement.querySelector(".chat-list cdk-virtual-scroll-viewport")?.removeEventListener("scroll",this.onChatListScrolled),!this.isDmTray&&this.splitInstance.destroy()}startChat(){if(this.currentUser.conversationsEnabled){if(this.isDmTray){this.startChatDmTray.emit();return}this.router.navigate(["/conversations/chats/create"])}}navigateToChat(e){if(this.isDmTray){this.chatId.emit(e);return}this.router.navigate([`/conversations/chats/${e}`],{queryParams:this.queryParams})}navigateToChannel(e){this.router.navigate([`/conversations/channels/${e}`],{queryParams:this.queryParams})}toggleBrowseChannels(){this.navigationService.getLatestRoute()===this.browseChannelsUrl?this.router.navigate([this.latestRoute]):(this.activeChannelId=null,this.activeChatId=null,this.latestRoute=this.navigationService.getLatestRoute(),this.router.navigate([this.browseChannelsUrl]))}fetchMoreChats(e=null){if(e===null&&(e={shouldSubscribeToLoadMore:!1,shouldTryToLoadMoreNow:!1,shouldSkipLoadingCheck:!1}),this.loadingMoreChats&&!e.shouldSkipLoadingCheck)return;let t=this.chatList.length>0?this.chatList[this.chatList.length-1].id:null;this.loadingMoreChats=!0,this.fetchChatsSubscription?.unsubscribe(),this.fetchChatsSubscription=this.chatService.getMyChats(t,this.chatSearchTerm,this.activeChatListPanel===de.Archive,this.activeChatListPanel===de.MessageRequests).subscribe({next:i=>{if(this.totalChats=i.totalChats,i.chats.length===0){this.loadingChatList=!1,this.loadingMoreChats=!1,this.loadedAllChats=!0,e?.shouldSubscribeToLoadMore&&setTimeout(()=>{this.subscribeToLoadMoreElements()});return}i.chats=i.chats.filter(d=>this.chatList.find(M=>M.id===d.id)===void 0),this.chatList=[...this.chatList,...i.chats],this.loadingChatList=!1,this.loadingMoreChats=!1,this.chatList.length===i.totalChats&&(this.loadedAllChats=!0),e?.shouldSubscribeToLoadMore&&setTimeout(()=>{this.subscribeToLoadMoreElements()}),e?.shouldTryToLoadMoreNow&&this.loadMoreIfScrolledToBottom()},error:i=>this.handleErrors(i)})}markAllChannelsRead(){this.channelService.markAllChannelAsRead().subscribe({error:e=>this.handleErrors(e)})}navigateToThreads(){this.router.navigate(["/conversations/threads"],{queryParams:this.queryParams}),this.activeChannelId=null,this.activeChatId=null}navigateToBookmarks(){this.router.navigate(["/conversations/bookmarks"],{queryParams:this.queryParams}),this.activeChannelId=null,this.activeChatId=null}onSearchChange(e){this.searchTermChange.next(e),this.chatSearchTerm&&(this.loadingMoreChats=!0)}setActivePanel(e){this.activeChatListPanel=e,this.chatList=[],this.chatSearchTerm=null,this.loadedAllChats=!1,setTimeout(()=>{e===de.Search?this.searchInput.focusInput():this.fetchMoreChats({shouldTryToLoadMoreNow:!0})})}fetchChannels(){this.channelService.getMyChannels().subscribe({next:e=>{this.channelCategories=e,this.loadingChannelList=!1},error:e=>this.handleErrors(e)})}onConversationChanged(e){this.activeChatId=e.chat?e.chat.id:null,this.activeChannelId=e.channel?e.channel.id:null}onChatMessageReceived(e){if(e.threadStartMessageId)return;let t=this.chatList.find(i=>i.id===e.chatId);t?(t.lastMessageText=e.lastMessageText,t.lastMessageDate=e.lastMessageDate,this.utilityService.sort(this.chatList,"lastMessageDate",!0),this.chatList=[...this.chatList]):this.chatService.getChatListItem(e.chatId).subscribe(i=>{this.addChatListItem(i)})}onChannelMessageReceived(e){let t=this.findChannel(e.channelId);t&&(t.hasUnreadMessages=e.hasUnreadMessages)}onChatStarted(e){e.isMessageRequest&&e.createdByUserId!==this.currentUser.id&&this.messageRequestChatIds.push(e.chatId),!(e.archived&&this.activeChatListPanel!==de.Archive)&&(this.chatList.find(t=>t.id===e.chatId)||this.chatService.getChatListItem(e.chatId).subscribe(t=>this.addChatListItem(t,e.isMessageRequest)))}onChatJoined(e){e.usersJoining.find(t=>t.userId===this.currentUser.id)&&this.ensureChatListItemExists(e.chatId)}onChatLeft(e){this.currentUser.id===e.userLeavingId&&this.ensureChatListItemDoesNotExist(e.chatId)}onChannelJoined(e){if(this.currentUser.id!==e.userJoiningId)return;this.chatList.find(i=>i.id===e.channelId)||this.channelService.getChannelListItem(e.channelId).subscribe(i=>{this.addChannelListItem(i)})}onChannelLeft(e){if(this.currentUser.id!==e.userLeavingId)return;let t=this.findChannel(e.channelId);t&&(this.removeChannelListItem(t),this.channelCategories.length?this.activeChannelId===e.channelId&&(this.activeChannelId=this.channelCategories[0].channels[0].id,this.router.navigate([`/conversations/channels/${this.activeChannelId}`])):(this.activeChannelId=null,this.router.navigate(["/conversations"])))}handleNotificationUpdates(e){for(let t of this.chatList){let i=e.chats.find(d=>d.id===t.id);t.unreadMessages=i?.unreadMessages||0}for(let t of this.channelCategories)for(let i of t.channels){let d=e.channels.find(M=>M.id===i.id);i.hasUnreadMessages=!!d}this.threadUnreadCount=e.threads.map(t=>t.unreadMessages).reduce((t,i)=>t+i,0),this.messageRequestChatIds=e.messageRequestChatIds}loadMoreIfScrolledToBottom(){this.chatListScroller.measureScrollOffset("bottom")>0||this.fetchMoreChats()}subscribeToLoadMoreElements(){this.loadMoreIfScrolledToBottom();let e=this.chatListScroller.elementScrolled().pipe(Di(()=>this.chatListScroller.measureScrollOffset("bottom")),Ni(),Bi(([t,i])=>i<t&&i<140),zi(200)).subscribe(()=>{this.loadedAllChats||this.ngZone.run(()=>{this.fetchMoreChats()})});this.subscriptions.push(e),this.ngZone.runOutsideAngular(()=>{this.onChatListScrolled=this.onChatListScrolled.bind(this),this.chatListScroller.elementRef.nativeElement.addEventListener("scroll",this.onChatListScrolled)})}refreshVirtualScroller(e){e.checkViewportSize(),e.measureScrollOffset("bottom")>0||this.fetchMoreChats()}addChatListItem(e,t=!1){this.chatList.find(i=>i.id===e.id)||this.activeChatListPanel===de.Default&&t||this.activeChatListPanel===de.MessageRequests&&!t||(this.chatList.push(e),this.utilityService.sort(this.chatList,"lastMessageDate",!0),this.chatList=[...this.chatList])}onChatMessageRequestAccepted(e){if(this.activeChatListPanel===de.MessageRequests){let t=this.chatList.find(i=>i.id===e.chatId);t&&(this.chatList.splice(this.chatList.indexOf(t),1),this.chatList=[...this.chatList])}this.activeChatListPanel===de.Default&&(this.chatList.find(i=>i.id===e.chatId)||this.ensureChatListItemExists(e.chatId))}onChatMessageRequestIgnored(e){e.createdByUserId!==this.currentUser.id&&this.ensureChatListItemDoesNotExist(e.chatId)}onChatListScrolled(){window.requestAnimationFrame(()=>{let e=this.chatListScroller.elementRef.nativeElement,t=this.chatListScrolledToBottom,i=e.scrollTop+e.clientHeight>=e.scrollHeight-40;t!==i&&this.ngZone.run(()=>{this.chatListScrolledToBottom=i})})}onChannelUpdated(e){let t=this.findChannel(e.id);if(!t){e.archived||this.channelService.getChannelListItem(e.id).subscribe(i=>{this.addChannelListItem(i)});return}t.name=e.name,t.isPrivate=e.isPrivate,t.type=e.type,e.archived&&this.removeChannelListItem(t)}onChannelUserUpdated(e){if(this.currentUser.id!==e.userId)return;let t=this.findChannel(e.channelId);t&&(t.isMuted=e.isMuted)}onChatUserUpdated(e){if(this.currentUser.id!==e.userId)return;let t=this.chatList.find(M=>M.id===e.chatId);if(!t)return;if(e.deleted){this.ensureChatListItemDoesNotExist(e.chatId);return}if(t.isMuted=e.isMuted,!(t.archived!==e.archived))return;let d;e.archived?d=this.activeChatListPanel===de.Archive?this.ensureChatListItemExists:this.ensureChatListItemDoesNotExist:d=this.activeChatListPanel===de.Archive?this.ensureChatListItemDoesNotExist:this.ensureChatListItemExists,d.call(this,e.chatId)}findChannel(e){for(let t of this.channelCategories)for(let i of t.channels)if(i.id===e)return i;return null}addChannelListItem(e){let t=this.channelCategories.find(i=>i.name===e.categoryName);if(t){t.channels.push(e),this.channelService.orderChannelsInCategory(t);return}this.channelCategories=this.channelService.addChannelToCategoryListAndOrder(e,this.channelCategories)}removeChannelListItem(e){let t=null;for(let i of this.channelCategories){let d=i.channels.indexOf(e);if(d>-1){i.channels.splice(d,1),i.channels.length===0&&(t=i);break}}t&&this.channelCategories.splice(this.channelCategories.indexOf(t),1)}ensureChatListItemExists(e){this.chatList.find(i=>i.id===e)||this.chatService.getChatListItem(e).subscribe(i=>{this.addChatListItem(i),this.activeChatId===null&&this.activeChannelId===null&&(this.activeChatId=this.chatList[0].id,this.router.navigate([`/conversations/chats/${this.activeChatId}`]))})}ensureChatListItemDoesNotExist(e){let t=this.chatList.find(i=>i.id===e);t&&(this.chatList.splice(this.chatList.indexOf(t),1),this.chatList=[...this.chatList],this.router.url.includes(`/conversations/chats/${e}`)&&(this.activeChatId=null,this.router.navigate(["/conversations"])))}storePanelDimensions(){if(this.isDmTray)return;let e=this.splitInstance.getSizes()[0];localStorage.setItem(hi,e.toString())}handleShortcutHit(e){if(this.activeChatId)switch(e.shortcut){case F.MessageArchive:this.toggleActiveChatArchivedState();break;case F.MessageMarkUnread:this.markActiveChatAsUnread();break;case F.NextChatListItem:this.highlightNextChatListItem();break;case F.PreviousChatListItem:this.highlightPreviousChatListItem();break;default:break}}toggleActiveChatArchivedState(){this.activeChatId&&this.chatService.toggleArchivedState(this.activeChatId).subscribe({error:e=>this.handleErrors(e)})}markActiveChatAsUnread(){this.activeChatId&&this.chatService.markChatAsUnread(this.activeChatId).subscribe({next:()=>{this.chatList=this.chatList.map(e=>(e.id===this.activeChatId&&(e.markedAsUnread=!0),e))},error:e=>this.handleErrors(e)})}highlightNextChatListItem(){let e=this.chatList.find(i=>i.id===this.activeChatId);if(!e)return;let t=this.chatList.indexOf(e);t>=0&&t<this.chatList.length-1&&(this.activeChatId=this.chatList[t+1].id,this.router.navigate([`/conversations/chats/${this.activeChatId}`]))}highlightPreviousChatListItem(){let e=this.chatList.find(i=>i.id===this.activeChatId);if(!e)return;let t=this.chatList.indexOf(e);t>0&&t<this.chatList.length&&(this.activeChatId=this.chatList[t-1].id,this.router.navigate([`/conversations/chats/${this.activeChatId}`]))}handleErrors(e){this.loadingMoreChats=!1,this.loadingChannelList=!1,this.loadingChatList=!1,this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(se),C(ce),C(X),C(B),C(Ue),C(te),C(Pn),C(Wt),C(Dt),C(N),C(G),C(ei))},o.\u0275cmp=k({type:o,selectors:[["ss-conversation-list"]],viewQuery:function(t,i){if(t&1&&(J(Br,5),J(Nr,5),J(zr,5),J(Fr,5),J(jr,5)),t&2){let d;K(d=Y())&&(i.channelListElement=d.first),K(d=Y())&&(i.chatListElement=d.first),K(d=Y())&&(i.chatListScroller=d.first),K(d=Y())&&(i.channelListScroller=d.first),K(d=Y())&&(i.searchInput=d.first)}},hostVars:2,hostBindings:function(t,i){t&1&&_("beforeunload",function(){return i.beforeNavigatedAway()},At)("keydown.escape",function(){return i.handleKeyboardEvent()},dt),t&2&&V("collapsed",i.collapsed)},inputs:{collapsed:"collapsed",isDmTray:"isDmTray"},outputs:{chatId:"chatId",startChatDmTray:"startChatDmTray"},standalone:!1,decls:11,vars:9,consts:[["chatListElement",""],["channelListElement",""],["searchInput",""],["chatListScroller",""],[1,"conversation-wrapper"],[1,"channel-list"],[1,"chat-list"],[1,"section-title"],[1,"chat-type"],[1,"alternate-view-wrapper"],[1,"right-side"],["diameter","30","strokeWidth","3",1,"content-spinner"],["itemSize","50",1,"section-content"],["routerLink","/conversations/threads","routerLinkActive","active",1,"section-title","thread",3,"click"],[1,"title-wrapper"],["iconName","chat_arrow_back","color","gradient-20",1,"section-title-icon",3,"iconVariant","size"],[1,"unread-messages","notification"],["routerLink","/conversations/bookmarks","routerLinkActive","active",1,"section-title","thread",3,"click"],["color","gradient-20","iconName","bookmark",1,"section-title-icon",3,"iconVariant","size"],["color","gradient-20","iconName","channel",1,"section-title-icon",3,"iconVariant","size"],["iconName","mail_all_read","role","button","matTooltip","Mark all channels as read",1,"action-icon",3,"click","iconVariant","size"],["iconName","search","role","button","matTooltip","Browse",3,"click","iconVariant","size"],[1,"section-content"],[1,"channel-group"],["matTooltipPosition","right",3,"active","collapsed","channelListItem","matTooltip"],["matTooltipPosition","right",3,"click","active","collapsed","channelListItem","matTooltip"],["iconName","chat","color","gradient-20",1,"section-title-icon",3,"iconVariant","size"],[3,"matTooltip","matTooltipShowDelay"],["iconName","arrow_left","role","button","matTooltip","Go Back",3,"click","iconVariant","size"],["iconName","mail",1,"archive-icon",3,"iconVariant","size"],[1,"message-request-wrapper"],["id","chats-search","name","chatsSearchTerm","placeholder","Type to search chats...",1,"chats-search-input",3,"ngModel","noMargin"],[1,"notification","unread-message-requests-counter"],["iconName","archive",1,"archive-icon",3,"iconVariant","size"],["id","chats-search","name","chatsSearchTerm","placeholder","Type to search chats...",1,"chats-search-input",3,"ngModelChange","ngModel","noMargin"],[1,"message-request-icon-wrapper"],["iconName","mail","role","button","matTooltip","Message Requests",1,"action-icon",3,"click","size","iconVariant"],[1,"blue-dot"],["iconName","archive","role","button","matTooltip","Archive",1,"action-icon",3,"click","size","iconVariant"],["iconName","people_search","role","button","matTooltip","Search",1,"search-icon",3,"click","iconVariant","size"],["iconName","add","role","button","matTooltipPosition","right",3,"click","iconVariant","size","matTooltip"],[3,"chatListItem","active","collapsed","isMessageRequest","messageRequestChatIds","click",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"load-more-wrapper"],["diameter","30","strokeWidth","3"],[1,"end-message"],[1,"section-empty"],[1,"section-empty","alternate-view"],[3,"click","chatListItem","active","collapsed","isMessageRequest","messageRequestChatIds"]],template:function(t,i){t&1&&(g(0,Gr,11,5),l(1,"div",4),g(2,Kr,12,8,"section",5),l(3,"section",6,0)(5,"div",7),g(6,Yr,4,5,"div",8),g(7,sl,3,3,"div",9),g(8,al,7,10,"div",10),c(),g(9,rl,1,0,"mat-spinner",11),g(10,gl,8,5,"cdk-virtual-scroll-viewport",12),c()()),t&2&&(p(i.isDmTray?-1:0),a(2),p(i.isDmTray?-1:2),a(),V("alternate-view",i.activeChatListPanel!==i.ChatListPanelRef.Default),a(3),p(i.activeChatListPanel===i.ChatListPanelRef.Default?6:-1),a(),p(i.activeChatListPanel!==i.ChatListPanelRef.Default?7:-1),a(),p(i.activeChatListPanel===i.ChatListPanelRef.Default?8:-1),a(),p(i.loadingChatList?9:-1),a(),p(i.loadingChatList?-1:10))},dependencies:[Re,Ee,tn,nn,Ve,ie,$i,Ki,Ji,D,Xe,Oi,vi,zt],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%;background:var(--grayscale)}.collapsed[_nghost-%COMP%]   .section-title[_ngcontent-%COMP%]{padding:0 20px 0 22px}.collapsed[_nghost-%COMP%]   .section-title.thread[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .collapsed[_nghost-%COMP%]   .section-title[_ngcontent-%COMP%]   .chat-type[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .collapsed[_nghost-%COMP%]   .section-title[_ngcontent-%COMP%]   .chat-type[_ngcontent-%COMP%]   .title-action-menu-trigger[_ngcontent-%COMP%], .collapsed[_nghost-%COMP%]   .section-title[_ngcontent-%COMP%]   .end-message[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%], .collapsed[_nghost-%COMP%]   .section-title[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{display:none}.collapsed[_nghost-%COMP%]   .section-title.thread[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{position:relative;top:3px;left:-9px;min-width:12px;height:12px;padding:0 2px;font-size:8px;line-height:13px}.collapsed[_nghost-%COMP%]   .section-content[_ngcontent-%COMP%]{overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.collapsed[_nghost-%COMP%]   .section-content[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.collapsed[_nghost-%COMP%]   .section-content[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--default-80)}.collapsed[_nghost-%COMP%]   .section-content[_ngcontent-%COMP%]::-webkit-scrollbar, .collapsed[_nghost-%COMP%]   .section-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:25px;background:transparent}.collapsed[_nghost-%COMP%]   .section-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px;height:4px}.collapsed[_nghost-%COMP%]   .channel-group[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{display:block;width:50px;overflow:hidden;margin-left:5px;text-overflow:ellipsis;white-space:nowrap}.smaller[_nghost-%COMP%]   .section-title[_ngcontent-%COMP%]   .chat-type[_ngcontent-%COMP%]   .title-action-menu-trigger[_ngcontent-%COMP%], .smaller[_nghost-%COMP%]   .section-title[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{display:none}.conversation-wrapper[_ngcontent-%COMP%]{height:calc(100% - 80px)}.chat-list[_ngcontent-%COMP%]{position:relative;z-index:2;height:calc(100% - 40px)}.chat-list[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{position:relative;box-shadow:var(--elevation-s1-bottom-only);background:var(--alt-60)}.chat-list.alternate-view[_ngcontent-%COMP%]   .section-content[_ngcontent-%COMP%]{height:calc(100% - 52px)}.chat-list.alternate-view[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{height:52px}.chat-list[_ngcontent-%COMP%]   .chats-search-input[_ngcontent-%COMP%]     input{height:36px;border:none;border-radius:8px;box-shadow:var(--element-inner);background:var(--accent-gradient-90)}.channel-list[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{position:relative;z-index:1;box-shadow:var(--elevation-s1-bottom-only);background:var(--alt-60)}.section-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:40px;padding:0 16px 0 18px;background-color:var(--alt-80)}@media only screen and (max-width: 1024px){.section-title[_ngcontent-%COMP%]{padding:0 20px 0 10px}}@media only screen and (max-width: 767px){.section-title[_ngcontent-%COMP%]{padding:0 10px}}.section-title[_ngcontent-%COMP%]:hover   .title-action-menu-trigger[_ngcontent-%COMP%]{display:block}.section-title.thread[_ngcontent-%COMP%]{padding:0 16px 0 18px;background-color:var(--alt-90);cursor:pointer}.section-title.thread[_ngcontent-%COMP%]   .title-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.section-title.thread[_ngcontent-%COMP%]:hover{background-color:var(--alt-80)}.section-title.thread.active[_ngcontent-%COMP%]{background:var(--accent-gradient-90)}.section-title.thread[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{min-width:16px;height:16px;padding:0 5px;border-radius:88px;color:var(--contrast);background-color:var(--accent-blue);text-align:center}@media only screen and (max-width: 1024px){.section-title.thread[_ngcontent-%COMP%]{padding:0 20px 0 10px}}.section-title[_ngcontent-%COMP%]   .chat-type[_ngcontent-%COMP%]{display:flex;align-items:center}.section-title[_ngcontent-%COMP%]   .section-title-icon[_ngcontent-%COMP%]{margin-right:10px}@media only screen and (max-width: 767px){.section-title[_ngcontent-%COMP%]   .section-title-icon[_ngcontent-%COMP%]{margin-right:4px}}.section-title[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{display:flex;align-items:center}.section-title[_ngcontent-%COMP%]   .title-action-menu-trigger[_ngcontent-%COMP%]{display:none;margin-left:10px}.section-title[_ngcontent-%COMP%]   .title-action-menu-trigger.visible[_ngcontent-%COMP%]{display:block}.action-icon[_ngcontent-%COMP%], .search-icon[_ngcontent-%COMP%]{margin-right:15px}@media only screen and (max-width: 767px){.action-icon[_ngcontent-%COMP%], .search-icon[_ngcontent-%COMP%]{margin-right:4px}}.message-request-icon-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-flex}.message-request-icon-wrapper[_ngcontent-%COMP%]   .blue-dot[_ngcontent-%COMP%]{position:absolute;right:13px;bottom:-2px;display:block;width:11px;height:11px;border:1px solid var(--alt-60);border-radius:50%;background:var(--accent-blue)}.message-request-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.unread-message-requests-counter[_ngcontent-%COMP%]{min-width:16px;height:16px;padding:0 5px;border-radius:88px;line-height:17px;color:var(--contrast);background-color:var(--accent-blue);text-align:center}.alternate-view-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}.alternate-view-wrapper[_ngcontent-%COMP%]   .archive-icon[_ngcontent-%COMP%]{margin-right:14px;margin-left:16px}.alternate-view-wrapper[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]{width:100%;margin-left:15px}@media only screen and (max-width: 767px){.alternate-view-wrapper[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]{width:calc(100% - 36px)}}.search-results-wrapper[_ngcontent-%COMP%]{height:calc(100% - 40px);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.search-results-wrapper[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.search-results-wrapper[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.search-results-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar, .search-results-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.search-results-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.section-content[_ngcontent-%COMP%]{height:calc(100% - 40px);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.section-content[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.section-content[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.section-content[_ngcontent-%COMP%]::-webkit-scrollbar, .section-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.section-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.channel-group[_ngcontent-%COMP%]{margin-top:12px}.channel-group[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{margin-left:16px;color:var(--accent-blue)}  .ios.chrome-ios .chat-list .cdk-virtual-scroll-content-wrapper{padding-bottom:50px}.load-more-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:50px}.load-more-wrapper[_ngcontent-%COMP%]   .end-message[_ngcontent-%COMP%]{padding-bottom:16px}@media only screen and (max-width: 1024px){.load-more-wrapper[_ngcontent-%COMP%]   .end-message[_ngcontent-%COMP%]{text-align:center}}.alternate-view.section-empty[_ngcontent-%COMP%]{position:relative;top:-40px}mat-spinner.content-spinner[_ngcontent-%COMP%]{margin:10px auto}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]  .cdk-virtual-scroll-content-wrapper{width:100%}"]});let s=o;return s})(),de=function(s){return s[s.Default=0]="Default",s[s.Search=1]="Search",s[s.Archive=2]="Archive",s[s.MessageRequests=3]="MessageRequests",s}(de||{});var kt=(()=>{let o=class o{constructor(){this.deleted=new I}removeMember(){this.deleted.emit(this.member.id)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=k({type:o,selectors:[["ss-group-member"]],inputs:{member:"member"},outputs:{deleted:"deleted"},standalone:!1,decls:4,vars:7,consts:[[3,"size","title","initials","avatarColor","avatarThumbUrl"],["role","button","iconName","dismiss","color","contrast",1,"remove-member",3,"click","size"]],template:function(t,i){t&1&&(v(0,"ss-user-avatar",0),l(1,"small"),f(2),c(),l(3,"ss-icon",1),_("click",function(){return i.removeMember()}),c()),t&2&&(u("size",24)("title",i.member.fullName)("initials",i.member.initials)("avatarColor",i.member.avatarColor)("avatarThumbUrl",i.member.avatarThumbUrl),a(2),U(i.member.displayName),a(),u("size",8))},dependencies:[D,le],styles:["[_nghost-%COMP%]{display:flex;align-items:center;padding-right:5px;margin:0 12px 7px 0;border-radius:8px;background:var(--grayscale-g1)}.last-child[_nghost-%COMP%]{margin-right:0}small[_ngcontent-%COMP%], ss-user-avatar[_ngcontent-%COMP%]{margin-right:5px}ss-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.remove-member[_ngcontent-%COMP%]{width:14px;height:14px;border-radius:50%;background:var(--default-20)}.remove-member[_ngcontent-%COMP%]     i{width:12px;line-height:14px;text-align:center}.remove-member[_ngcontent-%COMP%]:hover{background:var(--default)}"]});let s=o;return s})();var ul=["userSearchInput"],Cl=["messageInputBlock"],as=(s,o)=>o.id;function _l(s,o){if(s&1){let n=b();l(0,"ss-icon",11),_("click",function(){h(n);let t=r();return m(t.backToMessageList.emit())}),c()}s&2&&u("size",24)}function fl(s,o){if(s&1){let n=b();l(0,"ss-group-member",12),_("deleted",function(){let t=h(n).$implicit,i=r();return m(i.removeMemberFromList(t))}),c()}if(s&2){let n=o.$implicit,e=r();u("member",n)("matTooltip",!e.isAdminOrModerator()&&!n.canAddToGroup?"Can't be added to a group due to their privacy settings":"")}}function vl(s,o){if(s&1){let n=b();l(0,"ss-input",13,0),ve("ngModelChange",function(t){h(n);let i=r();return fe(i.userSearchTerm,t)||(i.userSearchTerm=t),m(t)}),_("ngModelChange",function(t){h(n);let i=r();return m(i.onSearchChange(t))}),c()}if(s&2){let n=r();u("id",Me("search-term-",n.searchInputUuid))("name",Me("searchTerm-",n.searchInputUuid))("placeholder",n.hasSelectedUserThatCantBeAddedToGroup()?"":"Enter names here\u2026")("readonly",n.hasSelectedUserThatCantBeAddedToGroup())("isSmall",!0)("noMargin",!0),_e("ngModel",n.userSearchTerm)}}function Ml(s,o){if(s&1){let n=b();l(0,"ss-user-list-item",14),_("click",function(){let t=h(n).$implicit,i=r();return m(i.addToChatGroup(t))})("blockUser",function(t){h(n);let i=r();return m(i.toggleBlock(t))})("unblockUser",function(t){h(n);let i=r();return m(i.toggleBlock(t))})("followUser",function(t){h(n);let i=r();return m(i.followUser(t))}),c()}if(s&2){let n=o.$implicit,e=r();u("startChatFromHeader",!0)("showFullName",!0)("showUserInfo",!1)("checkCanMessage",!0)("checkCanAddToGroup",e.selectedUsers.length>0)("userListItem",n)}}function xl(s,o){if(s&1){let n=b();l(0,"ss-message-input-block",15,1),_("messageSubmit",function(t){h(n);let i=r();return m(i.createChat(t))}),c()}if(s&2){let n=r();u("messageInputBlockLocation",n.MessageInputBlockLocationRef.CreateGroup)("skipFormResetAfterSubmit",!0)}}var bl=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A,R,z,Be){this.userService=e,this.chatService=t,this.loaderService=i,this.toastService=d,this.utilityService=M,this.userFollowService=x,this.accountService=E,this.activatedRoute=A,this.subscriptionService=R,this.dialog=z,this.router=Be,this.isDmTray=!1,this.navigateToChatDmTray=new I,this.backToMessageList=new I,this.MessageInputBlockLocationRef=at,this.searchResults=[],this.selectedUsers=[],this.userSearchTermChange=new Pe,this.usersLoading=!1,this.startingChat=!1,this.userSearchTerm="",this.showTextarea=!1,this.followingUser=!1,this.startChatModel={},this.startChatWithMessageModel={},this.searchInputUuid=Qe()}ngOnInit(){if(this.loaderService.stop(),this.userSearchTermChange.pipe(Ne(300),He()).subscribe(()=>{this.loadSearchResults()}),this.utilityService.conversationLoaded.next({chat:null,channel:null}),this.isDmTray&&this.userToAddId){this.getUserProfileShort(this.userToAddId);return}this.activatedRoute.queryParams.subscribe(e=>{let t=e.userId;t&&this.getUserProfileShort(t)})}ngAfterViewInit(){setTimeout(()=>this.showTextarea=!0),setTimeout(()=>this.userSearchInput.focusInput(),100)}onSearchChange(e){this.usersLoading=!0,this.userSearchTermChange.next(e)}addToChatGroup(e){!this.isAdminOrModerator()&&(!e.canMessage||!e.canAddToGroup&&this.selectedUsers.length>0)||(this.selectedUsers.push(e),this.searchResults=[],this.userSearchTerm="",this.userSearchInput.focusInput())}isAdminOrModerator(){return this.accountService.isInRole(j.Administrator)||this.accountService.isInRole(j.Moderator)}removeMemberFromList(e){this.selectedUsers=this.selectedUsers.filter(t=>t.id!==e.id)}getSearchResults(){return this.searchResults.filter(e=>!this.selectedUsers.find(t=>e.id===t.id))}getUserProfileShort(e){this.userService.getUserProfileShort(e).subscribe({next:t=>this.selectedUsers.push(t),error:t=>this.handleErrors(t)})}createChat(e){if(this.startingChat)return;let t=e.sendMessageModel;this.startingChat=!0,t.text||t.files.length||t.tenorGifUrl?(this.startChatWithMessageModel.text=t.text,this.startChatWithMessageModel.files=t.files,this.startChatWithMessageModel.tenorGifUrl=t.tenorGifUrl,this.startChatWithMessageModel.otherUserIds=this.selectedUsers.map(i=>i.id),this.chatService.startChatWithMessage(this.startChatWithMessageModel).subscribe({next:i=>this.startChatCallback(i),error:i=>this.startChatError(i)})):(this.startChatModel.otherUserIds=this.selectedUsers.map(i=>i.id),this.chatService.startChat(this.startChatModel).subscribe({next:i=>this.startChatCallback(i),error:i=>this.startChatError(i)}))}startChatCallback(e){if(this.startingChat=!1,this.messageInputBlock.resetForm(!1),this.isDmTray){this.navigateToChatDmTray.emit(e.id);return}this.router.navigate([`/conversations/chats/${e.id}`])}startChatError(e){if(this.startingChat=!1,e.length&&e[0].errorCode==="ChatAlreadyExists"){if(this.isDmTray){this.navigateToChatDmTray.emit(e[0].params.chatId);return}this.router.navigate([`/conversations/chats/${e[0].params.chatId}`])}else e.length&&e[0].errorCode==="MaxChatsPerDayReached"?this.toastService.info({title:"Maximum chats reached",exceptionDetail:e[0],paidFeatureText:"Upgrade to send more",triggeredUpgradeFromSource:Ht.MaxChatsReached,autoClose:!1}):this.handleErrors(e)}toggleBlock(e){this.dialog.open(xe,{panelClass:"fullscreen-dialog",width:"414px",data:{user:e}})}followUser(e){this.followingUser||(this.followingUser=!0,this.userFollowService.followUser(e.id).subscribe({next:()=>{e.following=!0,this.followingUser=!1,this.toastService.success({message:`You started following ${e.displayName}.`})},error:t=>this.handleErrors(t)}))}hasSelectedUserThatCantBeAddedToGroup(){return!!this.selectedUsers.find(e=>!e.canAddToGroup)}enableUserSearchInput(){let e=this.subscriptionService.activeSubscriptionTier.maxChatUsersToAddInADay;return e===0||this.selectedUsers.length<e||this.accountService.isInRole(j.Administrator)||this.accountService.isInRole(j.Moderator)}loadSearchResults(){if(this.userSearchTerm.length<2){this.searchResults=[];return}this.usersLoading=!0,this.userService.searchActiveUsers(this.userSearchTerm).subscribe({next:e=>{this.searchResults=e,this.usersLoading=!1},error:e=>this.handleErrors(e)})}handleErrors(e){if(this.usersLoading=!1,this.followingUser=!1,e[0].errorCode==="ErrorChattingAgeRestriction"){this.toastService.info({exceptionDetail:e[0]});return}this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(Ae),C(se),C(pt),C(N),C(X),C(Ze),C(B),C(Ue),C(ut),C(Z),C(te))},o.\u0275cmp=k({type:o,selectors:[["ss-create-group"]],viewQuery:function(t,i){if(t&1&&(J(ul,5),J(Cl,5)),t&2){let d;K(d=Y())&&(i.userSearchInput=d.first),K(d=Y())&&(i.messageInputBlock=d.first)}},hostVars:2,hostBindings:function(t,i){t&2&&V("dm-tray",i.isDmTray)},inputs:{isDmTray:"isDmTray",userToAddId:"userToAddId"},outputs:{navigateToChatDmTray:"navigateToChatDmTray",backToMessageList:"backToMessageList"},standalone:!1,decls:13,vars:3,consts:[["userSearchInput",""],["messageInputBlock",""],[1,"header"],[1,"input-wrapper"],["role","button","iconName","chevron_left","color","default-60",1,"back-button",3,"size"],["matTooltipPosition","below",3,"member","matTooltip"],[1,"user-search",3,"id","name","placeholder","readonly","isSmall","noMargin","ngModel"],[1,"user-list-wrapper"],[3,"startChatFromHeader","showFullName","showUserInfo","checkCanMessage","checkCanAddToGroup","userListItem"],[3,"messageInputBlockLocation","skipFormResetAfterSubmit"],[1,"loading-placeholder"],["role","button","iconName","chevron_left","color","default-60",1,"back-button",3,"click","size"],["matTooltipPosition","below",3,"deleted","member","matTooltip"],[1,"user-search",3,"ngModelChange","id","name","placeholder","readonly","isSmall","noMargin","ngModel"],[3,"click","blockUser","unblockUser","followUser","startChatFromHeader","showFullName","showUserInfo","checkCanMessage","checkCanAddToGroup","userListItem"],[3,"messageSubmit","messageInputBlockLocation","skipFormResetAfterSubmit"]],template:function(t,i){t&1&&(l(0,"div",2)(1,"div",3),g(2,_l,1,1,"ss-icon",4),l(3,"em"),f(4,"To:"),c(),Q(5,fl,1,2,"ss-group-member",5,as),g(7,vl,2,9,"ss-input",6),c()(),l(8,"div",7),Q(9,Ml,1,6,"ss-user-list-item",8,as),c(),g(11,xl,2,2,"ss-message-input-block",9),v(12,"div",10)),t&2&&(a(2),p(i.isDmTray?2:-1),a(3),$(i.selectedUsers),a(2),p(i.enableUserSearchInput()?7:-1),a(2),$(i.getSearchResults()),a(2),p(i.showTextarea?11:-1))},dependencies:[Re,Ee,ie,Gt,xt,D,Xe,kt],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}.page-content-wrapper[_ngcontent-%COMP%]{height:calc(100vh - 56px)}@media only screen and (max-width: 1024px){.page-content-wrapper[_ngcontent-%COMP%]{height:100%}}.page-content[_ngcontent-%COMP%]{max-width:1340px;width:100%;padding:50px 70px;margin:0 auto}@media only screen and (max-width: 1024px){.page-content[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]{position:relative;width:100%;height:100%;border-radius:20px}.dm-tray[_nghost-%COMP%]   .back-button[_ngcontent-%COMP%]{margin-right:5px}.dm-tray[_nghost-%COMP%]   .loading-placeholder[_ngcontent-%COMP%]{height:auto}.dm-tray[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{border-top-left-radius:16px;border-top-right-radius:16px}.dm-tray[_nghost-%COMP%]     ss-group-member small{max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.header[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;min-height:68px;overflow:auto;padding:14px 33px 14px 20px;background:var(--alt-80)}.header[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]{width:210px}.header[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.header[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{margin-right:15px}.header[_ngcontent-%COMP%]   ss-group-member[_ngcontent-%COMP%] {margin:4px 12px 4px 0}.user-list-wrapper[_ngcontent-%COMP%]{position:absolute;left:0;z-index:1;width:100%;max-height:600px;background:var(--alt-80);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.user-list-wrapper[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.user-list-wrapper[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.user-list-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar, .user-list-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.user-list-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}@media only screen and (max-width: 767px){.user-list-wrapper[_ngcontent-%COMP%]{max-height:300px}}.user-list-wrapper[_ngcontent-%COMP%]   ss-user-list-item[_ngcontent-%COMP%]{cursor:pointer}.user-list-wrapper[_ngcontent-%COMP%]   ss-user-list-item[_ngcontent-%COMP%]:hover{background:var(--alt-60)}.loading-placeholder[_ngcontent-%COMP%]{height:calc(100vh - 138px);background:var(--alt-60)}ss-message-input-block[_ngcontent-%COMP%]{position:absolute;bottom:0}"]});let s=o;return s})();var rs=(s,o)=>o.id;function wl(s,o){if(s&1){let n=b();l(0,"ss-icon",16),_("click",function(){h(n);let t=r();return m(t.close())}),c()}s&2&&u("size",24)}function yl(s,o){if(s&1){let n=b();l(0,"ss-group-member",18),_("deleted",function(){let t=h(n).$implicit,i=r(2);return m(i.onRemoveUserFromChat(t))}),c()}if(s&2){let n=o.$implicit;u("member",n)}}function Sl(s,o){if(s&1&&(l(0,"div",3),Q(1,yl,1,1,"ss-group-member",17,rs),c()),s&2){let n=r();a(),$(n.selectedUsers)}}function Il(s,o){s&1&&(l(0,"div",6),v(1,"mat-spinner",19),c())}function Ol(s,o){if(s&1){let n=b();l(0,"ss-user-list-item",20),_("addToChat",function(t){h(n);let i=r();return m(i.onAddUserToChat(t))})("blockUser",function(t){h(n);let i=r();return m(i.toggleBlock(t))})("unblockUser",function(t){h(n);let i=r();return m(i.toggleBlock(t))})("followUser",function(t){h(n);let i=r();return m(i.followUser(t))}),c()}if(s&2){let n=o.$implicit,e=r();u("userListItem",n)("showAdd",e.allowAddUserToChat())("checkCanMessage",!0)("checkCanAddToGroup",!0)}}function Tl(s,o){s&1&&(l(0,"div",14),f(1," Type at least 2 characters to generate search results. "),c())}function Pl(s,o){if(s&1&&(l(0,"div",14),f(1),c()),s&2){let n=r(2);a(),me(" ",n.getSearchResults().length," result",n.getSearchResults().length===1?"":"s",". ")}}function kl(s,o){if(s&1&&(l(0,"div",14),f(1),c()),s&2){let n=r(2);a(),P(" ",n.usersLoading?"Loading users...":"No results."," ")}}function Ul(s,o){if(s&1&&(l(0,"div",14),f(1),c()),s&2){let n=r(2);a(),P(" Showing first ",n.maxSearchResults," results. Try narrowing your search by typing something to search for. ")}}function Ll(s,o){if(s&1&&(l(0,"div",14),f(1),c()),s&2){let n=r(2);a(),P(" Showing a maximum of ",n.maxSearchResults," results for each of the groups (Focus room and App users). Try narrowing your search by typing something to search for. ")}}function Rl(s,o){if(s&1&&(g(0,Pl,2,2,"div",14),g(1,kl,2,1,"div",14),g(2,Ul,2,1,"div",14),g(3,Ll,2,1,"div",14)),s&2){let n=r();p(!n.usersLoading&&n.totalUsersCount>0&&n.getSearchResults().length!==0?0:-1),a(),p(n.getSearchResults().length===0?1:-1),a(),p(n.searchResults.length===n.maxSearchResults&&(n.selectedRoom==="AllFocusRooms"||n.selectedRoom==="AppUsers")?2:-1),a(),p(n.searchResults.length>n.maxSearchResults&&n.selectedRoom==="Everywhere"?3:-1)}}var El=(()=>{let o=class o{constructor(e,t,i,d,M,x,E,A,R){this.userService=e,this.userFollowService=t,this.chatService=i,this.toastService=d,this.focusRoomService=M,this.accountService=x,this.signalRService=E,this.subscriptionService=A,this.dialog=R,this.isDmTray=!1,this.panelBack=new I,this.panelClose=new I,this.backToMessageList=new I,this.backToDmChat=new I,this.searchResults=[],this.selectedUsers=[],this.allRoomParticipants=[],this.searchTerm="",this.searchTermChange=new Pe,this.updatingChat=!1,this.usersLoading=!1,this.showSearchMessage=!1,this.followingUser=!1,this.roomDropdownOptions=[],this.maxSearchResults=50,this.searchInputUuid=Qe()}ngOnInit(){if(this.usersLoading=!0,this.currentUserId=this.accountService.currentUser.id,!!!this.chat.chatUsers.find(t=>t.userId===this.currentUserId)?.isAdmin){this.close();return}this.focusRoomService.getActiveForMyself(!1).subscribe({next:t=>{for(let d of t.rooms)this.roomDropdownOptions.push({label:d.roomDisplayName,provider:d.provider,value:d.roomName,isMeeting:!0,disabled:!1});let i={label:"Whole App",value:"AppUsers",isMeeting:!1,disabled:!1};this.roomDropdownOptions.push(i),this.selectedRoom="AppUsers"},error:t=>this.handleErrors(t)}),this.chatUserUpdatedSubscription=this.signalRService.chatUserUpdated.subscribe(t=>this.onChatUserUpdated(t))}ngAfterViewInit(){this.searchTermChangeSubscription=this.searchTermChange.pipe(Ne(300),He()).subscribe(()=>{if(this.usersLoading)return;let e=this.roomDropdownOptions.find(t=>t.value===this.selectedRoom);if(!e){this.loadUserSearchResults();return}if(e.isMeeting){if(this.checkShortSearch())return;this.showSearchMessage=!1;let t=this.searchTerm.toLowerCase();this.searchResults=this.allRoomParticipants.filter(i=>i.displayName&&i.displayName.toLowerCase().indexOf(t)>-1||i.fullName&&i.fullName.toLowerCase().indexOf(t)>-1),this.totalUsersCount=this.searchResults.length}else{if(this.checkShortSearch())return;this.showSearchMessage=!1,this.searchAllUsers()}})}ngOnDestroy(){this.searchTermChangeSubscription?.unsubscribe(),this.chatUserUpdatedSubscription?.unsubscribe()}checkShortSearch(){return this.searchTerm.length===0?(this.searchResults=this.allRoomParticipants,this.showSearchMessage=!1,!0):this.searchTerm.length<2?(this.searchResults=[],this.showSearchMessage=!0,!0):!1}onFocusRoomChange(){let e=this.roomDropdownOptions.find(t=>t.value===this.selectedRoom);e&&(this.searchResults=[],this.usersLoading=!0,this.searchTerm="",e.isMeeting?this.getAllParticipants(e):this.searchAllUsers())}searchAllUsers(){this.usersLoading=!0,this.searchResults=[],this.focusRoomService.searchAllUsers(this.searchTerm).subscribe({next:e=>{this.totalUsersCount=e.totalCount,this.searchResults=e.participants,this.usersLoading=!1},error:e=>this.handleErrors(e)})}getAllParticipants(e){this.focusRoomService.searchAllUsers("",e.provider,e.value).subscribe({next:t=>{this.usersLoading=!1,this.allRoomParticipants=t.participants,this.totalUsersCount=t.totalCount,this.searchResults=t.participants},error:t=>this.handleErrors(t)})}onSearchChange(e){this.searchTermChange.next(e)}onAddUserToChat(e){this.allowAddUserToChat()&&this.selectedUsers.push(e)}allowAddUserToChat(){let e=this.subscriptionService.activeSubscriptionTier.maxChatUsersToAddInADay;return e===0||this.selectedUsers.length<e||this.accountService.isInRole(j.Administrator)||this.accountService.isInRole(j.Moderator)}onRemoveUserFromChat(e){this.selectedUsers.splice(this.selectedUsers.indexOf(e),1)}back(){if(this.selectedUsers=[],this.searchTerm="",this.isDmTray){this.backToMessageList.emit();return}this.panelBack.emit()}close(){this.selectedUsers=[],this.searchTerm="",this.panelClose.emit()}saveChanges(){let e=this.selectedUsers.map(t=>t.id);this.updatingChat=!0,this.chatService.addUsersToChat(this.chat.id,e).subscribe({next:t=>{this.updatingChat=!1,this.selectedUsers=[],this.searchTerm="",this.isDmTray?this.backToDmChat.emit(this.chat.id):this.panelBack.emit()},error:t=>this.handleErrors(t)})}getSearchResults(){let e=this.selectedUsers.map(t=>t.id);return e.push(...this.chat.chatUsers.map(t=>t.userId)),this.searchResults.filter(t=>t.id&&e.indexOf(t.id)===-1)}toggleBlock(e){this.dialog.open(xe,{panelClass:"fullscreen-dialog",width:"414px",data:{user:e}})}followUser(e){this.followingUser||(this.followingUser=!0,this.userFollowService.followUser(e.id).subscribe({next:()=>{e.following=!0,this.followingUser=!1,this.toastService.success({message:`You started following ${e.displayName}.`})},error:t=>this.handleErrors(t)}))}onChatUserUpdated(e){this.chat.id===e.chatId&&e.userId===this.currentUserId&&!e.isAdmin&&this.close()}loadUserSearchResults(){if(this.usersLoading=!0,this.searchTerm.length<2){this.searchResults=[],this.usersLoading=!1;return}this.searchResults=[],this.userService.searchActiveUsers(this.searchTerm).subscribe({next:e=>{this.searchResults=e,this.usersLoading=!1},error:e=>this.handleErrors(e)})}handleErrors(e){this.updatingChat=!1,this.usersLoading=!1,this.followingUser=!1,this.toastService.error({exceptionDetail:e[0]})}};o.\u0275fac=function(t){return new(t||o)(C(Ae),C(Ze),C(se),C(N),C(Mn),C(B),C(G),C(ut),C(Z))},o.\u0275cmp=k({type:o,selectors:[["ss-group-manage-users-panel"]],hostVars:2,hostBindings:function(t,i){t&2&&V("dm-tray",i.isDmTray)},inputs:{isDmTray:"isDmTray",chat:"chat"},outputs:{panelBack:"panelBack",panelClose:"panelClose",backToMessageList:"backToMessageList",backToDmChat:"backToDmChat"},standalone:!1,decls:26,vars:20,consts:[["searchTermControl","ngModel"],["role","button","iconName","arrow_left","color","default-60",1,"back-button",3,"click","size"],["role","button","iconName","dismiss","color","default-60",1,"close-button",3,"size"],[1,"group-members"],[1,"search"],["placeholder","Search","prefixIconName","search",3,"ngModelChange","id","name","noMargin","ngModel"],[1,"loader-wrapper"],[1,"filter-rooms"],["id","type","name","type","placeholder","Select Focus Room","title","Select Focus Room","disabledProperty","disabled","panelClass","small-select","labelProperty","label","valueProperty","value",3,"ngModelChange","ngModel","options","disabled","noMargin","small"],[1,"start-group-chat-wrapper"],["iconName","add","color","default-60",3,"size"],[1,"list-wrapper"],[1,"list-holder"],[3,"userListItem","showAdd","checkCanMessage","checkCanAddToGroup"],[1,"message"],[1,"next-step-btn",3,"buttonClick","disabled","isLoading"],["role","button","iconName","dismiss","color","default-60",1,"close-button",3,"click","size"],[3,"member"],[3,"deleted","member"],["diameter","20","strokeWidth","2"],[3,"addToChat","blockUser","unblockUser","followUser","userListItem","showAdd","checkCanMessage","checkCanAddToGroup"]],template:function(t,i){if(t&1){let d=b();l(0,"h3"),f(1,"Add Users to Group"),c(),l(2,"ss-icon",1),_("click",function(){return h(d),m(i.back())}),c(),g(3,wl,1,1,"ss-icon",2),g(4,Sl,3,0,"div",3),l(5,"div",4)(6,"ss-input",5,0),ve("ngModelChange",function(x){return h(d),fe(i.searchTerm,x)||(i.searchTerm=x),m(x)}),_("ngModelChange",function(x){return h(d),m(i.onSearchChange(x))}),c(),g(8,Il,2,0,"div",6),c(),l(9,"div",7)(10,"div"),f(11,"Show users from"),c(),l(12,"ss-select",8),ve("ngModelChange",function(x){return h(d),fe(i.selectedRoom,x)||(i.selectedRoom=x),m(x)}),_("ngModelChange",function(){return h(d),m(i.onFocusRoomChange())}),c()(),l(13,"div",9)(14,"div")(15,"em"),f(16,"Select Users"),c()(),v(17,"ss-icon",10),c(),l(18,"div",11)(19,"div",12),Q(20,Ol,1,4,"ss-user-list-item",13,rs),g(22,Tl,2,0,"div",14),g(23,Rl,4,4),c()(),l(24,"ss-button",15),_("buttonClick",function(){return h(d),m(i.saveChanges())}),f(25,` Done
`),c()}t&2&&(a(2),u("size",24),a(),p(i.isDmTray?-1:3),a(),p(i.selectedUsers.length?4:-1),a(2),u("id",Me("search-term-",i.searchInputUuid))("name",Me("searchTerm-",i.searchInputUuid))("noMargin",!0),_e("ngModel",i.searchTerm),a(2),p(i.usersLoading?8:-1),a(4),_e("ngModel",i.selectedRoom),u("options",i.roomDropdownOptions)("disabled",i.usersLoading)("noMargin",!0)("small",!0),a(5),u("size",24),a(3),$(i.getSearchResults()),a(2),p(i.showSearchMessage?22:-1),a(),p(i.showSearchMessage?-1:23),a(),u("disabled",i.selectedUsers.length===0)("isLoading",i.updatingChat))},dependencies:[Re,Ee,Ve,xt,jt,D,Xe,mn,kt],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;width:332px;padding-top:25px;background:var(--grayscale)}.dm-tray[_nghost-%COMP%]{width:100%;border-radius:16px}.dm-tray[_nghost-%COMP%]   .next-step-btn[_ngcontent-%COMP%]{padding:15px}.dm-tray[_nghost-%COMP%]     ss-group-member small{max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}h3[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}.back-button[_ngcontent-%COMP%]{position:absolute;top:25px;left:28px;z-index:1}.close-button[_ngcontent-%COMP%]{position:absolute;top:25px;right:28px;z-index:1;width:24px;height:24px;cursor:pointer}.search[_ngcontent-%COMP%]{position:relative;padding:1px 20px 0;margin-bottom:21px}.search[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]{margin-bottom:0}.search[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]  .mat-mdc-form-field-infix input{padding-right:32px}.search[_ngcontent-%COMP%]   .loader-wrapper[_ngcontent-%COMP%]{position:absolute;top:calc(50% - 10px);right:30px;display:flex;justify-content:center;align-items:center}.filter-rooms[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 20px;margin-bottom:16px}.filter-rooms[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex-shrink:0;margin-right:8px}.filter-rooms[_ngcontent-%COMP%]   ss-select[_ngcontent-%COMP%]{flex:1;min-width:0}.start-group-chat-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:43px;padding:7px 27px 7px 20px;border:1px solid var(--alt-40);background:var(--alt-80)}.start-group-chat-wrapper[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;align-items:center}.start-group-chat-wrapper[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:15px}.group-members[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;padding:0 20px;margin-bottom:14px}.list-wrapper[_ngcontent-%COMP%]{width:100%;overflow:hidden;flex:1;padding-top:10px}.list-holder[_ngcontent-%COMP%]{height:100%;padding-bottom:40px;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.list-holder[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.list-holder[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.list-holder[_ngcontent-%COMP%]::-webkit-scrollbar, .list-holder[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.list-holder[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.list-holder[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{padding:10px;text-align:center}.next-step-btn[_ngcontent-%COMP%]{padding:15px 30px 31px;box-shadow:var(--elevation-s1)}"]});let s=o;return s})();var Om=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Hi({type:o}),o.\u0275inj=ji({imports:[Qi,cn,sn,Zi,Cn,un,_n,dn,pn,hn,Yi,Tn,qn,On,In.forRoot({style:"zoom-in"}),Xi.forChild({loader:en({prefix:"./assets/i18n/",suffix:".json"})})]});let s=o;return s})();export{Is as a,qs as b,ro as c,ei as d,F as e,yi as f,Ot as g,qa as h,Lr as i,ss as j,ni as k,pl as l,kt as m,bl as n,El as o,Om as p};
