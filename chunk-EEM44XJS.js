import{a as dr}from"./chunk-2SMT2VOK.js";import{a as lr}from"./chunk-PW65HFMM.js";import"./chunk-ZKMWVOKP.js";import"./chunk-HYBSAPSS.js";import{a as Ei}from"./chunk-5DBHZAKT.js";import{g as or}from"./chunk-X2T26I4W.js";import{d as rr,e as sr,h as ar,p as cr}from"./chunk-KCSJC7J5.js";import"./chunk-KJPTR26Z.js";import{a as wt}from"./chunk-67KBQVMJ.js";import{a as po,b as mo,c as uo}from"./chunk-RLNFJA3A.js";import{Gb as nr,H as Do,I as _t,Ia as Wo,J as Bo,K as No,La as $o,Ma as Jo,Na as Wt,O as Ht,P as zo,Qa as qo,Xa as Yo,Ya as Ko,Za as Qo,a as oo,ab as Xo,ba as Ri,ja as ct,jb as Zo,m as Eo,n as Uo,p as Vo,pa as jo,pb as er,r as Ao,s as Lo,t as Go,tb as tr,ua as Ho,wb as ir}from"./chunk-GXZQKE6V.js";import"./chunk-WYPJZQF5.js";import{$a as l,$c as Mn,$f as te,$h as go,Ab as bn,Af as we,Ag as qn,Ai as yo,Bb as Pn,Bd as ge,Bh as xt,C as hn,Ca as ae,Cb as Te,Cd as tt,Cf as Be,Cg as Nt,Ch as zt,Da as ce,Db as De,Df as it,Dg as Zt,Di as Mt,Eb as kn,Ed as N,Ef as Ke,Eg as Yn,Fd as ye,Ff as J,Fg as Kn,Fh as rt,Gd as oe,Ge as Ln,Ha as _n,Hd as ee,He as Ki,Hg as nt,Ia as u,Id as fe,Ie as Gn,If as Nn,Ig as G,Ii as Ti,Ja as h,Jd as Rn,Je as Dn,Jf as Qi,Jg as Qn,Ji as So,Kd as si,Kf as zn,La as je,Lf as jn,Lg as Xn,Lh as yi,Li as Mo,M as Dt,Ma as V,Md as En,Mg as I,Mi as at,Na as A,Nd as Un,Oa as p,Od as Vn,Of as Ci,Og as ft,Oi as Ee,Pa as a,Pe as ci,Pg as ot,Ph as ho,Qa as c,Qd as ai,Qe as Vt,Qg as Zn,Qi as wo,R as gn,Ra as b,Re as li,Rf as bi,S as oi,Sd as bt,Sg as eo,Sh as st,Tf as Hn,Tg as Pi,Th as Si,Ti as Ii,U as Ji,Ue as di,Uf as Wn,Ug as to,Ui as Oo,Vd as qi,Ve as pi,Vf as Xi,Vg as io,Vi as To,W as _,Wd as le,We as mi,Wf as w,Wi as Fi,X as C,Xd as Ut,Xe as ui,Ya as P,Yd as gt,Ye as hi,Yf as $n,Zb as xn,Ze as gi,Zg as ki,_a as f,_b as yn,_d as Re,_e as fi,_g as no,_h as K,a as Rt,ae as Pt,ai as fo,aj as Io,b as Xt,bc as Sn,bi as Zi,bj as Fo,cg as ie,ch as xi,ci as vo,cj as Ro,db as Ae,dh as ro,di as en,e as ii,ea as fn,eb as Le,eh as so,ei as _o,fb as Ge,fh as ao,g as Y,ga as ze,gb as xe,gg as Bt,gh as ve,gi as yt,hb as qe,hh as co,ib as S,id as wn,ig as Jn,ih as vt,ii as Mi,j as Gt,jb as Cn,jd as On,jh as lo,kb as g,kf as Q,la as Ze,lb as R,ld as Tn,lf as U,li as Qe,ma as Et,mb as O,md as In,mf as vi,mi as Co,n as mn,nb as Se,ne as An,nf as j,ni as wi,oa as vn,oe as Yi,oh as re,oi as bo,pa as et,pf as Bn,pi as M,qa as s,qb as me,qf as At,qi as jt,r as ni,rb as ue,rf as Ye,rh as _e,s as un,sb as he,sh as H,si as St,ti as Po,ua as m,uf as $,ui as Me,vf as _i,vh as y,vi as ko,wf as de,wh as kt,wi as xo,x as W,xa as x,xb as ht,xd as Ie,xh as Ce,ya as ri,yd as Fe,yf as X,yh as He,yi as Oi,z as Ct,zd as Fn,zg as L,zh as F}from"./chunk-4LPE7HNY.js";var Ui=(()=>{let r=class r{constructor(e){this.dialogRef=e}};r.\u0275fac=function(t){return new(t||r)(m(ge))},r.\u0275cmp=x({type:r,selectors:[["ss-confirm-hide-user-modal"]],standalone:!1,decls:16,vars:2,consts:[[1,"mat-header"],["mat-dialog-title",""],["mat-dialog-close","",1,"close-modal"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],["src","/assets/images/unhide.gif","alt","unhide user",1,"small"],["mat-dialog-close","","color","tertiary",1,"close-button"],[3,"buttonClick"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2,"Hide this user?"),c(),a(3,"button",2),b(4,"ss-icon",3),c()(),a(5,"mat-dialog-content")(6,"p"),g(7,"Are you sure you want to hide this user?"),c(),a(8,"p"),g(9,'You can unhide them anytime using the "Show hidden users" option, as shown below:'),c(),b(10,"img",4),c(),a(11,"mat-dialog-actions")(12,"ss-button",5),g(13," Cancel "),c(),a(14,"ss-button",6),f("buttonClick",function(){return o.dialogRef.close(!0)}),g(15," Yes "),c()()),t&2&&(s(4),p("size",20)("iconVariant",20))},dependencies:[I,w,ye,oe,fe,ee],styles:["p[_ngcontent-%COMP%]{margin-bottom:20px}"]});let n=r;return n})();var pr=(()=>{let r=class r{get documentPictureInPicture(){return"documentPictureInPicture"in window?window.documentPictureInPicture:null}get documentPictureInPictureAvailable(){return"documentPictureInPicture"in window}get tooltipText(){return this.documentPictureInPictureAvailable?this.pipParticipants.length===0?"In order to use picture-in-picture please go to a page where someone has their camera on.":this.loadingPiP?"Loading...":this.isPiPOn?"Turn picture-in-picture off":"Turn picture-in-picture on":"Picture-in-picture is only available in desktop versions of Chrome, Edge, Brave and other Chromium based browsers (versions \u2265 111)."}get isChromeOrEdge(){return this.browser===Xi.Chrome||this.browser===Xi.Edge}constructor(e,t,o,d,v,k,T,B){this.settingsService=e,this.livekit=t,this.dialog=o,this.themeService=d,this.accountModalsService=v,this.utilityService=k,this.analyticsService=T,this.toastService=B,this.displayedParticipants=[],this.pipParticipants=[],this.isPiPOn=!1,this.loadingPiP=!1,this.browser=Wn(),this.pipWindow=null,this.subscriptions=[]}ngOnInit(){this.setParticipantsToShow(),this.subscriptions.push(this.themeService.themeChange.subscribe(()=>setTimeout(()=>this.setDocumentBackgroundColor())),this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.livekit.pipWindowClose.subscribe(()=>this.tryClosingPipWindow()),this.livekit.recalculateGrid.subscribe(()=>{this.setParticipantsToShow(),this.pipWindow&&this.redrawPipElements(this.pipWindow)}))}ngOnChanges(e){e.displayedParticipants&&!e.displayedParticipants.firstChange&&(this.setParticipantsToShow(),this.pipWindow&&this.redrawPipElements(this.pipWindow))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}tryToTogglePictureInPicture(){return Y(this,null,function*(){let e=this.livekit.room.pipOptions;if(!e.usePip){if(e.doNotAskMeAgain){this.analyticsService.markActivity(y.LivekitPiPInfoShown),this.toastService.info({message:"You chose not to be asked about picture-in-picture again. If you want us to ask you again, please log out and log back in."});return}this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Enable picture-in-picture?",description:"EnablePictureInPictureWarning",confirmButtonLabel:"Reload",cancelButtonLabel:"Cancel",checkboxLabel:"Remember my choice"}}).afterClosed().subscribe(o=>{o&&(this.livekit.room.pipOptions={usePip:o.dialogResult,doNotAskMeAgain:o.checkboxValue},o.dialogResult&&window.location.reload())});return}this.isPiPOn?this.onLeavePiP():yield this.enterPiP()})}tryClosingPipWindow(){this.pipWindow?.close(),this.pipWindow=null,this.isPiPOn=!1}enterPiP(){return Y(this,null,function*(){if(!this.documentPictureInPicture||!this.accountModalsService.ensureUserCompletedBasicInfo()||(this.setParticipantsToShow(),this.pipParticipants.length===0))return;let e=30;this.pipWindow=yield this.documentPictureInPicture.requestWindow({width:640,height:360+e}),this.setDocumentBackgroundColor(),this.drawPiPElements(this.pipWindow),this.pipWindow.addEventListener("pagehide",this.onLeavePiP.bind(this),{once:!0}),this.isPiPOn=!0,this.analyticsService.markActivity(y.LivekitPiPStart)})}onLeavePiP(){this.tryClosingPipWindow(),this.analyticsService.markActivity(y.LivekitPiPStop)}drawPiPElements(e){e.document.body.style.margin="0px",this.createAndAddContainerElement(e);for(let t of this.pipParticipants)this.createAndAddVideoElement(t,e)}redrawPipElements(e){let t=e.document.querySelector(".container");this.resetContainerStyles(t);let o=Array.from(e.document.querySelectorAll("video"));for(let d of o)this.pipParticipants.find(v=>v.sid===d.id)===void 0&&d.remove();for(let d of this.pipParticipants)e.document.querySelector(`video#${d.sid}`)===null&&this.createAndAddVideoElement(d,e)}createAndAddContainerElement(e){let t=document.createElement("div");this.resetContainerStyles(t),e.document.body.append(t)}resetContainerStyles(e){e.className="container",e.style.display="grid",e.style.alignItems="center",e.style.gridTemplateColumns=this.pipParticipants.length>1?"1fr 1fr":"1fr",e.style.gridTemplateRows=this.pipParticipants.length>2?"1fr 1fr":"1fr",e.style.width="100%",e.style.height="calc((100vw / 16) * 9)"}createAndAddVideoElement(e,t){let o=t.document.createElement("video");o.id=e.sid,o.style.width="100%",e.isLocal&&this.livekit.room.settings.mirrorMode&&(o.style.transform="scaleX(-1)"),t.document.querySelector(".container").append(o),this.tryBindingActivePublication(e)}tryBindingActivePublication(e){let t=e.getTrackPublications().find(o=>o.kind===j.Kind.Video&&o.isSubscribed);t?this.tryToAttachVideoElement(e.sid,t):e.on(U.TrackSubscribed,(o,d)=>{o.kind===j.Kind.Video&&this.tryToAttachVideoElement(e.sid,d)})}tryToAttachVideoElement(e,t){if(!this.pipWindow)return;let o=t.track;if(!o)return;let d=this.pipWindow.document.querySelector(`video#${e}`);o.attachedElements.includes(d)||o.attach(d)}setParticipantsToShow(){this.pipParticipants=[];let e=this.displayedParticipants.filter(t=>t.isCameraEnabled&&t.identity);this.pipParticipants=e.slice(0,4),window.pipParticipants=this.pipParticipants}setDocumentBackgroundColor(){if(!this.pipWindow)return;let e=getComputedStyle(document.body).backgroundColor;this.pipWindow.document.body.style.background=e}};r.\u0275fac=function(t){return new(t||r)(m(X),m(M),m(N),m(nt),m(K),m(J),m(H),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-document-picture-in-picture"]],inputs:{displayedParticipants:"displayedParticipants"},standalone:!1,features:[fn],decls:1,vars:6,consts:[["iconName","picture_in_picture_enter",3,"buttonClick","matTooltip","active","iconSize","iconOnly","isLoading","disabled"]],template:function(t,o){t&1&&(a(0,"ss-button",0),f("buttonClick",function(){return o.tryToTogglePictureInPicture()}),c()),t&2&&p("matTooltip",o.tooltipText)("active",o.isPiPOn)("iconSize",o.isMobile?24:20)("iconOnly",!0)("isLoading",o.loadingPiP)("disabled",o.pipParticipants.length===0||!o.documentPictureInPictureAvailable)},dependencies:[I,L],styles:["[_nghost-%COMP%]{display:inline-block}@media only screen and (max-width: 767px){[_nghost-%COMP%]{display:none}}[_nghost-%COMP%]   ss-button[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]   ss-button[_ngcontent-%COMP%]  button.primary{height:auto;padding:0;background:none}[_nghost-%COMP%]   ss-button[_ngcontent-%COMP%]  button.primary:hover{background:none}[_nghost-%COMP%]   ss-button[_ngcontent-%COMP%]  button.primary.active ss-icon i{color:var(--contrast)}"]});let n=r;return n})();var mr=(()=>{let r=class r{get tileWidth(){return this.livekit.room.tileDimensions.width}get tileHeight(){return this.livekit.room.tileDimensions.height}constructor(e){this.livekit=e,this.noParticipants=!1,this.addAnotherParticipant=new ce}addAnother(){this.addAnotherParticipant.emit()}};r.\u0275fac=function(t){return new(t||r)(m(M))},r.\u0275cmp=x({type:r,selectors:[["ss-empty-tile"]],hostVars:6,hostBindings:function(t,o){t&2&&(qe("width",o.tileWidth,"px")("height",o.tileHeight,"px"),S("no-participants",o.noParticipants))},inputs:{noParticipants:"noParticipants"},outputs:{addAnotherParticipant:"addAnotherParticipant"},standalone:!1,decls:1,vars:2,consts:[["matTooltip","Add another user","color","website-transparent","iconName","arrow_repeat_all",3,"buttonClick","iconOnly","iconSize"]],template:function(t,o){t&1&&(a(0,"ss-button",0),f("buttonClick",function(){return o.addAnother()}),c()),t&2&&p("iconOnly",!0)("iconSize",70)},dependencies:[I,L],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;overflow:hidden;border-radius:12px;background:var(--grayscale);opacity:0;transition:opacity .25s}.no-participants[_nghost-%COMP%], [_nghost-%COMP%]:hover{opacity:1}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{z-index:initial;border-radius:0;box-shadow:none;opacity:1}.active[_nghost-%COMP%], [_nghost-%COMP%]:hover{z-index:initial;box-shadow:none}}[_nghost-%COMP%]   ss-button[_ngcontent-%COMP%]:hover{opacity:.7}"]});let n=r;return n})();var ur=(()=>{let r=class r{constructor(e){this.dialogRef=e}handleKeyboardEvent(e){e.key==="Escape"&&this.dialogRef.close()}register(){this.dialogRef.close(!0)}};r.\u0275fac=function(t){return new(t||r)(m(ge))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-buddies-await-modal"]],hostBindings:function(t,o){t&1&&f("keydown",function(v){return o.handleKeyboardEvent(v)})},standalone:!1,decls:15,vars:2,consts:[[1,"mat-header"],["mat-dialog-title",""],["mat-dialog-close","",1,"close-modal"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"content"],[1,"blur-wrapper"],[1,"pinned-user","first"],[1,"pinned-user","second"],[3,"buttonClick"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2,"Your Focus Buddies Await"),c(),a(3,"button",2),b(4,"ss-icon",3),c()(),a(5,"mat-dialog-content",4)(6,"div"),g(7,"There are people online right now who match your criteria & are open to connecting. Create your account to view them."),c(),a(8,"div",5),b(9,"div",6)(10,"div",7)(11,"div",6),c()(),a(12,"mat-dialog-actions")(13,"ss-button",8),f("buttonClick",function(){return o.register()}),g(14," Register & See Focus Buddies "),c()()),t&2&&(s(4),p("size",20)("iconVariant",20))},dependencies:[I,w,ye,oe,fe,ee],styles:[".pinned-user[_ngcontent-%COMP%]{width:334px;height:60px;margin:0 0 16px 10px}.pinned-user.first[_ngcontent-%COMP%]{background:url(/assets/images/pinned-by-user-1.png) center no-repeat}.pinned-user.second[_ngcontent-%COMP%]{background:url(/assets/images/pinned-by-user-2.png) center no-repeat}"]});let n=r;return n})();var us=["videoTile"],Ai=(()=>{let r=class r{handleClickOutside(e){let t=e.target;this.videoTile.elementRef.nativeElement.contains(t)||this.dialogRef.close()}constructor(e,t,o,d,v,k){this.participant=e,this.dialogRef=t,this.livekit=o,this.themeService=d,this.toastService=v,this.utilityService=k,this.isMobile=!1,this.subscriptions=[],this.onRemoteParticipantDisconnected=this.onRemoteParticipantDisconnected.bind(this)}ngOnInit(){this.livekit.room.on(Q.ParticipantDisconnected,this.onRemoteParticipantDisconnected),this.livekit.room.currentlyFullscreenedParticipant=this.participant,this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.themeService.themeChange.subscribe(e=>this.theme=e))}ngOnDestroy(){this.livekit.room.off(Q.ParticipantDisconnected,this.onRemoteParticipantDisconnected),this.livekit.room.currentlyFullscreenedParticipant=null,this.subscriptions.forEach(e=>e.unsubscribe())}onRemoteParticipantDisconnected(e){this.participant.identity===e.identity&&(this.toastService.info({title:"Fullscreen preview closed",message:"The user has left the room."}),this.dialogRef.close())}};r.\u0275fac=function(t){return new(t||r)(m(tt),m(ge),m(M),m(nt),m(F),m(J))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-tile-view-modal"]],viewQuery:function(t,o){if(t&1&&Ae(us,5),t&2){let d;Le(d=Ge())&&(o.videoTile=d.first)}},hostBindings:function(t,o){t&1&&f("click",function(v){return o.handleClickOutside(v)})},standalone:!1,decls:4,vars:5,consts:[["videoTile",""],[1,"actions-wrapper"],["mat-dialog-close","","role","button","iconName","dismiss","color","default-60",3,"size"],[3,"participant","isMobile","isViewModalTile","theme"]],template:function(t,o){t&1&&(a(0,"div",1),b(1,"ss-icon",2),c(),b(2,"ss-focus-room-tile",3,0)),t&2&&(s(),p("size",24),s(),p("participant",o.participant)("isMobile",o.isMobile)("isViewModalTile",!0)("theme",o.theme))},styles:["[_nghost-%COMP%]{position:relative}.actions-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}ss-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:40px;height:40px;margin-bottom:8px;border-radius:50%;background:var(--grayscale)}ss-focus-room-tile[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;max-width:177.7777777778vh;width:100%;margin:0 auto}ss-focus-room-tile[_ngcontent-%COMP%]     video{width:100%;height:100%;object-fit:contain}ss-focus-room-tile[_ngcontent-%COMP%]     .hover-top-menu{top:0}"]});let n=r;return n})();function fs(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.encourageUser(t.encouragements[0]))}),b(1,"ss-icon",6),a(2,"span"),g(3,"Encourage"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function vs(n,r){if(n&1){let i=P();a(0,"button",7),f("click",function(){_(i);let t=l();return C(t.messageUser())}),b(1,"ss-icon",8),a(2,"span"),g(3,"Message"),c()()}if(n&2){let i=l();p("matTooltip",i.livekit.room.focusPlus.active?"Cannot message in Focus+":"")("disabled",i.livekit.room.focusPlus.active),s(),p("iconVariant",20)("size",24)}}function _s(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.removeParticipant())}),b(1,"ss-icon",9),a(2,"span"),g(3,"Remove user"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function Cs(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.forceCameraOff())}),b(1,"ss-icon",10),a(2,"span"),g(3,"Turn off camera"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function bs(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.forceAudioOff())}),b(1,"ss-icon",11),a(2,"span"),g(3,"Turn off audio"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function Ps(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.showTaskHistory())}),b(1,"ss-icon",12),a(2,"span"),g(3,"Focused tasks history"),c()(),a(4,"button",5),f("click",function(){_(i);let t=l();return C(t.showUserBio())}),b(5,"ss-icon",13),a(6,"span"),g(7,"User bio"),c()()}n&2&&(s(),p("iconVariant",20)("size",24),s(4),p("iconVariant",20)("size",24))}function ks(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.reportUser())}),b(1,"ss-icon",14),a(2,"span"),g(3,"Report user"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function xs(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.blockUser())}),b(1,"ss-icon",15),a(2,"span"),g(3,"Block user"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function ys(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.banUser())}),b(1,"ss-icon",16),a(2,"span"),g(3,"Ban user"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function Ss(n,r){if(n&1&&b(0,"ss-upgrade-cta",20),n&2){let i=l(4);p("short",!0)("openedFromSource",i.TriggeredUpgradeFromSourceRef.TwoWayHide)}}function Ms(n,r){if(n&1){let i=P();a(0,"div",18)(1,"button",19),f("click",function(){_(i);let t=l(3);return C(t.hideUser(!0))}),b(2,"ss-icon",17),a(3,"span"),g(4,"Two-way hide"),c()(),u(5,Ss,1,2,"ss-upgrade-cta",20),c()}if(n&2){let i=l(3);s(),p("disabled",!i.subscriptionService.hasPremiumFeatures),s(),p("size",24),s(3),h(i.subscriptionService.hasPremiumFeatures?-1:5)}}function ws(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l(2);return C(t.hideUser())}),b(1,"ss-icon",17),a(2,"span"),g(3,"Hide user"),c()(),u(4,Ms,6,3,"div",18)}if(n&2){let i=l(2);s(),p("size",24),s(3),h(i.participant.userInfo.isModerator?-1:4)}}function Os(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l(2);return C(t.unhideUser())}),b(1,"ss-icon",21),a(2,"span"),g(3,"Unhide user"),c()()}n&2&&(s(),p("size",24))}function Ts(n,r){if(n&1&&(u(0,ws,5,2),u(1,Os,4,1,"button",3)),n&2){let i=l();h(i.showHideUserOptions&&!i.isHiddenParticipant?0:-1),s(),h(i.isHiddenParticipant?1:-1)}}function Is(n,r){if(n&1){let i=P();a(0,"button",5),f("click",function(){_(i);let t=l();return C(t.saveAsTestimonial())}),b(1,"ss-icon",22),a(2,"span"),g(3,"Save status as testimonial"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}var Li=(()=>{let r=class r{get isModerator(){return!!this.livekit.room.localParticipant.userInfo?.isModerator}get isAdministrator(){return this.accountService.isInRole(ft.Administrator)}get encouragements(){return this.livekit.encouragements}get isCurrentUser(){return this.accountService.currentUser.id===this.participant.identity}get isActiveGroupOwner(){return this.activeGroup?.createdByUserId===this.accountService.currentUser.id}get localParticipant(){return this.livekit.room.localParticipant}get shouldShowHideControls(){return!this.livekit.room.isPinned(this.participant.identity)&&!this.isCurrentUser}constructor(e,t,o,d,v,k,T,B,z,ke,pe,Ve,Xe){this.settingsService=e,this.dialog=t,this.livekit=o,this.subscriptionService=d,this.accountService=v,this.testimonialService=k,this.encouragementService=T,this.chatService=B,this.utilityService=z,this.accountModalsService=ke,this.snackBarService=pe,this.toastService=Ve,this.badgeService=Xe,this.isHiddenParticipant=!1,this.isRoomTileMenu=!1,this.isGroupTile=!1,this.showHideUserOptions=!1,this.participantMenuOpened=new ce,this.openUserBio=new ce,this.openTaskHistory=new ce,this.menuOpened=!1,this.TriggeredUpgradeFromSourceRef=re,this.subscriptions=[],this.isMobile=!1}ngOnInit(){this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}removeParticipant(){this.dialog.open(xo,{width:"420px",data:{userId:this.participant.identity,roomName:this.livekit.room.roomName,isLivekit:!0}})}reportUser(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.dialog.open(Ti,{panelClass:"fullscreen-dialog",width:"480px",disableClose:!0,data:{reportedUser:this.participant.userInfo,roomName:this.livekit.room.roomName,reportSource:Oi.FocusRoom,elementToScreenshotSelector:"ss-dashboard"}})}blockUser(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.dialog.open(So,{panelClass:"fullscreen-dialog",width:"414px",data:{user:this.participant.userInfo}})}banUser(){this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"BanUserConfirmation",confirmButtonLabel:"Yes, ban this user"}}).afterClosed().subscribe(t=>{!t||this.activeGroup===null||this.livekit.banUserForFocusRoomSessionGroup(this.livekit.room.name,this.activeGroup.id,this.participant.identity).subscribe({error:o=>this.handleErrors(o)})})}encourageUser(e){if(!this.accountModalsService.ensureUserCompletedBasicInfo()||this.livekit.room.checkEncouragementsDisabled(this.participant))return;let t={encouragementTypeId:e.id};this.encouragementService.postEncouragement(this.participant.identity,t).subscribe({next:o=>Y(this,null,function*(){this.livekit.room.milestones.encouragedSomeone||this.subscriptions.push(W(2e3).subscribe(()=>this.badgeService.checkForNewBadges.next())),this.livekit.room.milestones.encouragedSomeone=!0,o.receiverWasInFocusMode?yield this.snackBarService.info({message:"This user is currently focussing. They'll see your encouragement later on."}):o.encouragementsPerDayLeft!==null?yield this.snackBarService.info({message:`Encouragement sent. You have ${o.encouragementsPerDayLeft} encouragements left for today.`}):yield this.snackBarService.info({message:"Encouragement sent."})}),error:o=>{o[0].errorCode==="EncouragementTimeLimit"?this.toastService.info({title:"Please wait",exceptionDetail:o[0]}):o[0].errorCode==="MaxEncouragementsPerDayReached"?this.toastService.info({title:"Maximum encouragements reached",exceptionDetail:o[0],paidFeatureText:"Upgrade to encourage more",triggeredUpgradeFromSource:re.MaxEncouragementsReached,autoClose:!1}):o[0].errorCode==="MaxEncouragementsPerDayReachedPremium"?this.toastService.info({title:"Maximum encouragements reached",exceptionDetail:o[0]}):this.handleErrors(o)}})}messageUser(){if(!this.accountModalsService.ensureUserCompletedBasicInfo())return;let e={otherUserIds:[this.participant.identity]};this.chatService.checkIfChatExists(e.otherUserIds[0]).subscribe({next:()=>{this.chatService.startChat(e).subscribe({next:t=>this.navigateToChat(t.id),error:t=>{t.length&&t[0].errorCode==="ChatAlreadyExists"?this.navigateToChat(t[0].params.chatId):this.handleErrors(t)}})},error:t=>{t.length&&t[0].errorCode==="ChatDoesNotExist"?this.isMobile?window.open(`${le.appUrl}/conversations/chats/create?userId=${e.otherUserIds[0]}`,"_blank"):this.utilityService.requestChatNavigation.next(e.otherUserIds[0]):this.handleErrors(t)}})}forceCameraOff(){this.livekit.forceTurnOffCameraForParticipant(this.livekit.room.name,this.participant.identity).subscribe()}forceAudioOff(){this.livekit.forceTurnOffAudioForParticipant(this.livekit.room.name,this.participant.identity).subscribe()}hideUser(e=!1){if(!this.accountModalsService.ensureUserCompletedBasicInfo())return;this.dialog.open(Ui,{panelClass:"fullscreen-dialog",width:"500px"}).afterClosed().subscribe(o=>{o&&this.livekit.room.hide(this.participant,e)})}unhideUser(){this.livekit.room.unhide(this.participant.identity)}onMenuOpened(){this.participantMenuOpened.emit(!0),this.menuOpened=!0}onMenuClosed(){this.participantMenuOpened.emit(!1),this.menuOpened=!1}showUserBio(){this.openUserBio.emit()}showTaskHistory(){this.openTaskHistory.emit()}saveAsTestimonial(){this.participant.status&&this.testimonialService.saveTestimonial(Ri.LivekitUserStatus,this.participant.status.id).subscribe({next:()=>Y(this,null,function*(){return yield this.snackBarService.info({message:"Saved as testimonial."})}),error:e=>this.handleErrors(e)})}navigateToChat(e){this.isMobile?window.open(`${le.appUrl}/conversations/chats/${e}`,"_blank"):this.utilityService.openDmTrayChat.next(e)}handleErrors(e){if(e[0].errorCode==="ErrorChattingAgeRestriction"){this.toastService.info({exceptionDetail:e[0]});return}this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(X),m(N),m(M),m(_e),m(G),m(Mi),m(kt),m(Mt),m(J),m(K),m(xt),m(F),m(Qe))},r.\u0275cmp=x({type:r,selectors:[["ss-participant-menu"]],inputs:{participant:"participant",isHiddenParticipant:"isHiddenParticipant",isRoomTileMenu:"isRoomTileMenu",isGroupTile:"isGroupTile",showHideUserOptions:"showHideUserOptions"},outputs:{participantMenuOpened:"participantMenuOpened",openUserBio:"openUserBio",openTaskHistory:"openTaskHistory"},standalone:!1,decls:14,vars:18,consts:[["participantMenu","matMenu"],["role","button","iconName","more_horizontal",3,"menuOpened","menuClosed","matMenuTriggerFor","color","size"],["xPosition","before","yPosition","below"],["mat-menu-item",""],["mat-menu-item","",3,"matTooltip","disabled"],["mat-menu-item","",3,"click"],["iconName","thumb_like",3,"iconVariant","size"],["mat-menu-item","",3,"click","matTooltip","disabled"],["iconName","chat",3,"iconVariant","size"],["iconName","person_subtract",3,"iconVariant","size"],["iconName","camera_off",3,"iconVariant","size"],["iconName","mic_off",3,"iconVariant","size"],["iconName","tasks_app",3,"iconVariant","size"],["iconName","person",3,"iconVariant","size"],["iconName","shield_error",3,"iconVariant","size"],["iconName","dismiss_square",3,"iconVariant","size"],["iconName","chat_dismiss",3,"iconVariant","size"],["iconName","eye_off",3,"size"],[1,"two-way-hide"],["mat-menu-item","","matTooltip","This feature will hide this user from your grid and also prevent them from seeing your video tile.",3,"click","disabled"],[3,"short","openedFromSource"],["iconName","eye",3,"size"],["iconName","mail_inbox",3,"iconVariant","size"]],template:function(t,o){if(t&1){let d=P();a(0,"ss-icon",1),f("menuOpened",function(){return _(d),C(o.onMenuOpened())})("menuClosed",function(){return _(d),C(o.onMenuClosed())}),c(),a(1,"mat-menu",2,0),u(3,fs,4,2,"button",3),u(4,vs,4,4,"button",4),u(5,_s,4,2,"button",3),u(6,Cs,4,2,"button",3),u(7,bs,4,2,"button",3),u(8,Ps,8,4),u(9,ks,4,2,"button",3),u(10,xs,4,2,"button",3),u(11,ys,4,2,"button",3),u(12,Ts,2,2),u(13,Is,4,2,"button",3),c()}if(t&2){let d=xe(2);S("room-tile-menu",o.isRoomTileMenu)("active",o.menuOpened),p("matMenuTriggerFor",d)("color",o.isRoomTileMenu?"contrast":"default-60")("size",18),s(3),h(o.encouragements.length>0&&!o.isCurrentUser&&!o.isHiddenParticipant?3:-1),s(),h(!o.isCurrentUser&&!o.isHiddenParticipant&&!o.settingsService.isB2BApp()?4:-1),s(),h(o.isModerator&&!o.participant.userInfo.isModerator?5:-1),s(),h(o.isModerator&&o.participant.isCameraEnabled&&!o.participant.userInfo.isModerator?6:-1),s(),h(o.isModerator&&o.participant.isMicrophoneEnabled&&!o.participant.userInfo.isModerator?7:-1),s(),h(o.isRoomTileMenu?8:-1),s(),h(o.isCurrentUser?-1:9),s(),h(o.isCurrentUser?-1:10),s(),h(o.isGroupTile&&!o.isCurrentUser&&o.isActiveGroupOwner?11:-1),s(),h(o.shouldShowHideControls?12:-1),s(),h(o.isAdministrator&&o.participant.status?13:-1)}},dependencies:[_t,w,ro,xi,so,L],styles:["[_nghost-%COMP%]{display:flex}.room-tile-menu.active[_ngcontent-%COMP%]     i, .room-tile-menu[_ngcontent-%COMP%]:hover     i{color:var(--accent-blue-20);opacity:1}.two-way-hide[_ngcontent-%COMP%]{display:flex}"]});let n=r;return n})();var Fs=(n,r)=>r.id;function Rs(n,r){if(n&1){let i=P();a(0,"div",11),f("click",function(){let t=_(i).$implicit,o=l(2);return C(o.selectedCharCode=t.reactionCharCode)}),b(1,"span",12),Te(2,"emoji"),g(3),c()}if(n&2){let i=r.$implicit,e=l(2);S("my-reaction",e.currentUserHasReacted(i))("active",i.reactionCharCode===e.selectedCharCode),s(),p("innerHTML",De(2,6,i.reactionCharCode),Ze),s(2),O("\xA0\xA0",i.usersReacted.length>999?"999+":i.usersReacted.length," ")}}function Es(n,r){if(n&1){let i=P();a(0,"ss-icon",18),f("click",function(){_(i);let t=l().$implicit,o=l(2);return C(o.removeReaction(t))}),c()}n&2&&p("size",20)("iconVariant",20)}function Us(n,r){n&1&&b(0,"mat-spinner",17)}function Vs(n,r){if(n&1){let i=P();a(0,"div",10)(1,"div",13),f("click",function(){let t=_(i).$implicit,o=l(2);return C(o.togglePopup(t.id))}),b(2,"ss-user-avatar",14),a(3,"span",15),g(4),c()(),u(5,Es,1,2,"ss-icon",16),u(6,Us,1,0,"mat-spinner",17),c()}if(n&2){let i=r.$implicit,e=l(2);s(2),p("size",24)("title",i.displayName)("initials",i.initials)("avatarColor",i.avatarColor)("avatarThumbUrl",i.avatarThumbUrl)("userId",i.id)("showOnlineStatus",!1),s(2),Se("",i.displayName,"",e.isMyReaction(i)?" (me)":""),s(),h(e.removingReactionUserId!==i.id&&e.canRemoveReaction(i)?5:-1),s(),h(e.removingReactionUserId===i.id?6:-1)}}function As(n,r){if(n&1&&(a(0,"div",7),V(1,Rs,4,8,"div",8,je),c(),a(3,"div",9),V(4,Vs,7,11,"div",10,Fs),c()),n&2){let i=l();s(),A(i.reactions),s(3),A(i.filteredUsersPerReaction)}}function Ls(n,r){n&1&&(a(0,"div",5),b(1,"mat-spinner",17),c())}function Gs(n,r){if(n&1){let i=P();a(0,"ss-user-popup",20),f("closePopup",function(){_(i);let t=l(2);return C(t.togglePopup())}),c()}if(n&2){let i=l(2);p("userId",i.userForPopupId)}}function Ds(n,r){if(n&1&&u(0,Gs,1,1,"ss-user-popup",19),n&2){let i=l();h(i.userForPopupId?0:-1)}}var fr=(()=>{let r=class r{get filteredUsersPerReaction(){let e=this.reactions.find(t=>t.reactionCharCode===this.selectedCharCode);return e?e.usersReacted:[]}constructor(e,t,o,d,v){this.participant=e,this.dialogRef=t,this.livekit=o,this.accountService=d,this.toastService=v,this.reactions=[],this.selectedCharCode=null,this.popupOpened=!1,this.loadingReactions=!0,this.userForPopupId=null,e.status&&this.livekit.getAllReactionsToUserStatus(this.livekit.room.name,e.status.id).subscribe({next:k=>{this.loadingReactions=!1,this.reactions=k,this.reactions.length>0&&(this.selectedCharCode=this.reactions[0].reactionCharCode),this.participant.status&&(this.participant.status.totalReactions=this.reactions.map(T=>T.usersReacted.length).reduce((T,B)=>T+B,0),this.reactions.length>0?this.participant.status.topReaction={reactionCharCode:this.reactions[0].reactionCharCode,reactionsCount:this.reactions[0].usersReacted.length}:this.participant.status.topReaction=null)},error:k=>this.handleErrors(k)})}togglePopup(e=null,t=null){t&&t.stopPropagation(),e&&(this.userForPopupId=e),this.popupOpened=!this.popupOpened}currentUserHasReacted(e){return e.usersReacted.some(t=>t.id===this.accountService.currentUser.id)}isMyReaction(e){return e.id===this.accountService.currentUser.id}canRemoveReaction(e){return this.participant.identity===this.accountService.currentUser.id||this.isMyReaction(e)||this.accountService.isInRole(ft.Administrator)||this.accountService.isInRole(ft.Moderator)}removeReaction(e){!this.selectedCharCode||!this.participant.status||(this.removingReactionUserId=e.id,this.livekit.reactToUserStatus(this.livekit.room.name,this.participant.status.id,this.selectedCharCode,e.id).subscribe({next:()=>{this.removingReactionUserId=null;let t=this.participant.status;if(!t||!t.topReaction)return;let o=this.filteredUsersPerReaction.find(k=>k.id===e.id);if(o&&this.filteredUsersPerReaction.splice(this.filteredUsersPerReaction.indexOf(o),1),t.topReaction.reactionCharCode===this.selectedCharCode&&(t.topReaction.reactionsCount--,t.topReaction.reactionsCount===0&&this.filteredUsersPerReaction.length===0&&this.reactions.length===1&&(t.topReaction=null)),t.totalReactions--,this.filteredUsersPerReaction.length>0)return;let d=this.reactions.find(k=>k.reactionCharCode===this.selectedCharCode);if(d&&this.reactions.splice(this.reactions.indexOf(d),1),this.reactions.length===0){this.dialogRef.close();return}let v=this.reactions[0];this.selectedCharCode=v.reactionCharCode,t.topReaction={reactionCharCode:v.reactionCharCode,reactionsCount:v.usersReacted.length}}}))}handleErrors(e){this.removingReactionUserId=null,this.loadingReactions=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(tt),m(ge),m(M),m(G),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-status-reactions-modal"]],standalone:!1,decls:10,vars:8,consts:[["trigger","cdkOverlayOrigin"],["cdkOverlayOrigin","",1,"mat-header"],["mat-dialog-title",""],["mat-dialog-close","",1,"close-modal"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"loader-wrapper"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],[1,"reactions"],["role","button",1,"reaction",3,"my-reaction","active"],[1,"users"],[1,"user-wrapper"],["role","button",1,"reaction",3,"click"],[3,"innerHTML"],[1,"user",3,"click"],[3,"size","title","initials","avatarColor","avatarThumbUrl","userId","showOnlineStatus"],[1,"interactable"],["iconName","dismiss","role","button","color","default-20",3,"size","iconVariant"],["diameter","20","strokeWidth","2"],["iconName","dismiss","role","button","color","default-20",3,"click","size","iconVariant"],["cssClass","margin-horizontal",3,"userId"],["cssClass","margin-horizontal",3,"closePopup","userId"]],template:function(t,o){if(t&1){let d=P();a(0,"div",1,0)(2,"h2",2),g(3,"Reactions"),c(),a(4,"button",3),b(5,"ss-icon",4),c()(),a(6,"mat-dialog-content"),u(7,As,6,0),u(8,Ls,2,0,"div",5),c(),ae(9,Ds,1,1,"ng-template",6),f("backdropClick",function(k){return _(d),C(o.togglePopup(null,k))})}if(t&2){let d=xe(1);s(5),p("size",20)("iconVariant",20),s(2),h(!o.loadingReactions&&o.reactions.length>0?7:-1),s(),h(o.loadingReactions?8:-1),s(),p("cdkConnectedOverlayOrigin",d)("cdkConnectedOverlayOpen",o.popupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0)}},dependencies:[w,Me,at,ye,oe,ee,Fe,Ie,ve,Ht],styles:[".loader-wrapper[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin:20px auto}mat-dialog-content[_ngcontent-%COMP%]{display:flex}.reactions[_ngcontent-%COMP%]{width:90px;margin:5px 24px 0 0;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.reactions[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.reactions[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.reactions[_ngcontent-%COMP%]::-webkit-scrollbar, .reactions[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.reactions[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.reaction[_ngcontent-%COMP%]{display:flex;align-items:center;width:68px;height:30px;padding-left:4px;border-radius:5px;color:var(--default-40)}.reaction.my-reaction[_ngcontent-%COMP%]{border:1px solid var(--accent-blurple-60)}.reaction[_ngcontent-%COMP%]:hover{color:var(--default-20);background:var(--alt-60)}.reaction.active[_ngcontent-%COMP%]{color:var(--default);background:var(--alt-40)}.reaction[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}.reaction[_ngcontent-%COMP%]     span.emoji-pipe-image{width:20px!important;height:20px!important}.users[_ngcontent-%COMP%]{width:100%;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.users[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.users[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.users[_ngcontent-%COMP%]::-webkit-scrollbar, .users[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.users[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.user-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 7px;margin-right:20px;border-bottom:1px solid var(--alt-40)}.user-wrapper[_ngcontent-%COMP%]:hover{background:var(--alt-40)}.user-wrapper[_ngcontent-%COMP%]:last-child{border-bottom:none}.user[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:13px;line-height:20px;color:var(--default);cursor:pointer}.user[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{margin-right:8px}"]});let n=r;return n})();function Ns(n,r){n&1&&b(0,"ss-premium-tick")}function zs(n,r){if(n&1&&b(0,"ss-badge",9),n&2){let i=l(2);p("badge",i.participant.userInfo.userBadge)}}function js(n,r){if(n&1&&(a(0,"div",10),g(1," NEW \u{1F389} "),c()),n&2){let i=l(2);p("matTooltip",i.participant.isLocal?"This new tag is shown during your first week. You can toggle it off in video settings.":"New user - give them a warm welcome!")}}function Hs(n,r){if(n&1&&(a(0,"div",11),b(1,"ss-icon",13),a(2,"small"),g(3),c()()),n&2){let i=l(2);s(),p("size",16),s(2),R(i.selectedTask.text)}}function Ws(n,r){if(n&1&&(a(0,"small"),g(1),c()),n&2){let i=l(2);s(),R(i.participant.userInfo.areaOfStudyName)}}function $s(n,r){if(n&1){let i=P();a(0,"ss-user-popup",14),f("focusRoomUnauthenticatedActionAttempt",function(){_(i);let t=l(2);return C(t.handleUnauthenticatedActionAttempt())})("closePopup",function(){_(i);let t=l(2);return C(t.userInfoPopupOpened=!1)}),c()}if(n&2){let i=l(2);p("userId",i.participant.identity)("openedFromSource",i.OpenedFromSourceRef.FocusRoom)}}function Js(n,r){if(n&1){let i=P();a(0,"div",6,0),f("click",function(){_(i);let t=l();return C(t.openUserPopup())}),a(2,"div",7),u(3,Ns,1,0,"ss-premium-tick"),a(4,"div",8),g(5),c(),u(6,zs,1,1,"ss-badge",9),u(7,js,2,1,"div",10),c(),u(8,Hs,4,2,"div",11)(9,Ws,2,1,"small"),ae(10,$s,1,2,"ng-template",12),f("backdropClick",function(){_(i);let t=l();return C(t.userInfoPopupOpened=!1)}),c()}if(n&2){let i=xe(1),e=l();S("hide",e.userStatusPopupOpened),s(3),h(!e.settingsService.isB2BApp()&&e.participant.userInfo.showPremiumTick?3:-1),s(2),Se(" ",e.participant.userInfo.displayName,"",e.participant.isLocal?" (you)":""," "),s(),h(e.participant.userInfo.userBadge?6:-1),s(),h(e.showNewUserMarker?7:-1),s(),h(e.selectedTask?8:9),s(2),p("cdkConnectedOverlayOrigin",i)("cdkConnectedOverlayOpen",e.userInfoPopupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0)}}function qs(n,r){if(n&1){let i=P();a(0,"ss-user-avatar",22),f("click",function(){_(i);let t=l(2);return C(t.userStatusPopupOpened=!0)}),c()}if(n&2){let i=l(2);p("size",28)("avatarColor",i.participant.userInfo.avatarColor)("avatarThumbUrl",i.participant.userInfo.avatarThumbUrl)("showOnlineStatus",!1)("userId",i.participant.identity)("initials",i.participant.userInfo.initials)}}function Ys(n,r){n&1&&b(0,"ss-premium-tick")}function Ks(n,r){if(n&1&&(a(0,"div",10),g(1," NEW \u{1F389} "),c()),n&2){let i=l(2);p("matTooltip",i.participant.isLocal?"This new tag is shown during your first week. You can toggle it off in video settings.":"New user - give them a warm welcome!")}}function Qs(n,r){if(n&1&&(a(0,"span"),g(1),c()),n&2){let i=l(4);s(),O("+",i.otherReactionsCount)}}function Xs(n,r){if(n&1){let i=P();a(0,"ss-button-small",24),f("buttonClick",function(){_(i);let t=l(3);return C(t.reactToUserStatus(t.participant.status.topReaction.reactionCharCode))}),b(1,"span",25),Te(2,"emoji"),g(3),c(),a(4,"ss-button-small",26),f("buttonClick",function(){_(i);let t=l(3);return C(t.showAllReactionsModal())}),u(5,Qs,2,1,"span"),c()}if(n&2){let i=l(3);p("isLoading",i.reactionLoading),s(),p("innerHTML",De(2,5,i.participant.status.topReaction.reactionCharCode),Ze),s(2),O(" ",i.participant.status.topReaction.reactionsCount," "),s(),p("iconName",i.otherReactionsCount?"":"emoji_multiple"),s(),h(i.otherReactionsCount>0?5:-1)}}function Zs(n,r){if(n&1){let i=P();a(0,"div",20),u(1,Xs,6,7),a(2,"ss-emoji-picker",23),f("emojiSelected",function(t){_(i);let o=l(2);return C(o.onReactionChanged(t))}),c()()}if(n&2){let i=l(2);s(),h(i.participant.status&&i.participant.status.topReaction?1:-1),s(),p("isMobile",i.isMobile)("iconSize",20)("isReaction",!0)}}function ea(n,r){if(n&1){let i=P();a(0,"ss-user-popup",14),f("focusRoomUnauthenticatedActionAttempt",function(){_(i);let t=l(2);return C(t.handleUnauthenticatedActionAttempt())})("closePopup",function(){_(i);let t=l(2);return C(t.userStatusPopupOpened=!1)}),c()}if(n&2){let i=l(2);p("userId",i.participant.identity)("openedFromSource",i.OpenedFromSourceRef.FocusRoom)}}function ta(n,r){if(n&1){let i=P();a(0,"div",15,1),f("mouseenter",function(){_(i);let t=l();return C(t.onStatusMouseEnter())})("mouseleave",function(){_(i);let t=l();return C(t.onStatusMouseLeave())}),a(2,"div",16,2),u(4,qs,1,6,"ss-user-avatar",17),u(5,Ys,1,0,"ss-premium-tick"),a(6,"div",18),f("click",function(){_(i);let t=l();return C(t.userStatusPopupOpened=!0)}),g(7),c(),u(8,Ks,2,1,"div",10),c(),a(9,"div",19),u(10,Zs,3,4,"div",20),a(11,"div",21),f("click",function(){_(i);let t=l();return C(t.userStatusPopupOpened=!0)}),g(12),c()(),ae(13,ea,1,2,"ng-template",12),f("backdropClick",function(){_(i);let t=l();return C(t.userStatusPopupOpened=!1)}),c()}if(n&2){let i=xe(3),e=l();S("active",e.userStatusPopupOpened),s(4),h(e.participant.userInfo?4:-1),s(),h(!e.settingsService.isB2BApp()&&e.participant.userInfo.showPremiumTick?5:-1),s(),S("no-tick",e.settingsService.isB2BApp()||!e.participant.userInfo.showPremiumTick),s(),Se(" ",e.participant.userInfo.displayName,"",e.participant.isLocal?" (you)":""," "),s(),h(e.showNewUserMarker?8:-1),s(2),h(e.focusPlusActive?-1:10),s(),S("expanded",e.statusHoverExpanded),s(),O(" ",e.participant.status==null?null:e.participant.status.text," "),s(),p("cdkConnectedOverlayOrigin",i)("cdkConnectedOverlayOpen",e.userStatusPopupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0)}}var vr=(()=>{let r=class r{get otherReactionsCount(){return this.participant.status?.topReaction?this.participant.status.totalReactions-this.participant.status.topReaction.reactionsCount:0}get hasStatus(){return!!this.participant.status&&(!this.participant.isLocal||!this.livekit.room.userActiveStatus?.clearedAt)}get showNewUserMarker(){return this.participant.userInfo.showNewUserMarker}get focusPlusActive(){return!!this.livekit.room?.focusPlus.active}get selectedTask(){return this.participant.isLocal?this.accountService.currentUser.selectedTask:this.participant.selectedTask}constructor(e,t,o,d,v,k){this.settingsService=e,this.accountModalsService=t,this.dialog=o,this.toastService=d,this.livekit=v,this.accountService=k,this.userInfoPopupOpened=!1,this.userStatusPopupOpened=!1,this.statusHoverExpanded=!1,this.reactionLoading=!1,this.OpenedFromSourceRef=Pt}ngOnDestroy(){this.statusReactionsModalSubscription?.unsubscribe()}openUserPopup(){this.isMobile||(this.userInfoPopupOpened=!0)}onStatusMouseEnter(){this.statusHoverExpanded=!0}onStatusMouseLeave(){setTimeout(()=>{this.statusHoverExpanded=!1},300)}onReactionChanged(e){this.accountModalsService.ensureUserCompletedBasicInfo()&&(!this.participant.status||!e.native||this.reactToUserStatus(e.native))}reactToUserStatus(e){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.participant.status&&(this.reactionLoading=!0,this.livekit.reactToUserStatus(this.livekit.room.name,this.participant.status.id,e).subscribe({next:t=>this.onReactionSuccess(t,e),error:t=>this.handleErrors(t)}))}showAllReactionsModal(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.participant.status&&this.dialog.open(fr,{panelClass:"fullscreen-dialog",width:"600px",data:this.participant})}handleUnauthenticatedActionAttempt(){this.reactionLoading=!1,this.accountModalsService.ensureUserCompletedBasicInfo()}onReactionSuccess(e,t){let o=this.participant.status;if(!o){this.reactionLoading=!1;return}if(e){if(!o.topReaction){o.topReaction={reactionCharCode:e.reactionCharCode,reactionsCount:1},o.totalReactions=1,this.reactionLoading=!1;return}o.topReaction.reactionCharCode===e.reactionCharCode&&o.topReaction.reactionsCount++,o.totalReactions++,this.reactionLoading=!1}else if(o.totalReactions--,o.topReaction&&o.topReaction.reactionCharCode===t){if(o.topReaction.reactionsCount--,o.totalReactions===0){o.topReaction=null,this.reactionLoading=!1;return}if(o.topReaction.reactionsCount>0){this.reactionLoading=!1;return}this.livekit.getTopReactionToUserStatus(this.livekit.room.name,o.id).subscribe({next:d=>{o.topReaction=d,this.reactionLoading=!1},error:d=>this.handleErrors(d)})}else this.reactionLoading=!1}handleErrors(e){this.reactionLoading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(X),m(K),m(N),m(F),m(M),m(G))},r.\u0275cmp=x({type:r,selectors:[["ss-user-info-status"]],inputs:{participant:"participant",isMobile:"isMobile"},standalone:!1,decls:3,vars:2,consts:[["userInfoTrigger","cdkOverlayOrigin"],["statusWrapperElement",""],["userStatusTrigger","cdkOverlayOrigin"],[1,"user-info-wrapper"],["cdkOverlayOrigin","","role","button",1,"user-info",3,"hide"],[1,"status-wrapper",3,"active"],["cdkOverlayOrigin","","role","button",1,"user-info",3,"click"],[1,"name-wrapper"],[1,"notification"],[3,"badge"],[1,"new-user-marker",3,"matTooltip"],[1,"selected-task"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],["iconName","target","color","accent-blue",3,"size"],["cssClass","margin-horizontal",3,"focusRoomUnauthenticatedActionAttempt","closePopup","userId","openedFromSource"],[1,"status-wrapper",3,"mouseenter","mouseleave"],["cdkOverlayOrigin","",1,"status-name-wrapper"],["status","online",3,"size","avatarColor","avatarThumbUrl","showOnlineStatus","userId","initials"],[1,"notification","display-name",3,"click"],[1,"reaction-status-wrapper"],[1,"reactions"],[1,"status","notification",3,"click"],["status","online",3,"click","size","avatarColor","avatarThumbUrl","showOnlineStatus","userId","initials"],["matTooltip","Emoji React","matTooltipPosition","above",3,"emojiSelected","isMobile","iconSize","isReaction"],["matTooltip","Top reaction","matTooltipPosition","above",3,"buttonClick","isLoading"],[3,"innerHTML"],["matTooltip","User reactions","matTooltipPosition","above",3,"buttonClick","iconName"]],template:function(t,o){t&1&&(a(0,"div",3),u(1,Js,11,12,"div",4),c(),u(2,ta,14,17,"div",5)),t&2&&(s(),h(o.participant.userInfo?1:-1),s(),h(o.hasStatus?2:-1))},dependencies:[zo,w,Me,at,Ce,rt,Ii,Fe,Ie,L,Ht],styles:["[_nghost-%COMP%]{display:block}.user-info-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:2px;left:2px;z-index:3;display:flex}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:baseline;max-width:280px;padding:2px 8px;border-radius:10px;background:var(--video-overlay)}.user-info[_ngcontent-%COMP%]   .name-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.user-info[_ngcontent-%COMP%]   .selected-task[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:4px}.user-info[_ngcontent-%COMP%]   .selected-task[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:4px}.user-info[_ngcontent-%COMP%]   ss-badge[_ngcontent-%COMP%]{flex-shrink:0;margin-left:5px}.user-info[_ngcontent-%COMP%]   .notification[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:-webkit-box;overflow:hidden;color:var(--contrast);word-break:break-all;text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}.user-info[_ngcontent-%COMP%]   .new-user-marker[_ngcontent-%COMP%]{margin-left:6px}.new-user-marker[_ngcontent-%COMP%]{font-size:8px;font-weight:600;color:var(--positive)}.status-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:2px;left:2px;z-index:1;width:calc(100% - 4px);padding:2px;border-radius:10px;background:rgba(var(--blue-black-rgb),.85);cursor:pointer}.status-wrapper[_ngcontent-%COMP%]:hover   .status-name-wrapper[_ngcontent-%COMP%], .status-wrapper.active[_ngcontent-%COMP%]   .status-name-wrapper[_ngcontent-%COMP%]{bottom:0;height:20px;opacity:1;transition:bottom .3s ease-out,height .3s ease-out,opacity .3s .15s ease-out}.status-wrapper[_ngcontent-%COMP%]:hover   .status[_ngcontent-%COMP%], .status-wrapper.active[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{max-height:52px}.status-wrapper[_ngcontent-%COMP%]   .new-user-marker[_ngcontent-%COMP%]{margin-left:2px}.status-name-wrapper[_ngcontent-%COMP%]{position:relative;bottom:-19px;display:flex;align-items:center;height:0;opacity:0;transition:bottom .3s ease-out,height .3s ease-out,opacity .15s ease-out}.status-name-wrapper[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{position:relative;top:-5px}.status-name-wrapper[_ngcontent-%COMP%]   ss-premium-tick[_ngcontent-%COMP%]{position:relative;top:-2px;margin-left:4px}.status-name-wrapper[_ngcontent-%COMP%]   .display-name[_ngcontent-%COMP%]{position:relative;bottom:1px;display:-webkit-box;overflow:hidden;padding-right:3px;color:var(--contrast);text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}.status-name-wrapper[_ngcontent-%COMP%]   .display-name.no-tick[_ngcontent-%COMP%]{margin-left:4px}.reaction-status-wrapper[_ngcontent-%COMP%]{position:relative}.reactions[_ngcontent-%COMP%]{position:absolute;top:-23px;right:10px;display:flex;align-items:center;gap:0 6px}.reactions[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]     button{height:24px;border:1px solid var(--accent-gradient-60-dark);border-radius:5px;background-color:var(--accent-blue-80-dark)}.reactions[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]     button ss-icon{margin-right:0;background:var(--accent-blue);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}.reactions[_ngcontent-%COMP%]   ss-emoji-picker[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:24px;padding:0 5px;border:1px solid var(--accent-gradient-60-dark);border-radius:5px;background-color:var(--accent-blue-80-dark)}.reactions[_ngcontent-%COMP%]   ss-emoji-picker[_ngcontent-%COMP%]     ss-icon i{background:var(--accent-blue);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}.status[_ngcontent-%COMP%]{display:-webkit-box;max-height:20px;overflow:hidden;padding:2px 8px;border-radius:8px;color:var(--contrast);text-overflow:ellipsis;white-space:pre-wrap;background:var(--widget-super-subtle);transition:max-height .3s ease-out;-webkit-line-clamp:1;-webkit-box-orient:vertical}.status.expanded[_ngcontent-%COMP%]{-webkit-line-clamp:3}"]});let n=r;return n})();var na=(n,r)=>r.id;function oa(n,r){n&1&&b(0,"mat-spinner",11)}function ra(n,r){if(n&1){let i=P();a(0,"div",15),f("click",function(){let t=_(i).$implicit,o=l(3);return C(o.sendFeedback(t.id))}),g(1),c()}if(n&2){let i=r.$implicit;s(),R(i.text)}}function sa(n,r){if(n&1){let i=P();a(0,"div",15),f("click",function(){_(i);let t=l(3);return C(t.otherInputVisible=!0)}),g(1,"Other"),c()}}function aa(n,r){if(n&1){let i=P();a(0,"div",14)(1,"ss-input",16),he("ngModelChange",function(t){_(i);let o=l(3);return ue(o.otherOptionText,t)||(o.otherOptionText=t),C(t)}),f("keyup.enter",function(){_(i);let t=l(3);return C(t.sendFeedback(null))}),c()()}if(n&2){let i=l(3);s(),p("actions",i.inputActions),me("ngModel",i.otherOptionText),p("maxlength",50)}}function ca(n,r){if(n&1&&(a(0,"div",12),V(1,ra,2,1,"div",13,na),u(3,sa,2,0,"div",13),c(),u(4,aa,2,3,"div",14)),n&2){let i=l(2);s(),A(i.options),s(2),h(i.otherInputVisible?-1:3),s(),h(i.otherInputVisible?4:-1)}}function la(n,r){if(n&1){let i=P();a(0,"div",4)(1,"div",5)(2,"div",6),b(3,"ss-icon",7),a(4,"div",8)(5,"h4"),g(6),c()()(),a(7,"ss-button",9),f("buttonClick",function(){_(i);let t=l();return C(t.closePopup())}),c()(),a(8,"div",10),u(9,oa,1,0,"mat-spinner",11)(10,ca,5,2),c()()}if(n&2){let i=l();s(3),p("size",24),s(3),O("Why did you pin ",i.participant.userInfo.displayName,"?"),s(),p("iconVariant",20)("iconSize",24)("iconOnly",!0),s(),S("scrollable",!i.feedbackPopupInViewport),s(),h(i.loadingOptions?9:10)}}var _r=(()=>{let r=class r{constructor(e,t,o,d){this.livekit=e,this.accountService=t,this.toastService=o,this.userInteractionsService=d,this.popupOpened=!1,this.options=[],this.otherOptionText="",this.loadingOptions=!1,this.sendingAnswer=!1,this.otherInputVisible=!1,this.positionPairs=[{offsetY:-52,originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],this.inputActions={send:{iconName:"send",loading:this.sendingAnswer,onClick:()=>this.sendFeedback(null),disabled:()=>this.otherOptionText.length<3}},this.PIN_REASON_NO_ANSWER_ID_REF=Yi,this.feedbackPopupInViewport=!0}openPopup(){this.loadingOptions=!0,this.popupOpened=!0,this.userInteractionsService.getInteractionOptions(Ko.Pin).subscribe({next:e=>{this.loadingOptions=!1,this.options=e.filter(t=>t.id!==Yi),setTimeout(()=>{let t=document.querySelector(".feedback-popup");t&&(this.feedbackPopupInViewport=jn(t))})},error:e=>this.handleErrors(e)})}closePopup(){this.popupOpened=!1,this.otherOptionText="",this.otherInputVisible=!1,this.feedbackPopupInViewport=!0}sendFeedback(e){if(this.sendingAnswer)return;let t={userInteractedWithId:this.participant.identity};e?t.optionId=e:t.otherOptionText=this.otherOptionText,this.sendingAnswer=!0,this.userInteractionsService.postAnswer(t).subscribe({next:()=>{this.loadingOptions=!1,this.popupOpened=!1,this.sendingAnswer=!1,this.participant.shouldShowPinQuestion=!1},error:o=>this.handleErrors(o)})}handleErrors(e){this.loadingOptions=!1,this.sendingAnswer=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(G),m(F),m(Qo))},r.\u0275cmp=x({type:r,selectors:[["ss-pin-feedback"]],hostVars:2,hostBindings:function(t,o){t&2&&S("popup-opened",o.popupOpened)},inputs:{participant:"participant"},standalone:!1,decls:5,vars:8,consts:[["pinningReasonOptionTrigger","cdkOverlayOrigin"],["cdkOverlayOrigin","",1,"feedback-circle",3,"click"],["color","website-transparent","iconName","dismiss",1,"close-modal",3,"buttonClick","iconVariant","iconSize","iconOnly"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose","cdkConnectedOverlayPositions"],[1,"feedback-popup"],[1,"header"],[1,"left"],["iconName","pin","color","accent-blue",3,"size"],[1,"text"],["color","website-transparent","iconName","dismiss",1,"close-popup",3,"buttonClick","iconVariant","iconSize","iconOnly"],[1,"popup-content-wrapper"],["diameter","20","strokeWidth","2"],[1,"reasons-list"],[1,"interactable"],[1,"input-wrapper"],[1,"interactable",3,"click"],["name","otherOption","placeholder","Enter other reason...","autocomplete","off",3,"ngModelChange","keyup.enter","actions","ngModel","maxlength"]],template:function(t,o){if(t&1){let d=P();a(0,"div",1,0),f("click",function(){return _(d),C(o.openPopup())}),g(2,` Pin reason
`),c(),a(3,"ss-button",2),f("buttonClick",function(){return _(d),C(o.sendFeedback(o.PIN_REASON_NO_ANSWER_ID_REF))}),c(),ae(4,la,11,8,"ng-template",3),f("backdropClick",function(){return _(d),C(o.closePopup())})}if(t&2){let d=xe(1);s(3),p("iconVariant",20)("iconSize",12)("iconOnly",!0),s(),p("cdkConnectedOverlayOrigin",d)("cdkConnectedOverlayOpen",o.popupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0)("cdkConnectedOverlayPositions",o.positionPairs)}},dependencies:[I,w,Ee,te,Bt,ie,Fe,Ie,ve],styles:["[_nghost-%COMP%]{position:absolute;top:40px;right:10px;z-index:3;filter:drop-shadow(var(--inner-strong))}.popup-opened[_nghost-%COMP%]   .feedback-circle[_ngcontent-%COMP%], .popup-opened[_nghost-%COMP%]   .close-modal[_ngcontent-%COMP%]{visibility:hidden}.feedback-circle[_ngcontent-%COMP%]{display:flex;align-items:center;width:52px;height:52px;border-radius:50%;font-size:13px;line-height:normal;color:var(--contrast);background:var(--accent-blue-80-dark);cursor:pointer;text-align:center}.feedback-circle[_ngcontent-%COMP%]:hover{background:var(--accent-blue-60-dark)}.close-modal[_ngcontent-%COMP%]{position:absolute;top:-2px;right:0;width:20px;border-radius:50%;background:var(--accent-blue-80-dark)}.close-modal[_ngcontent-%COMP%]:hover{background:var(--accent-blue-60-dark)}.close-modal[_ngcontent-%COMP%]     button{width:20px;height:20px;padding:10px}.close-popup[_ngcontent-%COMP%]     button{width:20px;height:20px;padding:0}.close-popup[_ngcontent-%COMP%]     button ss-icon i{color:var(--default-60)}.popup-content-wrapper.scrollable[_ngcontent-%COMP%]{height:120px;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.popup-content-wrapper.scrollable[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.popup-content-wrapper.scrollable[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.popup-content-wrapper.scrollable[_ngcontent-%COMP%]::-webkit-scrollbar, .popup-content-wrapper.scrollable[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.popup-content-wrapper.scrollable[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.feedback-popup[_ngcontent-%COMP%]{width:300px;border:1px solid var(--alt);border-radius:20px;background:var(--contrast)}.feedback-popup[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:8px}.feedback-popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%], .feedback-popup[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.feedback-popup[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{padding:12px}.feedback-popup[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{margin-right:20px}.feedback-popup[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .feedback-popup[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-40)}mat-spinner[_ngcontent-%COMP%]{margin:0 auto 12px}.input-wrapper[_ngcontent-%COMP%]{padding:6px 12px 0;margin:0}.reasons-list[_ngcontent-%COMP%]   .interactable[_ngcontent-%COMP%]{padding:6px 12px;color:var(--default-40);cursor:pointer}.reasons-list[_ngcontent-%COMP%]   .interactable[_ngcontent-%COMP%]:last-of-type{border-bottom-right-radius:20px;border-bottom-left-radius:20px}.reasons-list[_ngcontent-%COMP%]   .interactable[_ngcontent-%COMP%]:hover{background-color:var(--alt-60)}"]});let n=r;return n})();var ua=["videoElement"];function ha(n,r){if(n&1){let i=P();a(0,"div",28),f("click",function(){_(i);let t=l(2);return C(t.onVideoClicked())}),c()}if(n&2){let i=l(2);S("ad-user",i.adUser&&i.adUser.adUrl)}}function ga(n,r){if(n&1){let i=P();a(0,"ss-html-tooltip",4)(1,"ss-button",29),f("buttonClick",function(){_(i);let t=l(2);return C(t.isPinned?t.unpin():t.pin(!0))}),c(),a(2,"div",30)(3,"h4"),g(4,"Pin to Start Focusing Together"),c(),a(5,"p"),g(6,"Pinning is a low-pressure way to connect."),c(),a(7,"p"),g(8,"All of these people have Pin4Pin enabled - they want you to pin them, and they'll pin you back!"),c(),a(9,"p"),g(10,"Note: They won't see you unless your camera is on."),c()()()}if(n&2){let i=l(2);p("disabled",i.isPinned||i.focusPlusActive),s(),S("pulse-white",!i.isPinned&&i.participant.isCameraEnabled&&!i.focusPlusActive)("pulse-gray",!i.isPinned&&!i.participant.isCameraEnabled&&!i.focusPlusActive),p("matTooltipPosition",i.isGroupTile?"below":"above")("matTooltip",i.focusPlusActive?"Cannot "+(i.isPinned?"unpin":"pin")+" in Focus+":i.isPinned?"Unpin":"Pin")("iconName",i.isPinned?"pin_off":"pin")("iconOnly",!0)("iconSize",20)("isLoading",i.livekit.room.pinningUserIds!==null&&i.livekit.room.pinningUserIds.includes(i.participant.identity))("disabled",i.focusPlusActive||i.livekit.room.pinningUserIds!==null&&!i.livekit.room.pinningUserIds.includes(i.participant.identity))}}function fa(n,r){if(n&1&&b(0,"div",34),n&2){let i=l(3);S("premium",i.participant.userInfo.includePremiumFeatures)}}function va(n,r){if(n&1&&(a(0,"div",32),b(1,"ss-icon",35),a(2,"small"),g(3),c()()),n&2){let i=l(3);s(),p("size",12),s(2),R(i.participant.pinnedCount)}}function _a(n,r){if(n&1){let i=P();a(0,"div",33)(1,"img",36),f("click",function(){_(i);let t=l(3);return C(t.openSpotifyUrl(t.participant.spotifyData.url))}),c(),a(2,"span"),g(3),c()()}if(n&2){let i=l(3);p("matTooltip",i.isVideoPill?i.participant.spotifyData.currentlyPlaying:""),s(3),R(i.participant.spotifyData.currentlyPlaying)}}function Ca(n,r){if(n&1&&(a(0,"div",5),u(1,fa,1,2,"div",31),u(2,va,4,2,"div",32),u(3,_a,4,2,"div",33),c()),n&2){let i=l(2);s(),h(i.participant.isHandRaised&&!i.focusPlusActive?1:-1),s(),h(i.shouldShowPinCount?2:-1),s(),h(i.participant.spotifyData&&!i.isMobile?3:-1)}}function ba(n,r){if(n&1&&(a(0,"div",37),g(1," P4P "),c()),n&2){let i=l(2);S("selected-task",i.selectedTask)}}function Pa(n,r){if(n&1){let i=P();a(0,"div",10),g(1," Enable yours here: "),a(2,"ss-icon",38),f("click",function(){_(i);let t=l(2);return C(t.openPinSettingsModal())}),c()()}n&2&&(s(2),p("size",20))}function ka(n,r){if(n&1&&b(0,"ss-icon",11),n&2){let i=l(2);p("size",20)("matTooltip",i.selectedTask?"Current task - "+i.selectedTask.text:"")}}function xa(n,r){if(n&1&&(a(0,"div",39),g(1," F+ "),c()),n&2){let i=l(2);S("dark-color",!i.participant.isCameraEnabled&&!i.showHoverTopMenu)}}function ya(n,r){if(n&1&&b(0,"ss-badge",13),n&2){let i=l(2);p("size",20)("badge",i.participant.userInfo.userBadge)}}function Sa(n,r){if(n&1){let i=P();a(0,"div",40),f("click",function(){_(i);let t=l(2);return C(t.toggleHdFlag())}),b(1,"ss-icon",41),a(2,"small"),g(3,"HD"),c()()}if(n&2){let i=l(2);S("active",i.participant.hd),p("matTooltip",i.participant.hd?"Click to unmark HD flag":"Click to mark HD flag"),s(),p("size",20)}}function Ma(n,r){if(n&1){let i=P();a(0,"div",42),f("click",function(){_(i);let t=l(2);return C(t.showUserReports())}),b(1,"ss-icon",43),a(2,"small"),g(3),c()()}if(n&2){let i=l(2);s(),p("size",12),s(2),R(i.participant.reportCount)}}function wa(n,r){n&1&&(a(0,"div",17),b(1,"ss-icon",44),c()),n&2&&(s(),p("size",12))}function Oa(n,r){if(n&1){let i=P();a(0,"div",45),f("click",function(){_(i);let t=l(2);return C(t.openSpotifyUrl(t.participant.spotifyData.url))}),b(1,"img",46),a(2,"span"),g(3),c()()}if(n&2){let i=l(2);S("feedback-visible",i.showPinFeedback),p("matTooltip",i.participant.spotifyData.currentlyPlaying),s(3),R(i.participant.spotifyData.currentlyPlaying)}}function Ta(n,r){n&1&&(a(0,"div",48),b(1,"mat-spinner",58),c())}function Ia(n,r){if(n&1){let i=P();a(0,"img",60),f("click",function(){_(i);let t=l(4);return C(t.encourageUser(t.encouragements[0]))}),c()}if(n&2){let i=l(4);p("matTooltipPosition",i.isGroupTile?"below":"above")("src",i.encouragements[0].iconUrl,Et)}}function Fa(n,r){if(n&1&&u(0,Ia,1,2,"img",59),n&2){let i=l(3);h(i.encouragements.length>0&&i.participant.identity!==i.currentUser.id?0:-1)}}function Ra(n,r){if(n&1){let i=P();a(0,"ss-button",61),f("buttonClick",function(){_(i);let t=l(3);return C(t.showTaskHistory())}),c()}if(n&2){let i=l(3);S("active",i.taskHistoryOpened),p("matTooltipPosition",i.isGroupTile?"below":"above")("iconOnly",!0)("iconSize",20)("isLoading",i.loadingTaskHistory)("disabled",i.loadingTaskHistory)}}function Ea(n,r){if(n&1){let i=P();a(0,"ss-button",62),f("buttonClick",function(){_(i);let t=l(3);return C(t.messageUser())}),c()}if(n&2){let i=l(3);S("disabled",i.focusPlusActive),p("matTooltipPosition",i.isGroupTile?"below":"above")("matTooltip",i.focusPlusActive?"Cannot message in Focus+":"Message")("iconOnly",!0)("iconSize",20)}}function Ua(n,r){if(n&1){let i=P();a(0,"ss-button",63),f("buttonClick",function(){_(i);let t=l(3);return C(t.livekit.room.selfViewVideoVisibility=!t.livekit.room.selfViewVideoVisibility)}),c()}if(n&2){let i=l(3);p("matTooltipPosition",i.isGroupTile?"below":"above")("matTooltip",(i.livekit.room.selfViewVideoVisibility?"Hide":"Show")+" self view video")("iconName",i.livekit.room.selfViewVideoVisibility?"camera":"camera_off")("iconOnly",!0)("iconSize",20)}}function Va(n,r){if(n&1){let i=P();a(0,"ss-button",64),f("buttonClick",function(){_(i);let t=l(3);return C(t.showFullscreenTile())}),c()}if(n&2){let i=l(3);p("matTooltipPosition",i.isGroupTile?"below":"above")("iconOnly",!0)("iconSize",20)("isLoading",i.fullscreenTileLoading)}}function Aa(n,r){if(n&1){let i=P();a(0,"ss-button",65),f("buttonClick",function(){_(i);let t=l(3);return C(t.hideUser())}),c()}n&2&&p("iconSize",20)}function La(n,r){if(n&1){let i=P();a(0,"ss-task-calendar",67),f("closePopup",function(){_(i);let t=l(4);return C(t.taskHistoryOpened=!1)}),c()}if(n&2){let i=l(4);p("userInfo",i.participant.userInfo)("initialTaskHistoryLoad",i.tasksHistory)}}function Ga(n,r){if(n&1&&u(0,La,1,2,"ss-task-calendar",66),n&2){let i=l(3);h(i.taskHistoryOpened?0:-1)}}function Da(n,r){if(n&1){let i=P();a(0,"ss-user-popup",68),f("focusRoomUnauthenticatedActionAttempt",function(){_(i);let t=l(3);return C(t.accountModalsService.ensureUserCompletedBasicInfo())})("closePopup",function(){_(i);let t=l(3);return C(t.userBioPopupOpened=!1)}),c()}if(n&2){let i=l(3);p("userId",i.participant.identity)("openedFromSource",i.OpenedFromSourceRef.FocusRoom)}}function Ba(n,r){if(n&1){let i=P();a(0,"ss-button",69),f("buttonClick",function(){_(i);let t=l(3);return C(t.sendAGift(t.participant.userInfo.displayName))}),c()}if(n&2){let i=l(3);p("matTooltipPosition",i.isGroupTile?"below":"above")("iconOnly",!0)("iconSize",20)}}function Na(n,r){if(n&1){let i=P();a(0,"div",57)(1,"ss-participant-menu",70),f("participantMenuOpened",function(t){_(i);let o=l(3);return C(o.onParticipantMenuOpened(t))})("openUserBio",function(){_(i);let t=l(3);return C(t.onOpenUserBio())})("openTaskHistory",function(){_(i);let t=l(3);return C(t.showTaskHistory())}),c()()}if(n&2){let i=l(3);s(),p("matTooltipPosition",i.isGroupTile?"below":"above")("isRoomTileMenu",!0)("showHideUserOptions",!0)("isGroupTile",i.isGroupTile)("participant",i.participant)}}function za(n,r){if(n&1){let i=P();a(0,"div",19)(1,"div",47,1)(3,"ss-button",29),f("buttonClick",function(){_(i);let t=l(2);return C(t.isPinned?t.unpin():t.pin())}),c(),u(4,Ta,2,0,"div",48)(5,Fa,1,1),a(6,"ss-button",49),f("buttonClick",function(){_(i);let t=l(2);return C(t.participant.favorited?t.removeFavorite():t.favoriteUser())}),c(),u(7,Ra,1,7,"ss-button",50),u(8,Ea,1,6,"ss-button",51),u(9,Ua,1,5,"ss-button",52),u(10,Va,1,4,"ss-button",53),u(11,Aa,1,1,"ss-button",54),ae(12,Ga,1,1,"ng-template",55),f("backdropClick",function(){_(i);let t=l(2);return C(t.taskHistoryOpened=!1)}),ae(13,Da,1,2,"ng-template",55),f("backdropClick",function(){_(i);let t=l(2);return C(t.userBioPopupOpened=!1)}),u(14,Ba,1,3,"ss-button",56),u(15,Na,2,5,"div",57),c()()}if(n&2){let i=xe(2),e=l(2);s(3),p("matTooltipPosition",e.isGroupTile?"below":"above")("matTooltip",e.focusPlusActive?"Cannot "+(e.isPinned?"unpin":"pin")+" in Focus+":e.isPinned?"Unpin":"Pin")("iconName",e.isPinned?"pin_off":"pin")("iconOnly",!0)("iconSize",20)("isLoading",e.livekit.room.pinningUserIds!==null&&e.livekit.room.pinningUserIds.includes(e.participant.identity))("disabled",e.focusPlusActive||e.livekit.room.pinningUserIds!==null&&!e.livekit.room.pinningUserIds.includes(e.participant.identity)),s(),h(e.livekit.room.encouragingUserId===e.participant.identity?4:5),s(2),p("matTooltipPosition",e.isGroupTile?"below":"above")("matTooltip",e.participant.favorited?"Remove favorite":"Favorite")("iconColor",e.participant.favorited?"gold":"contrast")("iconOnly",!0)("iconSize",20)("isLoading",e.favoriteLoading)("disabled",e.favoriteLoading),s(),h(e.isCurrentUser?7:-1),s(),h(!e.isCurrentUser&&!e.settingsService.isB2BApp()?8:-1),s(),h(e.isCurrentUser&&e.livekit.room.settings.selfViewVideoEnabled&&!e.focusPlusActive?9:-1),s(),h(e.allowFullscreening?10:-1),s(),h(e.shouldShowHideControls?11:-1),s(),p("cdkConnectedOverlayOrigin",i)("cdkConnectedOverlayOpen",e.taskHistoryOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0),s(),p("cdkConnectedOverlayOrigin",i)("cdkConnectedOverlayOpen",e.userBioPopupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0),s(),h(e.isTop40&&!e.isCurrentUser?14:-1),s(),h(!e.isMobile&&!e.isCurrentUser&&!e.isAnonymousUser?15:-1)}}function ja(n,r){if(n&1){let i=P();a(0,"div",20)(1,"ss-button",71),f("buttonClick",function(){_(i);let t=l(2);return C(t.swapFocusPlusParticipant.emit(t.participant))}),c(),a(2,"ss-button",72),f("buttonClick",function(){_(i);let t=l(2);return C(t.removeFromFocusPlus.emit(t.participant))}),c()()}n&2&&(s(),p("iconOnly",!0)("iconSize",28),s(),p("iconOnly",!0)("iconSize",28))}function Ha(n,r){if(n&1&&b(0,"ss-user-avatar",21),n&2){let i=l(2);p("size",100)("avatarColor",i.participant.userInfo.avatarColor)("avatarThumbUrl",i.participant.userInfo.avatarThumbUrl)("showOnlineStatus",!1)("userId",i.participant.identity)("initials",i.participant.userInfo.initials)}}function Wa(n,r){n&1&&b(0,"mat-spinner",74)}function $a(n,r){if(n&1&&(a(0,"span",75),g(1),c()),n&2){let i=l(3);s(),R(i.participant.focusRoomGroup==null?null:i.participant.focusRoomGroup.usersCount)}}function Ja(n,r){if(n&1){let i=P();a(0,"div",73),f("click",function(){_(i);let t=l(2);return C(t.handleJoiningToPrivateGroup())}),u(1,Wa,1,0,"mat-spinner",74),u(2,$a,2,1,"span",75),b(3,"ss-icon",76),c()}if(n&2){let i=l(2);p("matTooltip",i.setPrivateSpaceTooltip()),s(),h(i.joining?1:-1),s(),h(i.joining?-1:2),s(),p("size",16)}}function qa(n,r){if(n&1&&b(0,"ss-pin-feedback",24),n&2){let i=l(2);p("participant",i.participant)}}function Ya(n,r){if(n&1&&(a(0,"div"),g(1),c()),n&2){let i=r.$implicit;s(),Se(" ",i.key,": ",i.value," ")}}function Ka(n,r){if(n&1&&(a(0,"div"),g(1),c(),a(2,"div"),g(3),c(),a(4,"div"),g(5),c()),n&2){let i=l(3);s(),O("tileRenderedAt: ",i.statsForNerds.dateRendered.toLocaleString(i.timeWithSecondsRef)),s(2),Se("subscribe req/res: ",i.statsForNerds.timeToSubscribeRequest??"N/A","s - ",i.statsForNerds.timeToSubscribeResponse??"N/A","s"),s(2),Se("trackAttach req/res: ",i.statsForNerds.timeToTrackAttachRequest??"N/A","s - ",i.statsForNerds.timeToTrackAttachResponse??"N/A","s")}}function Qa(n,r){if(n&1){let i=P();a(0,"div",27)(1,"div",77)(2,"ss-button-small",78),f("buttonClick",function(){_(i);let t=l(2);return C(t.logTracksToConsole())}),g(3,"Log tracks"),c(),a(4,"ss-button-small",78),f("buttonClick",function(){_(i);let t=l(2);return C(t.logParticipantToConsole())}),g(5,"Log participant"),c()(),V(6,Ya,2,2,"div",null,je),Te(8,"keyvalue"),a(9,"div"),g(10),c(),u(11,Ka,6,5),c()}if(n&2){let i=l(2);s(6),A(De(8,2,i.getParticipantStatsForNerds())),s(4),O("participantSid: ",i.participant.sid),s(),h(i.statsForNerds.dateRendered?11:-1)}}function Xa(n,r){if(n&1){let i=P();u(0,ha,1,2,"div",2),a(1,"div",3),u(2,ga,11,12,"ss-html-tooltip",4)(3,Ca,4,3,"div",5),a(4,"div",6)(5,"ss-html-tooltip",7),f("overlayOpenChange",function(t){_(i);let o=l();return C(o.tooltipOverlayOpenChanged(t))}),u(6,ba,2,2,"div",8),a(7,"div",9),g(8," User has pin-for-pin enabled. They will pin you back if they have available pin slots. "),u(9,Pa,3,1,"div",10),c()(),u(10,ka,1,2,"ss-icon",11),u(11,xa,2,2,"div",12),u(12,ya,1,2,"ss-badge",13),c()(),a(13,"div",14),u(14,Sa,4,4,"div",15),u(15,Ma,4,2,"div",16),u(16,wa,2,1,"div",17),u(17,Oa,4,4,"div",18),c(),u(18,za,16,30,"div",19),u(19,ja,3,4,"div",20),u(20,Ha,1,6,"ss-user-avatar",21),b(21,"ss-user-info-status",22),u(22,Ja,4,4,"div",23),u(23,qa,1,1,"ss-pin-feedback",24),a(24,"video",25,0),f("click",function(){_(i);let t=l();return C(t.onVideoClicked())}),c(),a(26,"div",26),f("click",function(){_(i);let t=l();return C(t.onMobileOverlayClicked())}),c(),u(27,Qa,12,4,"div",27)}if(n&2){let i=l();h(i.participant.userInfo.showNewUserMarker?0:-1),s(),S("hover-active",!i.simplifiedTile&&i.showHoverTopMenu&&!i.isVideoPill),s(),h(i.simplifiedTile?2:!i.showHoverTopMenu||i.isVideoPill?3:-1),s(4),h((i.showHoverTopMenu||i.pinForPinTooltipOpen)&&i.participant.userInfo.includePremiumFeatures&&i.livekit.room.shouldShowPinForPinFlag(i.participant)?6:-1),s(3),h(i.livekit.room.roomSettings!=null&&i.livekit.room.roomSettings.pinForPinEnabled?-1:9),s(),h(i.selectedTask!=null&&i.selectedTask.text?10:-1),s(),h((i.isLocal?i.focusPlusActive:i.participant.inFocusMode)?11:-1),s(),h(i.participant.userInfo.userBadge?12:-1),s(2),h(i.isAdministrator?14:-1),s(),h(i.isModerator&&i.participant.reportCount>0?15:-1),s(),h(i.participant.reinstatedPin?16:-1),s(),h(i.participant.spotifyData&&i.showHoverTopMenu&&!i.isVideoPill?17:-1),s(),h(!i.isMobile&&!i.simplifiedTile?18:-1),s(),h(i.livekit.room.focusPlus.active?19:-1),s(),h(i.participant.userInfo&&!i.isCameraOn?20:-1),s(),S("focus-active",i.focusPlusActive),p("participant",i.participant)("isMobile",i.isMobile),s(),h(!i.isGroupTile&&(i.participant.focusRoomGroup!=null&&i.participant.focusRoomGroup.id)&&!i.focusPlusActive?22:-1),s(),h(i.showPinFeedback?23:-1),s(),qe("transform",i.transformValue),S("ad-user",i.adUser&&i.adUser.adUrl),p("poster",i.isDarkTheme?"/assets/images/poster-dark.jpg":"/assets/images/poster-light.png",Et),s(3),h(i.statsForNerdsVisible?27:-1)}}var ut=(()=>{let r=class r{onMouseEnter(){this.showHoverTopMenu=!0}onMouseLeave(){this.participantMenuOpened||(this.showHoverTopMenu=!1)}onDoubleClick(e){if(!this.allowFullscreening)return;let t=e.target,o=this.videoElement.nativeElement;t===o&&this.showFullscreenTile(!0)}get id(){return this.participant.identity}get tileWidth(){return this.isViewModalTile?null:this.livekit.room.tileDimensions.width}get tileHeight(){return this.isViewModalTile?null:this.livekit.room.tileDimensions.height}get isLocal(){return this.participant.isLocal}get isVideoAd(){return!this.participant.identity}get isHighlighted(){return this.participant.highlighted}get isPinningMe(){return this.livekit.room.pinnedByUserIds.some(e=>e===this.participant.identity)}get isActiveTile(){return this.participantMenuOpened||this.userBioPopupOpened||this.taskHistoryOpened||this.pinForPinTooltipOpen}get isSpeaking(){return this.livekit.room.speakingParticipants.some(e=>e.identity===this.participant.identity)}get isCameraOff(){return!this.isCameraOn}get hasStatus(){return!!this.participant.status&&(!this.participant.isLocal||!this.livekit.room.userActiveStatus?.clearedAt)}get zoomToFitDisabled(){return!this.participant.zoomToFit&&this.participant.isCameraEnabled}get isSmallTile(){return!!this.livekit.room.tileDimensions.width&&this.livekit.room.tileDimensions.width<210}get allowFullscreening(){return this.allowFullscreenView&&!this.isAdTile&&this.participant.isCameraEnabled}get showNewUserMarker(){return this.participant.userInfo.showNewUserMarker}get isPinned(){return this.livekit.room.isPinned(this.participant.identity)}get shouldShowPinCount(){return this.participant.pinnedCount>0&&!this.focusPlusActive&&(this.participant.isLocal?!this.livekit.room.roomSettings?.pinCountHidden:!this.participant.pinCountHidden)&&!this.livekit.room.roomSettings?.selfPinCountHidden}get isCurrentUser(){return this.accountService.currentUser.id===this.participant.identity}get isAnonymousUser(){return this.livekit.room.localParticipant.anonymous}get localParticipant(){return this.livekit.room.localParticipant}get focusPlusActive(){return this.livekit.room.focusPlus.active}get adUser(){return this.participant.userInfo.adUser}get isCameraOn(){return this.participant.isCameraEnabled}get isTop40(){return!1}get statsForNerdsVisible(){return this.livekit.room.statsForNerdsVisible}get forceGridView(){return this.livekit.room.forceGridView}get transformValue(){if(!this.isCameraOn)return"";let e=null;if(this.participant.zoomToFit&&this.videoElement?.nativeElement?.videoHeight){let d=this.videoElement.nativeElement.videoWidth/this.videoElement.nativeElement.videoHeight;e=16/9/d}let t=this.participant.isLocal?this.livekit.room.settings.mirrorMode:this.participant.mirrorModeForOthers,o=e===null||e===1?"":`scale(${e})`;return o+=t?" scaleX(-1)":"",o=o.trim(),o}get isModerator(){return!!this.livekit.room.localParticipant.userInfo?.isModerator}get isAdministrator(){return this.accountService.isInRole(ft.Administrator)}get encouragements(){return this.livekit.encouragements}get isDarkTheme(){return this.theme===gt.Dark}get milestones(){return this.livekit.room.milestones}get selectedTask(){return this.participant.isLocal?this.accountService.currentUser.selectedTask:this.participant.selectedTask}get showSpotifyNowPlaying(){return this.participant.isLocal?this.livekit.room.roomSettings?.enableSpotifyNowPlaying:this.participant.showSpotifyNowPlaying}get isAdTile(){return!this.participant.identity}get simplifiedTile(){return!this.participant.isLocal&&!this.livekit.room.milestones.pinnedSomeone&&this.participant.userInfo.pinForPinEnabled&&!this.participant.userInfo.filledPinSlots}get shouldShowHideControls(){return!this.livekit.room.isPinned(this.participant.identity)&&!this.isCurrentUser}get showPinFeedback(){return!this.forceGridView&&this.isPinned&&!this.isCurrentUser&&this.participant.shouldShowPinQuestion&&!this.focusPlusActive}constructor(e,t,o,d,v,k,T,B,z,ke,pe,Ve,Xe,Ft,qt,Yt,Kt){this.settingsService=e,this.livekit=t,this.elementRef=o,this.accountModalsService=d,this.accountService=v,this.userService=k,this.encouragementService=T,this.analyticsService=B,this.chatService=z,this.utilityService=ke,this.userTaskService=pe,this.toastService=Ve,this.livekitAdUserService=Xe,this.badgeService=Ft,this.userFavoriteService=qt,this.snackBarService=Yt,this.dialog=Kt,this.isGroupTile=!1,this.isVideoPill=!1,this.allowFullscreenView=!1,this.isViewModalTile=!1,this.swapFocusPlusParticipant=new ce,this.removeFromFocusPlus=new ce,this.statsForNerds={},this.currentUser=this.accountService.currentUser,this.userBioPopupOpened=!1,this.showHoverTopMenu=!1,this.taskHistoryOpened=!1,this.joining=!1,this.loadingTaskHistory=!1,this.loadingHdFlagChange=!1,this.favoriteLoading=!1,this.fullscreenTileLoading=!1,this.pinForPinTooltipOpen=!1,this.tasksHistory=[],this.timeWithSecondsRef=$.TIME_WITH_SECONDS,this.activeGroup=null,this.OpenedFromSourceRef=Pt,this.retryModel={delay:500,interval:1e3,maxAttempts:10,timesRetried:1,stopRetries:new Gt},this.subscriptions=[],this.participantMenuOpened=!1,this.onTrackSubscribed=this.onTrackSubscribed.bind(this),this.onTrackPublished=this.onTrackPublished.bind(this),this.onLocalTrackPublished=this.onLocalTrackPublished.bind(this)}ngOnInit(){this.participant.on(U.TrackSubscribed,this.onTrackSubscribed).on(U.TrackPublished,this.onTrackPublished).on(U.LocalTrackPublished,this.onLocalTrackPublished)}ngAfterViewInit(){if(this.statsForNerds.dateRendered=$.now(),this.participant.isLocal?this.tryBindingActivePublication():(this.setVideoTracksSubscribedState(!0),W(this.retryModel.delay,this.retryModel.interval).pipe(Dt(this.retryModel.stopRetries)).subscribe(()=>this.retrySubscribingAndBinding())),this.subscriptions.push(this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e),this.livekit.participantHighlight.hide.subscribe(()=>this.participant.highlighted=!1)),this.isAdTile){let e=new CustomEvent("ssAdTileCreated",{detail:{payload:this.elementRef.nativeElement}});window.dispatchEvent(e)}}ngOnDestroy(){if(this.retryModel.stopRetries.next(),this.isGroupTile)this.setAudioTracksSubscribedState(!1);else{let e=this.livekit.room.activeGroupParticipants.some(d=>d.identity===this.participant.identity)||this.livekit.room.activePredefinedGroupParticipants.some(d=>d.participant&&d.participant.identity===this.participant.identity),t=this.utilityService.groupInviteParticipantActive?.identity===this.participant.identity,o=this.livekit.room.currentlyFullscreenedParticipant===this.participant;!e&&!t&&!o&&this.setVideoTracksSubscribedState(!1)}if(this.participant.off(U.TrackSubscribed,this.onTrackSubscribed).off(U.TrackPublished,this.onTrackPublished).off(U.LocalTrackPublished,this.onLocalTrackPublished),this.subscriptions.forEach(e=>e.unsubscribe()),this.isAdTile){let e=new CustomEvent("ssAdTileDestroyed",{detail:{payload:this.elementRef.nativeElement}});window.dispatchEvent(e)}}showFullscreenTile(e=!1){!this.accountModalsService.ensureUserCompletedBasicInfo()||this.fullscreenTileLoading||(this.fullscreenTileLoading=!0,this.userService.markVideoTileView(this.participant.identity,this.livekit.room.name).subscribe({next:()=>{this.analyticsService.markActivity(y.LivekitEnlargeVideoTile,{isDoubleClick:e}),this.dialog.open(Ai,{panelClass:"preview-modal",width:"calc(100% - 40px)",maxWidth:"100vw",maxHeight:"calc(100vh - 20px)",data:this.participant}),this.fullscreenTileLoading=!1},error:t=>{if(this.fullscreenTileLoading=!1,t[0].errorCode==="ErrorAllowEnlargeTilePrivacy"){this.toastService.info({exceptionDetail:t[0]});return}this.handleErrors(t)}}))}onParticipantMenuOpened(e){this.participantMenuOpened=e,this.participantMenuOpened||(this.showHoverTopMenu=!1)}onOpenUserBio(){this.participantMenuOpened=!1,this.userBioPopupOpened=!0}encourageUser(e){if(!this.accountModalsService.ensureUserCompletedBasicInfo()||this.livekit.room.checkEncouragementsDisabled(this.participant))return;let t={encouragementTypeId:e.id};this.livekit.room.encouragingUserId=this.participant.identity,this.encouragementService.postEncouragement(this.participant.identity,t).subscribe({next:o=>Y(this,null,function*(){this.livekit.room.milestones.encouragedSomeone||this.subscriptions.push(W(2e3).subscribe(()=>this.badgeService.checkForNewBadges.next())),this.livekit.room.encouragingUserId=null,this.livekit.room.milestones.encouragedSomeone=!0,o.receiverWasInFocusMode?yield this.snackBarService.info({message:"This user is currently focussing. They'll see your encouragement later on."}):o.encouragementsPerDayLeft!==null?yield this.snackBarService.info({message:`Encouragement sent. You have ${o.encouragementsPerDayLeft} encouragements left for today.`}):yield this.snackBarService.info({message:"Encouragement sent."})}),error:o=>{o[0].errorCode==="EncouragementTimeLimit"?this.toastService.info({title:"Please wait",exceptionDetail:o[0]}):o[0].errorCode==="MaxEncouragementsPerDayReached"?this.toastService.info({title:"Maximum encouragements reached",exceptionDetail:o[0],paidFeatureText:"Upgrade to encourage more",triggeredUpgradeFromSource:re.MaxEncouragementsReached,autoClose:!1}):o[0].errorCode==="MaxEncouragementsPerDayReachedPremium"?this.toastService.info({title:"Maximum encouragements reached",exceptionDetail:o[0]}):this.handleErrors(o),this.livekit.room.encouragingUserId=null}})}getParticipantStatsForNerds(){let e=this.participant.getTrackPublications().filter(d=>d.kind===j.Kind.Video);if(e.length===0)return{};let t=e[0];if(!this.videoElement)return{};let o=this.videoElement.nativeElement;return{videoDimensions:`${o.videoHeight}p (${o.videoWidth}x${o.videoHeight})`,videoQuality:this.videoQualityToJSON(t.videoQuality),subscriptionStatus:t.subscriptionStatus,pubDimensions:t.dimensions?`${t.dimensions.height}p (${t.dimensions.width}x${t.dimensions.height})`:"",bitrate:`${(t.track?.currentBitrate??0).toFixed(2)} bps`}}showUserReports(){this.dialog.open(lr,{width:"600px",data:this.participant.identity})}toggleHdFlag(){if(this.loadingHdFlagChange)return;let e=!this.participant.hd;this.loadingHdFlagChange=!0,this.userService.updateUserHdFlag(this.participant.identity,e).subscribe({next:t=>{this.loadingHdFlagChange=!1,t&&(this.participant.hd=e)},error:t=>this.handleErrors(t)})}logTracksToConsole(){console.log("[LoggedTrack]"),console.log(this.participant.getTrackPublications())}logParticipantToConsole(){console.log("[LoggedParticipant]"),console.log(this.participant)}handleUnauthenticatedActionAttempt(){this.accountModalsService.ensureUserCompletedBasicInfo()}pin(e=!1){this.livekit.room.pin({participant:this.participant,madeFromThePulsatingIcon:e})}unpin(){this.livekit.room.unpin({pinnedUserId:this.participant.identity})}messageUser(){if(!this.accountModalsService.ensureUserCompletedBasicInfo()||this.focusPlusActive)return;let e={otherUserIds:[this.participant.identity]};this.chatService.checkIfChatExists(e.otherUserIds[0]).subscribe({next:()=>{this.chatService.startChat(e).subscribe({next:t=>this.navigateToChat(t.id),error:t=>{t.length&&t[0].errorCode==="ChatAlreadyExists"?this.navigateToChat(t[0].params.chatId):this.handleErrors(t)}})},error:t=>{t.length&&t[0].errorCode==="ChatDoesNotExist"?this.isMobile?window.open(`${le.appUrl}/conversations/chats/create?userId=${e.otherUserIds[0]}`,"_blank"):this.utilityService.requestChatNavigation.next(e.otherUserIds[0]):this.handleErrors(t)}})}onMobileOverlayClicked(){this.isMobile&&(!this.adUser||!this.adUser.adUrl)&&this.livekit.participantInfoMobile.next(this.participant)}onVideoClicked(){if(!this.adUser||!this.adUser.adUrl)return;window.open(this.adUser.adUrl,"_blank"),this.livekitAdUserService.storeUrlClick(this.livekit.room.name,this.participant.identity).subscribe();let e={userId:this.participant.identity,adUrl:this.adUser.adUrl};this.analyticsService.markActivity(y.LivekitAdUserLinkClick,e)}sendAGift(e){let t={userId:this.participant.identity};this.analyticsService.markActivity(y.LivekitGiftACoffeeModalOpened,t),this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Gift a coffee",description:"GiveACoffeeGift",descriptionParams:{participantName:e,giftValue:this.settingsService.settings.giftStripeValue},confirmButtonLabel:"Payment link"}}).afterClosed().subscribe(d=>{d&&(this.analyticsService.markActivity(y.LivekitGiftACoffeeButtonClick,t),window.open(`${this.settingsService.settings.giftStripeUrl}?prefilled_email=${this.currentUser.email}`,"_blank"))})}inviteUser(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.livekit.inviteUser(this.participant)}setPrivateSpaceTooltip(){if(!this.participant.focusRoomGroup)return"";let e=this.participant.focusRoomGroup.usersCount>1?` There are ${this.participant.focusRoomGroup.usersCount} people focusing together.`:"";return`Click to join ${this.participant.userInfo.displayName?.trim()}'s space.${e}`}handleJoiningToPrivateGroup(){if(!this.accountModalsService.ensureUserCompletedBasicInfo()||this.joining)return;if(this.activeGroup?.createdByUserId===this.participant.identity){this.livekit.room.privateGroupMinimized=!1;return}this.joining=!0,this.activeGroup?this.leaveActiveAndJoinNewPrivateGroup():this.joinPrivateGroup()}showTaskHistory(){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.loadingTaskHistory=!0,this.userTaskService.getHistory(this.participant.identity,null).subscribe({next:e=>{this.tasksHistory=e,this.loadingTaskHistory=!1,this.taskHistoryOpened=!0},error:e=>this.handleErrors(e)}))}openSpotifyUrl(e){e&&window.open(e)}favoriteUser(){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.favoriteLoading=!0,this.userFavoriteService.addUserToFavorites(this.participant.identity).subscribe({next:()=>this.favoriteLoading=!1,error:e=>this.handleErrors(e)}))}removeFavorite(){this.favoriteLoading=!0,this.userFavoriteService.removeUserFromFavorites(this.participant.identity).subscribe({next:()=>this.favoriteLoading=!1,error:e=>this.handleErrors(e)})}hideUser(){if(!this.accountModalsService.ensureUserCompletedBasicInfo())return;this.dialog.open(Ui,{panelClass:"fullscreen-dialog",width:"500px"}).afterClosed().subscribe(t=>{t&&this.livekit.room.hide(this.participant,!1)})}tooltipOverlayOpenChanged(e){setTimeout(()=>this.pinForPinTooltipOpen=e)}openPinSettingsModal(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.livekit.showOptionsModal(jt.PinSettings)}leaveActiveAndJoinNewPrivateGroup(){let e=this.activeGroup?.createdByUserId===this.accountService.currentUser.id;this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:e?"LeaveMyPrivatePod":"LeavePrivatePod",confirmButtonLabel:"Leave & Join"}}).afterClosed().subscribe(o=>{if(!o){this.joining=!1;return}this.livekit.leaveActiveGroups(this.livekit.room.name,!0).subscribe({next:()=>this.joinPrivateGroup(),error:d=>this.handleErrors(d)})})}joinPrivateGroup(){if(!this.participant.focusRoomGroup){this.toastService.info({message:"The owner has ended this space."}),this.joining=!1;return}this.analyticsService.markActivity(y.JoinVideoTilePodAttempted),this.livekit.joinPrivateGroup(this.livekit.room.name,this.participant.focusRoomGroup.id).subscribe({next:()=>{this.livekit.room.privateGroupMinimized=!1,this.joining=!1},error:e=>{if(e[0].errorCode==="LivekitRoomMaxSamePeerSessionsReached"){this.toastService.info({exceptionDetail:e[0]});return}this.handleErrors(e)}})}navigateToChat(e){this.isMobile?window.open(`${le.appUrl}/conversations/chats/${e}`,"_blank"):this.utilityService.openDmTrayChat.next(e)}retrySubscribingAndBinding(){(!this.participant.isCameraEnabled||this.retryModel.timesRetried===this.retryModel.maxAttempts)&&this.retryModel.stopRetries.next(),this.setVideoTracksSubscribedState(!0),this.tryBindingActivePublication(),this.retryModel.timesRetried++}setVideoTracksSubscribedState(e){this.participant.videoTrackPublications.forEach(t=>{t instanceof At&&(t.setSubscribed(e),this.statsForNerds.timeToSubscribeRequest=this.getSecondsSinceRenderTime())})}setAudioTracksSubscribedState(e){this.livekit.room.privateGroupMinimized||this.participant.audioTrackPublications.forEach(t=>{t instanceof At&&t.setSubscribed(e)})}onTrackSubscribed(e,t){e.kind===j.Kind.Video&&(this.statsForNerds.timeToSubscribeResponse=this.getSecondsSinceRenderTime(),this.tryToAttachVideoElement(t))}onTrackPublished(e){e.isSubscribed||this.setVideoTracksSubscribedState(!0)}onLocalTrackPublished(e){!e.track||e.track.kind!==j.Kind.Video||this.tryToAttachVideoElement(e)}tryBindingActivePublication(){let e=this.participant.getTrackPublications().find(t=>t.kind===j.Kind.Video&&t.isSubscribed);e&&this.tryToAttachVideoElement(e)}tryToAttachVideoElement(e){let t=e.track;if(!t)return;let o=this.videoElement.nativeElement;t.attachedElements.includes(o)||(this.statsForNerds.timeToTrackAttachRequest=this.getSecondsSinceRenderTime(),t.attach(o),this.statsForNerds.timeToTrackAttachResponse=this.getSecondsSinceRenderTime(),this.retryModel.stopRetries.next())}getSecondsSinceRenderTime(){return this.statsForNerds.dateRendered?+($.now().diff(this.statsForNerds.dateRendered,"seconds").seconds??0).toFixed(3):0}videoQualityToJSON(e){switch(e){case vi.LOW:return"LOW";case vi.MEDIUM:return"MEDIUM";case vi.HIGH:return"HIGH";default:return"UNRECOGNIZED"}}handleErrors(e){if(this.joining=!1,this.loadingHdFlagChange=!1,this.favoriteLoading=!1,e[0].errorCode==="MaxFavoriteUsersCountReached"){this.toastService.info({title:"Maximum favorites reached",exceptionDetail:e[0],paidFeatureText:"Upgrade to add more",triggeredUpgradeFromSource:re.MaxFavoriteUsersReached,autoClose:!1});return}if(e[0].errorCode==="LivekitRoomSessionGroupEnded"){this.participant.focusRoomGroup=null,this.toastService.info({autoClose:!1,exceptionDetail:{errorCode:"LivekitRoomSessionGroupEndedUserAction"}});return}if(e[0].errorCode==="ErrorShowSelectedTaskHistoryPrivacy"){this.loadingTaskHistory=!1,this.toastService.info({exceptionDetail:e[0]});return}if(e[0].errorCode==="ErrorChattingAgeRestriction"){this.toastService.info({exceptionDetail:e[0]});return}this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(X),m(M),m(ze),m(K),m(G),m(yi),m(kt),m(H),m(Mt),m(J),m(qo),m(F),m(dr),m(Qe),m(ct),m(xt),m(N))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-tile"]],viewQuery:function(t,o){if(t&1&&Ae(ua,5),t&2){let d;Le(d=Ge())&&(o.videoElement=d.first)}},hostVars:25,hostBindings:function(t,o){t&1&&f("mouseenter",function(){return o.onMouseEnter()})("mouseleave",function(){return o.onMouseLeave()})("dblclick",function(v){return o.onDoubleClick(v)}),t&2&&(_n("data-id",o.id),qe("width",o.tileWidth,"px")("height",o.tileHeight,"px"),S("is-local",o.isLocal)("is-video-ad",o.isVideoAd)("highlighted",o.isHighlighted)("pinning-me",o.isPinningMe)("active",o.isActiveTile)("is-speaking",o.isSpeaking)("camera-off",o.isCameraOff)("has-status",o.hasStatus)("zoom-to-fit-disabled",o.zoomToFitDisabled)("small-tile",o.isSmallTile))},inputs:{participant:"participant",theme:"theme",isMobile:"isMobile",isGroupTile:"isGroupTile",isVideoPill:"isVideoPill",allowFullscreenView:"allowFullscreenView",isViewModalTile:"isViewModalTile"},outputs:{swapFocusPlusParticipant:"swapFocusPlusParticipant",removeFromFocusPlus:"removeFromFocusPlus"},standalone:!1,decls:1,vars:1,consts:[["videoElement",""],["actionWrapperTrigger","cdkOverlayOrigin"],[1,"new-user-border",3,"ad-user"],[1,"top-line"],[3,"disabled"],[1,"left-part"],[1,"right-part"],[3,"overlayOpenChange"],[1,"pin-for-pin",3,"selected-task"],["tooltip",""],[1,"pin-for-pin-tooltip-action"],["iconName","target","color","accent-blue","matTooltipPosition","above",1,"header-selected-task",3,"size","matTooltip"],["matTooltip","User is in Focus mode",1,"focus-plus",3,"dark-color"],[1,"header-badge",3,"size","badge"],[1,"second-line"],[1,"hd-toggle",3,"active","matTooltip"],[1,"reports-count"],["matTooltip","Automatically re-instated pin: this user might have recently refreshed or lost their pins. You can unpin them manually if you wish.",1,"recently-restored-pin"],["matTooltipShowDelay","500","matTooltipHideDelay","200",1,"spotify-playing",3,"feedback-visible","matTooltip"],[1,"hover-top-menu"],[1,"focus-plus-actions"],["status","online",1,"avatar-placeholder",3,"size","avatarColor","avatarThumbUrl","showOnlineStatus","userId","initials"],[3,"participant","isMobile"],[1,"private-space-indicator",3,"matTooltip"],[3,"participant"],["autoplay","","playsInline","",3,"click","poster"],[1,"transparent-mobile-overlay",3,"click"],[1,"stats-for-nerds"],[1,"new-user-border",3,"click"],["color","website-transparent",1,"pin-button",3,"buttonClick","matTooltipPosition","matTooltip","iconName","iconOnly","iconSize","isLoading","disabled"],["tooltip","",1,"custom-tooltip"],[1,"boost",3,"premium"],["matTooltip","The number of others that have pinned this user",1,"pined-count"],[1,"spotify-playing",3,"matTooltip"],[1,"boost"],["iconName","pin","color","light-widget-active",3,"size"],["draggable","false","src","/assets/icons/socials/spotify.svg","alt","spotify icon",3,"click"],[1,"pin-for-pin"],["role","button","iconName","settings","color","accent-blue-20",3,"click","size"],["matTooltip","User is in Focus mode",1,"focus-plus"],[1,"hd-toggle",3,"click","matTooltip"],["iconName","glasses","color","light-widget-active",3,"size"],[1,"reports-count",3,"click"],["iconName","warning","color","light-widget-active",3,"size"],["iconName","info","color","light-widget-active",3,"size"],["matTooltipShowDelay","500","matTooltipHideDelay","200",1,"spotify-playing",3,"click","matTooltip"],["draggable","false","src","/assets/icons/socials/spotify.svg","alt","spotify icon"],["cdkOverlayOrigin","",1,"actions-wrapper"],[1,"spinner-wrapper"],["color","website-transparent","iconName","star",1,"favorite-user",3,"buttonClick","matTooltipPosition","matTooltip","iconColor","iconOnly","iconSize","isLoading","disabled"],["matTooltip","View history of focused tasks","color","website-transparent","iconName","tasks_app",3,"active","matTooltipPosition","iconOnly","iconSize","isLoading","disabled"],["color","website-transparent","iconName","chat",1,"chat-button",3,"matTooltipPosition","matTooltip","iconOnly","iconSize","disabled"],["color","website-transparent",3,"matTooltipPosition","matTooltip","iconName","iconOnly","iconSize"],["matTooltip","Enlarge tile (you can also double-click on video)","color","website-transparent","iconName","full_screen_maximize",3,"matTooltipPosition","iconOnly","iconSize","isLoading"],["matTooltip","Hide user","iconName","eye_off","color","website-transparent",1,"hide-user",3,"iconSize"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],["matTooltip","Gift a coffee","color","website-transparent","iconName","drink_coffee",3,"matTooltipPosition","iconOnly","iconSize"],[1,"menu-wrapper"],["diameter","20","strokeWidth","3"],["height","20","matTooltip","Encourage","alt","thumbs-up",1,"thumbs-up",3,"matTooltipPosition","src"],["height","20","matTooltip","Encourage","alt","thumbs-up",1,"thumbs-up",3,"click","matTooltipPosition","src"],["matTooltip","View history of focused tasks","color","website-transparent","iconName","tasks_app",3,"buttonClick","matTooltipPosition","iconOnly","iconSize","isLoading","disabled"],["color","website-transparent","iconName","chat",1,"chat-button",3,"buttonClick","matTooltipPosition","matTooltip","iconOnly","iconSize"],["color","website-transparent",3,"buttonClick","matTooltipPosition","matTooltip","iconName","iconOnly","iconSize"],["matTooltip","Enlarge tile (you can also double-click on video)","color","website-transparent","iconName","full_screen_maximize",3,"buttonClick","matTooltipPosition","iconOnly","iconSize","isLoading"],["matTooltip","Hide user","iconName","eye_off","color","website-transparent",1,"hide-user",3,"buttonClick","iconSize"],[3,"userInfo","initialTaskHistoryLoad"],[3,"closePopup","userInfo","initialTaskHistoryLoad"],["cssClass","margin-horizontal",3,"focusRoomUnauthenticatedActionAttempt","closePopup","userId","openedFromSource"],["matTooltip","Gift a coffee","color","website-transparent","iconName","drink_coffee",3,"buttonClick","matTooltipPosition","iconOnly","iconSize"],["matTooltip","More options",3,"participantMenuOpened","openUserBio","openTaskHistory","matTooltipPosition","isRoomTileMenu","showHideUserOptions","isGroupTile","participant"],["matTooltipPosition","left","matTooltip","Swap this user with another one","color","website-transparent","iconName","arrow_repeat_all",3,"buttonClick","iconOnly","iconSize"],["matTooltipPosition","left","matTooltip","Remove this user from Focus+","color","website-transparent","iconName","video_person_off",3,"buttonClick","iconOnly","iconSize"],[1,"private-space-indicator",3,"click","matTooltip"],["diameter","16","strokeWidth","2"],[1,"interactable-bold"],["iconName","grid","color","contrast",3,"size"],[1,"button-wrapper"],[3,"buttonClick"]],template:function(t,o){t&1&&u(0,Xa,28,28),t&2&&h(o.participant.identity?0:-1)},dependencies:[er,I,w,Me,at,Ce,rt,zt,Fe,Ie,L,ve,Li,vr,_r,yn],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:center;overflow:hidden;border-radius:12px;background:var(--grayscale);container-type:inline-size}@container (max-width: 380px){[_nghost-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{margin-right:6px}[_nghost-%COMP%]   .spotify-playing[_ngcontent-%COMP%]{max-width:180px}}@container (max-width: 328px){[_nghost-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]   .chat-button[_ngcontent-%COMP%], [_nghost-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]   .hide-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]   .thumbs-up[_ngcontent-%COMP%]{display:none}}@container (max-width: 250px){[_nghost-%COMP%]   .spotify-playing[_ngcontent-%COMP%], [_nghost-%COMP%]   .header-selected-task[_ngcontent-%COMP%], [_nghost-%COMP%]   ss-user-info-status[_ngcontent-%COMP%]{display:none}}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{z-index:initial;border-radius:0;box-shadow:none}.active[_nghost-%COMP%], [_nghost-%COMP%]:hover{z-index:initial;box-shadow:none}}.active[_nghost-%COMP%], [_nghost-%COMP%]:hover{z-index:1}.active[_nghost-%COMP%]   .hover-top-menu[_ngcontent-%COMP%], [_nghost-%COMP%]:hover   .hover-top-menu[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]:hover   .focus-plus-actions[_ngcontent-%COMP%], [_nghost-%COMP%]:hover   .hd-toggle[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]:hover   ss-user-info-status.focus-active[_ngcontent-%COMP%]{opacity:1}.has-status[_nghost-%COMP%]    {container-type:inline-size}.has-status[_nghost-%COMP%]     .user-info{display:none}@container (max-width: 165px){.has-status[_nghost-%COMP%]     .status{-webkit-line-clamp:2}}.video-pill[_nghost-%COMP%]{width:310px;aspect-ratio:16/9}@media only screen and (max-width: 1024px){.video-pill[_nghost-%COMP%]{width:100%}}.video-pill.active[_nghost-%COMP%], .video-pill[_nghost-%COMP%]:hover{box-shadow:none}.camera-off[_nghost-%COMP%]{box-sizing:border-box}.camera-off[_nghost-%COMP%]   video[_ngcontent-%COMP%]{display:none}.highlighted[_nghost-%COMP%]{position:relative;z-index:1001;border-color:var(--contrast);background:var(--grayscale)}.zoom-to-fit-disabled[_nghost-%COMP%]{background:var(--video-poster-background)}.is-speaking[_nghost-%COMP%]{border-color:var(--positive)}.small-tile[_nghost-%COMP%]   .hover-top-menu[_ngcontent-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]{margin-left:6px}.small-tile[_nghost-%COMP%]   .hover-top-menu[_ngcontent-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]    {width:18px;height:18px;margin-right:6px}.small-tile[_nghost-%COMP%]   .hover-top-menu[_ngcontent-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]     ss-icon{font-size:18px!important}.small-tile[_nghost-%COMP%]   .hover-top-menu[_ngcontent-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{font-size:18px!important}.pinning-me[_nghost-%COMP%]{outline:2px solid var(--accent-blue)}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:12px}@media only screen and (max-width: 1024px){[_nghost-%COMP%]   video[_ngcontent-%COMP%]{border-radius:0}[_nghost-%COMP%]   video[_ngcontent-%COMP%]:after{position:absolute;top:0;left:0;width:100%;height:100%}}[_nghost-%COMP%]   .transparent-mobile-overlay[_ngcontent-%COMP%]{display:none}@media only screen and (max-width: 1024px){[_nghost-%COMP%]   .transparent-mobile-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;display:block;width:100%;height:100%}}[_nghost-%COMP%]   ss-participant-menu[_ngcontent-%COMP%]{margin-right:14px;margin-bottom:5px}.animated[_nghost-%COMP%]{animation:shakeX;animation-duration:1s;animation-delay:.5s}.new-user-border[_ngcontent-%COMP%]{position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;border:2px solid var(--positive-d1);border-radius:12px}@media only screen and (max-width: 1024px){.new-user-border[_ngcontent-%COMP%]{border-radius:0}}.top-line[_ngcontent-%COMP%]{position:absolute;top:4px;z-index:3;display:flex;justify-content:space-between;align-items:center;width:100%;height:25px;padding:0 8px 0 6px}.top-line.hover-active[_ngcontent-%COMP%]{right:0;width:auto}.left-part[_ngcontent-%COMP%]{display:flex;align-items:center;max-width:calc(100% - 46px)}.spotify-playing[_ngcontent-%COMP%]{display:flex;align-items:center;padding:2px 6px;border-radius:8px;color:var(--contrast);background:var(--video-overlay);font-size:12px;line-height:16px;cursor:pointer}@media only screen and (max-width: 1024px){.spotify-playing[_ngcontent-%COMP%]{position:absolute;top:-37px;left:0;max-width:238px;width:auto}.spotify-playing.feedback-visible[_ngcontent-%COMP%]{width:200px!important}.spotify-playing[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap}}.spotify-playing.feedback-visible[_ngcontent-%COMP%]{max-width:calc(100% - 55px)}.spotify-playing[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:21px;height:21px;margin-right:4px}.spotify-playing[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:-webkit-box;overflow:hidden;word-break:break-all;text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}.right-part[_ngcontent-%COMP%]{display:flex;align-items:center}.right-part[_ngcontent-%COMP%]   .pin-for-pin[_ngcontent-%COMP%]{padding-left:8px;margin-right:4px;font-size:12px;color:var(--contrast)}.right-part[_ngcontent-%COMP%]   .pin-for-pin.selected-task[_ngcontent-%COMP%]{right:56px}.right-part[_ngcontent-%COMP%]   .focus-plus[_ngcontent-%COMP%]{margin-right:4px;font-size:14px;font-weight:600;color:var(--contrast)}.right-part[_ngcontent-%COMP%]   .header-selected-task[_ngcontent-%COMP%]{margin-right:4px}.hover-top-menu[_ngcontent-%COMP%]{position:absolute;z-index:2;display:flex;width:100%;height:32px;background:var(--light-default);opacity:0}.actions-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:14px}.actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{margin-right:10px}.actions-wrapper[_ngcontent-%COMP%]   ss-button.active[_ngcontent-%COMP%]  ss-icon i{color:var(--accent-blue-20)}.actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]  button{width:20px;height:20px}.actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]  button:hover ss-icon i{color:var(--accent-blue-20)}.actions-wrapper[_ngcontent-%COMP%]   .fb-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:32px;height:32px;margin-right:10px;background:var(--accent-blurple-20) url(/assets/icons/fb-icon.svg) center no-repeat;cursor:pointer}.actions-wrapper[_ngcontent-%COMP%]   .fb-icon.active[_ngcontent-%COMP%], .actions-wrapper[_ngcontent-%COMP%]   .fb-icon[_ngcontent-%COMP%]:hover{background:var(--accent-blurple-40) url(/assets/icons/fb-icon.svg) center no-repeat}.boost[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-shrink:0;width:19px;height:20px;margin-right:4px;border-radius:8px;background:url(/assets/icons/boost-tile.svg) center no-repeat var(--video-overlay);background-size:16px}@media only screen and (max-width: 1024px){.boost[_ngcontent-%COMP%]{background-size:14px}}.boost.premium[_ngcontent-%COMP%]{width:24px;height:24px;background:url(/assets/icons/premium-boost-tile.svg) center no-repeat var(--video-overlay);background-size:16px}.spinner-wrapper[_ngcontent-%COMP%]{width:20px;margin-right:10px}.pined-count[_ngcontent-%COMP%], .hd-toggle[_ngcontent-%COMP%], .reports-count[_ngcontent-%COMP%], .recently-restored-pin[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;max-width:100px;height:16px;padding:0 6px 0 4px;border-radius:8px;background:var(--video-overlay)}.pined-count[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%], .hd-toggle[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%], .reports-count[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%], .recently-restored-pin[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:4px}.pined-count[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], .hd-toggle[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], .reports-count[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], .recently-restored-pin[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--contrast)}.pined-count[_ngcontent-%COMP%]{margin-right:4px}.hd-toggle[_ngcontent-%COMP%]{display:none}.hd-toggle.active[_ngcontent-%COMP%]{display:flex;background:var(--accent-blurple-20)}.second-line[_ngcontent-%COMP%]{position:absolute;top:40px;left:0;z-index:3;display:flex;align-items:center;height:25px;padding:0 6px}.second-line[_ngcontent-%COMP%]   .hd-toggle[_ngcontent-%COMP%], .second-line[_ngcontent-%COMP%]   .reports-count[_ngcontent-%COMP%]{margin-right:4px;cursor:pointer}.second-line[_ngcontent-%COMP%]   .hd-toggle[_ngcontent-%COMP%]   small[_ngcontent-%COMP%], .second-line[_ngcontent-%COMP%]   .reports-count[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{position:relative;top:1px}.recently-restored-pin[_ngcontent-%COMP%]{padding:0 4px;margin-right:4px}.recently-restored-pin[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{padding:0;margin-right:0}.menu-wrapper[_ngcontent-%COMP%]{position:relative;top:3px}.thumbs-up[_ngcontent-%COMP%]{margin-right:10px;cursor:pointer}.thumbs-up[_ngcontent-%COMP%]:hover{opacity:.7}.avatar-placeholder[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;z-index:1;transform:translate(-50%,-50%)}ss-user-info-status.focus-active[_ngcontent-%COMP%]{opacity:0;transition:opacity .25s}.focus-plus-actions[_ngcontent-%COMP%]{position:absolute;top:50%;right:0;z-index:1;display:none;flex-direction:column;transform:translateY(-50%);gap:4px}.status-name-wrapper[_ngcontent-%COMP%]{position:relative;bottom:-19px;display:flex;align-items:center;height:0;opacity:0;transition:bottom .3s ease-out,height .3s ease-out,opacity .15s ease-out}.status-name-wrapper[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{position:absolute;top:-10px;left:4px}.status-name-wrapper[_ngcontent-%COMP%]   .display-name[_ngcontent-%COMP%]{position:relative;bottom:1px;display:-webkit-box;overflow:hidden;padding-right:3px;margin-left:36px;color:var(--contrast);text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}.stats-for-nerds[_ngcontent-%COMP%]{position:absolute;z-index:3;width:100%;height:100%;padding:12px;font-size:12px;line-height:12px;color:var(--grayscale);background:rgba(var(--helper-dark),.7)}.stats-for-nerds[_ngcontent-%COMP%]   .button-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:4px}.stats-for-nerds[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]{margin-right:2px}.stats-for-nerds[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]:last-of-type{margin-right:0}.private-space-indicator[_ngcontent-%COMP%]{position:absolute;top:50%;right:0;z-index:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:22px 8px;border-top-left-radius:30px;border-bottom-left-radius:30px;color:var(--contrast);background:var(--private-space-indicator);cursor:pointer;transform:translateY(-50%)}.private-space-indicator[_ngcontent-%COMP%]:hover{opacity:.85}.private-space-indicator[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:4px}.ad-user[_ngcontent-%COMP%]{cursor:pointer}.custom-tooltip[_ngcontent-%COMP%]{font-family:Poppins,sans-serif}.custom-tooltip[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:8px}.custom-tooltip[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:6px;font-size:13px;line-height:20px}.pulse-white[_ngcontent-%COMP%], .pulse-gray[_ngcontent-%COMP%]{padding:4px;margin-left:6px;border-radius:50%}.pulse-white[_ngcontent-%COMP%]{box-shadow:0 0 rgba(var(--white),1);animation:_ngcontent-%COMP%_pulse-white 1s infinite ease-in-out}.pulse-white[_ngcontent-%COMP%]     button{height:20px;padding:0}.pulse-gray[_ngcontent-%COMP%]{box-shadow:0 0 rgba(var(--default-60),1);animation:_ngcontent-%COMP%_gray-pulse 1s infinite ease-in-out}.pulse-gray[_ngcontent-%COMP%]     button{height:20px;padding:0}.pulse-gray[_ngcontent-%COMP%]     button i{color:var(--default-60)}@keyframes _ngcontent-%COMP%_pulse-white{0%{box-shadow:0 0 rgba(var(--white),.7);transform:scale(1)}70%{box-shadow:0 0 0 12px rgba(var(--white),0);transform:scale(1.05)}to{box-shadow:0 0 rgba(var(--white),0);transform:scale(1)}}@keyframes _ngcontent-%COMP%_gray-pulse{0%{box-shadow:0 0 #64646499;transform:scale(1)}70%{box-shadow:0 0 0 12px #64646400;transform:scale(1.05)}to{box-shadow:0 0 #64646400;transform:scale(1)}}.light-theme[_nghost-%COMP%]   .dark-color[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .dark-color[_ngcontent-%COMP%]{color:var(--black)}"]});let n=r;return n})();var ec=["tilesWrapper"],tc=(n,r)=>r.identity;function ic(n,r){if(n&1){let i=P();a(0,"ss-focus-room-tile",4),f("swapFocusPlusParticipant",function(t){_(i);let o=l();return C(o.addAnotherParticipantToFocusPlus(t))})("removeFromFocusPlus",function(t){_(i);let o=l();return C(o.removeParticipantFromFocusPlus(t))}),c()}if(n&2){let i=r.$implicit,e=l();p("participant",i)("isMobile",e.isMobile)("theme",e.theme)("allowFullscreenView",!0)}}function nc(n,r){if(n&1){let i=P();a(0,"ss-empty-tile",5),f("addAnotherParticipant",function(){_(i);let t=l();return C(t.addAnotherParticipantToFocusPlus())}),c()}if(n&2){let i=l();p("noParticipants",i.participants.length===0)}}var zi=(()=>{let r=class r{get shouldShowEmptyTile(){return this.livekit.room.focusPlus.active&&this.livekit.room?.paginator.tilesPerPage>this.participants.length}constructor(e,t,o,d,v){this.livekit=e,this.elementRef=t,this.sidebarService=o,this.utilityService=d,this.snackBarService=v,this.participants=[],this.isMobile=!1,this.ASPECT=16/9,this.GAP=5,this.tileGridResizeObserver=new ResizeObserver(k=>{requestAnimationFrame(()=>{this.isMobile&&(this.setMobileWrapperStyleAndTileDimensions(),this.onGridElementResized(k[0].target)),this.setWrapperDimensions()})}),this.gridDimensions={width:0,height:0},this.sidebarExpanded=!1,this.activeGroup=null,this.activePredefinedGroup=null,this.numberOfTilesOnPage=null,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.livekit.recalculateGrid.subscribe(()=>this.recalculateGridAndTiles(!0)))}ngAfterViewInit(){this.tileGridResizeObserver.observe(this.elementRef.nativeElement),this.subscriptions.push(this.livekit.room.activeGroup.pipe(Ct(e=>this.activeGroup!==e)).subscribe(e=>{this.activeGroup=e,this.setWrapperDimensions()}),this.livekit.room.activePredefinedGroup.pipe(Ct(e=>this.activePredefinedGroup!==e)).subscribe(e=>{this.activePredefinedGroup=e,this.setWrapperDimensions()}),this.utilityService.isMobile.pipe(Ct(e=>this.isMobile!==e)).subscribe(e=>{this.isMobile&&!e&&this.livekit.recalculateGrid.next(),this.isMobile=e,this.setWrapperDimensions()}),this.sidebarService.sidebarStateChange.pipe(Ct(e=>this.sidebarExpanded!==e)).subscribe(e=>{this.sidebarExpanded=e,this.setWrapperDimensions()}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),zn(this.tileGridResizeObserver,this.elementRef?.nativeElement)}addAnotherParticipantToFocusPlus(e){let t=this.livekit.room,o=t.pinnedParticipants.length>0&&!t.forceGridView?t.pinnedParticipants:t.allParticipants,d;if(o===t.allParticipants){let v=Math.min(t.paginator.tilesPerPage,t.paginator.maxTilesAllowed),k=(t.paginator.currentPage-1)*v,T=k+v;d=o.slice(k,T).find(z=>!t.focusPlus.participants.includes(z)&&z!==e),d||(d=o.find(z=>!t.focusPlus.participants.includes(z)&&z!==e))}else d=o.find(v=>!t.focusPlus.participants.includes(v)&&v!==e);if(!d){let v=o===t.allParticipants?"You have already added everyone that's currently in the room.":"You have already added all pinned participants.";this.snackBarService.info({message:v});return}if(e){let v=t.focusPlus.participants.indexOf(e);v!==-1?t.focusPlus.participants.splice(v,1,d):t.focusPlus.participants.push(d)}else t.focusPlus.participants.push(d);t.recalculateGrid.next()}removeParticipantFromFocusPlus(e){let t=this.livekit.room,o=t.focusPlus.participants.indexOf(e);o!==-1&&(t.focusPlus.participants.splice(o,1),t.recalculateGrid.next())}setWrapperDimensions(){if(this.isMobile){this.setMobileWrapperStyleAndTileDimensions();return}setTimeout(()=>{let e=document.querySelector("ss-focus-room-session-group"),t=document.querySelector("ss-focus-room-predefined-groups"),o=this.sidebarExpanded?199:55,d=24,v=e?.clientWidth??0,k=t?.clientWidth??0,T=o+d+v+k,B=document.querySelector("ss-main-app-header"),z=document.querySelector("ss-focus-room-actions"),ke=document.querySelector("ss-focus-room-milestones-bar"),pe=document.querySelector(".dashboard-wrapper.ads-shown .router-wrapper + div"),Ve=B?.clientHeight??0,Xe=z?.clientHeight??0,Ft=ke?ke.clientHeight+8:0,qt=8,Yt=pe?.clientHeight??0,Kt=Ve+Xe+Ft+qt+Yt,Qt=this.elementRef.nativeElement;Qt.style.width=`calc(100vw - ${T}px)`,Qt.style.height=`calc(100vh - ${Kt}px)`,this.onGridElementResized(Qt)})}setMobileWrapperStyleAndTileDimensions(){setTimeout(()=>{this.elementRef.nativeElement.style.width="100vw",this.elementRef.nativeElement.style.height="";let e=Math.ceil(this.livekit.room.paginator.maxTilesAllowed/8);this.tilesWrapper.nativeElement.style.gridTemplateColumns="1fr ".repeat(e).trim(),this.tilesWrapper.nativeElement.style.gridTemplateRows="",this.livekit.room.tileDimensions.width=Math.round(this.elementRef.nativeElement.clientWidth/e),this.livekit.room.tileDimensions.height=Math.round(9*this.livekit.room.tileDimensions.width/16)})}onGridElementResized(e){this.gridDimensions.width===e.clientWidth&&this.gridDimensions.height===e.clientHeight||(this.gridDimensions.width=e.clientWidth,this.gridDimensions.height=e.clientHeight,this.recalculateGridAndTiles())}recalculateGridAndTiles(e=!1){if(this.gridDimensions.width===0||this.gridDimensions.height===0)return;this.livekit.room.setMaxAllowedTiles(this.elementRef.nativeElement.clientWidth);let o=this.livekit.room.pinnedParticipants.length>0&&!this.livekit.room.forceGridView?this.livekit.room.pinnedParticipants:this.livekit.room.filteredParticipants,d=Math.min(this.livekit.room.focusPlus.active?this.livekit.room.focusPlus.participants.length+(this.shouldShowEmptyTile?1:0):o.length,this.livekit.room.paginator.tilesPerPage,this.livekit.room.paginator.maxTilesAllowed);if(e&&d===this.numberOfTilesOnPage||(this.numberOfTilesOnPage=d,d===0||this.isMobile))return;let v=this.computeBestLayout(d,this.gridDimensions.width,this.gridDimensions.height);this.applyLayout(v)}computeBestLayout(e,t,o){let d=null,v=-1;for(let k=1;k<=e;k++){let T=Math.ceil(e/k),B=Math.floor((t-this.totalGap(T))/T),z=Math.floor(B/this.ASPECT);if(z*k+this.totalGap(k)>o&&(z=Math.floor((o-this.totalGap(k))/k),B=Math.floor(z*this.ASPECT)),B*T+this.totalGap(T)>t||z*k+this.totalGap(k)>o)continue;let pe=B*z*e;(pe>v||pe===v&&d&&k<d.rows||pe===v&&d&&k===d.rows&&T<d.columns)&&(v=pe,d={rows:k,columns:T,tileWidth:B,tileHeight:z})}if(!d){let k=Math.floor(t),T=Math.floor(k/this.ASPECT);d={rows:e,columns:1,tileWidth:k,tileHeight:T}}return d}applyLayout(e){let t=this.tilesWrapper.nativeElement;t.style.gridTemplateRows=`repeat(${e.rows}, 1fr)`,t.style.gridTemplateColumns=`repeat(${e.columns}, 1fr)`,this.livekit.room.tileDimensions.width=e.tileWidth,this.livekit.room.tileDimensions.height=e.tileHeight}totalGap(e){return(e-1)*this.GAP}};r.\u0275fac=function(t){return new(t||r)(m(M),m(ze),m(Ei),m(J),m(xt))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-tile-grid"]],viewQuery:function(t,o){if(t&1&&Ae(ec,5),t&2){let d;Le(d=Ge())&&(o.tilesWrapper=d.first)}},inputs:{theme:"theme",participants:"participants"},standalone:!1,decls:5,vars:1,consts:[["tilesWrapper",""],[1,"tiles-wrapper"],[3,"participant","isMobile","theme","allowFullscreenView"],[3,"noParticipants"],[3,"swapFocusPlusParticipant","removeFromFocusPlus","participant","isMobile","theme","allowFullscreenView"],[3,"addAnotherParticipant","noParticipants"]],template:function(t,o){t&1&&(a(0,"div",1,0),V(2,ic,1,4,"ss-focus-room-tile",2,tc),u(4,nc,1,1,"ss-empty-tile",3),c()),t&2&&(s(2),A(o.participants),s(2),h(o.shouldShowEmptyTile?4:-1))},dependencies:[ut,mr],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{height:auto}}.tiles-wrapper[_ngcontent-%COMP%]{display:grid;align-items:center;grid-template-columns:1fr;grid-template-rows:1fr;grid-gap:5px}@media only screen and (max-width: 1024px){.tiles-wrapper[_ngcontent-%COMP%]{grid-gap:0}}"]});let n=r;return n})();function oc(n,r){if(n&1&&b(0,"div",7),n&2){let i=l();qe("background-image","url(/assets/images/logo-text-white"+(i.settingsService.isB2BApp()||i.settingsService.isCoWork()?"-cw":"")+".svg)")}}function rc(n,r){if(n&1&&(a(0,"div",8),g(1),c()),n&2){let i=l(2);s(),O(" ",i.taskText," ")}}function sc(n,r){if(n&1&&(a(0,"span"),g(1),c()),n&2){let i=r.$implicit;s(),R(i)}}function ac(n,r){if(n&1){let i=P();a(0,"div",9)(1,"div",10),V(2,sc,2,1,"span",null,je),c(),a(4,"ss-button-small",11),f("buttonClick",function(){_(i);let t=l(2);return C(t.datePaused?t.resume():t.pause())}),c()()}if(n&2){let i=l(2);s(2),A(i.timerValueParts),s(2),p("iconName",i.datePaused?"play":"drink_coffee")("iconSize",20)("iconOnly",!0)("matTooltip",i.datePaused?"Resume":"Take a break")}}function cc(n,r){if(n&1&&(a(0,"div",2),u(1,rc,2,1,"div",8),u(2,ac,5,4,"div",9),c()),n&2){let i=l();s(),h(i.taskText?1:-1),s(),h(i.timerValueParts!==null?2:-1)}}var Pr=(()=>{let r=class r{get participants(){return this.livekit.room.focusPlus.participants}get taskText(){return this.livekit.room.focusPlus.taskText}handleKeyboardEvent(){this.close()}constructor(e,t,o,d){this.settingsService=e,this.livekit=t,this.themeService=o,this.toastService=d,this.timerValueParts=null,this.datePaused=null,this.dateExpiresAt=null,this.UserThemeRef=gt,this.timerSubscription=null,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.themeService.themeChange.subscribe(e=>this.theme=e)),this.themeService.setTheme(gt.Dark,!0),document.body.classList.contains("focus-plus")||document.body.classList.add("focus-plus"),this.livekit.room.focusPlus.taskDurationInMinutes>0&&(this.dateExpiresAt=$.now().plus({minutes:this.livekit.room.focusPlus.taskDurationInMinutes}),this.startTimer(this.dateExpiresAt))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.timerSubscription?.unsubscribe(),this.themeService.setTheme(this.theme,!0),document.body.classList.contains("focus-plus")&&document.body.classList.remove("focus-plus")}pause(){this.datePaused=$.now(),this.timerSubscription?.unsubscribe()}resume(){if(!this.datePaused||!this.dateExpiresAt)return;let e=$.now().diff(this.datePaused);this.dateExpiresAt=this.dateExpiresAt.plus(e),this.startTimer(this.dateExpiresAt),this.datePaused=null}close(){this.timerSubscription?.unsubscribe(),this.livekit.room.focusPlus.exit()}startTimer(e){this.timerSubscription=W(0,1e3).subscribe(()=>this.tick(e))}tick(e){let t=e.diffNow(["minutes","seconds"]);if(t.minutes<=0&&t.seconds<=0){this.toastService.success({message:"Congratulations! Your Focus+ session has been completed.",closeTimeoutMs:12e3}),this.close();return}let o=Qi(Math.floor(t.minutes),2),d=Qi(Math.floor(t.seconds),2),v=`${o}:${d}`;this.timerValueParts=v.split("")}};r.\u0275fac=function(t){return new(t||r)(m(X),m(M),m(nt),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-plus"]],hostBindings:function(t,o){t&1&&f("keydown.escape",function(){return o.handleKeyboardEvent()},et)},standalone:!1,decls:9,vars:5,consts:[[1,"focus-plus-header"],[1,"logo",3,"backgroundImage"],[1,"additional-info"],[1,"close-button",3,"click"],["iconName","dismiss","color","contrast",3,"size","iconVariant"],[3,"participants","theme"],[1,"focus-plus-footer"],[1,"logo"],["matTooltip","Your current task","matTooltipPosition","right",1,"task"],[1,"timer-wrapper"],[1,"timer"],["role","button",3,"buttonClick","iconName","iconSize","iconOnly","matTooltip"]],template:function(t,o){t&1&&(a(0,"section",0),u(1,oc,1,2,"div",1)(2,cc,3,2,"div",2),a(3,"button",3),f("click",function(){return o.close()}),b(4,"ss-icon",4),c()(),b(5,"ss-focus-room-tile-grid",5),a(6,"section",6)(7,"small"),g(8,"When in Focus+ mode you won't receive encouragements, private space invitations, or message notifications."),c()()),t&2&&(s(),h(!o.taskText&&o.timerValueParts===null?1:2),s(3),p("size",20)("iconVariant",20),s(),p("participants",o.participants)("theme",o.UserThemeRef.Dark))},dependencies:[w,Ce,L,zi],styles:["[_nghost-%COMP%]{position:fixed;top:0;left:0;z-index:1003;display:block;width:100vw;height:100vh;background-color:var(--focus-plus-background);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){[_nghost-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}[_nghost-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}[_nghost-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.focus-plus-header[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:60px}.focus-plus-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:100px;height:15px;background-position:center;background-repeat:no-repeat}@media only screen and (max-width: 1024px){.focus-plus-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:none}}.focus-plus-header[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.focus-plus-header[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]   .task[_ngcontent-%COMP%], .focus-plus-header[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]   .timer-wrapper[_ngcontent-%COMP%]{margin-left:8px}.focus-plus-header[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]   .task[_ngcontent-%COMP%]{margin-bottom:2px}.focus-plus-header[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]   .timer-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:8px}.focus-plus-header[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]   .timer-wrapper[_ngcontent-%COMP%]   .timer[_ngcontent-%COMP%]{font-size:18px;text-align:center}.focus-plus-header[_ngcontent-%COMP%]   .additional-info[_ngcontent-%COMP%]   .timer-wrapper[_ngcontent-%COMP%]   .timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;width:11px}.focus-plus-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;display:flex;justify-content:center;align-items:center;min-width:36px;width:36px;height:36px;padding:0;border:none;border-radius:15px;outline:none;background-color:transparent;cursor:pointer;transition:all .3s}@media only screen and (max-width: 767px){.focus-plus-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{position:fixed;z-index:3;order:3}}.focus-plus-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:hover{opacity:.8}ss-focus-room-tile-grid[_ngcontent-%COMP%]{width:100vw!important;height:calc(100vh - 120px)!important}.focus-plus-footer[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:60px}.focus-plus-footer[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--default-40)}"]});let n=r;return n})();function dc(n,r){if(n&1){let i=P();a(0,"ss-focus-room-select",18),f("ngModelChange",function(t){_(i);let o=l();return C(o.onUserTypeFilterChange(t))}),c()}if(n&2){let i=l();p("ngModel",i.livekit.room.simpleFilter?i.tempFilter.selectedUserTypes:i.livekit.room.filter.selectedUserTypes)("options",i.userTypes)("multiple",!0)}}function pc(n,r){if(n&1){let i=P();a(0,"ss-focus-room-select",19),he("ngModelChange",function(t){_(i);let o=l();return ue(o.livekit.room.filter.selectedCountries,t)||(o.livekit.room.filter.selectedCountries=t),C(t)}),f("ngModelChange",function(){_(i);let t=l();return C(t.onCountryFilterUpdated())}),c(),a(1,"ss-focus-room-select",20),he("ngModelChange",function(t){_(i);let o=l();return ue(o.livekit.room.filter.selectedAreasOfStudy,t)||(o.livekit.room.filter.selectedAreasOfStudy=t),C(t)}),f("ngModelChange",function(){_(i);let t=l();return C(t.onAreaOfStudyFilterUpdated())}),c()}if(n&2){let i=l();me("ngModel",i.livekit.room.filter.selectedCountries),p("options",i.countries)("multiple",!0)("ellipsisPx",194)("showTooltip",!0),s(),me("ngModel",i.livekit.room.filter.selectedAreasOfStudy),p("placeholder",i.settingsService.isB2BApp()?"Industry":"Subject")("options",i.areasOfStudy)("multiple",!0)("ellipsisPx",194)("showTooltip",!0)}}function mc(n,r){if(n&1){let i=P();a(0,"div",11)(1,"div",6),b(2,"ss-icon",21),a(3,"span",8),g(4,"Sort"),c()(),a(5,"ss-focus-room-select-long",22),he("ngModelChange",function(t){_(i);let o=l();return ue(o.livekit.room.filter.selectedSortOption,t)||(o.livekit.room.filter.selectedSortOption=t),C(t)}),f("ngModelChange",function(){_(i);let t=l();return C(t.onSortUpdated())}),c()()}if(n&2){let i=l();s(2),p("size",20),s(3),me("ngModel",i.livekit.room.filter.selectedSortOption),p("options",i.sortOptions)}}function uc(n,r){if(n&1){let i=P();a(0,"div",12)(1,"mat-slide-toggle",23),f("change",function(){_(i);let t=l(2);return C(t.toggleShowParticipantsWithReportsOnly())}),c(),a(2,"div"),g(3,"Only participants with reports"),c()()}if(n&2){let i=l(2);s(),p("checked",i.reportsOnly)}}function hc(n,r){if(n&1){let i=P();a(0,"div",12)(1,"mat-slide-toggle",23),f("change",function(t){_(i);let o=l();return C(o.onToggleEmptyPinSlots(t.checked))}),c(),a(2,"div"),g(3,"Has pin slots remaining"),c(),b(4,"ss-info-tooltip",24),c(),a(5,"div",12)(6,"mat-slide-toggle",23),f("change",function(){_(i);let t=l();return C(t.toggleShowParticipantsWithNewMarkerOnly())}),c(),a(7,"div"),g(8,"Only new users"),c()(),u(9,uc,4,1,"div",12)}if(n&2){let i=l();s(),p("checked",i.livekit.room.simpleFilter?i.tempFilter.participantsWithEmptyPinSlots:i.livekit.room.filter.participantsWithEmptyPinSlots),s(3),p("isSmall",!0),s(2),p("checked",i.newUsersOnly),s(3),h(i.isModerator?9:-1)}}function gc(n,r){if(n&1&&(a(0,"div"),g(1),c()),n&2){let i=l();s(),O(" Filtered results: ",i.livekit.room.filteredParticipants.length," ")}}var yr=(()=>{let r=class r{get isModerator(){return!!this.livekit.room.localParticipant.userInfo?.isModerator}get reportsOnly(){return this.livekit.room.filter.participantsWithReportsOnly}get newUsersOnly(){return this.livekit.room.filter.participantsWithNewMarkerOnly}constructor(e,t,o,d,v,k,T,B,z,ke,pe,Ve){this.dialogRef=e,this.settingsService=t,this.livekit=o,this.countryService=d,this.subscriptionService=v,this.areaOfStudyService=k,this.accountService=T,this.accountModalsService=B,this.analyticsService=z,this.utilityService=ke,this.toastService=pe,this.dialog=Ve,this.countries=[],this.areasOfStudy=[],this.userTypes=[{label:"Professional \u{1F9D1}\u200D\u{1F4BB}",value:Re.Professional},{label:"Uni Student \u{1F469}\u200D\u{1F393}",value:Re.UniStudent},{label:"Pre Uni Student \u{1F4DA}",value:Re.PreUniStudent}],this.genderOptions=[{id:Ut.Male,name:"Male"},{id:Ut.Female,name:"Female"}],this.tempFilter={participantsWithPinForPinEnabled:!0,participantsWithEmptyPinSlots:!0,selectedUserTypes:[],selectedGenders:[],selectedSortOption:it.MostPins},this.firstChanges={countryFilter:!0,areaOfStudyFilter:!0,userTypeFilter:!0,genderFilter:!0,sort:!0},this.skipMarkActivity={countryFilter:!1,areaOfStudyFilter:!1,userTypeFilter:!1,genderFilter:!1,sort:!1},this.isMobile=!1,this.countryCounts={},this.areaOfStudyCounts={},this.genderCounts={},this.userTypeCounts={},this.subscriptions=[],this.sortOptions=[{label:"Most pins (default)",value:it.MostPins},{label:"Ignore pin counts",value:it.IgnorePinCounts}]}ngOnInit(){this.initCountsAndDropdowns(),this.livekit.room.simpleFilter||(this.countryService.getAll().subscribe({next:e=>this.countries=this.filterCountries(e),error:e=>this.handleErrors(e)}),this.areaOfStudyService.getAllActive().subscribe({next:e=>this.areasOfStudy=this.filterAreas(e),error:e=>this.handleErrors(e)})),this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>{this.isMobile=e,this.isMobile&&this.clearFilters()})),this.dialogRef.beforeClosed().subscribe(()=>{let e=this.livekit.room.simpleFilter?y.NewUserFIlterModalClosed:y.NormalUserFIlterModalClosed;this.analyticsService.markActivity(e)}),this.initializeTempFilterFromRealOrStoredFilters()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onCountryFilterUpdated(){if(this.firstChanges.countryFilter){this.firstChanges.countryFilter=!1;return}this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.skipMarkActivity.countryFilter?this.skipMarkActivity.countryFilter=!1:this.analyticsService.markActivity(y.FocusRoomCountryFilterChange)}onAreaOfStudyFilterUpdated(){if(this.firstChanges.areaOfStudyFilter){this.firstChanges.areaOfStudyFilter=!1;return}this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.skipMarkActivity.areaOfStudyFilter?this.skipMarkActivity.areaOfStudyFilter=!1:this.analyticsService.markActivity(y.FocusRoomAreaOfStudyFilterChange)}onUserTypeFilterChange(e){if(this.livekit.room.simpleFilter){this.tempFilter.selectedUserTypes=e;return}this.livekit.room.filter.selectedUserTypes=e,this.onUserTypeFilterUpdated()}onGenderFilterChange(e){if(this.livekit.room.simpleFilter){this.tempFilter.selectedGenders=e;return}this.livekit.room.filter.selectedGenders=e,this.onGenderFilterUpdated()}onUserTypeFilterUpdated(){if(this.firstChanges.userTypeFilter){this.firstChanges.userTypeFilter=!1;return}this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.skipMarkActivity.userTypeFilter?this.skipMarkActivity.userTypeFilter=!1:this.analyticsService.markActivity(y.FocusRoomUserTypeFilterChange)}onGenderFilterUpdated(){if(this.firstChanges.genderFilter){this.firstChanges.genderFilter=!1;return}this.skipMarkActivity.genderFilter?this.skipMarkActivity.genderFilter=!1:this.analyticsService.markActivity(y.FocusRoomGenderFilterChange),this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next()}onSortUpdated(){if(this.firstChanges.sort){this.firstChanges.sort=!1;return}if(this.skipMarkActivity.sort)this.skipMarkActivity.sort=!1;else{let e=this.livekit.room.filter.selectedSortOption===it.MostPins?y.FocusRoomSortByMostPins:y.FocusRoomSortByIgnorePinCounts;this.analyticsService.markActivity(e)}this.livekit.room.sortAndAssignDisplayedParticipants()}onTogglePinForPin(e){if(this.livekit.room.simpleFilter){this.tempFilter.participantsWithPinForPinEnabled=e;return}this.livekit.room.filter.participantsWithPinForPinEnabled=e,this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.analyticsService.markActivity(y.AutoPinFilter,{active:e})}onToggleEmptyPinSlots(e){if(this.livekit.room.simpleFilter){this.tempFilter.participantsWithEmptyPinSlots=e;return}this.livekit.room.filter.participantsWithEmptyPinSlots=e,this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.analyticsService.markActivity(y.EmptyPinSlotsFilter,{active:e})}toggleShowParticipantsWithReportsOnly(){this.livekit.room.filter.participantsWithReportsOnly=!this.livekit.room.filter.participantsWithReportsOnly,this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.analyticsService.markActivity(y.ReportsFilter,{active:this.livekit.room.filter.participantsWithReportsOnly})}toggleShowParticipantsWithNewMarkerOnly(){this.livekit.room.filter.participantsWithNewMarkerOnly=!this.livekit.room.filter.participantsWithNewMarkerOnly,this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.analyticsService.markActivity(y.NewUsersFilter,{active:this.livekit.room.filter.participantsWithNewMarkerOnly})}clearFilters(){if(this.livekit.room.simpleFilter){localStorage.removeItem(Vt),this.livekit.room.clearFilters(),this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.close();return}this.skipMarkActivity.countryFilter=!0,this.skipMarkActivity.areaOfStudyFilter=!0,this.skipMarkActivity.userTypeFilter=!0,this.skipMarkActivity.genderFilter=!0,this.skipMarkActivity.sort=this.livekit.room.filter.selectedSortOption!==it.MostPins,this.analyticsService.markActivity(y.ClearedFilters),this.livekit.room.clearFilters()}save(){let e={gender:this.accountService.currentUser.gender,type:this.accountService.currentUser.type};this.livekit.room.simpleFilter?(localStorage.setItem(Vt,JSON.stringify(this.tempFilter)),this.analyticsService.markActivity(y.NewUserFilterApplied,{filters:this.tempFilter,senderInfo:e}),!this.accountService.currentUser.completedBasicInfo||!this.accountService.currentUser.emailConfirmed?this.showFocusBuddiesAwaitModal():(this.applyTempFilterToRealFilter(),this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next())):(localStorage.removeItem(Vt),this.analyticsService.markActivity(y.NormalUserFilterApplied,{filters:this.livekit.room.filter,senderInfo:e})),this.dialogRef.close()}close(){this.livekit.room.simpleFilter&&this.clearTempFilters(),this.dialogRef.close()}showFocusBuddiesAwaitModal(){this.dialog.open(ur,{panelClass:"fullscreen-dialog"}).afterClosed().subscribe(t=>{t&&this.accountModalsService.ensureUserCompletedBasicInfo()})}initializeTempFilterFromRealOrStoredFilters(){if(!this.livekit.room.simpleFilter)return;let e=this.livekit.room.filter;if(e.selectedUserTypes&&e.selectedUserTypes.length>0||e.selectedGenders&&e.selectedGenders.length>0||e.selectedSortOption!==it.MostPins||!e.participantsWithPinForPinEnabled||!e.participantsWithEmptyPinSlots)this.tempFilter={selectedUserTypes:[...e.selectedUserTypes],selectedGenders:[...e.selectedGenders],selectedSortOption:e.selectedSortOption||it.MostPins,participantsWithPinForPinEnabled:e.participantsWithPinForPinEnabled,participantsWithEmptyPinSlots:e.participantsWithEmptyPinSlots};else{let o=localStorage.getItem(Vt);if(o){let d=JSON.parse(o);this.tempFilter={selectedUserTypes:d.selectedUserTypes||[],selectedGenders:d.selectedGenders||[],selectedSortOption:d.selectedSortOption||it.MostPins,participantsWithPinForPinEnabled:d.participantsWithPinForPinEnabled??!0,participantsWithEmptyPinSlots:d.participantsWithEmptyPinSlots??!0}}}this.tempFilter.participantsWithPinForPinEnabled=!0,this.tempFilter.participantsWithEmptyPinSlots=!0}applyTempFilterToRealFilter(){this.livekit.room.filter.selectedUserTypes=[...this.tempFilter.selectedUserTypes],this.livekit.room.filter.selectedGenders=[...this.tempFilter.selectedGenders],this.livekit.room.filter.selectedSortOption=this.tempFilter.selectedSortOption,this.livekit.room.filter.participantsWithPinForPinEnabled=this.tempFilter.participantsWithPinForPinEnabled,this.livekit.room.filter.participantsWithEmptyPinSlots=this.tempFilter.participantsWithEmptyPinSlots}clearTempFilters(){this.tempFilter={participantsWithPinForPinEnabled:!1,participantsWithEmptyPinSlots:!1,selectedUserTypes:[],selectedGenders:[],selectedSortOption:it.MostPins}}initCountsAndDropdowns(){this.genderCounts={},this.userTypeCounts={},this.countryCounts={},this.areaOfStudyCounts={};for(let e of this.livekit.room.allParticipants){let t=e.userInfo;t.gender!=null&&(this.genderCounts[t.gender]=(this.genderCounts[t.gender]??0)+1),t.type!=null&&(this.userTypeCounts[t.type]=(this.userTypeCounts[t.type]??0)+1),t.countryId!=null&&(this.countryCounts[t.countryId]=(this.countryCounts[t.countryId]??0)+1),t.areaOfStudyId!=null&&(this.areaOfStudyCounts[t.areaOfStudyId]=(this.areaOfStudyCounts[t.areaOfStudyId]??0)+1)}this.genderOptions=[{id:Ut.Male,name:`Male (${this.genderCounts[Ut.Male]??0})`},{id:Ut.Female,name:`Female (${this.genderCounts[Ut.Female]??0})`}],this.userTypes=[{value:Re.Professional,label:`Professional \u{1F9D1}\u200D\u{1F4BB} (${this.userTypeCounts[Re.Professional]??0})`},{value:Re.UniStudent,label:`Uni Student \u{1F469}\u200D\u{1F393} (${this.userTypeCounts[Re.UniStudent]??0})`},{value:Re.PreUniStudent,label:`Pre-Uni Student \u{1F4DA} (${this.userTypeCounts[Re.PreUniStudent]??0})`}]}filterCountries(e){let t=[],o=[];for(let d of this.livekit.room.allParticipants){let v=d.userInfo?.countryId;v&&!t.includes(v)&&t.push(v)}for(let d of this.livekit.room.filter.selectedCountries??[])d&&!t.includes(d)&&t.push(d);for(let d of e)if(d.id&&t.includes(d.id)){let v=this.countryCounts[d.id]??0;o.push(Xt(Rt({},d),{name:`${d.name} (${v})`}))}return o}filterAreas(e){let t=[],o=[];for(let d of this.livekit.room.allParticipants){let v=d.userInfo?.areaOfStudyId;v&&!t.includes(v)&&t.push(v)}for(let d of this.livekit.room.filter.selectedAreasOfStudy??[])d&&!t.includes(d)&&t.push(d);for(let d of e)if(d.id&&t.includes(d.id)){let v=this.areaOfStudyCounts[d.id]??0;o.push(Xt(Rt({},d),{name:`${d.name} (${v})`}))}return o}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(ge),m(X),m(M),m($o),m(_e),m(Jo),m(G),m(K),m(H),m(J),m(F),m(N))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-filter-modal"]],standalone:!1,decls:29,vars:22,consts:[[1,"mat-header"],["mat-dialog-title",""],[1,"close-modal",3,"click"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"filter-sort-wrapper"],[1,"filters"],[1,"section-title"],["iconName","filter","color","accent-blue",3,"size"],[1,"interactable"],["id","gender","name","gender","placeholder","Gender","labelProperty","name","valueProperty","id",3,"ngModelChange","ngModel","options","multiple"],["id","user-type","name","userType","placeholder","Choose user type","labelProperty","label","valueProperty","value",3,"ngModel","options","multiple"],[1,"sort"],[1,"toggle-wrapper"],[3,"change","checked","disabled"],[3,"isSmall","matTooltip"],[1,"buttons-wrapper"],["color","secondary","iconName","eraser",3,"buttonClick","disabled","iconVariant"],[3,"buttonClick"],["id","user-type","name","userType","placeholder","Choose user type","labelProperty","label","valueProperty","value",3,"ngModelChange","ngModel","options","multiple"],["id","country","name","country","placeholder","Country","labelProperty","name","valueProperty","id",3,"ngModelChange","ngModel","options","multiple","ellipsisPx","showTooltip"],["id","area-of-study","name","areaOfStudy","labelProperty","name","valueProperty","id",3,"ngModelChange","ngModel","placeholder","options","multiple","ellipsisPx","showTooltip"],["iconName","arrow_sort_down_lines","color","accent-blue",3,"size"],["id","sort-option","name","sortOption","placeholder","Sort by...","labelProperty","label","valueProperty","value",3,"ngModelChange","ngModel","options"],[3,"change","checked"],["matTooltip","This means that they aren't using all of their pin slots & are available to new focus buddies.",3,"isSmall"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2),c(),a(3,"button",2),f("click",function(){return o.close()}),b(4,"ss-icon",3),c()(),a(5,"mat-dialog-content")(6,"div",4)(7,"div",5)(8,"div",6),b(9,"ss-icon",7),a(10,"span",8),g(11,"Filter"),c()(),a(12,"ss-focus-room-select",9),f("ngModelChange",function(v){return o.onGenderFilterChange(v)}),c(),u(13,dc,1,3,"ss-focus-room-select",10),u(14,pc,2,11),c(),u(15,mc,6,3,"div",11),c(),a(16,"div",12)(17,"mat-slide-toggle",13),f("change",function(v){return o.onTogglePinForPin(v.checked)}),c(),a(18,"div"),g(19),c(),b(20,"ss-info-tooltip",14),c(),u(21,hc,10,4),c(),a(22,"mat-dialog-actions"),u(23,gc,2,1,"div"),a(24,"div",15)(25,"ss-button",16),f("buttonClick",function(){return o.clearFilters()}),g(26," Clear "),c(),a(27,"ss-button",17),f("buttonClick",function(){return o.save()}),g(28),c()()()),t&2&&(s(2),R(o.livekit.room.simpleFilter?"Find Focus Buddy":"Filtering and sorting"),s(2),p("size",20)("iconVariant",20),s(5),p("size",20),s(3),p("ngModel",o.livekit.room.simpleFilter?o.tempFilter.selectedGenders:o.livekit.room.filter.selectedGenders)("options",o.genderOptions)("multiple",!0),s(),h(o.settingsService.isB2BApp()?-1:13),s(),h(o.livekit.room.simpleFilter?-1:14),s(),h(o.livekit.room.simpleFilter?-1:15),s(2),p("checked",o.livekit.room.simpleFilter?o.tempFilter.participantsWithPinForPinEnabled:o.livekit.room.filter.participantsWithPinForPinEnabled)("disabled",o.livekit.room.simpleFilter),s(2),R(o.livekit.room.simpleFilter?"Open to focusing with others":"Has P4P on"),s(),p("isSmall",!0)("matTooltip",o.livekit.room.simpleFilter?"This means they have P4P enabled and have available pin slots, i.e. if you 'pin' them, they will pin you back.":"If you 'pin' them, they will pin you back if they have available pin slots."),s(),h(o.livekit.room.simpleFilter?-1:21),s(),S("right-aligned",!o.livekit.room.anyFiltersSelectedOrSortChanged),s(),h(o.livekit.room.anyFiltersSelectedOrSortChanged?23:-1),s(2),p("disabled",!o.livekit.room.anyFiltersSelectedOrSortChanged)("iconVariant",20),s(3),R(o.livekit.room.simpleFilter?"Start":"Done"))},dependencies:[I,w,Yn,Kn,Nt,te,ie,oe,fe,ee,L,vt],styles:[".section-title[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.section-title[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:8px}.filter-sort-wrapper[_ngcontent-%COMP%]{display:flex;gap:30px;margin-bottom:20px}.filter-sort-wrapper[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{flex:1}.filter-sort-wrapper[_ngcontent-%COMP%]   .sort[_ngcontent-%COMP%]{width:250px}mat-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:80vh;overflow-y:auto;padding:24px}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:24px;margin:0}mat-dialog-actions.right-aligned[_ngcontent-%COMP%]{justify-content:flex-end}mat-dialog-actions[_ngcontent-%COMP%]   .buttons-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}mat-dialog-actions[_ngcontent-%COMP%]   .buttons-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{margin-left:8px}.toggle-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:14px}.toggle-wrapper[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin-right:8px}.toggle-wrapper[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{flex-direction:column}ss-info-tooltip[_ngcontent-%COMP%]{margin-left:4px}"]});let n=r;return n})();var wr=ii(_i());function vc(n,r){if(n&1){let i=P();a(0,"ss-user-popup",10),f("focusRoomUnauthenticatedActionAttempt",function(){_(i);let t=l(2);return C(t.handleUnauthenticatedActionAttempt())})("closePopup",function(){_(i);let t=l(2);return C(t.popupOpened=!1)}),c()}if(n&2){let i=l(2);p("userId",i.user.id)("openedFromSource",i.OpenedFromSourceRef.FocusRoom)}}function _c(n,r){if(n&1&&b(0,"ss-badge",8),n&2){let i=l(2);p("badge",i.user.userBadge)("size",20)}}function Cc(n,r){if(n&1){let i=P();a(0,"div",3,0)(2,"ss-user-avatar",6),f("click",function(t){_(i);let o=l();return C(o.openUserPopup(t))}),c(),ae(3,vc,1,2,"ng-template",7),f("backdropClick",function(){_(i);let t=l();return C(t.popupOpened=!1)}),u(4,_c,1,2,"ss-badge",8),a(5,"p",9),f("click",function(t){_(i);let o=l();return C(o.openUserPopup(t))}),g(6),c()()}if(n&2){let i=xe(1),e=l();s(2),p("size",40)("title",e.user.displayName)("initials",e.user.initials)("avatarColor",e.user.avatarColor)("avatarThumbUrl",e.user.avatarThumbUrl)("lastOnline",e.user.lastActive)("userId",e.user.id),s(),p("cdkConnectedOverlayOrigin",i)("cdkConnectedOverlayOpen",e.popupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0),s(),h(e.user.userBadge?4:-1),s(2),Se("",e.user.displayName,"",e.user.isModerator?" (Moderator)":"")}}function bc(n,r){if(n&1&&b(0,"mat-checkbox",4),n&2){let i=l();p("checked",i.user.selectedForGroupInvite)}}function Pc(n,r){if(n&1){let i=P();a(0,"ss-button-small",11),f("buttonClick",function(){_(i);let t=l();return C(t.createGroupOrContinueExistingChat())}),g(1," Message "),c()}if(n&2){let i=l();p("isLoading",i.startingChat)("color",i.ButtonColorRef.Secondary)}}var Sr=(()=>{let r=class r{onListItemClick(){this.suggestedUser||(this.user.selectedForGroupInvite=!this.user.selectedForGroupInvite)}constructor(e,t,o,d,v,k,T,B){this.settingsService=e,this.livekit=t,this.chatService=o,this.utilityService=d,this.accountModalsService=v,this.elementRef=k,this.toastService=T,this.router=B,this.suggestedUser=!1,this.messageUser=new ce,this.popupOpened=!1,this.startingChat=!1,this.OpenedFromSourceRef=Pt,this.ButtonColorRef=He}openUserPopup(e){e.stopPropagation(),this.popupOpened=!0}handleUnauthenticatedActionAttempt(){this.accountModalsService.ensureUserCompletedBasicInfo()}showParticipantHighlight(){if(this.isMobile)return;this.livekit.participantHighlight.hideOverlay.next(!0);let e=this.elementRef.nativeElement.getBoundingClientRect(),t=document.querySelector(".dashboard-wrapper").clientHeight,o={id:this.user.id,left:e.left-234,bottom:t-e.top-94,source:Be.ParticipantListItem};this.livekit.participantHighlight.show.next(o)}createGroupOrContinueExistingChat(){this.chatService.checkIfChatExists(this.user.id).subscribe({next:()=>{this.startChat()},error:e=>{e.length&&e[0].errorCode==="ChatDoesNotExist"?this.utilityService.requestChatNavigation.next(this.user.id):this.handleErrors(e)}})}onChatStarted(e){this.messageUser.emit(),this.startingChat=!1,this.isMobile?this.router.navigate([`/conversations/chats/${e}`]):this.utilityService.openDmTrayChat.next(e)}startChat(){this.startingChat=!0;let e={otherUserIds:[this.user.id]};this.chatService.startChat(e).subscribe({next:t=>this.onChatStarted(t.id),error:t=>{t.length&&t[0].errorCode==="ChatAlreadyExists"?this.onChatStarted(t[0].params.chatId):this.handleErrors(t)}})}handleErrors(e){if(e[0].errorCode==="ErrorChattingAgeRestriction"){this.toastService.info({exceptionDetail:e[0]});return}this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(X),m(M),m(Mt),m(J),m(K),m(ze),m(F),m(bt))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-session-group-list-item"]],hostVars:2,hostBindings:function(t,o){t&1&&f("click",function(){return o.onListItemClick()}),t&2&&S("suggested-user",o.suggestedUser)},inputs:{user:"user",suggestedUser:"suggestedUser"},outputs:{messageUser:"messageUser"},standalone:!1,decls:5,vars:4,consts:[["trigger","cdkOverlayOrigin"],[1,"hover-highlight",3,"click"],["iconName","eye",3,"size"],["cdkOverlayOrigin","",1,"user-info"],["name","selected",3,"checked"],[3,"isLoading","color"],["role","button",3,"click","size","title","initials","avatarColor","avatarThumbUrl","lastOnline","userId"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],[1,"user-marker",3,"badge","size"],["role","button",3,"click"],["cssClass","margin-horizontal",3,"focusRoomUnauthenticatedActionAttempt","closePopup","userId","openedFromSource"],[3,"buttonClick","isLoading","color"]],template:function(t,o){t&1&&(a(0,"div",1),f("click",function(){return o.showParticipantHighlight()}),b(1,"ss-icon",2),c(),u(2,Cc,7,14,"div",3),u(3,bc,1,1,"mat-checkbox",4),u(4,Pc,2,2,"ss-button-small",5)),t&2&&(s(),p("size",18),s(),h(o.user?2:-1),s(),h(o.suggestedUser?-1:3),s(),h(o.suggestedUser&&!o.settingsService.isB2BApp()?4:-1))},dependencies:[w,Me,at,Ce,rt,Fe,Ie,ki],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:space-between;align-items:center;width:100%;padding:10px 10px 10px 0;cursor:pointer}.suggested-user[_nghost-%COMP%]{cursor:initial}.hover-highlight[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:20px;margin-right:5px}.hover-highlight[_ngcontent-%COMP%]:hover   ss-icon[_ngcontent-%COMP%]     i{background:var(--accent-gradient);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}@media only screen and (max-width: 1024px){.hover-highlight[_ngcontent-%COMP%]{display:none}}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:auto}ss-user-avatar[_ngcontent-%COMP%]{margin-right:15px}ss-badge[_ngcontent-%COMP%]{margin-right:6px}"]});let n=r;return n})();var Or=(n,r)=>r.id;function xc(n,r){if(n&1&&(a(0,"div")(1,"div"),g(2),c(),a(3,"div"),g(4,"You can only add users to a private space who follow you or have pinned you in the past."),c(),a(5,"div"),g(6,"Try these:"),c(),a(7,"ol")(8,"li"),g(9,"Follow others and encourage them to follow you back \u2705"),c(),a(10,"li"),g(11,"Turn your video on \u{1F3A5} and do something interesting \u{1F57A} to receive some pins \u{1F4CC}"),c()()()),n&2){let i=l(2);s(2),O("None of your ",i.settingsService.isB2BApp()||i.settingsService.isCoWork()?"connections":"friends"," are currently online \u{1F614}")}}function yc(n,r){n&1&&(a(0,"div")(1,"h4"),g(2,"Choose someone to invite to your private space"),c(),a(3,"div"),g(4,"To add more people they either need to follow you or have pinned you in the past."),c()())}function Sc(n,r){if(n&1&&(a(0,"div",10),g(1),c()),n&2){let i=l(3);s(),O(" No search results. ",i.selectedUserIds.length>0?i.selectedUserIds.length+" user"+(i.selectedUserIds.length===1?"":"s")+" selected.":""," ")}}function Mc(n,r){if(n&1){let i=P();a(0,"ss-input",9),he("ngModelChange",function(t){_(i);let o=l(2);return ue(o.searchTerm,t)||(o.searchTerm=t),C(t)}),c(),u(1,Sc,2,1,"div",10)}if(n&2){let i=l(2);me("ngModel",i.searchTerm),s(),h(i.searchResults.length===0?1:-1)}}function wc(n,r){if(n&1&&(u(0,xc,12,1,"div"),u(1,yc,5,0,"div"),u(2,Mc,2,2)),n&2){let i=l();h(i.availableUsers.length===0?0:-1),s(),h(i.availableUsers.length>0?1:-1),s(),h(i.availableUsers.length>=i.minAvailableUsersToShowSearch?2:-1)}}function Oc(n,r){n&1&&b(0,"mat-spinner",5)}function Tc(n,r){if(n&1&&b(0,"ss-focus-room-session-group-list-item",11),n&2){let i=l().$implicit;p("user",i)}}function Ic(n,r){if(n&1&&u(0,Tc,1,1,"ss-focus-room-session-group-list-item",11),n&2){let i=r.$implicit,e=l();h(e.isASearchMatch(i)?0:-1)}}function Fc(n,r){if(n&1){let i=P();a(0,"ss-focus-room-session-group-list-item",14),f("messageUser",function(){_(i);let t=l(2);return C(t.closeModal())}),c()}if(n&2){let i=r.$implicit;p("user",i)("suggestedUser",!0)}}function Rc(n,r){if(n&1&&(a(0,"h4",12),g(1),c(),V(2,Fc,1,2,"ss-focus-room-session-group-list-item",13,Or)),n&2){let i=l();s(),R(i.suggestedUsersMessage),s(),A(i.suggestedUsers)}}function Ec(n,r){if(n&1){let i=P();a(0,"div",6)(1,"div",15),g(2,"To get better matches complete your profile. Click 'Edit Profile' while you wait."),c(),a(3,"ss-button",16),f("buttonClick",function(){_(i);let t=l();return C(t.editAdditionalProfileSettings())}),g(4,"Edit Profile"),c()()}}var $t=(()=>{let r=class r{get selectedUserIds(){return this.availableUsers.filter(e=>e.selectedForGroupInvite).map(e=>e.id)}get ctaButtonText(){return this.selectedUserIds.length===0?"Invite later":`Invite ${this.selectedUserIds.length} user${this.selectedUserIds.length===1?"":"s"}`}get searchResults(){if(!this.searchTerm)return this.availableUsers;let e=this.searchTerm.trim().toLowerCase();return this.availableUsers.filter(t=>t.displayName&&t.displayName.toLowerCase().includes(e))}constructor(e,t,o,d,v,k,T,B,z){this.podName=e,this.livekit=t,this.settingsService=o,this.dialogRef=d,this.translateService=v,this.analyticsService=k,this.dialog=T,this.accountService=B,this.toastService=z,this.availableUsers=[],this.suggestedUsers=[],this.activeGroup=null,this.availableUsersLoaded=!1,this.loadingInvite=!1,this.suggestedUsersMessage="Try messaging these people that are also",this.searchTerm=null,this.minAvailableUsersToShowSearch=20,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e)),this.livekit.getInteractableParticipants(this.livekit.room.name).subscribe({next:e=>{this.availableUsers=this.activeGroup?e.filter(t=>!this.activeGroup?.members.some(o=>o.id===t.id)):e,this.availableUsersLoaded=!0,this.availableUsers.length<10&&this.livekit.room.milestones.completedProfileSetup&&this.setSuggestedUsers()},error:e=>this.handleErrors(e)})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}inviteUsers(){this.loadingInvite=!0,this.analyticsService.markActivity(y.LivekitPrivatePodInviteUsersButtonClick),this.activeGroup?this.livekit.inviteUserToFocusRoomSessionGroup(this.livekit.room.name,this.activeGroup.id,this.selectedUserIds).subscribe({next:()=>{this.loadingInvite=!1,this.dialogRef.close()},error:e=>{if(e[0].errorCode==="LivekitRoomMaxSamePeerSessionsReached"){this.toastService.info({exceptionDetail:e[0]});return}this.handleErrors(e)}}):this.livekit.createFocusRoomSessionGroup(this.livekit.room.name,this.selectedUserIds,void 0,this.podName).subscribe({next:e=>{this.livekit.room.activeGroup.next(e),this.loadingInvite=!1,this.dialogRef.close(),e.name&&e.id&&this.toastService.createdNamedPrivateSpace(e.name,this.livekit.room.name,e.id,e.wasJustReopened)},error:e=>this.handleErrors(e)})}closeModal(){this.dialogRef.close()}isASearchMatch(e){return this.searchResults.includes(e)}editAdditionalProfileSettings(){this.dialog.open(Wt,{panelClass:"fullscreen-dialog",width:"600px",disableClose:!0}).afterClosed().subscribe(()=>{if(!this.livekit.room.milestones)return;let t=this.accountService.currentUser,o=!!t.countryId&&!!t.bio&&!!t.areaOfStudyId&&t.hasUserInterests;this.livekit.room.milestones.completedProfileSetup=o,this.availableUsers.length<10&&this.livekit.room.milestones.completedProfileSetup&&(this.setSuggestedUsers(),this.livekit.updateMetadata(this.livekit.room.name,this.livekit.room.settings.zoomToFit,this.livekit.room.settings.mirrorModeForOthers).subscribe())})}setSuggestedUsers(){let e=this.accountService.currentUser,o=this.livekit.room.allParticipants.filter(k=>!k.isLocal&&k.userInfo&&!this.availableUsers.some(T=>T.id===k.identity)&&(e.areaOfStudyId&&k.userInfo.areaOfStudyId===e.areaOfStudyId||e.countryId&&k.userInfo.countryId===e.countryId)).map(k=>({areaOfStudyMatch:k.userInfo.areaOfStudyId===e.areaOfStudyId,countryMatch:k.userInfo.countryId===e.countryId,userInfo:k.userInfo})).sort((0,wr.firstBy)(k=>k.areaOfStudyMatch,{direction:"desc"})).slice(0,10),d=o.some(k=>k.areaOfStudyMatch),v=o.some(k=>k.countryMatch);d&&v?this.suggestedUsersMessage=`${this.suggestedUsersMessage} studying ${e.areaOfStudyName} or are from ${e.countryName}:`:this.suggestedUsersMessage=d?`${this.suggestedUsersMessage} studying ${e.areaOfStudyName}:`:`${this.suggestedUsersMessage} from ${e.countryName}:`,this.suggestedUsers=o.map(k=>k.userInfo)}handleErrors(e,t=!1){return Y(this,null,function*(){if(this.availableUsersLoaded=!0,this.loadingInvite=!1,t){let o=yield ni(this.translateService.get("errors."+e[0].errorCode,e[0].params));this.toastService.info({title:"Please note",message:o})}else this.toastService.error({exceptionDetail:e[0]})})}};r.\u0275fac=function(t){return new(t||r)(m(tt),m(M),m(X),m(ge),m(si),m(H),m(N),m(G),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-session-group-invite-modal"]],standalone:!1,decls:18,vars:9,consts:[[1,"mat-header"],["mat-dialog-title",""],["mat-dialog-close","",1,"close-modal"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"loader-wrapper"],["diameter","30","strokeWidth","3"],[1,"edit-profile-wrapper"],["color","tertiary","mat-dialog-close",""],[3,"buttonClick","isLoading"],["id","user-search","name","userSearch","placeholder","Search people to invite...",3,"ngModelChange","ngModel"],[1,"no-results-message"],[3,"user"],[1,"suggested-users-title"],[3,"user","suggestedUser"],[3,"messageUser","user","suggestedUser"],[1,"notification"],["color","secondary",3,"buttonClick"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2),c(),a(3,"button",2),b(4,"ss-icon",3),c()(),a(5,"mat-dialog-content"),u(6,wc,3,3),a(7,"div",4),u(8,Oc,1,0,"mat-spinner",5),c(),V(9,Ic,1,1,null,null,Or),u(11,Rc,4,1),u(12,Ec,5,0,"div",6),c(),a(13,"mat-dialog-actions")(14,"ss-button",7),g(15,"Cancel"),c(),a(16,"ss-button",8),f("buttonClick",function(){return o.inviteUsers()}),g(17),c()()),t&2&&(s(2),O("Invite users to ",o.podName||"this space"),s(2),p("size",20)("iconVariant",20),s(2),h(o.availableUsersLoaded?6:-1),s(2),h(o.availableUsersLoaded?-1:8),s(),A(o.availableUsers),s(2),h(o.suggestedUsers.length>0&&o.livekit.room.milestones.completedProfileSetup?11:-1),s(),h(o.livekit.room.milestones.completedProfileSetup?-1:12),s(4),p("isLoading",o.loadingInvite),s(),O(" ",o.ctaButtonText," "))},dependencies:[I,w,Ee,te,ie,ye,oe,fe,ee,ve,Sr],styles:[".loader-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}h4[_ngcontent-%COMP%]{margin-bottom:10px}.suggested-users-title[_ngcontent-%COMP%]{margin-top:10px}.edit-profile-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:20px;border-top:1px solid var(--alt)}ss-input[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}.no-results-message[_ngcontent-%COMP%]{padding:12px 0;text-align:center}"]});let n=r;return n})();function Uc(n,r){n&1&&(a(0,"h2",5),g(1,"Name your space? (Optional)"),c())}function Vc(n,r){n&1&&(a(0,"h2",5),g(1,"Private Spaces"),c())}function Ac(n,r){if(n&1&&(u(0,Uc,2,0,"h2",5),u(1,Vc,2,0,"h2",5)),n&2){let i=l();h(i.createNewNameState?0:-1),s(),h(i.createNewNameState?-1:1)}}function Lc(n,r){n&1&&b(0,"mat-spinner",2)}function Gc(n,r){n&1&&b(0,"mat-spinner",2)}function Dc(n,r){if(n&1){let i=P();a(0,"div",6),g(1,"Give your private space a name"),c(),a(2,"ss-input",7),he("ngModelChange",function(t){_(i);let o=l();return ue(o.spaceName,t)||(o.spaceName=t),C(t)}),c()}if(n&2){let i=l();s(2),me("ngModel",i.spaceName)}}function Bc(n,r){if(n&1){let i=P();a(0,"h3",10),f("click",function(){let t=_(i).$implicit,o=l(2);return C(o.useExistingName(t))}),g(1),c()}if(n&2){let i=r.$implicit;s(),O(" ",i," ")}}function Nc(n,r){if(n&1&&(V(0,Bc,2,1,"h3",8,je),a(2,"div",9),g(3,"or"),c()),n&2){let i=l();A(i.groupNames)}}function zc(n,r){if(n&1){let i=P();a(0,"mat-dialog-actions")(1,"ss-button",11),f("buttonClick",function(){_(i);let t=l();return C(t.createNewNameState?t.createPrivateSpace():t.createNewNameState=!0)}),g(2),c()()}if(n&2){let i=l();s(2),O(" ",i.createNewNameState?i.spaceName?"Create":"Create without a name":"Create new private space"," ")}}var Tr=(()=>{let r=class r{constructor(e,t,o,d,v){this.livekit=e,this.dialogRef=t,this.analyticsService=o,this.dialog=d,this.toastService=v,this.spaceName="",this.groupNames=[],this.loading=!0,this.createNewNameState=!1}ngOnInit(){this.livekit.getGroupNamesCreatedByMe(this.livekit.room.name).subscribe({next:e=>{this.groupNames=e,this.loading=!1,this.groupNames.length===0&&(this.createNewNameState=!0)},error:e=>this.handleErrors(e)})}useExistingName(e){this.spaceName=e,this.createPrivateSpace()}createPrivateSpace(){this.dialogRef.close(),this.analyticsService.markActivity(y.LivekitAudioPodModalOpen),this.dialog.open($t,{panelClass:"fullscreen-dialog",width:"640px",data:this.spaceName.trim()})}handleErrors(e){this.loading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(ge),m(H),m(N),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-session-group-name"]],standalone:!1,decls:12,vars:8,consts:[[1,"mat-header"],[1,"loader-wrapper"],["diameter","30","strokeWidth","3"],["mat-dialog-close","",1,"close-modal"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],["mat-dialog-title",""],[1,"interactable"],["id","new-space-name","name","spaceName","placeholder","Name your private space...","maxlength","100",3,"ngModelChange","ngModel"],[1,"space-name"],[1,"separator"],[1,"space-name",3,"click"],[3,"buttonClick"]],template:function(t,o){t&1&&(a(0,"div",0),u(1,Ac,2,2),a(2,"div",1),u(3,Lc,1,0,"mat-spinner",2),c(),a(4,"button",3),b(5,"ss-icon",4),c()(),a(6,"mat-dialog-content")(7,"div",1),u(8,Gc,1,0,"mat-spinner",2),c(),u(9,Dc,3,1),u(10,Nc,4,0),c(),u(11,zc,3,1,"mat-dialog-actions")),t&2&&(s(),h(o.loading?-1:1),s(2),h(o.loading?3:-1),s(2),p("size",20)("iconVariant",20),s(3),h(o.loading?8:-1),s(),h(o.createNewNameState?9:-1),s(),h(o.createNewNameState?-1:10),s(),h(o.loading?-1:11))},dependencies:[I,w,Ee,te,Bt,ie,ye,oe,fe,ee,ve],styles:[".loader-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.interactable[_ngcontent-%COMP%]{margin-bottom:8px;color:var(--default-40)}.space-name[_ngcontent-%COMP%]{overflow:hidden;padding:16px;margin-bottom:4px;border-radius:16px;text-overflow:ellipsis;white-space:nowrap;background-color:var(--alt);cursor:pointer}.space-name[_ngcontent-%COMP%]:hover{background-color:var(--alt-40)}.space-name[_ngcontent-%COMP%]:last-of-type{margin-bottom:0}.separator[_ngcontent-%COMP%]{margin-top:16px;text-align:center}ss-button[_ngcontent-%COMP%]{width:100%}"]});let n=r;return n})();function jc(n,r){n&1&&(a(0,"h2",8),g(1,"Waiting for a match"),c(),a(2,"small"),g(3,"We're looking for someone to match you with. Don't refresh the page while you're waiting, but you can close this window."),c())}function Hc(n,r){n&1&&(a(0,"h2"),g(1,"Nobody is available"),c(),a(2,"small"),g(3,"Try again in a few minutes."),c())}function Wc(n,r){n&1&&(a(0,"span"),g(1," while you wait"),c())}function $c(n,r){if(n&1){let i=P();a(0,"div",5)(1,"div",9),g(2," To get better matches complete your profile. Click 'Edit Profile' "),u(3,Wc,2,0,"span"),g(4," . "),c(),a(5,"ss-button",10),f("buttonClick",function(){_(i);let t=l();return C(t.editProfile())}),g(6,"Edit Profile"),c()()}if(n&2){let i=l();s(3),h(i.waitingForGroupMatch?3:-1)}}function Jc(n,r){if(n&1){let i=P();a(0,"ss-button",11),f("buttonClick",function(){_(i);let t=l();return C(t.cancelRandomMatching())}),g(1," Cancel matching "),c()}if(n&2){let i=l();p("isLoading",i.cancellingMatchRequest)}}var ji=(()=>{let r=class r{get waitingForGroupMatch(){return this.livekit.room.groupMatch.waiting}get hasCompletedProfile(){let e=this.accountService.currentUser;return!!e.countryId&&!!e.bio&&!!e.areaOfStudyId&&e.hasUserInterests}constructor(e,t,o,d,v,k){this.accountService=e,this.livekit=t,this.dialog=o,this.dialogRef=d,this.signalRService=v,this.toastService=k,this.cancellingMatchRequest=!1,this.subscriptions=[]}ngOnInit(){this.getGroupMatch(),this.subscriptions.push(this.signalRService.roomSessionGroupMatched.subscribe(e=>this.onRoomSessionGroupMatched()))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}editProfile(){this.dialog.open(Wt,{panelClass:"fullscreen-dialog",width:"600px",disableClose:!0})}cancelRandomMatching(){this.cancellingMatchRequest=!0,this.livekit.cancelGroupMatch(this.livekit.room.name).subscribe({next:()=>{this.cancellingMatchRequest=!1,this.livekit.room.groupMatch.waiting=!1,this.dialogRef.close()},error:e=>this.handleErrors(e)})}onRoomSessionGroupMatched(){this.dialogRef.close()}getGroupMatch(){this.livekit.getGroupMatch(this.livekit.room.name).subscribe({next:e=>{if(e.expiryDate){this.livekit.room.groupMatch.startTimer(e.expiryDate);return}this.livekit.room.activeGroup.next({id:e.groupId,members:e.members}),this.livekit.room.groupMatch.waiting=!1,this.dialogRef.close()},error:e=>this.handleErrors(e)})}handleErrors(e){this.cancellingMatchRequest=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(G),m(M),m(N),m(ge),m(St),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-random-match-modal"]],standalone:!1,decls:14,vars:7,consts:[[1,"mat-header"],["mat-dialog-title",""],["mat-dialog-close","",1,"close-modal"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"modal-info"],[1,"edit-profile"],["color","tertiary",3,"isLoading"],["mat-dialog-close","",3,"isLoading"],[1,"loading"],[1,"notification"],["color","secondary",3,"buttonClick"],["color","tertiary",3,"buttonClick","isLoading"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2,"Random match"),c(),a(3,"button",2),b(4,"ss-icon",3),c()(),a(5,"mat-dialog-content")(6,"div",4),u(7,jc,4,0)(8,Hc,4,0),c(),u(9,$c,7,1,"div",5),c(),a(10,"mat-dialog-actions"),u(11,Jc,2,1,"ss-button",6),a(12,"ss-button",7),g(13),c()()),t&2&&(s(4),p("size",20)("iconVariant",20),s(3),h(o.waitingForGroupMatch?7:8),s(2),h(o.hasCompletedProfile?-1:9),s(2),h(o.waitingForGroupMatch?11:-1),s(),p("isLoading",o.cancellingMatchRequest),s(),O(" Close",o.waitingForGroupMatch?" and wait":""," "))},dependencies:[I,w,ye,oe,fe,ee],styles:['@charset "UTF-8";.modal-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:200px;padding-bottom:24px}.modal-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:8px}.modal-info[_ngcontent-%COMP%]   h2.loading[_ngcontent-%COMP%]{width:220px}@media only screen and (max-width: 1024px){.modal-info[_ngcontent-%COMP%]   h2.loading[_ngcontent-%COMP%]{width:310px}}.modal-info[_ngcontent-%COMP%]   h2.loading[_ngcontent-%COMP%]:after{content:"\\2026";display:inline-block;width:0;overflow:hidden;vertical-align:bottom;animation:_ngcontent-%COMP%_ellipsis steps(4,end) .9s infinite}.modal-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{width:260px;text-align:center}@media only screen and (max-width: 1024px){.modal-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{width:auto}}.edit-profile[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:24px;border-top:1px solid var(--alt-40)}@media only screen and (max-width: 767px){.edit-profile[_ngcontent-%COMP%]{flex-wrap:wrap}}.edit-profile[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{min-width:104px;margin-left:8px}@media only screen and (max-width: 767px){.edit-profile[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{margin:12px 0 0}}@keyframes _ngcontent-%COMP%_ellipsis{to{width:1.25em}}']});let n=r;return n})();var Ir=(()=>{let r=class r{constructor(e,t,o,d){this.livekit=e,this.analyticsService=t,this.dialogRef=o,this.dialog=d}inviteRandomMatch(){this.livekit.room.groupMatch.waiting=!0,this.dialogRef.close(),this.dialog.open(ji,{panelClass:"fullscreen-dialog",width:"480px"})}inviteFriends(){this.livekit.room.groupMatch.waiting=!1,this.dialogRef.close(),this.analyticsService.markActivity(y.LivekitAudioPodModalOpen),this.dialog.open($t,{panelClass:"fullscreen-dialog",width:"640px"})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(H),m(ge),m(N))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-pods-modal"]],standalone:!1,decls:16,vars:2,consts:[[1,"mat-header"],["mat-dialog-title",""],["mat-dialog-close","",1,"close-modal"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"pod-option-item","random",3,"click"],[1,"pod-option-item","friends",3,"click"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2,"Spaces"),c(),a(3,"button",2),b(4,"ss-icon",3),c()(),a(5,"mat-dialog-content")(6,"div",4),f("click",function(){return o.inviteRandomMatch()}),a(7,"h2"),g(8,"Random match"),c(),a(9,"small"),g(10,"Someone else who is looking for a random focus buddy"),c()(),a(11,"div",5),f("click",function(){return o.inviteFriends()}),a(12,"h2"),g(13,"Invite friends"),c(),a(14,"small"),g(15,"Invite people who are following or have pinned you"),c()()()),t&2&&(s(4),p("size",20)("iconVariant",20))},dependencies:[w,ye,oe,ee],styles:[".pod-option-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;height:143px;padding:0 24px;margin-bottom:20px;border:1px solid var(--alt-20);border-radius:16px;cursor:pointer;transition:all .3s ease-in-out}.pod-option-item[_ngcontent-%COMP%]:last-of-type{margin:0}.pod-option-item.random[_ngcontent-%COMP%]{background:url(/assets/images/pods-item-2.svg) 96% 80% no-repeat,url(/assets/images/pods-item-1.svg) 80% center no-repeat}.pod-option-item.friends[_ngcontent-%COMP%]{background:url(/assets/images/pods-item-3.svg) 116% 0 no-repeat}.pod-option-item[_ngcontent-%COMP%]:hover{border-color:var(--accent-blue);box-shadow:var(--elevation-l1)}.pod-option-item[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:block;width:182px}.dark-theme[_nghost-%COMP%]   .pod-option-item.random[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .pod-option-item.random[_ngcontent-%COMP%]{background:url(/assets/images/pods-item-2.svg) 96% 80% no-repeat,url(/assets/images/pods-item-1-dark.svg) 80% center no-repeat}.dark-theme[_nghost-%COMP%]   .pod-option-item.friends[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .pod-option-item.friends[_ngcontent-%COMP%]{background:url(/assets/images/pods-item-3-dark.svg) 116% 0 no-repeat}"]});let n=r;return n})();var Fr=(()=>{let r=class r{get forceGridView(){return this.livekit.room.forceGridView}get tooltipText(){return`Switch to ${this.forceGridView?"Pinned":"Grid"} view`}get buttonText(){return this.forceGridView?`Pinned view (${this.livekit.room.pinnedParticipants.length})`:"Grid view"}constructor(e,t){this.livekit=e,this.analyticsService=t}ngOnDestroy(){this.livekit.room.animateViewToggleButton=!1}switchView(){this.forceGridView&&(this.livekit.room.lastOpenedGridPage=this.livekit.room.paginator.currentPage),this.livekit.room.forceGridView=!this.livekit.room.forceGridView;let e=this.livekit.room.forceGridView?y.LivekitGridViewTurnedOn:y.LivekitPinViewTurnedOn;this.analyticsService.markActivity(e),this.livekit.room.sortAndAssignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.forceGridView&&this.livekit.room.paginator.goToPage(this.livekit.room.lastOpenedGridPage)}};r.\u0275fac=function(t){return new(t||r)(m(M),m(H))},r.\u0275cmp=x({type:r,selectors:[["ss-switch-room-view-button"]],standalone:!1,decls:3,vars:5,consts:[["color","focus-room",1,"switch-view-button",3,"buttonClick","matTooltip","iconVariant"]],template:function(t,o){t&1&&(a(0,"ss-button",0),f("buttonClick",function(){return o.switchView()}),a(1,"div"),g(2),c()()),t&2&&(S("animate",o.livekit.room.animateViewToggleButton),p("matTooltip",o.tooltipText)("iconVariant",20),s(2),R(o.buttonText))},dependencies:[I,L],styles:["[_nghost-%COMP%]{position:relative;display:block}.switch-view-button[_ngcontent-%COMP%]{margin-left:6px}.switch-view-button.animate[_ngcontent-%COMP%]{animation:shakeX;animation-duration:1s;animation-delay:.5s}"]});let n=r;return n})();var Hi=(()=>{let r=class r{get paginator(){return this.livekit.room.paginator}constructor(e){this.livekit=e,this.lastFiredPageChangeEvent=null}onKeyDown(e){e.repeat||(e.key==="ArrowRight"?this.nextPage():e.key==="ArrowLeft"&&this.previousPage())}nextPage(){if(this.shouldDisableKeyNavigation())return;this.livekit.room.paginator.next()&&this.tryToFireCustomEvent()}previousPage(){if(this.shouldDisableKeyNavigation())return;this.livekit.room.paginator.previous()&&this.tryToFireCustomEvent()}skipTenForward(){this.livekit.room.paginator.skipTenForward()&&this.tryToFireCustomEvent()}skipTenBack(){this.livekit.room.paginator.skipTenBack()&&this.tryToFireCustomEvent()}tryToFireCustomEvent(){if(this.lastFiredPageChangeEvent&&$.now().diff(this.lastFiredPageChangeEvent,"seconds").seconds<10)return;let e=new CustomEvent("ssRoomPageChanged",{detail:{payload:"pageChangeEvent"}});window.dispatchEvent(e),this.lastFiredPageChangeEvent=$.now()}shouldDisableKeyNavigation(){return document.activeElement?.classList.contains("ql-editor")||document.activeElement?.tagName.toLowerCase()==="input"||document.activeElement?.tagName.toLowerCase()==="textarea"}};r.\u0275fac=function(t){return new(t||r)(m(M))},r.\u0275cmp=x({type:r,selectors:[["ss-paginator"]],hostBindings:function(t,o){t&1&&f("keydown",function(v){return o.onKeyDown(v)},et)},standalone:!1,decls:6,vars:16,consts:[["iconName","chevron_double_left",3,"click","role","color","iconVariant","size"],["iconName","chevron_left",3,"click","role","color","size"],["iconName","chevron_right",3,"click","role","color","size"],["iconName","chevron_double_right",3,"click","role","color","iconVariant","size"]],template:function(t,o){t&1&&(a(0,"ss-icon",0),f("click",function(){return o.skipTenBack()}),c(),a(1,"ss-icon",1),f("click",function(){return o.previousPage()}),c(),a(2,"span"),g(3),c(),a(4,"ss-icon",2),f("click",function(){return o.nextPage()}),c(),a(5,"ss-icon",3),f("click",function(){return o.skipTenForward()}),c()),t&2&&(p("role",o.paginator.currentPage>1?"button":"icon")("color",o.paginator.currentPage>1?"accent-blue-60":"default-80")("iconVariant",20)("size",24),s(),p("role",o.paginator.currentPage>1?"button":"icon")("color",o.paginator.currentPage>1?"accent-blue-60":"default-80")("size",24),s(2),Se("",o.paginator.currentPage," / ",o.paginator.totalPages||1),s(),p("role",o.paginator.currentPage!==(o.paginator.totalPages||1)?"button":"icon")("color",o.paginator.currentPage!==(o.paginator.totalPages||1)?"accent-blue-60":"default-80")("size",24),s(),p("role",o.paginator.currentPage!==(o.paginator.totalPages||1)?"button":"icon")("color",o.paginator.currentPage!==(o.paginator.totalPages||1)?"accent-blue-60":"default-80")("iconVariant",20)("size",24))},dependencies:[w],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;flex-shrink:0;width:150px;margin:1px 10px 0;-webkit-user-select:none;user-select:none}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{margin-bottom:30px}}ss-icon[_ngcontent-%COMP%]{width:20px}span[_ngcontent-%COMP%]{display:inline-block;margin:0 6px}"]});let n=r;return n})();function Kc(n,r){n&1&&b(0,"mat-spinner",3)}function Qc(n,r){n&1&&b(0,"ss-icon",4),n&2&&p("size",20)("iconVariant",20)}function Xc(n,r){n&1&&(a(0,"small"),g(1,"Note: everyone is muted inside the room but you can use audio inside private spaces (if you join/create one)."),c())}function Zc(n,r){if(n&1){let i=P();a(0,"ss-select",7),he("ngModelChange",function(t){_(i);let o=l();return ue(o.settings.activeAudioDevice,t)||(o.settings.activeAudioDevice=t),C(t)}),c(),u(1,Xc,2,0,"small")}if(n&2){let i=l();me("ngModel",i.settings.activeAudioDevice),p("options",i.availableAudioDevices)("disabled",i.availableAudioDevices.length===0),s(),h(i.allowOnlyGroupAudio?1:-1)}}var Er=(()=>{let r=class r{get isDarkTheme(){return this.theme===gt.Dark}get canPublishAudio(){return this.livekit.room.canPublishAudio}get allowOnlyGroupAudio(){return this.livekit.room.allowOnlyGroupAudio}get zoomToFitDisabled(){return!this.settings.zoomToFit&&this.settings.isCameraEnabled}constructor(e,t,o,d,v){this.livekit=e,this.theme=t,this.mediaDevicesService=o,this.loaderService=d,this.dialogRef=v,this.availableAudioDevices=[],this.mediaDevicesLoaded=!1,this.mediaDevicesPromptDisplayed=!1,this.ButtonLoadersRef=ti,this.closeModalHeaderButtonLoading=!1,this.saveButtonLoading=!1,this.setAvailableDevices=this.setAvailableDevices.bind(this),this.settings=JSON.parse(JSON.stringify(this.livekit.room.settings))}ngOnInit(){return Y(this,null,function*(){if(this.loaderService.stop(),!navigator.userAgent.toLowerCase().includes("firefox")&&(yield navigator.permissions.query({name:"camera"})).state==="denied"){this.mediaDevicesLoaded=!0,this.tryClosing();return}window.navigator&&navigator.mediaDevices.addEventListener("devicechange",this.setAvailableDevices),this.mediaDevicesService.getDevices("audioinput",!0).then(t=>{if(this.availableAudioDevices=t,this.mediaDevicesLoaded=!0,this.tryClosing(),this.availableAudioDevices.length===0)return;let o=this.livekit.room.settings.activeAudioDevice,d=o?this.availableAudioDevices.find(v=>v.deviceId===o):null;this.settings.activeAudioDevice=d?.deviceId??this.availableAudioDevices[0].deviceId})})}ngOnDestroy(){window.navigator&&navigator.mediaDevices.removeEventListener("devicechange",this.setAvailableDevices)}onClose(e){if(e!==ti.Save){this.closeModalHeaderButtonLoading=!0,this.dialogRef.close();return}this.mediaDevicesLoaded||this.mediaDevicesPromptDisplayed?(this.dialogRef.close(this.settings),this.availableAudioDevices=[]):this.saveButtonLoading=!0}setAvailableDevices(){this.mediaDevicesService.getDevices("audioinput",!0).then(e=>{this.availableAudioDevices=e})}tryClosing(){this.closeModalHeaderButtonLoading?(this.closeModalHeaderButtonLoading=!1,this.onClose(ti.Close)):this.saveButtonLoading&&(this.saveButtonLoading=!1,this.onClose(ti.Save))}};r.\u0275fac=function(t){return new(t||r)(m(M),m(tt),m(Hn),m(bi),m(ge))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-audio-source-modal"]],standalone:!1,decls:13,vars:5,consts:[[1,"mat-header"],["mat-dialog-title",""],[1,"close-modal",3,"click"],["diameter","20","strokeWidth","2"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],["color","tertiary",3,"buttonClick","isLoading"],["color","positive",3,"buttonClick","isLoading"],["id","activeDevice","name","activeDevice","placeholder","Select audio device","labelProperty","label","valueProperty","deviceId",3,"ngModelChange","ngModel","options","disabled"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2,"Audio Settings"),c(),a(3,"button",2),f("click",function(){return o.onClose(o.ButtonLoadersRef.Close)}),u(4,Kc,1,0,"mat-spinner",3),u(5,Qc,1,2,"ss-icon",4),c()(),a(6,"mat-dialog-content"),u(7,Zc,2,4),c(),a(8,"mat-dialog-actions")(9,"ss-button",5),f("buttonClick",function(){return o.onClose(o.ButtonLoadersRef.Close)}),g(10," Cancel "),c(),a(11,"ss-button",6),f("buttonClick",function(){return o.onClose(o.ButtonLoadersRef.Save)}),g(12," Unmute "),c()()),t&2&&(s(4),h(o.closeModalHeaderButtonLoading?4:-1),s(),h(o.closeModalHeaderButtonLoading?-1:5),s(2),h(o.canPublishAudio?7:-1),s(2),p("isLoading",o.saveButtonLoading),s(2),p("isLoading",o.saveButtonLoading))},dependencies:[I,w,Zt,te,ie,oe,fe,ee,ve],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:row;flex-direction:column;justify-content:center;align-items:flex-start;width:100%;height:100%}.toggle-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:flex-start;padding:10px 0}ss-select[_ngcontent-%COMP%]{margin:10px 0}mat-checkbox[_ngcontent-%COMP%]{margin-top:20px}.mat-header[_ngcontent-%COMP%], mat-dialog-content[_ngcontent-%COMP%], mat-dialog-actions[_ngcontent-%COMP%]{width:100%}"]});let n=r;return n})(),ti=function(n){return n.Close="Close",n.Save="Save",n}(ti||{});var el=(n,r)=>r.id;function tl(n,r){n&1&&(a(0,"div",4),g(1,"You don't have any previous video tile messages "),a(2,"span"),g(3,"that received emoji reactions."),c()())}function il(n,r){if(n&1&&(a(0,"ss-button-small",12)(1,"span"),g(2),c()()),n&2){let i=l(2).$implicit,e=l(2);s(2),O("+",e.otherReactionsCount(i))}}function nl(n,r){if(n&1&&(a(0,"ss-button-small",10),b(1,"span",11),Te(2,"emoji"),g(3),c(),u(4,il,3,1,"ss-button-small",12)),n&2){let i=l().$implicit,e=l(2);s(),p("innerHTML",De(2,3,i.topReaction.reactionCharCode),Ze),s(2),O(" ",i.topReaction.reactionsCount," "),s(),h(e.otherReactionsCount(i)>0?4:-1)}}function ol(n,r){if(n&1){let i=P();a(0,"div",6)(1,"div",7),f("click",function(){let t=_(i).$implicit,o=l(2);return C(o.selectStatus(t))}),a(2,"div",8),g(3),c(),a(4,"div",9),u(5,nl,5,5),c()()()}if(n&2){let i=r.$implicit;s(2),p("matTooltip",i.text),s(),R(i.text),s(2),h(i.topReaction?5:-1)}}function rl(n,r){if(n&1&&(a(0,"p"),g(1,"Here are some of your recent video tile messages that received an emoji reaction. You can re-activate any of the ones below."),c(),V(2,ol,6,3,"div",6,el)),n&2){let i=l();s(2),A(i.statuses)}}var Ur=(()=>{let r=class r{handleKeyboardEvent(e){e.key==="Escape"&&this.close()}constructor(e,t){this.statuses=e,this.dialogRef=t}selectStatus(e){this.dialogRef.close(e)}otherReactionsCount(e){return e.topReaction?e.totalReactions-e.topReaction.reactionsCount:0}close(){this.dialogRef.close()}};r.\u0275fac=function(t){return new(t||r)(m(tt),m(ge))},r.\u0275cmp=x({type:r,selectors:[["ss-status-list-modal"]],hostBindings:function(t,o){t&1&&f("keydown",function(v){return o.handleKeyboardEvent(v)})},standalone:!1,decls:11,vars:3,consts:[[1,"mat-header"],["mat-dialog-title",""],[1,"close-modal",3,"click"],["iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"no-statuses"],["color","tertiary",3,"click"],[1,"status-row"],[1,"status",3,"click"],[1,"text",3,"matTooltip"],[1,"reactions"],["matTooltip","Top reaction","matTooltipPosition","above"],[3,"innerHTML"],["matTooltip","User reactions","matTooltipPosition","above"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h2",1),g(2,"Video tile messages"),c(),a(3,"button",2),f("click",function(){return o.close()}),b(4,"ss-icon",3),c()(),a(5,"mat-dialog-content"),u(6,tl,4,0,"div",4)(7,rl,4,0),c(),a(8,"mat-dialog-actions")(9,"ss-button",5),f("click",function(){return o.close()}),g(10,"Close"),c()()),t&2&&(s(4),p("size",20)("iconVariant",20),s(2),h(o.statuses.length===0?6:7))},dependencies:[I,w,Ce,oe,fe,ee,L,Ht],styles:[".status-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--alt)}.status-row[_ngcontent-%COMP%]:last-of-type{border-bottom:0}.status[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;padding:2px;border-radius:10px;background:rgba(var(--blue-black-rgb),.85);cursor:pointer}.status[_ngcontent-%COMP%]:hover{background:rgba(var(--blue-black-rgb),.7)}.no-statuses[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-style:italic}.text[_ngcontent-%COMP%]{max-width:350px;overflow:hidden;padding:2px 8px;color:var(--contrast);text-overflow:ellipsis;white-space:nowrap}@media only screen and (max-width: 767px){.text[_ngcontent-%COMP%]{max-width:calc(100vw - 236px)}}ss-button-small[_ngcontent-%COMP%]{flex-shrink:0;margin-left:4px}.reactions[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:2px}.reactions[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]     button{height:24px;border:1px solid var(--accent-gradient-60-dark);border-radius:5px;background-color:var(--accent-blue-80-dark)}.reactions[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]     button ss-icon{margin-right:0;background:var(--accent-blue);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}"]});let n=r;return n})();function sl(n,r){if(n&1){let i=P();a(0,"ss-button-small",2),f("buttonClick",function(){_(i);let t=l();return C(t.openStatusListModal())}),g(1," See history "),c()}if(n&2){let i=l();p("color",i.ButtonColorRef.Secondary)("isLoading",i.loadingPreviousStatuses)}}var Vr=(()=>{let r=class r{get localParticipant(){return this.livekit.room.localParticipant}get hasActiveStatus(){return this.livekit.room.userActiveStatus!==null&&!this.livekit.room.userActiveStatus.clearedAt}get isD3OrHigher(){return Ci(this.accountService.currentUser)>=3}constructor(e,t,o,d,v,k){this.livekit=e,this.accountModalsService=t,this.toastService=o,this.badgeService=d,this.accountService=v,this.dialog=k,this.mobileStatus=!1,this.currentUserStatus={text:""},this.currentUserStatusActions={send:{iconName:"send",loading:!1,onClick:()=>this.sendStatus(),disabled:()=>this.shouldDisableSendingStatuses(),tooltipText:()=>{let T=this.getStatusTimeoutDateTime();if(!T||$.now()>T)return this.currentUserStatus.text.length<2?"Type at least 2 characters.":"Post";let B=T.diffNow(["seconds"])??"";return`You can update again in ${Math.floor(B.seconds)}s`}},undo:{iconName:"arrow_undo",loading:!1,onClick:()=>this.clearStatus(),disabled:()=>!this.localParticipant.status,tooltipText:()=>this.localParticipant.status?"Clear":""}},this.ButtonColorRef=He,this.loadingPreviousStatuses=!1,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.livekit.participantMetadataUpdated.subscribe(e=>{this.livekit.room.localParticipant.identity===e.identity&&this.setStatus()})),this.setStatus()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}shouldDisableSendingStatuses(){return this.currentUserStatus.text.length<2?!0:this.shouldDisableStatusInput()}shouldDisableStatusInput(){let e=this.getStatusTimeoutDateTime();return e?$.now()<e:!1}sendStatus(){if(!this.accountModalsService.ensureUserCompletedBasicInfo())return;this.currentUserStatusActions.send.loading=!0;let e={text:this.currentUserStatus.text,localParticipantTilePage:this.livekit.room.paginator.currentPage};this.livekit.createUserStatus(this.livekit.room.name,e).subscribe({next:t=>{this.livekit.room.milestones.createdTileStatus||this.subscriptions.push(W(5e3).subscribe(()=>this.badgeService.checkForNewBadges.next())),this.livekit.room.milestones.createdTileStatus=!0,this.currentUserStatusActions.send.loading=!1,this.livekit.room.userActiveStatus?(this.livekit.room.userActiveStatus.id=t.id,this.livekit.room.userActiveStatus.text=t.text,this.livekit.room.userActiveStatus.postedAt=t.postedAt,this.livekit.room.userActiveStatus.clearedAt=null,this.livekit.room.userActiveStatus.topReaction=null,this.livekit.room.userActiveStatus.totalReactions=0):this.livekit.room.userActiveStatus=t,this.livekit.room.localParticipant.status=this.livekit.room.userActiveStatus},error:t=>this.handleErrors(t)})}openStatusListModal(){this.loadingPreviousStatuses=!0,this.livekit.getTopStatuses(this.livekit.room.name).subscribe({next:e=>{this.loadingPreviousStatuses=!1,this.dialog.open(Ur,{panelClass:"fullscreen-dialog",width:"520px",data:e}).afterClosed().subscribe(o=>{o&&this.setPreviousUserStatus(o)})},error:e=>this.handleErrors(e)})}setPreviousUserStatus(e){let t=this.livekit.room.paginator.currentPage;this.livekit.setActiveStatus(this.livekit.room.name,e.id,t).subscribe({next:()=>{this.livekit.room.userActiveStatus=Xt(Rt({},e),{clearedAt:null}),this.livekit.room.localParticipant.status=this.livekit.room.userActiveStatus,this.setStatus()},error:o=>this.handleErrors(o)})}setStatus(){let e=this.livekit.room.userActiveStatus;this.currentUserStatus.text=e&&!e.clearedAt?e.text:""}clearStatus(){this.currentUserStatusActions.undo.loading=!0,this.livekit.clearUserStatus(this.livekit.room.name).subscribe({next:()=>{this.currentUserStatusActions.undo.loading=!1,this.currentUserStatus.text="",this.livekit.room.userActiveStatus=null,this.livekit.room.localParticipant.status=null},error:e=>this.handleErrors(e)})}getStatusTimeoutDateTime(){let e=this.localParticipant.status?.postedAt;return e?$.fromISO(e).plus({seconds:10}):null}handleErrors(e){this.loadingPreviousStatuses=!1,this.currentUserStatusActions.send.loading=!1,this.currentUserStatusActions.undo.loading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(K),m(F),m(Qe),m(G),m(N))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-status"]],hostVars:2,hostBindings:function(t,o){t&2&&S("mobile-status",o.mobileStatus)},inputs:{mobileStatus:"mobileStatus"},standalone:!1,decls:2,vars:6,consts:[["id","status-text","name","currentUserStatusText","type","search","placeholder","Post video tile message...","autocomplete","off",3,"ngModelChange","keyup.enter","actions","ngModel","disabled"],[1,"view-statuses-button",3,"color","isLoading"],[1,"view-statuses-button",3,"buttonClick","color","isLoading"]],template:function(t,o){t&1&&(a(0,"ss-input",0),he("ngModelChange",function(v){return ue(o.currentUserStatus.text,v)||(o.currentUserStatus.text=v),v}),f("keyup.enter",function(){return o.sendStatus()}),c(),u(1,sl,2,2,"ss-button-small",1)),t&2&&(S("has-status",o.hasActiveStatus),p("actions",o.currentUserStatusActions),me("ngModel",o.currentUserStatus.text),p("disabled",o.shouldDisableStatusInput()),s(),h(o.isD3OrHigher?1:-1))},dependencies:[Ee,Ce,te,ie],styles:["@media only screen and (max-width: 1300px){.mobile-status[_nghost-%COMP%]{position:absolute;top:100;z-index:5;width:100%;padding:10px 5px}}@media only screen and (max-width: 1024px){.mobile-status[_nghost-%COMP%]{position:absolute;top:auto;bottom:63px;z-index:5;width:100%;padding:10px 5px}}@media only screen and (max-height: 480px){.mobile-status[_nghost-%COMP%]{bottom:-63px;left:-146px;width:100vw}}.mobile-status[_nghost-%COMP%]   ss-input[_ngcontent-%COMP%]{width:100%}.mobile-status[_nghost-%COMP%]   ss-input[_ngcontent-%COMP%]     input{height:48px}[_nghost-%COMP%]   ss-input[_ngcontent-%COMP%]{margin-bottom:0}[_nghost-%COMP%]   ss-input.has-status[_ngcontent-%COMP%]     input{border:1px solid var(--positive)!important}[_nghost-%COMP%]   ss-input[_ngcontent-%COMP%]     .mdc-text-field--disabled{pointer-events:initial}[_nghost-%COMP%]   ss-input[_ngcontent-%COMP%]     input{padding:6px 72px 6px 16px;border:1px solid var(--alt-20)}[_nghost-%COMP%]   ss-input[_ngcontent-%COMP%]     .mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:36px}[_nghost-%COMP%]   ss-button-small[_ngcontent-%COMP%]{margin-top:4px}[_nghost-%COMP%]   ss-button-small[_ngcontent-%COMP%]     button{border:none;background:none!important}"]});let n=r;return n})();var cl=(n,r)=>r.id;function ll(n,r){if(n&1){let i=P();a(0,"div",2),f("click",function(){_(i);let t=l().$implicit,o=l();return C(o.setBackgroundOption(t))}),g(1),c()}if(n&2){let i=l().$implicit,e=l();S("active",i.id===e.activeVirtualBackgroundOptionId)("soft-blur",i.name===e.BackgroundOptionNameRef.SoftBlur)("hard-blur",i.name===e.BackgroundOptionNameRef.HardBlur)("disabled",!e.localParticipant.isCameraEnabled||e.virtualBackgroundLoading),p("matTooltip",e.localParticipant.isCameraEnabled?"":"Turn on camera to apply virtual background"),s(),O(" ",i.name," ")}}function dl(n,r){if(n&1){let i=P();a(0,"img",3),f("click",function(){_(i);let t=l().$implicit,o=l();return C(o.setBackgroundOption(t))}),c()}if(n&2){let i=l().$implicit,e=l();S("active",i.id===e.activeVirtualBackgroundOptionId)("disabled",!e.localParticipant.isCameraEnabled||e.virtualBackgroundLoading),p("matTooltip",e.localParticipant.isCameraEnabled?"":"Turn on camera to apply virtual background")("src",i.imageUrl,Et)("alt",i.name)}}function pl(n,r){if(n&1&&(u(0,ll,2,10,"div",0),u(1,dl,1,7,"img",1)),n&2){let i=r.$implicit,e=l();h(i.type===e.BackgroundOptionTypeRef.Blur||i.type===e.BackgroundOptionTypeRef.None?0:-1),s(),h(i.type===e.BackgroundOptionTypeRef.Image?1:-1)}}var Ar=(()=>{let r=class r{get localParticipant(){return this.livekit.room.localParticipant}constructor(e,t){this.livekit=e,this.analyticsService=t,this.updateActiveVirtualBackgroundOptionId=new ce,this.backgroundOptions=[{id:1,type:Oe.None,name:$e.None},{id:2,type:Oe.Blur,blurLevel:5,name:$e.SoftBlur},{id:3,type:Oe.Blur,blurLevel:10,name:$e.HardBlur},{id:4,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/classic/fondo-virtual-foto-oficina-blanco.png`,name:$e.Classic1},{id:5,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/classic/professional-office.png`,name:$e.Classic2},{id:6,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/nature/fondo-virtual-foto-grupo-de-suricatas.png`,name:$e.Natural1},{id:7,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/nature/green-and-blue-clean-and-corporate-empowerment.png`,name:$e.Natural2},{id:8,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/fun-and-silly/blue-bright-sun-zoom.png`,name:$e.Fun1},{id:9,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/fun-and-silly/naranja-verde-retro-tropical-colorido-plantas.png`,name:$e.Fun2},{id:10,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/simple/abstract-textured-shapes-creative-zoom.png`,name:$e.Simple1},{id:11,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/simple/brown-and-orange-abstract-zoom.png`,name:$e.Simple2},{id:12,type:Oe.Image,imageUrl:`${le.blobStorageRootUrl}/virtual-backgrounds/simple/pink-abstract-watercolor-zoom.png`,name:$e.Simple3}],this.BackgroundOptionTypeRef=Oe,this.BackgroundOptionNameRef=$e,this.virtualBackgroundLoading=!1}setBackgroundOption(e){return Y(this,null,function*(){if(!(this.virtualBackgroundLoading||!this.localParticipant.isCameraEnabled)){if(this.virtualBackgroundLoading=!0,this.analyticsService.markActivity(y.LivekitVirtualBackground,{newState:e.type,imageName:e.name||"",blur:e.blurLevel||""}),this.activeVirtualBackgroundOptionId===e.id||e.type===Oe.None){yield this.livekit.room.disableVirtualBackground(),this.updateActiveVirtualBackgroundOptionId.emit(1),this.virtualBackgroundLoading=!1;return}this.updateActiveVirtualBackgroundOptionId.emit(e.id),e.type===Oe.Image&&e.imageUrl?yield this.livekit.room.enableBackgroundImage(e.imageUrl):e.type===Oe.Blur&&e.blurLevel&&(yield this.livekit.room.enableBackgroundBlur(e.blurLevel)),this.virtualBackgroundLoading=!1}})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(H))},r.\u0275cmp=x({type:r,selectors:[["ss-virtual-backgrounds"]],inputs:{activeVirtualBackgroundOptionId:"activeVirtualBackgroundOptionId"},outputs:{updateActiveVirtualBackgroundOptionId:"updateActiveVirtualBackgroundOptionId"},standalone:!1,decls:2,vars:0,consts:[[3,"matTooltip","active","soft-blur","hard-blur","disabled"],[3,"matTooltip","active","disabled","src","alt"],[3,"click","matTooltip"],[3,"click","matTooltip","src","alt"]],template:function(t,o){t&1&&V(0,pl,2,2,null,null,cl),t&2&&A(o.backgroundOptions)},dependencies:[L],styles:["[_nghost-%COMP%]{position:absolute;left:343px;display:grid;grid-template-columns:1fr 1fr 1fr;width:312px;box-sizing:content-box;padding:6px;border-radius:8px;background:var(--alt-90);gap:6px}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{position:static}}[_nghost-%COMP%] > div[_ngcontent-%COMP%], [_nghost-%COMP%]   img[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100px;object-fit:cover;border:2px solid var(--alt-90);border-radius:8px;cursor:pointer;transition:border .3s ease;aspect-ratio:16/9;font-size:13px;line-height:20px}[_nghost-%COMP%] > div[_ngcontent-%COMP%]:hover:not(.disabled), [_nghost-%COMP%]   img[_ngcontent-%COMP%]:hover:not(.disabled){border:2px solid var(--accent-blue-40)}[_nghost-%COMP%] > div.active[_ngcontent-%COMP%], [_nghost-%COMP%]   img.active[_ngcontent-%COMP%]{border:2px solid var(--accent-blue)}[_nghost-%COMP%] > div.disabled[_ngcontent-%COMP%], [_nghost-%COMP%]   img.disabled[_ngcontent-%COMP%]{cursor:not-allowed;opacity:.5}[_nghost-%COMP%] > div.soft-blur[_ngcontent-%COMP%], [_nghost-%COMP%]   img.soft-blur[_ngcontent-%COMP%]{background-image:url(/assets/images/blur-background.jpg);background-position:bottom left}[_nghost-%COMP%] > div.hard-blur[_ngcontent-%COMP%], [_nghost-%COMP%]   img.hard-blur[_ngcontent-%COMP%]{background-image:url(/assets/images/blur-background.jpg);background-size:cover}"]});let n=r;return n})(),Oe=function(n){return n.Image="image",n.Blur="blur",n.None="none",n}(Oe||{}),$e=function(n){return n.None="None",n.SoftBlur="Soft Blur",n.HardBlur="Hard Blur",n.Classic1="Classic 1",n.Classic2="Classic 2",n.Natural1="Natural 1",n.Natural2="Natural 2",n.Fun1="Fun 1",n.Fun2="Fun 2",n.Simple1="Simple 1",n.Simple2="Simple 2",n.Simple3="Simple 3",n}($e||{});function ul(n,r){n&1&&b(0,"div",3)}function hl(n,r){n&1&&(a(0,"div"),g(1,"Turn off boost"),c())}function gl(n,r){if(n&1){let i=P();a(0,"div"),g(1,' We also have a "superboost" feature for premium users. Upgrade and try it! \u{1F680} '),c(),a(2,"ss-button",15),f("buttonClick",function(){_(i);let t=l(2);return C(t.upgradeForSuperboost())}),g(3),c()}if(n&2){let i=l(2);s(2),p("autoSize",!0),s(),O(" ",i.buttonText," ")}}function fl(n,r){if(n&1&&(a(0,"div"),g(1,"Get ahead of the crowd. Boost yourself forward."),c(),u(2,gl,4,2)),n&2){let i=l();s(2),h(i.subscriptionService.hasPremiumFeatures?-1:2)}}function vl(n,r){if(n&1&&b(0,"ss-document-picture-in-picture",11),n&2){let i=l();p("displayedParticipants",i.livekit.room.displayedParticipants)}}function _l(n,r){if(n&1){let i=P();a(0,"ss-icon",16),f("click",function(){_(i);let t=l();return C(t.closeDrawer())}),c()}if(n&2){let i=l();p("size",i.isMobile?24:20)}}function Cl(n,r){if(n&1){let i=P();a(0,"ss-icon",17),f("click",function(){_(i);let t=l();return C(t.openDrawer())}),c()}if(n&2){let i=l();p("size",i.isMobile?24:20)}}function bl(n,r){if(n&1){let i=P();a(0,"div",31),f("click",function(){_(i);let t=l(2);return C(t.openCameraTestPopup())}),a(1,"div"),g(2,"Test camera"),c(),b(3,"ss-info-tooltip",32),c()}}function Pl(n,r){if(n&1){let i=P();a(0,"div",33),f("click",function(){_(i);let t=l(2);return C(t.goToPage())}),a(1,"em"),g(2),c(),b(3,"ss-icon",34),c()}if(n&2){let i=l(2);S("current-page",i.userPageNumber===i.livekit.room.paginator.currentPage),s(2),R(i.goToPageTitle),s(),p("size",20)}}function kl(n,r){if(n&1){let i=P();a(0,"ss-button",35),f("buttonClick",function(){_(i);let t=l(2);return C(t.livekit.room.selfViewVideoVisibility=!t.livekit.room.selfViewVideoVisibility)}),c()}if(n&2){let i=l(2);p("matTooltip",(i.livekit.room.selfViewVideoVisibility?"Hide":"Show")+" self view video")("iconName",i.livekit.room.selfViewVideoVisibility?"camera":"camera_off")("iconSize",20)}}function xl(n,r){if(n&1){let i=P();a(0,"ss-button",36),f("click",function(){_(i);let t=l(2);return C(t.removeNewUserMarker())}),c()}n&2&&p("iconSize",20)}function yl(n,r){if(n&1){let i=P();a(0,"ss-virtual-backgrounds",37),f("updateActiveVirtualBackgroundOptionId",function(t){_(i);let o=l(2);return C(o.activeVirtualBackgroundOptionId=t)}),c()}if(n&2){let i=l(2);p("activeVirtualBackgroundOptionId",i.activeVirtualBackgroundOptionId)}}function Sl(n,r){if(n&1&&b(0,"ss-upgrade-cta",40),n&2){let i=l(3);p("short",!0)("openedFromSource",i.TriggeredUpgradeFromSourceRef.ConnectingSpotify)}}function Ml(n,r){if(n&1){let i=P();a(0,"ss-button-small",42),f("buttonClick",function(){_(i);let t=l(3);return C(t.disconnectSpotify())}),g(1," Disconnect Spotify "),c()}}function wl(n,r){if(n&1){let i=P();a(0,"ss-button-small",43),f("buttonClick",function(){_(i);let t=l(3);return C(t.connectSpotify())}),g(1," Connect Spotify "),c()}if(n&2){let i=l(3);p("matTooltip",i.subscriptionService.hasPremiumFeatures?"":"Upgrade to premium to connect Spotify")("disabled",!i.subscriptionService.hasPremiumFeatures)}}function Ol(n,r){if(n&1){let i=P();a(0,"div",30)(1,"div",38)(2,"mat-slide-toggle",39),f("change",function(t){_(i);let o=l(2);return C(o.toggleEnableSpotifyNowPlaying(t))}),c(),a(3,"div"),g(4,"Show now playing"),c(),u(5,Sl,1,2,"ss-upgrade-cta",40),c(),u(6,Ml,2,0,"ss-button-small")(7,wl,2,2,"ss-button-small",41),c()}if(n&2){let i=l(2);s(2),p("checked",i.livekit.room.roomSettings==null?null:i.livekit.room.roomSettings.enableSpotifyNowPlaying)("matTooltip",i.subscriptionService.hasPremiumFeatures&&!i.currentUser.hasSpotifyConnected?"Connect Spotify first":"")("disabled",!i.subscriptionService.hasPremiumFeatures||i.savingEnableSpotifyPlaying||!i.currentUser.hasSpotifyConnected),s(3),h(i.subscriptionService.hasPremiumFeatures?-1:5),s(),h(i.currentUser.hasSpotifyConnected?6:7)}}function Tl(n,r){if(n&1){let i=P();a(0,"div",14)(1,"div",18),u(2,bl,4,0,"div",19),u(3,Pl,4,4,"div",20),c(),a(4,"div",21)(5,"em"),g(6,"Your video tile"),c(),a(7,"div",22)(8,"ss-button",23),f("buttonClick",function(){_(i);let t=l();return C(t.isPinned?t.unpin():t.pin())}),c(),u(9,kl,1,3,"ss-button",24),u(10,xl,1,1,"ss-button",25),a(11,"ss-button",26),f("buttonClick",function(){_(i);let t=l();return C(t.showBackgroundOptions=!t.showBackgroundOptions)}),c()()(),u(12,yl,1,1,"ss-virtual-backgrounds",27),b(13,"ss-focus-room-tile",28)(14,"ss-focus-room-status",29),u(15,Ol,8,5,"div",30),c()}if(n&2){let i=l();s(2),h(i.localParticipant.isCameraEnabled?-1:2),s(),h(i.localParticipant.isCameraEnabled&&i.userPageNumber?3:-1),s(5),p("matTooltip",i.isPinned?"Unpin":"Pin")("iconName",i.isPinned?"pin_off":"pin")("iconOnly",!0)("iconSize",20)("isLoading",i.livekit.room.pinningUserIds!==null&&i.livekit.room.pinningUserIds.includes(i.localParticipant.identity))("disabled",i.livekit.room.pinningUserIds!==null&&!i.livekit.room.pinningUserIds.includes(i.localParticipant.identity)),s(),h(i.livekit.room.settings.selfViewVideoEnabled&&i.localParticipant.isCameraEnabled&&!i.livekit.room.focusPlus.active?9:-1),s(),h(i.localParticipant.userInfo.showNewUserMarker?10:-1),s(),p("iconSize",24)("iconVariant",24)("iconColor",i.showBackgroundOptions?"gradient-40":"contrast"),s(),h(i.showBackgroundOptions?12:-1),s(),p("isVideoPill",!0)("participant",i.localParticipant),s(2),h(i.settingsService.settings.spotifyEnabled?15:-1)}}var Jt=(()=>{let r=class r{get getVideoPillButtonClass(){switch(this.buttonLocation){case Ke.FocusRoom:return"focus-room";case Ke.PrivatePod:return"private-pod";case Ke.PublicPod:return"public-pod";default:return null}}get isCameraEnabled(){return this.localParticipant.isCameraEnabled}get isPrivateGroupMinimized(){return this.livekit.room.privateGroupMinimized}get localParticipant(){return this.livekit.room.localParticipant}get loadingVideo(){return this.livekit.room.loadingVideo}get allowOnlyGroupAudio(){return this.livekit.room.allowOnlyGroupAudio}get canPublishAudio(){return this.livekit.room.canPublishAudio}get performedFirstConnect(){return this.livekit.room.performedFirstConnect}get audioEnabled(){return this.performedFirstConnect&&this.canPublishAudio&&(!this.allowOnlyGroupAudio||this.activeGroup!==null)}get anyPinnedUsers(){return this.livekit.room.pinnedParticipants.length>0}get zoomToFitDisabled(){return!this.livekit.room.settings.zoomToFit&&this.livekit.room.settings.isCameraEnabled}get isPinned(){return this.livekit.room.isPinned(this.localParticipant.identity)}get userPageNumber(){let e=this.livekit.room.filteredParticipants.indexOf(this.localParticipant);return e<0?null:Math.ceil((e+1)/Math.min(this.livekit.room.paginator.tilesPerPage,this.livekit.room.paginator.maxTilesAllowed))}get goToPageTitle(){return this.userPageNumber===this.livekit.room.paginator.currentPage?"On this page":`Page ${this.userPageNumber}`}get getHeaderTitle(){if(this.localParticipant.anonymous)return"guest";if(this.activeGroup){if(this.activeGroupName)return this.activeGroupName;switch(this.buttonLocation){case Ke.PrivatePod:return"private space";case Ke.PublicPod:return"public pod";default:break}}return this.localParticipant.isCameraEnabled?"live":"viewer"}constructor(e,t,o,d,v,k,T,B,z,ke,pe,Ve,Xe){this.livekit=e,this.subscriptionService=t,this.settingsService=o,this.elementRef=d,this.accountService=v,this.subscriptionNavigationService=k,this.accountModalsService=T,this.analyticsService=B,this.utilityService=z,this.spotifyService=ke,this.signalRService=pe,this.toastService=Ve,this.dialog=Xe,this.expanded=!1,this.toggleCameraDisabled=!1,this.handRaiseToggling=!1,this.savingEnableSpotifyPlaying=!1,this.showBackgroundOptions=!1,this.activeVirtualBackgroundOptionId=1,this.TriggeredUpgradeFromSourceRef=re,this.subscriptions=[],this.currentUser=this.accountService.currentUser,this.buttonText=this.accountService.authenticated()?"Upgrade":"Register"}ngOnInit(){return Y(this,null,function*(){this.subscriptions.push(this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e),this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.livekit.room.videoPillButtonExpanded.subscribe(e=>this.setExpandedState(e))),this.accountService.isFullyVerifiedUser()})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),window.clearTimeout(this.toggleCameraDisableTimeoutRef)}openDrawer(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.livekit.room.videoPillButtonExpanded.next(!0)}closeDrawer(){this.elementRef.nativeElement.style.marginRight="initial",this.livekit.room.videoPillButtonExpanded.next(!1),this.isMobile&&(this.elementRef.nativeElement.style.position="static",setTimeout(()=>{this.elementRef.nativeElement.style.position=""},100))}setExpandedState(e){if(!this.accountModalsService.ensureUserCompletedBasicInfo())return;if(this.expanded=e,!this.expanded||this.isMobile){this.elementRef.nativeElement.style.marginRight="",this.showBackgroundOptions=!1;return}let t=this.elementRef.nativeElement.clientWidth;this.elementRef.nativeElement.style.marginRight=`${t-342}px`}toggleLocalVideo(){return Y(this,null,function*(){this.livekit.participantHighlight.hide.next(),this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.livekit.room.settings.activeVideoDevice?this.livekit.room.toggleLocalVideo():this.showFocusRoomVideoSourceModal(()=>this.livekit.room.toggleLocalVideo()),this.toggleCameraDisabled=!0,this.toggleCameraDisableTimeoutRef=window.setTimeout(()=>this.toggleCameraDisabled=!1,2e3))})}toggleLocalAudio(){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.livekit.room.settings.activeAudioDevice?this.livekit.room.toggleLocalAudio():this.showFocusRoomAudioSourceModal(()=>this.livekit.room.toggleLocalAudio()))}editPrivacySettings(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.dialog.open(Bo,{panelClass:["fullscreen-dialog","privacy-modal"],width:"600px",data:No.Other,disableClose:!0})}getToggleCameraTooltipText(){return this.toggleCameraDisabled?"You can only toggle your video every 2 seconds":this.localParticipant.isCameraEnabled?"Turn camera off":"Turn camera on"}getToggleAudioTooltipText(){return this.audioEnabled?`Microphone ${this.localParticipant.isMicrophoneEnabled?"on":"off"}`:"Mics are disabled."}goToPage(){if(this.userPageNumber===null)return;this.anyPinnedUsers&&!this.livekit.room.forceGridView?(this.livekit.room.forceGridView=!0,W(100).subscribe(()=>{this.livekit.room.assignDisplayedParticipants(),this.livekit.room.recalculateGrid.next(),this.navigateToUserPage()})):this.navigateToUserPage()}raiseHand(){!this.accountModalsService.ensureUserCompletedBasicInfo()||this.handRaiseToggling||(this.handRaiseToggling=!0,this.livekit.raiseHand(this.livekit.room.roomName??"").subscribe({next:()=>{this.livekit.room.localParticipant.isHandRaised=!0,this.livekit.room.localParticipant.handRaiseTimestamp=Date.now()/1e3,this.livekit.room.sortAndAssignDisplayedParticipants(),this.handRaiseToggling=!1},error:e=>this.handleErrors(e)}))}lowerHand(){!this.accountModalsService.ensureUserCompletedBasicInfo()||this.handRaiseToggling||(this.handRaiseToggling=!0,this.livekit.lowerHand(this.livekit.room.roomName??"").subscribe({next:()=>{this.livekit.room.localParticipant.isHandRaised=!1,this.livekit.room.localParticipant.handRaiseTimestamp=null,this.livekit.room.sortAndAssignDisplayedParticipants(),this.handRaiseToggling=!1},error:e=>this.handleErrors(e)}))}removeNewUserMarker(){this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"RemoveNewUserMarker",confirmButtonLabel:"Remove"}}).afterClosed().subscribe(t=>{t&&this.accountService.hideNewUserMarker().subscribe({next:()=>{this.livekit.updateMetadata(this.livekit.room.name,this.livekit.room.settings.zoomToFit,this.livekit.room.settings.mirrorModeForOthers).subscribe()},error:o=>this.handleErrors(o)})})}showOptionsModal(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.livekit.showOptionsModal()}upgradeForSuperboost(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.subscriptionNavigationService.openPlansAndPricing(re.Superboost)}toggleEnableSpotifyNowPlaying(e){this.livekit.room.roomSettings&&(this.livekit.room.roomSettings.enableSpotifyNowPlaying=e.checked,this.savingEnableSpotifyPlaying=!0,this.accountService.upsertRoomSettings(this.livekit.room.roomSettings,!1).subscribe({next:()=>{this.savingEnableSpotifyPlaying=!1,this.livekit.room.roomSettings?.enableSpotifyNowPlaying?this.livekit.room.getLocalCurrentlyPlaying():this.livekit.room.localParticipant.spotifyData=null},error:t=>this.handleErrors(t)}))}connectSpotify(){this.spotifyService.getLoginRequest().subscribe({next:e=>window.open(e,"_blank"),error:e=>this.handleErrors(e)})}disconnectSpotify(){this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"DisconnectSpotify",confirmButtonLabel:"Yes"}}).afterClosed().subscribe(t=>{t&&this.spotifyService.disconnect().subscribe({next:()=>this.currentUser.hasSpotifyConnected=!1,error:o=>this.handleErrors(o)})})}openCameraTestPopup(){let e=encodeURIComponent(this.livekit.room.settings.activeVideoDevice??"");window.open(`/camera-test?deviceId=${e}`,"CameraTest","width=600,height=450,menubar=no,toolbar=no,location=no,status=no,resizable=no")||this.toastService.error({message:"Popup blocked! Please allow popups for this site."})}pin(){this.livekit.room.pin({participant:this.localParticipant})}unpin(){this.livekit.room.unpin({pinnedUserId:this.localParticipant.identity})}showFocusRoomVideoSourceModal(e){this.livekit.room.storeLivekitSettings(),this.dialog.open(Si,{panelClass:"fullscreen-dialog",width:"550px",disableClose:!0}).afterClosed().subscribe(o=>{o&&(o.activeVideoDevice&&(this.livekit.room.settings.activeVideoDevice=o.activeVideoDevice,this.livekit.room.switchActiveDevice("videoinput",o.activeVideoDevice)),e(),this.livekit.room.storeLivekitSettings())})}navigateToUserPage(){this.userPageNumber!==null&&this.livekit.room.paginator.currentPage!==this.userPageNumber&&(this.livekit.room.paginator.goToPage(this.userPageNumber),this.analyticsService.markActivity(y.LivekitLocalVideoHighlightPageChanged))}showFocusRoomAudioSourceModal(e){this.livekit.room.storeLivekitSettings(),this.dialog.open(Er,{panelClass:"fullscreen-dialog",width:"550px",disableClose:!0}).afterClosed().subscribe(o=>{o&&(o.activeAudioDevice&&(this.livekit.room.settings.activeAudioDevice=o.activeAudioDevice,this.livekit.room.switchActiveDevice("audioinput",o.activeAudioDevice)),e(),this.livekit.room.storeLivekitSettings())})}handleErrors(e){this.handRaiseToggling=!1,this.savingEnableSpotifyPlaying=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(_e),m(X),m(ze),m(G),m(yt),m(K),m(H),m(J),m(bo),m(St),m(F),m(N))},r.\u0275cmp=x({type:r,selectors:[["ss-video-pill-button"]],hostVars:8,hostBindings:function(t,o){t&2&&(Cn(o.getVideoPillButtonClass),S("expanded",o.expanded)("camera-enabled",o.isCameraEnabled)("private-group-minimized",o.isPrivateGroupMinimized))},inputs:{buttonLocation:"buttonLocation",activeGroupName:"activeGroupName"},standalone:!1,decls:19,vars:38,consts:[[1,"header"],[1,"left"],[3,"size","avatarColor","avatarThumbUrl","showOnlineStatus","userId","initials"],[1,"dot"],[1,"text"],[1,"video-toggle-button",3,"buttonClick","matTooltip","iconName","active","iconSize","iconOnly","isLoading","disabled"],[1,"audio-toggle-button",3,"buttonClick","matTooltip","iconName","iconSize","iconOnly","disabled"],["role","button",1,"boost",3,"click","ssLadda"],["tooltip",""],["matTooltip","Privacy settings","iconName","shield_keyhole",1,"privacy-settings-button",3,"buttonClick","iconSize","iconOnly"],["matTooltip","Settings","iconName","settings",1,"settings",3,"buttonClick","iconSize","iconOnly"],[3,"displayedParticipants"],["role","button","iconName","dismiss","color","contrast",3,"size"],["iconName","chevron_down","role","button","color","default",1,"open-drawer-icon",3,"size"],[1,"drawer"],["color","blurple-20",3,"buttonClick","autoSize"],["role","button","iconName","dismiss","color","contrast",3,"click","size"],["iconName","chevron_down","role","button","color","default",1,"open-drawer-icon",3,"click","size"],[1,"jump-to-page-wrapper"],[1,"test-camera-wrapper"],[1,"page-number",3,"current-page"],[1,"tile-header"],[1,"right-group-buttons"],["color","website-transparent",1,"pin-button",3,"buttonClick","matTooltip","iconName","iconOnly","iconSize","isLoading","disabled"],["color","website-transparent",1,"self-view",3,"matTooltip","iconName","iconSize"],["matTooltip","Remove new user marker","role","button","iconName","person","color","website-transparent",1,"video-blur",3,"iconSize"],["iconName","video_background_effect","matTooltip","Virtual backgrounds","role","button","color","website-transparent",1,"video-blur",3,"buttonClick","iconSize","iconVariant","iconColor"],[3,"activeVirtualBackgroundOptionId"],[3,"isVideoPill","participant"],[1,"desktop-status"],[1,"spotify-wrapper"],[1,"test-camera-wrapper",3,"click"],["text","Other people won't see you"],[1,"page-number",3,"click"],["iconName","arrow_right","color","accent-blue-40",3,"size"],["color","website-transparent",1,"self-view",3,"buttonClick","matTooltip","iconName","iconSize"],["matTooltip","Remove new user marker","role","button","iconName","person","color","website-transparent",1,"video-blur",3,"click","iconSize"],[3,"updateActiveVirtualBackgroundOptionId","activeVirtualBackgroundOptionId"],[1,"toggle-wrapper"],["labelPosition","before",3,"change","checked","matTooltip","disabled"],[3,"short","openedFromSource"],[3,"matTooltip","disabled"],[3,"buttonClick"],[3,"buttonClick","matTooltip","disabled"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"div",1),b(2,"ss-user-avatar",2),u(3,ul,1,0,"div",3),a(4,"div",4),g(5),c(),a(6,"ss-button",5),f("buttonClick",function(){return o.toggleLocalVideo()}),c(),a(7,"ss-button",6),f("buttonClick",function(){return o.toggleLocalAudio()}),c(),a(8,"ss-html-tooltip")(9,"div",7),f("click",function(){return o.localParticipant.isHandRaised?o.lowerHand():o.raiseHand()}),c(),a(10,"div",8),u(11,hl,2,0,"div")(12,fl,3,1),c()(),a(13,"ss-button",9),f("buttonClick",function(){return o.editPrivacySettings()}),c(),a(14,"ss-button",10),f("buttonClick",function(){return o.showOptionsModal()}),c(),u(15,vl,1,1,"ss-document-picture-in-picture",11),c(),u(16,_l,1,1,"ss-icon",12),c(),u(17,Cl,1,1,"ss-icon",13),u(18,Tl,16,17,"div",14)),t&2&&(s(2),p("size",o.isMobile?28:24)("avatarColor",o.currentUser.id?o.currentUser.avatarColor:"C2C1E1")("avatarThumbUrl",o.currentUser.id?o.currentUser.avatarThumbUrl:null)("showOnlineStatus",!1)("userId",o.currentUser.id||null)("initials",o.currentUser.id&&o.currentUser.initials&&o.currentUser.initials!==" "?o.currentUser.initials:"YOU"),s(),h(o.localParticipant.isCameraEnabled?3:-1),s(),S("group-name",o.activeGroupName),s(),R(o.getHeaderTitle),s(),p("matTooltip",o.getToggleCameraTooltipText())("iconName",o.localParticipant.isCameraEnabled?"video":"video_off")("active",o.localParticipant.isCameraEnabled)("iconSize",o.isMobile?24:20)("iconOnly",!0)("isLoading",o.loadingVideo)("disabled",o.toggleCameraDisabled),s(),p("matTooltip",o.getToggleAudioTooltipText())("iconName",o.localParticipant.isMicrophoneEnabled?"mic":"mic_off")("iconSize",o.isMobile?24:20)("iconOnly",!0)("disabled",!o.audioEnabled),s(2),S("premium",o.subscriptionService.hasPremiumFeatures)("active",o.localParticipant.isHandRaised)("loading",o.handRaiseToggling),p("ssLadda",o.handRaiseToggling),s(2),h(o.localParticipant.isHandRaised?11:12),s(2),p("iconSize",o.isMobile?24:20)("iconOnly",!0),s(),p("iconSize",o.isMobile?24:20)("iconOnly",!0),s(),h(o.expanded?15:-1),s(),h(o.expanded?16:-1),s(),h(o.expanded?-1:17),s(),h(o.expanded?18:-1))},dependencies:[_t,I,w,Me,Nt,Ce,zt,Xn,L,vt,ut,pr,Vr,Ar],styles:["[_nghost-%COMP%]{position:relative;display:flex;justify-content:center;flex-shrink:0;height:32px;border-radius:12px;background:var(--overlay)}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{height:46px;margin-right:0}}.expanded[_nghost-%COMP%]{position:relative;z-index:6;width:342px;height:32px;border-bottom-right-radius:0;border-bottom-left-radius:0}@media only screen and (max-width: 1024px){.expanded[_nghost-%COMP%]{position:fixed;top:30%;left:50%;margin-right:0;transform:translate(-50%)}}@media only screen and (max-width: 767px){.expanded[_nghost-%COMP%]{top:0;left:0;width:100%;height:40px;border-radius:0;transform:none}.expanded[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{border-radius:0}.expanded[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{margin-right:16px}.expanded[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]     ss-icon i{font-size:28px}.expanded[_nghost-%COMP%]   .drawer[_ngcontent-%COMP%]{top:40px;width:100%;height:calc(100vh - 40px)}}.expanded[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{width:100%;border-bottom-right-radius:0;border-bottom-left-radius:0}.camera-enabled[_nghost-%COMP%]{background:var(--positive-60)}.camera-enabled[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{background:var(--positive-d2)}.private-pod[_nghost-%COMP%]{margin-right:10px;border:1px solid var(--container-2);background:none}.private-pod[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{background:none}.private-pod[_nghost-%COMP%]     .open-drawer-icon i{color:var(--contrast)}.private-pod.expanded[_nghost-%COMP%]{border:0;background:var(--accent-gradient)}.private-pod.private-group-minimized[_nghost-%COMP%]{background:var(--overlay)}.private-pod.private-group-minimized[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{background:var(--accent-blue)}.private-pod.private-group-minimized.camera-enabled[_nghost-%COMP%]{background:var(--positive-60)}.private-pod.private-group-minimized.camera-enabled[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{background:var(--positive-d2)}.public-pod[_nghost-%COMP%]{border:1px solid var(--container-2);background:none}.public-pod[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{background:none}.public-pod[_nghost-%COMP%]     .open-drawer-icon i{color:var(--contrast)}.public-pod.expanded[_nghost-%COMP%]{border:0;background:var(--blue-black)}ss-icon.open-drawer-icon[_ngcontent-%COMP%]{opacity:.4}ss-icon.open-drawer-icon[_ngcontent-%COMP%]:hover{opacity:1}.group-name[_ngcontent-%COMP%]{max-width:95px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:100%;border-radius:12px 8px 8px 12px;color:var(--contrast);background:var(--accent-blue)}.header[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:flex;align-items:center}.header[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{margin:0 6px 0 4px}.header[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:12px;height:12px;margin-right:6px;border-radius:50%;background-color:var(--negative)}.header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin-right:10px;font-family:Poppins,sans-serif;font-size:12px;font-weight:600;line-height:20px;text-transform:uppercase}@media only screen and (max-width: 1024px){.header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin-right:22px}}.header[_ngcontent-%COMP%]   .boost[_ngcontent-%COMP%]{width:20px;height:20px;padding:0;border:none;background:url(/assets/icons/boost-off.svg) center no-repeat}.header[_ngcontent-%COMP%]   .boost.active[_ngcontent-%COMP%]{background:url(/assets/icons/boost-on.svg) center no-repeat}.header[_ngcontent-%COMP%]   .boost.loading[_ngcontent-%COMP%]{background:none}.header[_ngcontent-%COMP%]   .boost.premium[_ngcontent-%COMP%]{background:url(/assets/icons/premium-boost-off.svg) center no-repeat}.header[_ngcontent-%COMP%]   .boost.premium.active[_ngcontent-%COMP%]{background:url(/assets/icons/premium-boost-on.svg) center no-repeat}.header[_ngcontent-%COMP%]   .audio-toggle-button[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .boost[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .share-screen-button[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .video-toggle-button[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .settings[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]   .privacy-settings-button[_ngcontent-%COMP%]{margin-right:10px}.header[_ngcontent-%COMP%]   .audio-toggle-button[_ngcontent-%COMP%]     button, .header[_ngcontent-%COMP%]   .boost[_ngcontent-%COMP%]     button, .header[_ngcontent-%COMP%]   .share-screen-button[_ngcontent-%COMP%]     button, .header[_ngcontent-%COMP%]   .video-toggle-button[_ngcontent-%COMP%]     button, .header[_ngcontent-%COMP%]   .settings[_ngcontent-%COMP%]     button, .header[_ngcontent-%COMP%]   .privacy-settings-button[_ngcontent-%COMP%]     button{height:auto;padding:0;background:none}.header[_ngcontent-%COMP%]   .audio-toggle-button[_ngcontent-%COMP%]     button.active ss-icon i, .header[_ngcontent-%COMP%]   .boost[_ngcontent-%COMP%]     button.active ss-icon i, .header[_ngcontent-%COMP%]   .share-screen-button[_ngcontent-%COMP%]     button.active ss-icon i, .header[_ngcontent-%COMP%]   .video-toggle-button[_ngcontent-%COMP%]     button.active ss-icon i, .header[_ngcontent-%COMP%]   .settings[_ngcontent-%COMP%]     button.active ss-icon i, .header[_ngcontent-%COMP%]   .privacy-settings-button[_ngcontent-%COMP%]     button.active ss-icon i{color:var(--contrast)}ss-icon[_ngcontent-%COMP%]{display:flex;height:100%;padding:0 5px}@media only screen and (max-width: 1024px){ss-icon[_ngcontent-%COMP%]{padding:0 10px}}.drawer[_ngcontent-%COMP%]{position:absolute;top:32px;left:0;z-index:5;display:flex;flex-direction:column;align-items:center;width:342px;padding:0 16px;border-bottom-right-radius:12px;border-bottom-left-radius:12px;box-shadow:var(--elevation-l1);background:var(--overlay)}@media only screen and (max-width: 767px){.drawer[_ngcontent-%COMP%]{width:80%}}.drawer[_ngcontent-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%]{width:100%!important;height:auto!important;margin-bottom:16px;border-top-left-radius:0;border-top-right-radius:0;background-color:var(--alt-60);aspect-ratio:16/9}.drawer[_ngcontent-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%]  video{border-top-left-radius:0;border-top-right-radius:0}.drawer[_ngcontent-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%]  .fb-border, .drawer[_ngcontent-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%]  .hover-top-menu, .drawer[_ngcontent-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%]  .pin-for-pin{display:none}.drawer[_ngcontent-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%]  .new-user-border{border-top-left-radius:0;border-top-right-radius:0}.jump-to-page-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;height:20px;margin:12px 0 8px;cursor:pointer}.jump-to-page-wrapper[_ngcontent-%COMP%]   .page-number[_ngcontent-%COMP%]{display:flex}.jump-to-page-wrapper[_ngcontent-%COMP%]   .page-number.current-page[_ngcontent-%COMP%]{cursor:initial}.jump-to-page-wrapper[_ngcontent-%COMP%]   .page-number.current-page[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{display:none}.jump-to-page-wrapper[_ngcontent-%COMP%]   .page-number[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{color:var(--accent-blue)}.tile-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;height:36px;padding:0 2px 0 7px;border-top-left-radius:12px;border-top-right-radius:12px;color:var(--contrast);background:var(--blue-black)}.tile-header[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{margin-left:8px;color:var(--contrast)}.right-group-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-right:6px}.right-group-buttons[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]:hover{opacity:.8}.right-group-buttons[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]     button{height:auto;padding:0}.right-group-buttons[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]     button ss-icon{margin-right:0}.test-camera-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:8px;font-weight:600}.test-camera-wrapper[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{cursor:pointer}.test-camera-wrapper[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:hover{opacity:.8}.test-camera-wrapper[_ngcontent-%COMP%]   ss-info-tooltip[_ngcontent-%COMP%]{position:relative;bottom:1px;margin-left:4px}ss-focus-room-status[_ngcontent-%COMP%]{width:100%;margin-bottom:12px}.spotify-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;height:28px;margin-bottom:12px}.spotify-wrapper[_ngcontent-%COMP%]   .toggle-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.spotify-wrapper[_ngcontent-%COMP%]   .toggle-wrapper[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin-right:8px}.spotify-wrapper[_ngcontent-%COMP%]   .toggle-wrapper[_ngcontent-%COMP%]     .mat-mdc-slide-toggle .mdc-form-field{display:flex;flex-direction:column-reverse}.spotify-wrapper[_ngcontent-%COMP%]   ss-upgrade-cta[_ngcontent-%COMP%]{margin-left:2px}"]});let n=r;return n})();function Il(n,r){if(n&1){let i=P();a(0,"ss-button",21),f("buttonClick",function(){_(i);let t=l(2);return C(t.showPrivatePodsModal())}),c()}if(n&2){let i=l(2);S("active",i.activeGroup),p("matTooltip",i.livekit.room.privateGroupMinimized&&i.activeGroup?"Back to space":"Private spaces")("iconOnly",!0)("iconVariant",20)}}function Fl(n,r){if(n&1&&b(0,"ss-video-pill-button",3),n&2){let i=l(2);p("buttonLocation",i.activeGroup?i.VideoPillButtonLocationRef.PrivatePod:i.VideoPillButtonLocationRef.FocusRoom)}}function Rl(n,r){if(n&1){let i=P();a(0,"ss-button",22),f("buttonClick",function(){_(i);let t=l(2);return C(t.toggleStatsForNerds())}),c()}if(n&2){let i=l(2);p("matTooltip",i.statsForNerdsVisible?"Hide stats for nerds":"Show stats for nerds")("active",i.statsForNerdsVisible)("iconName",i.statsForNerdsVisible?"bug":"bug_prohibited")("iconSize",28)("iconOnly",!0)}}function El(n,r){if(n&1&&(a(0,"div"),g(1),c()),n&2){let i=l(3);s(),R(i.livekit.room.displayName)}}function Ul(n,r){if(n&1&&(a(0,"div",5),u(1,El,2,1,"div"),b(2,"ss-paginator"),c()),n&2){let i=l(2);s(),h(i.settingsService.isB2BApp()?1:-1)}}function Vl(n,r){if(n&1){let i=P();a(0,"ss-button",23),f("buttonClick",function(){_(i);let t=l(2);return C(t.openFiltersPanel())}),g(1," Find Focus Buddies "),c()}if(n&2){let i=l(2);S("pulse",i.showNewUsersFilterPulse),p("iconSize",20)("iconVariant",20)}}function Al(n,r){if(n&1&&g(0),n&2){let i=l(3);O(" ",i.livekit.room.activeFilterCount," ")}}function Ll(n,r){if(n&1){let i=P();a(0,"ss-button",24),f("buttonClick",function(){_(i);let t=l(2);return C(t.openFiltersPanel())}),u(1,Al,1,1),c()}if(n&2){let i=l(2);p("active",i.livekit.room.anyFiltersSelectedOrSortChanged)("matTooltip",i.activeFilterTooltip)("iconVariant",20)("iconOnly",i.livekit.room.activeFilterCount===0),s(),h(i.livekit.room.activeFilterCount>0?1:-1)}}function Gl(n,r){if(n&1){let i=P();a(0,"ss-button",25),f("buttonClick",function(){_(i);let t=l(2);return C(t.toggleGreetingMode())}),c()}if(n&2){let i=l(2);p("active",i.livekit.room.greetingMode.active)("iconOnly",!0)("iconSize",24)("matTooltip",i.greetingModeTooltipText)("disabled",!i.livekit.room.greetingMode.enabled())("isLoading",i.livekit.room.greetingMode.loading)}}function Dl(n,r){if(n&1){let i=P();a(0,"ss-button",27),f("buttonClick",function(){_(i);let t=l(3);return C(t.showRoomChat())}),c()}if(n&2){let i=l(3);p("iconSize",24)("iconOnly",!0)("isLoading",i.roomChatLoading)}}function Bl(n,r){if(n&1&&u(0,Dl,1,3,"ss-button",26),n&2){let i=l(2);h(i.livekit.room.channelId&&!i.hideChatButton?0:-1)}}function Nl(n,r){if(n&1){let i=P();a(0,"ss-button",28),f("buttonClick",function(){_(i);let t=l(2);return C(t.restoreLostPins())}),c()}if(n&2){let i=l(2);p("iconSize",22)("iconVariant",24)("iconOnly",!0)("isLoading",i.restoringLostPins)}}function zl(n,r){n&1&&b(0,"ss-switch-room-view-button")}function jl(n,r){if(n&1&&(a(0,"span",15),g(1),c()),n&2){let i=r.$implicit;s(),O(" ",i," ")}}function Hl(n,r){if(n&1&&(a(0,"div",20),g(1),c()),n&2){let i=l(2);s(),Se(" ",i.anonymousParticipantCount," viewer",i.anonymousParticipantCount!==1?"s":""," ")}}function Wl(n,r){if(n&1){let i=P();a(0,"div",0)(1,"div",1),u(2,Il,1,5,"ss-button",2),u(3,Fl,1,1,"ss-video-pill-button",3),u(4,Rl,1,5,"ss-button",4),c(),u(5,Ul,3,1,"div",5),a(6,"div",6),u(7,Vl,2,4,"ss-button",7)(8,Ll,2,5,"ss-button",8),u(9,Gl,1,6,"ss-button",9),u(10,Bl,1,1),u(11,Nl,1,4,"ss-button",10),u(12,zl,1,0,"ss-switch-room-view-button"),a(13,"div",11)(14,"ss-button",12),f("buttonClick",function(){_(i);let t=l();return C(t.livekit.room.participantListVisibility=!0)}),a(15,"div",13),b(16,"ss-icon",14),V(17,jl,2,1,"span",15,je),c()(),a(19,"div",16)(20,"em"),g(21,"Participant Breakdown"),c(),a(22,"div"),b(23,"ss-icon",17),a(24,"div",18),g(25),c()(),a(26,"div"),b(27,"ss-icon",19),a(28,"div",18),g(29),c()(),u(30,Hl,2,2,"div",20),c()()()()}if(n&2){let i=l();s(2),h(i.allowOnlyGroupAudio&&(!i.isMobile||i.livekit.room.privateGroupMinimized)?2:-1),s(),h(i.activePredefinedGroup?-1:3),s(),h(i.isModerator?4:-1),s(),h(i.isMobile?-1:5),s(2),h(i.livekit.room.simpleFilter&&i.livekit.room.activeFilterCount===0?7:8),s(2),h(!i.isMobile&&i.livekit.room.greetingMode.qualifies&&!i.settingsService.isB2BApp()?9:-1),s(),h(i.isMobile?-1:10),s(),h(i.subscriptionService.isD0AndFree?-1:11),s(),h(!i.isMobile&&i.anyPinnedUsers?12:-1),s(2),p("active",i.participantListVisible),s(2),p("iconVariant",20)("size",20),s(),A(i.participantCountDigits),s(6),p("iconVariant",24)("size",24),s(2),O("",i.cameraOnParticipantCount," video on"),s(2),p("iconVariant",24)("size",24),s(2),Se("",i.cameraOffParticipantCount," other",i.cameraOffParticipantCount!==1?"s":""," online"),s(),h(i.anonymousParticipantCount>0?30:-1)}}var Lr=(()=>{let r=class r{get allowOnlyGroupAudio(){return this.livekit.room.allowOnlyGroupAudio}get hasActivePredefinedGroups(){return this.livekit.room.hasActivePredefinedGroups}get participantCountDigits(){let e=this.livekit.room.allParticipants.filter(t=>t.identity).length;return String(e).split("").map(Number)}get localParticipant(){return this.livekit.room.localParticipant}get displayedParticipants(){return this.livekit.room.displayedParticipants}get anonymousParticipantCount(){return this.livekit.room.allParticipants.filter(e=>e.anonymous).length}get cameraOffParticipantCount(){return this.livekit.room.allParticipants.filter(e=>!e.isCameraEnabled&&!e.anonymous).length}get cameraOnParticipantCount(){return this.livekit.room.allParticipants.filter(e=>e.identity&&e.isCameraEnabled).length}get anyPinnedUsers(){return this.livekit.room.pinnedParticipants.length>0}get statsForNerdsVisible(){return this.livekit.room.statsForNerdsVisible}get participantListVisible(){return this.livekit.room.participantListVisibility}get isModerator(){return!!this.livekit.room.localParticipant.userInfo?.isModerator}get newUsersOnly(){return this.livekit.room.filter.participantsWithNewMarkerOnly}get privatePodButtonText(){return this.livekit.room.groupMatch.waiting?`Searching...${this.livekit.room.groupMatch.timerValue??""}`:"Create a pod"}get podsButtonText(){return this.livekit.room.groupMatch.waiting?`Searching...${this.livekit.room.groupMatch.timerValue??""}`:"Create your own"}get greetingModeTooltipText(){return this.livekit.room.greetingMode.enabled()?this.livekit.room.greetingMode.active?"Deactivate greeting mode":"Activate greeting mode":"Your camera must be on to enter greeting mode"}get activeFilterTooltip(){let e=this.livekit.room.activeFilterCount;return e===0?"No active filters":`${e} active filter${e===1?"":"s"}`}get isProfessionalFilterActive(){return this.livekit.room.filter.selectedUserTypes.some(e=>e===Re.Professional)}constructor(e,t,o,d,v,k,T,B,z,ke,pe){this.livekit=e,this.settingsService=t,this.subscriptionService=o,this.accountModalsService=d,this.accountService=v,this.analyticsService=k,this.utilityService=T,this.channelService=B,this.toastService=z,this.dialog=ke,this.router=pe,this.activeGroup=null,this.activePredefinedGroup=null,this.isMobile=!1,this.isPhone=!1,this.roomChatLoading=!1,this.hideChatButton=!1,this.predefinedGroupsLoading=!1,this.podsMenuOpened=!1,this.restoringLostPins=!1,this.showNewUsersFilterPulse=!1,this.VideoPillButtonLocationRef=Ke,this.subscriptions=[]}ngOnInit(){return Y(this,null,function*(){this.showNewUsersFilterPulse=this.livekit.room.simpleFilter&&!localStorage.getItem(li),this.accountService.isFullyVerifiedUser()&&this.subscriptions.push(this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e),this.livekit.room.activePredefinedGroup.subscribe(e=>this.activePredefinedGroup=e))})}ngAfterViewInit(){setTimeout(()=>{this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>{this.isMobile=e,this.isMobile&&(this.livekit.room.roomChatVisibility=!1)}),this.utilityService.isPhone.subscribe(e=>this.isPhone=e))})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}showRoomChat(){this.livekit.room.channelId&&this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.roomChatLoading=!0,this.channelService.getChannelInfo(this.livekit.room.channelId).subscribe({next:e=>{e.isMember?(this.roomChatLoading=!1,this.livekit.room.participantListVisibility=!1,this.livekit.room.roomChatVisibility=!0):this.joinChannel()},error:e=>{this.hideChatButton=!0,this.handleErrors(e)}}))}toggleGreetingMode(){if(this.livekit.room.greetingMode.active){this.livekit.room.greetingMode.deactivate(!1),this.analyticsService.markActivity(y.LivekitGreetingModeDisabled);return}this.analyticsService.markActivity(y.LivekitGreetingModeButtonClick),this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Turn on greeting mode",description:"GreetingModePrompt",confirmButtonLabel:"Enable greeting mode",hideCancelButton:!0}}).afterClosed().subscribe(t=>{t&&(this.livekit.room.greetingMode.activate(),this.analyticsService.markActivity(y.LivekitGreetingModeEnabled))})}togglePredefinedGroups(){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.activePredefinedGroup?this.closePredefinedGroups():this.activeGroup&&!this.activeGroup.predefinedGroupId?this.leaveActiveGroups("LeavePrivatePodToBrowsePublicOnes","Leave",()=>{this.livekit.room.activeGroup.next(null),this.togglePredefinedGroups()}):this.showPredefinedGroups())}toggleStatsForNerds(){this.livekit.room.statsForNerdsVisible=!this.livekit.room.statsForNerdsVisible}openFiltersPanel(){this.anyPinnedUsers&&!this.livekit.room.forceGridView&&(this.livekit.room.forceGridView=!0,this.livekit.room.sortAndAssignDisplayedParticipants(),this.livekit.recalculateGrid.next());let e=this.livekit.room.simpleFilter?y.NewUserFindFocusBuddiesButtonClick:y.NormalFilterButtonClick;this.analyticsService.markActivity(e),this.livekit.room.animateViewToggleButton=!1,this.dialog.open(yr,{panelClass:"fullscreen-dialog",width:"600px"}).afterClosed().subscribe(()=>{this.livekit.room.simpleFilter&&!localStorage.getItem(li)&&(localStorage.setItem(li,"true"),this.showNewUsersFilterPulse=!1)})}showPodsModal(){if(this.accountModalsService.ensureUserCompletedBasicInfo()){if(this.utilityService.collapseEncouragements.next(),this.activeGroup===null){this.showCorrespondingGroupModal();return}this.activeGroup.predefinedGroupId?this.leaveActiveGroups("LeavePublicGroupToUsePrivatePods","Leave",()=>{this.livekit.room.predefinedGroupMaximized=!1,this.livekit.room.predefinedGroupInstances=[],this.livekit.room.activeGroup.next(null),this.livekit.room.activePredefinedGroup.next(null),this.showPodsModal()}):this.leaveActiveGroups("LeavePrivatePod","Leave & Join",()=>{this.livekit.room.activeGroup.next(null),this.showCorrespondingGroupModal()})}}showPrivatePodsModal(){if(this.accountModalsService.ensureUserCompletedBasicInfo()){if(this.livekit.room.privateGroupMinimized&&this.activeGroup){this.livekit.room.privateGroupMinimized=!1;return}this.dialog.open(Tr,{panelClass:"fullscreen-dialog",width:"410px"})}}toggleShowParticipantsWithNewMarkerOnly(){this.livekit.room.filter.participantsWithNewMarkerOnly=!this.livekit.room.filter.participantsWithNewMarkerOnly,this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next()}restoreLostPins(){if(this.accountModalsService.ensureUserCompletedBasicInfo()){if(!this.subscriptionService.hasPremiumFeatures){this.toastService.info({message:"This is a premium-only feature",paidFeatureText:"Get Premium to restore pins.",triggeredUpgradeFromSource:re.RestoreLostPins});return}this.restoringLostPins=!0,this.livekit.restoreRecentPins(this.livekit.room.name).subscribe({next:e=>{this.toastService.success({message:"Pins successfully restored based on availability. It might take up to 2 minutes for you to see them."}),e.length>0&&this.livekit.room.restorePinnedUsers(e),this.restoringLostPins=!1},error:e=>{this.restoringLostPins=!1;let t=e[0].errorCode;t==="ParticipantNotYetDetected"||t==="RateLimitOnRestoringPinsHit"?this.toastService.info({exceptionDetail:e[0]}):this.handleErrors(e)}})}}showPredefinedGroups(){this.predefinedGroupsLoading=!0,this.livekit.getPredefinedGroupsInstancesForSession(this.livekit.room.name).subscribe({next:e=>{if(this.livekit.room.predefinedGroupInstances=e,e.length===0){this.toastService.info({message:"No public pods defined for this room."});return}this.setActivePredefinedGroup(e[0])},error:e=>this.handleErrors(e)})}setActivePredefinedGroup(e){this.livekit.getSessionGroup(this.livekit.room.name,e.id,null).subscribe({next:t=>{this.predefinedGroupsLoading=!1,this.livekit.room.activePredefinedGroup.next(t)},error:t=>this.handleErrors(t)})}closePredefinedGroups(){this.activeGroup?this.leaveActiveGroups("LeavePublicGroup","Leave",()=>{this.livekit.room.predefinedGroupMaximized=!1,this.livekit.room.predefinedGroupInstances=[],this.livekit.room.activeGroup.next(null),this.livekit.room.activePredefinedGroup.next(null)}):(this.livekit.room.predefinedGroupMaximized=!1,this.livekit.room.predefinedGroupInstances=[],this.activePredefinedGroup&&this.livekit.unsubscribeFromSignalRPredefinedGroupUpdates(this.livekit.room.name,this.activePredefinedGroup.id).subscribe(),this.livekit.room.activePredefinedGroup.next(null))}leaveActiveGroups(e,t,o){this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:e,confirmButtonLabel:t}}).afterClosed().subscribe(v=>{v&&this.livekit.leaveActiveGroups(this.livekit.room.name,!0).subscribe({next:()=>o(),error:k=>this.handleErrors(k)})})}joinChannel(){this.livekit.room.channelId&&this.channelService.joinChannel(this.livekit.room.channelId).subscribe({next:()=>{this.roomChatLoading=!1,this.livekit.room.participantListVisibility=!1,this.livekit.room.roomChatVisibility=!0},error:e=>this.handleErrors(e)})}showCorrespondingGroupModal(){this.livekit.room.groupMatch.waiting?this.dialog.open(ji,{panelClass:"fullscreen-dialog",width:"480px"}):this.dialog.open(Ir,{panelClass:"fullscreen-dialog",width:"480px"})}handleErrors(e){this.roomChatLoading=!1,this.predefinedGroupsLoading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(X),m(_e),m(K),m(G),m(H),m(J),m(yo),m(F),m(N),m(bt))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-actions"]],standalone:!1,decls:1,vars:1,consts:[[1,"buttons-wrapper"],[1,"left-group"],["color","focus-room","iconName","inprivate_account",1,"pods-button",3,"matTooltip","iconOnly","active","iconVariant"],[3,"buttonLocation"],["color","focus-room",1,"stats-for-nerds",3,"matTooltip","active","iconName","iconSize","iconOnly"],[1,"paginator-wrapper"],[1,"right-group"],["color","focus-room","iconName","filter",1,"new-users-filter",3,"iconSize","iconVariant","pulse"],["color","focus-room","iconName","filter",1,"filter-button",3,"active","matTooltip","iconVariant","iconOnly"],["color","focus-room","iconName","handshake",1,"greeting-mode",3,"active","iconOnly","iconSize","matTooltip","disabled","isLoading"],["color","focus-room","matTooltip","Acquire recently lost pins","iconName","arrow_undo",1,"restore-pins",3,"iconSize","iconVariant","iconOnly","isLoading"],[1,"button-wrapper"],["matTooltip","Show participant list (and manage multi-pin)","matTooltipPosition","above","color","focus-room",1,"participant-list-button",3,"buttonClick","active"],[1,"participant-list-button-content"],["color","accent-blue-40","iconName","people",3,"iconVariant","size"],[1,"digit"],[1,"participant-breakdown"],["color","accent-blue-20","iconName","video",3,"iconVariant","size"],[1,"interactable"],["color","accent-blue-20","iconName","video_off",3,"iconVariant","size"],[1,"interactable","viewers"],["color","focus-room","iconName","inprivate_account",1,"pods-button",3,"buttonClick","matTooltip","iconOnly","iconVariant"],["color","focus-room",1,"stats-for-nerds",3,"buttonClick","matTooltip","active","iconName","iconSize","iconOnly"],["color","focus-room","iconName","filter",1,"new-users-filter",3,"buttonClick","iconSize","iconVariant"],["color","focus-room","iconName","filter",1,"filter-button",3,"buttonClick","active","matTooltip","iconVariant","iconOnly"],["color","focus-room","iconName","handshake",1,"greeting-mode",3,"buttonClick","active","iconOnly","iconSize","matTooltip","disabled","isLoading"],["matTooltip","Room chat","color","focus-room","iconName","chat_multiple",1,"room-chat-button",3,"iconSize","iconOnly","isLoading"],["matTooltip","Room chat","color","focus-room","iconName","chat_multiple",1,"room-chat-button",3,"buttonClick","iconSize","iconOnly","isLoading"],["color","focus-room","matTooltip","Acquire recently lost pins","iconName","arrow_undo",1,"restore-pins",3,"buttonClick","iconSize","iconVariant","iconOnly","isLoading"]],template:function(t,o){t&1&&u(0,Wl,31,20,"div",0),t&2&&h(o.localParticipant?0:-1)},dependencies:[I,w,L,Fr,Hi,Jt],styles:["[_nghost-%COMP%]{position:relative;display:block;height:52px}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{height:auto}}@media only screen and (max-height: 480px){[_nghost-%COMP%]{position:absolute;top:-55px;left:146px}}@media only screen and (max-height: 480px){[_nghost-%COMP%]   .safari[_nghost-%COMP%], .safari   [_nghost-%COMP%]{position:absolute;top:-48px;left:158px}}.paginator-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.paginator-wrapper[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-bottom:2px;font-size:13px;color:var(--default-40)}.buttons-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin:8px 0}@media only screen and (max-width: 1024px){.buttons-wrapper[_ngcontent-%COMP%]{margin:0}}@media only screen and (max-width: 767px){.buttons-wrapper[_ngcontent-%COMP%]{justify-content:space-around}}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%], .buttons-wrapper[_ngcontent-%COMP%]   .right-group[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}@media only screen and (max-width: 1024px){.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]{flex:initial;padding:6px 0;margin-bottom:0}}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{margin-right:8px}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   ss-button.highlighted[_ngcontent-%COMP%]{z-index:1002!important}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   ss-button.icon-only[_ngcontent-%COMP%]{width:44px}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button[_ngcontent-%COMP%]{flex-shrink:0}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button[_ngcontent-%COMP%]  button{background:var(--accent-gradient-80)}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button[_ngcontent-%COMP%]  button .ladda-label{flex-direction:row-reverse}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button[_ngcontent-%COMP%]  button ss-icon i{color:var(--default)}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button.active[_ngcontent-%COMP%]{animation:shakeX;animation-duration:1s;animation-delay:.5s}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button.active[_ngcontent-%COMP%]     button{color:var(--contrast);background:var(--positive-d2)}@media only screen and (max-width: 1024px){.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button[_ngcontent-%COMP%]{min-width:auto}}@media only screen and (max-width: 400px){.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .pods-button[_ngcontent-%COMP%]{display:none}}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .filter-button[_ngcontent-%COMP%], .buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .stats-for-nerds[_ngcontent-%COMP%]{width:44px}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .stats-for-nerds[_ngcontent-%COMP%]{margin-left:8px}@media only screen and (max-width: 600px){.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .stats-for-nerds[_ngcontent-%COMP%]{display:none}}.buttons-wrapper[_ngcontent-%COMP%]   .left-group[_ngcontent-%COMP%]   .focus-plus[_ngcontent-%COMP%]{min-width:116px}.buttons-wrapper[_ngcontent-%COMP%]   .button-wrapper[_ngcontent-%COMP%]{position:relative}.buttons-wrapper[_ngcontent-%COMP%]   .button-wrapper[_ngcontent-%COMP%]:hover   .participant-breakdown[_ngcontent-%COMP%]{display:block}@media only screen and (max-width: 1024px){.buttons-wrapper[_ngcontent-%COMP%]   .button-wrapper[_ngcontent-%COMP%]:hover   .participant-breakdown[_ngcontent-%COMP%]{display:none}}.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]{flex-shrink:0}@media only screen and (max-width: 767px){.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]{margin-left:0}.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]  .button-text{font-size:14px}}.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]   .participant-list-button-content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{position:relative;margin-right:6px}.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]  i{color:var(--accent-blue-40)}.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]     button:hover ss-icon i{color:var(--accent-blue)}.buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%]     button.active ss-icon i{color:var(--contrast)}.buttons-wrapper[_ngcontent-%COMP%]   .pinned-you-button[_ngcontent-%COMP%], .buttons-wrapper[_ngcontent-%COMP%]   .greeting-mode[_ngcontent-%COMP%], .buttons-wrapper[_ngcontent-%COMP%]   .participant-list-button[_ngcontent-%COMP%], .buttons-wrapper[_ngcontent-%COMP%]   .restore-pins[_ngcontent-%COMP%], .buttons-wrapper[_ngcontent-%COMP%]   .room-chat-button[_ngcontent-%COMP%]{margin-left:6px}.buttons-wrapper[_ngcontent-%COMP%]   .digit[_ngcontent-%COMP%]{display:inline-block;width:10px;text-align:center}.buttons-wrapper[_ngcontent-%COMP%]   .right-group[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.buttons-wrapper[_ngcontent-%COMP%]   .right-group[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]     button{padding:0 8px}@media only screen and (max-width: 1024px){.buttons-wrapper[_ngcontent-%COMP%]   .right-group[_ngcontent-%COMP%]{justify-content:flex-start;flex:initial}}.buttons-wrapper[_ngcontent-%COMP%]   .right-group[_ngcontent-%COMP%]   .new-users-filter[_ngcontent-%COMP%]{margin-right:6px}.buttons-wrapper[_ngcontent-%COMP%]   .right-group[_ngcontent-%COMP%]   .new-users-filter.pulse[_ngcontent-%COMP%]{animation:pulse 1.5s infinite}.buttons-wrapper[_ngcontent-%COMP%]   .right-group[_ngcontent-%COMP%]   .new-users-filter.pulse[_ngcontent-%COMP%]     button{border:1px solid var(--accent-blue)!important;outline:1px solid var(--accent-blurple)}.buttons-wrapper[_ngcontent-%COMP%]   .participant-breakdown[_ngcontent-%COMP%]{position:absolute;top:44px;right:0;z-index:10;display:none;width:180px;padding:12px 14px;border:1px solid var(--alt-20);border-radius:12px;background:var(--overlay)}.buttons-wrapper[_ngcontent-%COMP%]   .participant-breakdown[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{display:inline-block;margin-bottom:12px}.buttons-wrapper[_ngcontent-%COMP%]   .participant-breakdown[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:4px;font-size:14px}.buttons-wrapper[_ngcontent-%COMP%]   .participant-breakdown[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:8px}.buttons-wrapper[_ngcontent-%COMP%]   .participant-breakdown[_ngcontent-%COMP%]   .viewers[_ngcontent-%COMP%]{margin:10px 0 0;color:var(--default-40)}"]});let n=r;return n})();var Jl=(n,r,i,e,t)=>({id:n,name:r,iconUrl:i,earned:e,type:t});function ql(n,r){if(n&1&&b(0,"div",9),n&2){let i=l().$index,e=l(2);S("completed",e.isProgressBarCompleted(i))}}function Yl(n,r){if(n&1&&(a(0,"div",4),u(1,ql,1,2,"div",5),a(2,"ss-html-tooltip"),b(3,"ss-user-badge",6),a(4,"div",7),g(5),c(),b(6,"div",8),Te(7,"trustHtmlFull"),c()()),n&2){let i=r.$implicit,e=r.$index,t=l(2);S("completed",e===0||t.isStepCompleted(i.step)),s(),h(e>0?1:-1),s(2),p("badge",Pn(9,Jl,t.activationSteps[e].badge.id,t.activationSteps[e].badge.name,t.activationSteps[e].badge.iconUrl,t.isStepCompleted(i.step),t.activationSteps[e].badge.type))("size",40),s(2),R(i.label),s(),p("innerHTML",De(7,7,i.tooltipText),Ze)}}function Kl(n,r){if(n&1&&V(0,Yl,8,15,"div",3,je),n&2){let i=l();A(i.activationSteps)}}function Ql(n,r){n&1&&(a(0,"div",0)(1,"div",10),b(2,"ss-icon",11),c(),a(3,"div",7),g(4,"You did it! You've motivated others while working towards your own goals!"),c()()),n&2&&(s(2),p("size",14)("iconVariant",16))}var Gr=(()=>{let r=class r{get milestones(){return this.livekit.room.milestones}get allStepsFinished(){return this.milestones.pinnedSomeone&&this.milestones.encouragedSomeone&&this.milestones.hadVideoOn&&this.milestones.completedProfileSetup&&this.milestones.createdTileStatus&&this.milestones.had30MinSession}onListItemClick(e){e.target instanceof HTMLAnchorElement&&e.target.getAttribute("data-id")==="complete-profile-setup"&&this.editAdditionalProfileSettings()}constructor(e,t,o,d,v){this.livekit=e,this.dialog=t,this.accountService=o,this.badgeService=d,this.settingsService=v,this.hide=new ce,this.activationSteps=[{step:null,label:"Join",tooltipText:this.settingsService.isB2BApp()||this.settingsService.isCoWork()?"You've begun a co-working session inside this focus room. Check out the next steps and complete the whole activation flow to gain status within the room! \u{1F680}":"You've already completed the most important step by joining this focus room. Check out the next steps and complete the whole activation flow to gain status within the room! \u{1F680}",badge:{id:di.id,name:di.name,iconUrl:di.iconUrl,earned:this.isStepCompleted(null),type:wt.Milestone}},{step:"pinnedSomeone",label:"Pin someone",tooltipText:this.settingsService.isB2BApp()||this.settingsService.isCoWork()?"Want to zoom in on a particular co-worker and get the sense that you're working together? Pick out a group of up to 20 people to focus with by pinning their video tiles to your screen using the \u{1F4CC} icon on their video tile.":`Want to zoom in on a particular participant and study with them, or pick out a group of 4 people to work with? Pin their video tiles to your screen using the \u{1F4CC} icon on their video tile. <a href="https://www.studystream.live/blog/why-you-need-an-online-study-buddy/" target="_blank">Here's why you should</a>.`,badge:{id:pi.id,name:pi.name,iconUrl:pi.iconUrl,earned:this.isStepCompleted("pinnedSomeone"),type:wt.Milestone}},{step:"encouragedSomeone",label:"Encourage someone",tooltipText:"Sending encouragements can boost collaboration and rapport. If you see someone working hard, make their day by clicking the \u{1F44D} icon on their video tile.",badge:{id:mi.id,name:mi.name,iconUrl:mi.iconUrl,earned:this.isStepCompleted("encouragedSomeone"),type:wt.Milestone}},{step:"hadVideoOn",label:"Video on",tooltipText:this.settingsService.isB2BApp()||this.settingsService.isCoWork()?"Need some motivation to turn your camera on? There is science that shows working on camera with others increases accountability and reduces the likelihood of distractions. \u{1F3A5}":`Need some help turning your camera on? There is science behind putting your camera on and it won't be as hard as you think. <a href="https://www.studystream.live/blog/study-with-me-phenomenon/" target="_blank">Read our article here</a>. \u{1F3A5}`,badge:{id:ui.id,name:ui.name,iconUrl:ui.iconUrl,earned:this.isStepCompleted("hadVideoOn"),type:wt.Milestone}},{step:"createdTileStatus",label:"Write a tile message",tooltipText:this.settingsService.isB2BApp()||this.settingsService.isCoWork()?"Tell everyone else what's on your mind at the moment!":"Tell everyone else what you're up to at the moment!",badge:{id:hi.id,name:hi.name,iconUrl:hi.iconUrl,earned:this.isStepCompleted("createdTileStatus"),type:wt.Milestone}},{step:"completedProfileSetup",label:"Complete profile",tooltipText:'It will be much easier to connect with others if your profile is filled out. <a data-id="complete-profile-setup">Click here to edit.</a>',badge:{id:gi.id,name:gi.name,iconUrl:gi.iconUrl,earned:this.isStepCompleted("completedProfileSetup"),type:wt.Milestone}},{step:"had30MinSession",label:"Stay 30 minutes",tooltipText:this.settingsService.isB2BApp()||this.settingsService.isCoWork()?"Good things take time! Staying in the focus room for at least 30 minutes can improve your productivity and will also gain you a streak. Try to avoid task-switching and work on one task for at least half an hour at a time.":'Good things take time! Staying in the focus room for at least 30 minutes can improve your productivity and will also gain you a streak. Explore the science behind this strategy in <a href="https://www.studystream.live/blog/why-pomodoro-technique-works/" target="_blank">this article</a>.',badge:{id:fi.id,name:fi.name,iconUrl:fi.iconUrl,earned:this.isStepCompleted("had30MinSession"),type:wt.Milestone}}],this.subscriptions=[]}ngOnInit(){this.milestones.had30MinSession||(this.timerSubscription=W(0,6e4).subscribe(e=>{e<30||(this.milestones.had30MinSession||this.subscriptions.push(W(2e3).subscribe(()=>this.badgeService.checkForNewBadges.next())),this.milestones.had30MinSession=!0,this.timerSubscription.unsubscribe())}))}ngOnDestroy(){this.timerSubscription?.unsubscribe(),this.subscriptions.forEach(e=>e.unsubscribe())}close(){this.hide.emit()}isStepCompleted(e){return e===null?!0:this.milestones[e]===!0}isProgressBarCompleted(e){switch(e){case 1:return this.milestones.pinnedSomeone;case 2:return this.milestones.pinnedSomeone&&this.milestones.encouragedSomeone;case 3:return this.milestones.pinnedSomeone&&this.milestones.encouragedSomeone&&this.milestones.hadVideoOn;case 4:return this.milestones.pinnedSomeone&&this.milestones.encouragedSomeone&&this.milestones.hadVideoOn&&this.milestones.createdTileStatus;case 5:return this.milestones.pinnedSomeone&&this.milestones.encouragedSomeone&&this.milestones.hadVideoOn&&this.milestones.createdTileStatus&&this.milestones.completedProfileSetup;case 6:return this.milestones.pinnedSomeone&&this.milestones.encouragedSomeone&&this.milestones.hadVideoOn&&this.milestones.createdTileStatus&&this.milestones.completedProfileSetup&&this.milestones.had30MinSession;default:return!1}}editAdditionalProfileSettings(){this.dialog.open(Wt,{panelClass:"fullscreen-dialog",width:"600px",disableClose:!0}).afterClosed().subscribe(()=>{if(!this.livekit.room.milestones)return;let t=this.accountService.currentUser,o=!!t.countryId&&!!t.bio&&!!t.areaOfStudyId&&t.hasUserInterests;!this.livekit.room.milestones.completedProfileSetup&&o&&this.subscriptions.push(W(2e3).subscribe(()=>this.badgeService.checkForNewBadges.next())),this.livekit.room.milestones.completedProfileSetup=o})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(N),m(G),m(Qe),m(X))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-milestones-bar"]],hostBindings:function(t,o){t&1&&f("click",function(v){return o.onListItemClick(v)},et)},outputs:{hide:"hide"},standalone:!1,decls:4,vars:4,consts:[[1,"steps-finished"],[1,"close-modal",3,"click"],["iconName","dismiss","color","default-60",3,"size","iconVariant"],[1,"activation-step",3,"completed"],[1,"activation-step"],[1,"progress-bar",3,"completed"],[3,"badge","size"],[1,"label","notification"],["tooltip","",3,"innerHTML"],[1,"progress-bar"],[1,"icon"],["iconName","checkmark","color","contrast",3,"size","iconVariant"]],template:function(t,o){t&1&&(u(0,Kl,2,0),u(1,Ql,5,2,"div",0),a(2,"button",1),f("click",function(){return o.close()}),b(3,"ss-icon",2),c()),t&2&&(h(o.allStepsFinished?-1:0),s(),h(o.allStepsFinished?1:-1),s(2),p("size",16)("iconVariant",16))},dependencies:[ir,w,zt,Io],styles:["[_nghost-%COMP%]{display:flex;justify-content:space-between;align-items:center;height:32px;padding:8px 16px;margin-bottom:8px;border-radius:12px;background-color:var(--accent-blue-90)}ss-html-tooltip[_ngcontent-%COMP%]  .tooltip-wrapper{display:flex;align-items:center}.activation-step[_ngcontent-%COMP%]{display:flex;align-items:center;flex-grow:1}@media only screen and (max-width: 1024px){.activation-step[_ngcontent-%COMP%]{flex-grow:initial}}.activation-step[_ngcontent-%COMP%]:first-of-type{flex-grow:0}.activation-step[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{white-space:nowrap}.activation-step[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{width:100%;height:4px;margin:0 8px;border-radius:8px;background-color:var(--accent-blue-80)}.activation-step[_ngcontent-%COMP%]   .progress-bar.completed[_ngcontent-%COMP%]{background-color:var(--accent-blue-20)}@media only screen and (max-width: 1024px){.activation-step[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{display:none}}.activation-step.completed[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--accent-blue-20)}.icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-width:24px;width:24px;height:24px;margin-right:8px;border-radius:50%;background-color:var(--accent-blue-80)}.steps-finished[_ngcontent-%COMP%]{display:flex;align-items:center}.steps-finished[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background-color:var(--accent-blue-20)}ss-achievement-badge[_ngcontent-%COMP%]{position:relative;top:1px}.close-modal[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:0;margin-left:12px;border:none;outline:none;background-color:transparent;cursor:pointer}.notification[_ngcontent-%COMP%]{font-size:11px}@media only screen and (max-width: 1024px){.notification[_ngcontent-%COMP%]{font-size:11px}}ss-html-tooltip[_ngcontent-%COMP%]   ss-user-badge[_ngcontent-%COMP%]{margin-right:6px}@media only screen and (max-width: 1279px){ss-html-tooltip[_ngcontent-%COMP%]   ss-user-badge[_ngcontent-%COMP%]{margin-right:0}}"]});let n=r;return n})();var pn=ii(_i());var Zl=["videoElement"],ed=["userInfoElement"];function td(n,r){if(n&1&&b(0,"ss-user-avatar",1),n&2){let i=l();p("size",48)("avatarColor",i.participant.userInfo.avatarColor)("avatarThumbUrl",i.participant.userInfo.avatarThumbUrl)("showOnlineStatus",!1)("userId",i.participant.identity)("initials",i.participant.userInfo.initials)}}function id(n,r){if(n&1&&b(0,"ss-badge",7),n&2){let i=l(2);p("badge",i.participant.userInfo.userBadge)}}function nd(n,r){if(n&1&&(a(0,"div",5)(1,"div",6),u(2,id,1,1,"ss-badge",7),a(3,"div",8),g(4),c()(),a(5,"small"),g(6),c()()),n&2){let i=l();s(2),h(i.participant.userInfo.userBadge?2:-1),s(2),O(" ",i.participant.userInfo.displayName," "),s(2),R(i.participant.userInfo.areaOfStudyName)}}var Dr=(()=>{let r=class r{get selected(){return this.participant.selected}get isCameraOn(){return this.participant.isCameraEnabled}get isDarkTheme(){return this.theme===gt.Dark}constructor(e){this.livekit=e,this.retryModel={delay:500,interval:1e3,maxAttempts:10,timesRetried:1,stopRetries:new Gt},this.onTrackSubscribed=this.onTrackSubscribed.bind(this),this.onTrackPublished=this.onTrackPublished.bind(this),this.onLocalTrackPublished=this.onLocalTrackPublished.bind(this)}ngOnInit(){this.participant.on(U.TrackSubscribed,this.onTrackSubscribed).on(U.TrackPublished,this.onTrackPublished).on(U.LocalTrackPublished,this.onLocalTrackPublished)}ngAfterViewInit(){this.participant.isLocal?this.tryBindingActivePublication():(this.setVideoTracksSubscribedState(!0),W(this.retryModel.delay,this.retryModel.interval).pipe(Dt(this.retryModel.stopRetries)).subscribe(()=>this.retrySubscribingAndBinding()))}ngOnDestroy(){this.retryModel.stopRetries.next(),this.participant.off(U.TrackSubscribed,this.onTrackSubscribed).off(U.TrackPublished,this.onTrackPublished).off(U.LocalTrackPublished,this.onLocalTrackPublished)}retrySubscribingAndBinding(){(!this.participant.isCameraEnabled||this.retryModel.timesRetried===this.retryModel.maxAttempts)&&this.retryModel.stopRetries.next(),this.setVideoTracksSubscribedState(!0),this.tryBindingActivePublication(),this.retryModel.timesRetried++}setVideoTracksSubscribedState(e){this.participant.videoTrackPublications.forEach(t=>{t instanceof At&&t.setSubscribed(e)})}onTrackSubscribed(e,t){e.kind===j.Kind.Video&&this.tryToAttachVideoElement(t)}onTrackPublished(e){e.isSubscribed||this.setVideoTracksSubscribedState(!0)}onLocalTrackPublished(e){!e.track||e.track.kind!==j.Kind.Video||this.tryToAttachVideoElement(e)}tryBindingActivePublication(){let e=this.participant.getTrackPublications().find(t=>t.kind===j.Kind.Video&&t.isSubscribed);e&&this.tryToAttachVideoElement(e)}tryToAttachVideoElement(e){let t=e.track;if(!t)return;let o=this.videoElement.nativeElement;t.attachedElements.includes(o)||(t.attach(o),this.retryModel.stopRetries.next(),this.livekit.room.sortAndAssignDisplayedParticipants())}};r.\u0275fac=function(t){return new(t||r)(m(M))},r.\u0275cmp=x({type:r,selectors:[["ss-selectable-tile"]],viewQuery:function(t,o){if(t&1&&(Ae(Zl,5),Ae(ed,5)),t&2){let d;Le(d=Ge())&&(o.videoElement=d.first),Le(d=Ge())&&(o.userInfoElement=d.first)}},hostVars:2,hostBindings:function(t,o){t&2&&S("selected",o.selected)},inputs:{participant:"participant",theme:"theme",isMobile:"isMobile"},standalone:!1,decls:6,vars:4,consts:[["videoElement",""],["status","online",1,"avatar-placeholder",3,"size","avatarColor","avatarThumbUrl","showOnlineStatus","userId","initials"],["autoplay","","playsInline","",3,"poster"],[1,"selected-overlay"],["iconName","checkmark","color","contrast",3,"size"],[1,"user-info"],[1,"name-wrapper"],[3,"badge"],[1,"notification"]],template:function(t,o){t&1&&(u(0,td,1,6,"ss-user-avatar",1),b(1,"video",2,0),a(3,"div",3),b(4,"ss-icon",4),c(),u(5,nd,7,3,"div",5)),t&2&&(h(o.participant.userInfo&&!o.isCameraOn?0:-1),s(),p("poster",o.isDarkTheme?"/assets/images/poster-dark.jpg":"/assets/images/poster-light.png",Et),s(3),p("size",32),s(),h(o.participant.userInfo?5:-1))},dependencies:[w,Me,rt],styles:["[_nghost-%COMP%]{position:relative;display:block;max-width:176px;min-width:176px;background:var(--grayscale);cursor:pointer}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{box-shadow:none}[_nghost-%COMP%]:hover   video[_ngcontent-%COMP%]{box-shadow:none}}[_nghost-%COMP%]:hover   video[_ngcontent-%COMP%]{box-shadow:var(--effect-deep)}.selected[_nghost-%COMP%]   .selected-overlay[_ngcontent-%COMP%]{z-index:2;display:flex}.selected[_nghost-%COMP%]   video[_ngcontent-%COMP%]{position:relative}video[_ngcontent-%COMP%]{width:176px;aspect-ratio:16/9;border-radius:12px}.selected-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;display:none;justify-content:center;align-items:center;width:176px;border-radius:12px;background-color:var(--selected-tile-overlay);aspect-ratio:16/9}.avatar-placeholder[_ngcontent-%COMP%]{position:absolute;top:52px;left:50%;z-index:1;transform:translate(-50%,-50%)}.user-info[_ngcontent-%COMP%]{margin-top:8px}.user-info[_ngcontent-%COMP%]   .name-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:4px}.user-info[_ngcontent-%COMP%]   ss-badge[_ngcontent-%COMP%]{flex-shrink:0;margin-right:5px}.user-info[_ngcontent-%COMP%]   .notification[_ngcontent-%COMP%], .user-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:-webkit-box;overflow:hidden;word-break:break-all;text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}"]});let n=r;return n})();var Br=(n,r)=>r.identity;function rd(n,r){if(n&1){let i=P();a(0,"ss-button",7),f("buttonClick",function(){_(i);let t=l();return C(t.autoSelect())}),g(1," Autoselect "),c()}}function sd(n,r){if(n&1){let i=P();a(0,"ss-button",7),f("buttonClick",function(){_(i);let t=l();return C(t.start())}),g(1),c()}if(n&2){let i=l();s(),O(" Start (",i.selectedParticipants.length,") ")}}function ad(n,r){if(n&1){let i=P();a(0,"ss-selectable-tile",8),f("click",function(){let t=_(i).$implicit,o=l();return C(o.toggleTileSelection(t))}),c()}if(n&2){let i=r.$implicit,e=l();p("participant",i)("isMobile",e.isMobile)("theme",e.theme)}}function cd(n,r){if(n&1){let i=P();a(0,"ss-selectable-tile",8),f("click",function(){let t=_(i).$implicit,o=l();return C(o.toggleTileSelection(t))}),c()}if(n&2){let i=r.$implicit,e=l();p("participant",i)("isMobile",e.isMobile)("theme",e.theme)}}var Nr=(()=>{let r=class r{get remoteParticipants(){return this.livekit.room.allParticipants.filter(e=>!e.isLocal&&e.identity)}get selectedParticipants(){return this.mostViewedParticipants.filter(e=>e.selected).concat(this.similarParticipants.filter(e=>e.selected))}constructor(e,t,o,d,v){this.livekit=e,this.accountService=t,this.themeService=o,this.utilityService=d,this.analyticsService=v,this.mostViewedParticipants=[],this.similarParticipants=[],this.isMobile=!1,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.themeService.themeChange.subscribe(e=>this.theme=e),this.utilityService.isMobile.subscribe(e=>this.isMobile=e))}ngAfterViewInit(){setTimeout(()=>{this.mostViewedParticipants=this.getMostViewedParticipants(),this.similarParticipants=this.getSimilarFromRemainingParticipants()})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}start(){this.analyticsService.markActivity(y.LivekitFocusRoomOnboardingStart,{participantsSelected:this.selectedParticipants.length});for(let e of this.selectedParticipants)this.livekit.room.pin({participant:e});this.close()}autoSelect(){this.analyticsService.markActivity(y.LivekitFocusRoomOnboardingAutoselect);let e=this.mostViewedParticipants.splice(0,4);for(let t of e)this.livekit.room.pin({participant:t});this.close()}close(){this.analyticsService.markActivity(y.LivekitFocusRoomOnboardingSkip),this.livekit.room.focusRoomOnboardingShown=!1}toggleTileSelection(e){let t=!e.selected;t&&this.selectedParticipants.length===4||(e.selected=t)}getMostViewedParticipants(){return this.remoteParticipants.filter(e=>!e.isLocal).sort((0,pn.firstBy)(e=>e.isCameraEnabled,{direction:"desc"}).thenBy(e=>e.pinnedCount,{direction:"desc"})).slice(0,10)}getSimilarFromRemainingParticipants(){let e=this.accountService.currentUser,t=this.remoteParticipants.filter(d=>!d.isLocal&&!this.mostViewedParticipants.includes(d)).sort((0,pn.firstBy)(d=>d.isCameraEnabled,{direction:"desc"}).thenBy(d=>d.pinnedCount,{direction:"desc"}));if(e.areaOfStudyId){let d=t.filter(v=>v.userInfo.areaOfStudyId===e.areaOfStudyId);if(d.length>=10)return this.similarParticipantsTitle=`Other ${e.type===Re.Professional?"people working in":"students studying"} ${e.areaOfStudyName}`,d.slice(0,10)}if(e.countryId){let d=t.filter(v=>v.userInfo.countryId===e.countryId);if(d.length>=10)return this.similarParticipantsTitle=`Other people from ${e.countryName}`,d.slice(0,10)}if(!e.type)return[];let o=t.filter(d=>d.userInfo.type===e.type);return this.similarParticipantsTitle=`Other ${e.type===Re.PreUniStudent?"Pre-Uni Students":e.type===Re.UniStudent?"Uni Students":"Professionals"}`,o.slice(0,10)}};r.\u0275fac=function(t){return new(t||r)(m(M),m(G),m(nt),m(J),m(H))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-onboarding"]],standalone:!1,decls:23,vars:3,consts:[[1,"header"],[1,"title"],[1,"actions-wrapper"],["color","tertiary",3,"buttonClick"],[1,"suggested-users"],[1,"horizontal-grid"],[3,"participant","isMobile","theme"],[3,"buttonClick"],[3,"click","participant","isMobile","theme"]],template:function(t,o){t&1&&(a(0,"section",0)(1,"div",1)(2,"h2"),g(3,"Who would you like to see while you study? Up to 4!"),c(),a(4,"small"),g(5,"Click on up to 4 others below to watch them while you get your work done!"),c()(),a(6,"div",2)(7,"ss-button",3),f("buttonClick",function(){return o.close()}),g(8," Skip "),c(),u(9,rd,2,0,"ss-button"),u(10,sd,2,1,"ss-button"),c()(),a(11,"section",4)(12,"h3"),g(13,"Most viewed users"),c(),a(14,"div",5),V(15,ad,1,3,"ss-selectable-tile",6,Br),c()(),a(17,"section",4)(18,"h3"),g(19),c(),a(20,"div",5),V(21,cd,1,3,"ss-selectable-tile",6,Br),c()()),t&2&&(s(9),h(o.selectedParticipants.length===0?9:-1),s(),h(o.selectedParticipants.length>0?10:-1),s(5),A(o.mostViewedParticipants),s(4),R(o.similarParticipantsTitle),s(2),A(o.similarParticipants))},dependencies:[I,Dr],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%;padding-bottom:36px;background-color:var(--grayscale);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){[_nghost-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}[_nghost-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}[_nghost-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:40px 48px 28px}@media only screen and (max-width: 767px){.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;padding:20px 28px}.header[_ngcontent-%COMP%]   .actions-wrapper[_ngcontent-%COMP%]{margin-top:12px}}.actions-wrapper[_ngcontent-%COMP%]{display:flex;flex-shrink:0}.actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{margin-right:4px}.actions-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]:last-of-type{margin-right:0}.suggested-users[_ngcontent-%COMP%]{margin-bottom:24px}.suggested-users[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{padding:0 48px;margin-bottom:18px}@media only screen and (max-width: 767px){.suggested-users[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{padding:0 28px}}.horizontal-grid[_ngcontent-%COMP%]{display:flex;width:100%;padding-bottom:8px;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.horizontal-grid[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.horizontal-grid[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.horizontal-grid[_ngcontent-%COMP%]::-webkit-scrollbar, .horizontal-grid[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.horizontal-grid[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.horizontal-grid[_ngcontent-%COMP%]   ss-selectable-tile[_ngcontent-%COMP%]{margin-right:8px}.horizontal-grid[_ngcontent-%COMP%]   ss-selectable-tile[_ngcontent-%COMP%]:first-of-type{margin-left:48px}@media only screen and (max-width: 767px){.horizontal-grid[_ngcontent-%COMP%]   ss-selectable-tile[_ngcontent-%COMP%]:first-of-type{margin-left:28px}}.horizontal-grid[_ngcontent-%COMP%]   ss-selectable-tile[_ngcontent-%COMP%]:last-of-type{margin-right:48px}@media only screen and (max-width: 767px){.horizontal-grid[_ngcontent-%COMP%]   ss-selectable-tile[_ngcontent-%COMP%]:last-of-type{margin-right:28px}}"]});let n=r;return n})();function dd(n,r){n&1&&(b(0,"ss-icon",1),a(1,"em"),g(2,"Sit here"),c()),n&2&&p("size",28)("iconVariant",28)}function pd(n,r){n&1&&b(0,"mat-spinner",0)}var zr=(()=>{let r=class r{constructor(){this.loading=!1}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=x({type:r,selectors:[["ss-empty-seat"]],inputs:{loading:"loading"},standalone:!1,decls:2,vars:2,consts:[["diameter","30","strokeWidth","3"],["iconName","add","color","contrast",3,"size","iconVariant"]],template:function(t,o){t&1&&(u(0,dd,3,2),u(1,pd,1,0,"mat-spinner",0)),t&2&&(h(o.loading?-1:0),s(),h(o.loading?1:-1))},dependencies:[w,ve],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:auto;margin-bottom:4px;border-radius:8px;background:var(--grayscale-dark);aspect-ratio:16/9;cursor:pointer;opacity:.8}[_nghost-%COMP%]:hover{opacity:1}ss-icon[_ngcontent-%COMP%]{margin-bottom:3px}em[_ngcontent-%COMP%]{color:var(--contrast)}"]});let n=r;return n})();var Wi=(()=>{let r=class r{constructor(e,t){this.livekit=e,this.elementRef=t,this.subscriptions=[],this.activeGroup=null,this.onTrackSubscribed=this.onTrackSubscribed.bind(this),this.onTrackUnsubscribed=this.onTrackUnsubscribed.bind(this),this.onTrackPublished=this.onTrackPublished.bind(this),this.onTrackUnpublished=this.onTrackUnpublished.bind(this)}ngAfterViewInit(){this.subscriptions.push(this.livekit.room.activeGroup.subscribe(e=>{this.activeGroup=e,this.handleAudioSubscriptions()}),this.livekit.room.unhiddenParticipant.subscribe(e=>this.subscribeToAudioTrackEvents(e)),this.livekit.room.audioUnsubscribe.subscribe(e=>this.unsubscribeFromAudioTrackEvents(e)))}ngOnDestroy(){let e=Array.from(this.livekit.room.remoteParticipants.values());for(let t of e)this.unsubscribeFromAudioTrackEvents(t)}handleAudioSubscriptions(){let e=this.activeGroup!==null?this.activeGroup.members.map(o=>o.id):[],t=Array.from(this.livekit.room.remoteParticipants.values());for(let o of t)e.includes(o.identity)?this.subscribeToAudioTrackEvents(o):this.unsubscribeFromAudioTrackEvents(o)}subscribeToAudioTrackEvents(e){e.on(U.TrackSubscribed,this.onTrackSubscribed).on(U.TrackUnsubscribed,this.onTrackUnsubscribed).on(U.TrackPublished,this.onTrackPublished).on(U.TrackUnpublished,this.onTrackUnpublished),setTimeout(()=>this.setAudioTrackSubscribedState(e,!0),1e3)}unsubscribeFromAudioTrackEvents(e){setTimeout(()=>this.setAudioTrackSubscribedState(e,!1)),e.off(U.TrackSubscribed,this.onTrackSubscribed).off(U.TrackUnsubscribed,this.onTrackUnsubscribed).off(U.TrackPublished,this.onTrackPublished).off(U.TrackUnpublished,this.onTrackUnpublished),this.removeAllParticipantAudioElements(e.identity)}onTrackSubscribed(e,t){e.kind===j.Kind.Audio&&this.tryToAttachAudioElement(t)}onTrackUnsubscribed(e,t){e.kind===j.Kind.Audio&&this.removeAudioElement(t.trackSid)}onTrackPublished(e){e.isSubscribed||e.kind!==j.Kind.Audio||e.setSubscribed(!0)}onTrackUnpublished(e){!e.isSubscribed||e.kind!==j.Kind.Audio||e.setSubscribed(!1)}setAudioTrackSubscribedState(e,t){e.audioTrackPublications.forEach(o=>{o.setSubscribed(t)})}tryToAttachAudioElement(e){let t=e.track;if(!t)return;let o=this.elementRef.nativeElement,d=`audio-${e.trackSid}`,v=o.querySelector(`#${d}`);if(v===null){v=document.createElement("audio"),v.id=d,v.hidden=!0;let T=Array.from(this.livekit.room.remoteParticipants.values()).find(B=>Array.from(B.trackPublications.values()).some(z=>z.trackSid===e.trackSid));T&&(v.className=`audio-${T.identity}`),o.appendChild(v)}else if(t.attachedElements.includes(v))return;t.attach(v)}removeAllParticipantAudioElements(e){let t=this.elementRef.nativeElement;Array.from(t.querySelectorAll(`audio.audio-${e}`)).forEach(d=>{t.removeChild(d)})}removeAudioElement(e){let t=this.elementRef.nativeElement,o=t.querySelector(`#audio-${e}`);o&&t.removeChild(o)}};r.\u0275fac=function(t){return new(t||r)(m(M),m(ze))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-group-session-audio"]],standalone:!1,decls:0,vars:0,template:function(t,o){},encapsulation:2});let n=r;return n})();function ud(n,r){if(n&1){let i=P();a(0,"ss-icon",8),f("click",function(){_(i);let t=l();return C(t.closePredefinedGroups())}),c()}n&2&&p("size",20)("iconVariant",20)}function hd(n,r){if(n&1){let i=P();a(0,"ss-button-small",9),f("buttonClick",function(){_(i);let t=l();return C(t.leave())}),g(1," Leave "),c()}if(n&2){let i=l();p("isLoading",i.leaveLoading)("color",i.ButtonColorRef.Negative)}}function gd(n,r){if(n&1){let i=P();a(0,"div",10),g(1," Viewing "),a(2,"em"),g(3),c()(),a(4,"div",11)(5,"ss-button",12),f("buttonClick",function(){_(i);let t=l();return C(t.goToPreviousGroup())}),c(),a(6,"ss-button",13),f("buttonClick",function(){_(i);let t=l();return C(t.goToNextGroup())}),c()()}if(n&2){let i=l();p("matTooltip",i.activePredefinedGroup.predefinedGroupName||""),s(3),Se("",i.activePredefinedGroup.predefinedGroupName," ",i.participantCounts),s(2),p("iconOnly",!0)("isLoading",i.previousGroupLoading)("disabled",!i.previousGroupExists||i.joinLoading)("iconSize",24),s(),p("iconOnly",!0)("isLoading",i.nextGroupLoading)("disabled",!i.nextGroupExists||i.joinLoading)("iconSize",24)}}function fd(n,r){if(n&1){let i=P();a(0,"div",10),g(1),c(),a(2,"ss-button",14),f("buttonClick",function(){_(i);let t=l();return C(t.togglePredefinedGroupsMaximizedView())}),c()}if(n&2){let i=l();p("matTooltip",i.activePredefinedGroup.predefinedGroupName||""),s(),O(" You are in ",i.activePredefinedGroup.predefinedGroupName," "),s(),p("matTooltip",i.livekit.room.predefinedGroupMaximized?"Minimize":"Maximize")("iconName",i.livekit.room.predefinedGroupMaximized?"contract_down_left":"resize_large")("iconSize",24)("iconOnly",!0)}}function vd(n,r){if(n&1&&b(0,"ss-focus-room-tile",15),n&2){let i=l().$implicit,e=l();p("participant",i.participant)("isMobile",e.isMobile)("theme",e.theme)("isGroupTile",!0)}}function _d(n,r){if(n&1){let i=P();a(0,"ss-empty-seat",17),f("click",function(){_(i);let t=l().$implicit,o=l();return C(o.join(t))}),c()}if(n&2){let i=l().$implicit;p("loading",i.loading)}}function Cd(n,r){if(n&1&&u(0,vd,1,4,"ss-focus-room-tile",15)(1,_d,1,1,"ss-empty-seat",16),n&2){let i=r.$implicit;h(i.participant?0:1)}}function bd(n,r){if(n&1&&(a(0,"div",18)(1,"p"),g(2,"activePredefinedGroup:"),c(),a(3,"pre"),g(4),Te(5,"json"),c()(),a(6,"div",18)(7,"p"),g(8,"activeGroup:"),c(),a(9,"pre"),g(10),Te(11,"json"),c()(),a(12,"div",18)(13,"p"),g(14,"currentUserJoined:"),c(),a(15,"pre"),g(16),c()()),n&2){let i=l();s(4),R(De(5,3,i.activePredefinedGroup)),s(6),R(De(11,5,i.activeGroup)),s(6),R(i.currentUserJoined)}}function Pd(n,r){n&1&&b(0,"ss-focus-room-group-session-audio")}var Hr=(()=>{let r=class r{get maximized(){return this.livekit.room.predefinedGroupMaximized}get localParticipant(){return this.livekit.room.localParticipant}get currentUserJoined(){return this.activeGroup!==null&&this.livekit.room.activePredefinedGroupParticipants.some(e=>e.participant?.identity===this.livekit.room.localParticipant.identity)}get currentGroupIndex(){return this.livekit.room.predefinedGroupInstances.findIndex(e=>e.predefinedGroupId===this.activePredefinedGroup.predefinedGroupId)}get previousGroupExists(){return this.currentGroupIndex>0}get nextGroupExists(){return this.currentGroupIndex<this.livekit.room.predefinedGroupInstances.length-1}get participantCounts(){let e=this.livekit.room.activePredefinedGroupParticipants.filter(t=>t.participant!==null);return`(${e?e.length:0}/${this.activePredefinedGroup.predefinedGroupMaxSeats})`}constructor(e,t,o,d,v){this.livekit=e,this.dialog=t,this.toastService=o,this.translateService=d,this.utilityService=v,this.VideoPillButtonLocationRef=Ke,this.ButtonColorRef=He,this.isMobile=!1,this.leaveLoading=!1,this.joinLoading=!1,this.nextGroupLoading=!1,this.previousGroupLoading=!1,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e),this.livekit.room.activePredefinedGroup.subscribe(e=>{e&&(this.activePredefinedGroup=e)}))}ngAfterViewInit(){this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>{this.isMobile=e,this.isMobile&&(this.livekit.room.predefinedGroupMaximized=!1)}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.localParticipant.setMicrophoneEnabled(!1)}join(e){e.loading=!0,this.joinLoading=!0;let t={seatNumber:e.seatNumber};this.livekit.joinPublicGroup(this.livekit.room.name,this.activePredefinedGroup.id,t).subscribe({next:()=>{e.loading=!1,this.joinLoading=!1,this.livekit.room.predefinedGroupMaximized=!1},error:o=>Y(this,null,function*(){if(e.loading=!1,o[0].errorCode==="LivekitRoomPredefinedGroupSeatIsTakenOrAlreadyJoined"){let d=`LivekitRoomPredefinedGroup${this.currentUserJoined?"AlreadyJoined":"SeatIsTaken"}`,v=yield ni(this.translateService.get(`errors.${d}`));this.toastService.info({message:v});return}this.handleErrors(o)})})}leave(){this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"LeavePublicGroup",confirmButtonLabel:"Yes"}}).afterClosed().subscribe(t=>{t&&(this.leaveLoading=!0,this.livekit.leaveActiveGroups(this.livekit.room.name).subscribe({next:()=>{this.localParticipant.setMicrophoneEnabled(!1),this.livekit.room.predefinedGroupMaximized=!1,this.leaveLoading=!1},error:o=>this.handleErrors(o)}))})}goToPreviousGroup(){if(this.nextGroupLoading||this.joinLoading||this.currentGroupIndex===0)return;this.previousGroupLoading=!0;let e=this.livekit.room.predefinedGroupInstances[this.currentGroupIndex-1];this.setActivePredefinedGroup(e)}goToNextGroup(){if(this.previousGroupLoading||this.joinLoading||this.currentGroupIndex===this.livekit.room.predefinedGroupInstances.length-1)return;this.nextGroupLoading=!0;let e=this.livekit.room.predefinedGroupInstances[this.currentGroupIndex+1];this.setActivePredefinedGroup(e)}togglePredefinedGroupsMaximizedView(){this.livekit.room.predefinedGroupMaximized=!this.livekit.room.predefinedGroupMaximized}closePredefinedGroups(){this.livekit.room.predefinedGroupMaximized=!1,this.livekit.room.predefinedGroupInstances=[],this.livekit.room.activePredefinedGroup.next(null)}setActivePredefinedGroup(e){let t=this.activePredefinedGroup.id;this.livekit.getSessionGroup(this.livekit.room.name,e.id,t).subscribe({next:o=>{this.nextGroupLoading=!1,this.previousGroupLoading=!1,this.livekit.room.activePredefinedGroup.next(o)},error:o=>this.handleErrors(o)})}handleErrors(e){this.joinLoading=!1,this.leaveLoading=!1,this.nextGroupLoading=!1,this.previousGroupLoading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(N),m(F),m(si),m(J))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-predefined-groups"]],hostVars:2,hostBindings:function(t,o){t&2&&S("maximized",o.maximized)},inputs:{theme:"theme"},standalone:!1,decls:14,vars:9,consts:[[1,"menu"],[1,"top-row"],[3,"buttonLocation"],["iconName","dismiss","role","button","color","contrast",3,"size","iconVariant"],[3,"isLoading","color"],[1,"bottom-row"],[1,"group-tiles-wrapper"],[1,"group-tiles-inner-wrapper"],["iconName","dismiss","role","button","color","contrast",3,"click","size","iconVariant"],[3,"buttonClick","isLoading","color"],[1,"room-name",3,"matTooltip"],[1,"paginator"],["iconName","arrow_left","color","website-transparent","matTooltip","Previous",3,"buttonClick","iconOnly","isLoading","disabled","iconSize"],["iconName","arrow_right","matTooltip","Next","color","website-transparent",3,"buttonClick","iconOnly","isLoading","disabled","iconSize"],["color","website-transparent",1,"maximize-button",3,"buttonClick","matTooltip","iconName","iconSize","iconOnly"],[3,"participant","isMobile","theme","isGroupTile"],[3,"loading"],[3,"click","loading"],[1,"printout"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"div",1),b(2,"ss-video-pill-button",2),u(3,ud,1,2,"ss-icon",3),u(4,hd,2,2,"ss-button-small",4),c(),a(5,"div",5),u(6,gd,7,11),u(7,fd,3,6),c()(),a(8,"div",6)(9,"div",7),V(10,Cd,2,1,null,null,je),u(12,bd,17,7),c()(),u(13,Pd,1,0,"ss-focus-room-group-session-audio")),t&2&&(s(),S("no-padding",o.currentUserJoined),s(),p("buttonLocation",o.currentUserJoined?o.VideoPillButtonLocationRef.PublicPod:o.VideoPillButtonLocationRef.FocusRoom),s(),h(o.currentUserJoined?-1:3),s(),h(o.currentUserJoined?4:-1),s(2),h(o.currentUserJoined?-1:6),s(),h(o.currentUserJoined?7:-1),s(3),A(o.livekit.room.activePredefinedGroupParticipants),s(2),h(o.livekit.room.statsForNerdsVisible?12:-1),s(),h(o.currentUserJoined?13:-1))},dependencies:[I,w,Ce,L,ut,Wi,zr,Jt,xn],styles:["[_nghost-%COMP%]{display:block;min-width:356px;width:25vw;height:calc(100vh - 56px);overflow:hidden;padding:3px;margin-right:5px;border-top-left-radius:12px;border-top-right-radius:12px;background:var(--overlay-dark)}.maximized[_nghost-%COMP%]{width:calc(100vw - 79px)}.maximized[_nghost-%COMP%]   .group-tiles-inner-wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;grid-gap:5px}@media only screen and (max-width: 767px){.maximized[_nghost-%COMP%]   .group-tiles-inner-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media only screen and (max-width: 479px){.maximized[_nghost-%COMP%]   .group-tiles-inner-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{width:100%;margin:0 0 5px}}[_nghost-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%] {width:100%!important;height:auto!important;aspect-ratio:16/9;margin-bottom:4px}.group-tiles-wrapper[_ngcontent-%COMP%]{height:calc(100% - 80px);overflow:auto;overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.group-tiles-wrapper[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.group-tiles-wrapper[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.group-tiles-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar, .group-tiles-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.group-tiles-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.room-name[_ngcontent-%COMP%]{display:-webkit-box;align-items:center;overflow:hidden;line-height:28px;color:var(--contrast);word-break:break-all;text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}.room-name[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{color:var(--contrast)}.menu[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:center;margin:3px 8px;color:var(--contrast)}.menu[_ngcontent-%COMP%]   .top-row[_ngcontent-%COMP%], .menu[_ngcontent-%COMP%]   .bottom-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.menu[_ngcontent-%COMP%]   .top-row[_ngcontent-%COMP%]{height:42px}.menu[_ngcontent-%COMP%]   .top-row.no-padding[_ngcontent-%COMP%]{padding:0}.menu[_ngcontent-%COMP%]   .bottom-row[_ngcontent-%COMP%]{height:32px}@media only screen and (max-width: 1024px){.menu[_ngcontent-%COMP%]   .maximize-button[_ngcontent-%COMP%]{display:none}}.menu[_ngcontent-%COMP%]   .paginator[_ngcontent-%COMP%]{display:flex;flex-shrink:0}.menu[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]  button{width:28px;height:28px}.printout[_ngcontent-%COMP%]{padding:4px;margin-top:12px;margin-bottom:12px;border:1px solid var(--negative);font-size:10px;color:var(--contrast);background:var(--grayscale-dark)}.printout[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-weight:600}.light-theme[_nghost-%COMP%]   ss-video-pill-button.focus-room[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   ss-video-pill-button.focus-room[_ngcontent-%COMP%]{background:var(--alt-dark)}.light-theme[_nghost-%COMP%]   ss-video-pill-button.focus-room.camera-enabled[_ngcontent-%COMP%]    , .light-theme   [_nghost-%COMP%]   ss-video-pill-button.focus-room.camera-enabled[_ngcontent-%COMP%]    {background:var(--positive-60-dark)}.light-theme[_nghost-%COMP%]   ss-video-pill-button.focus-room.camera-enabled[_ngcontent-%COMP%]     .header, .light-theme   [_nghost-%COMP%]   ss-video-pill-button.focus-room.camera-enabled[_ngcontent-%COMP%]     .header{background:var(--positive-d2)}.light-theme[_nghost-%COMP%]   ss-video-pill-button.focus-room[_ngcontent-%COMP%]     .header, .light-theme   [_nghost-%COMP%]   ss-video-pill-button.focus-room[_ngcontent-%COMP%]     .header{background:var(--accent-blue-dark)}.light-theme[_nghost-%COMP%]   ss-video-pill-button.focus-room[_ngcontent-%COMP%]     .open-drawer-icon i, .light-theme   [_nghost-%COMP%]   ss-video-pill-button.focus-room[_ngcontent-%COMP%]     .open-drawer-icon i{color:var(--default-dark)}"]});let n=r;return n})();var xd=(n,r)=>r.identity;function yd(n,r){if(n&1){let i=P();a(0,"mat-slide-toggle",14),f("change",function(t){_(i);let o=l(2);return C(o.showConfirmationModal(t))}),a(1,"span",15),g(2,"Show space on video tile and allow others to join"),c(),a(3,"span",16),g(4,"Show on my video tile"),c(),b(5,"ss-icon",17),c()}if(n&2){let i=l(2);S("disabled",i.activeGroup.shownOnVideoTile),p("matTooltip",i.activeGroup.shownOnVideoTile?"To remove this space from your video tile, close it and re-open it again.":"")("disabled",i.activeGroup.shownOnVideoTile)("checked",i.activeGroup.shownOnVideoTile),s(5),p("size",28)}}function Sd(n,r){if(n&1){let i=P();u(0,yd,6,6,"mat-slide-toggle",12),a(1,"ss-button",13),f("buttonClick",function(){_(i);let t=l();return C(t.copyInviteLinkToClipboard())}),c()}if(n&2){let i=l();h(i.isActiveGroupOwner&&i.activeGroup?0:-1),s(),p("iconSize",28)("iconOnly",!0)}}function Md(n,r){if(n&1){let i=P();a(0,"ss-button",18),f("buttonClick",function(){_(i);let t=l();return C(t.minimizePrivateGroup())}),c()}n&2&&p("iconSize",28)("iconOnly",!0)}function wd(n,r){if(n&1&&b(0,"ss-focus-room-tile",8),n&2){let i=r.$implicit,e=l();p("participant",i)("isMobile",e.isMobile)("theme",e.theme)("isGroupTile",!0)}}function Od(n,r){if(n&1){let i=P();a(0,"div",11)(1,"small"),g(2),a(3,"a",10),f("click",function(){_(i);let t=l();return C(t.inviteOriginalInviterBack(t.activeGroup.invitedByUser))}),g(4,"Invite back"),c()(),a(5,"ss-icon",19),f("click",function(){_(i);let t=l();return C(t.shouldShowReinviteMessage=!1)}),c()()}if(n&2){let i=l();s(2),O("",i.activeGroup.invitedByUser.displayName," invited you to this space but they left. "),s(3),p("size",16)("iconVariant",16)}}var Wr=(()=>{let r=class r{get isFocusSession(){return this.activeGroup&&this.activeGroup.focusSessionId}get localParticipant(){return this.livekit.room.localParticipant}get isActiveGroupOwner(){return this.activeGroup?.createdByUserId===this.accountService.currentUser.id}constructor(e,t,o,d,v,k,T){this.livekit=e,this.dialog=t,this.clipboard=o,this.analyticsService=d,this.accountService=v,this.subscriptionService=k,this.toastService=T,this.VideoPillButtonLocationRef=Ke,this.isMobile=!1,this.shouldShowReinviteMessage=!1,this.activeGroup=null,this.stopTimer=new Gt,this.subscriptions=[]}ngAfterViewInit(){this.subscriptions.push(this.livekit.room.activeGroup.subscribe(e=>{setTimeout(()=>{let t=this.activeGroup===null;if(this.activeGroup=e,t&&e&&e.invitedByUser){let o=e.members.some(d=>d.id===e.invitedByUser?.id);setTimeout(()=>this.shouldShowReinviteMessage=!o)}this.setSessionEndTimer()})}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.stopTimer.next(),!this.livekit.room.privateGroupMinimized&&this.localParticipant.setMicrophoneEnabled(!1)}showGroupInviteModal(){this.dialog.open($t,{panelClass:"fullscreen-dialog",width:"640px"})}minimizePrivateGroup(){this.livekit.room.animateViewToggleButton=!1,this.livekit.room.privateGroupMinimized=!0}close(){let e=this.livekit.room.localParticipant.focusRoomGroup&&this.activeGroup?.createdByUserId===this.accountService.currentUser.id;this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:e?"CloseMySessionGroup":"CloseSessionGroup",confirmButtonLabel:"Yes"}}).afterClosed().subscribe(o=>{o&&this.activeGroup&&this.livekit.leaveActiveGroups(this.livekit.room.name).subscribe({next:()=>{this.livekit.room.animateViewToggleButton=!1,this.livekit.room.activeGroup.next(null)},error:d=>this.handleErrors(d)})})}inviteOriginalInviterBack(e){this.activeGroup!==null&&(this.shouldShowReinviteMessage=!1,this.analyticsService.markActivity(y.LivekitPrivatePodInviteUsersButtonClick),this.livekit.inviteUserToFocusRoomSessionGroup(this.livekit.room.name,this.activeGroup.id,[e.id]).subscribe({next:()=>{this.toastService.info({message:`You have sent ${e.displayName} an invitation to join this space again. They will recieve it if they're still in the room.`})},error:t=>{if(t[0].errorCode==="LivekitRoomMaxSamePeerSessionsReached"){this.toastService.info({exceptionDetail:t[0]});return}this.handleErrors(t)}}))}copyInviteLinkToClipboard(){if(this.activeGroup===null)return;let e=new URL(location.href),t=`${location.href}${e.search?"&":"?"}roomName=${this.livekit.room.name}&privateSpaceId=${this.activeGroup.id}`;this.clipboard.copy(t),this.toastService.info({message:"Private space invite link copied. Share it with someone to invite them to join this space."})}showConfirmationModal(e){if(!this.activeGroup)return;if(!this.subscriptionService.hasPremiumFeatures){this.toastService.info({title:"Premium feature",message:"Make your private space visible to others!",paidFeatureText:"Upgrade to premium to unlock this feature",triggeredUpgradeFromSource:re.ShowPodOnTileToast,autoClose:!1}),e.source.checked=!1;return}this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"MakeYourPrivateSpaceVisibleToOthers",confirmButtonLabel:"Yes"}}).afterClosed().subscribe(o=>{o?this.toggleShownOnVideoTile(e):e.source.checked=!1})}setSessionEndTimer(){if(!this.activeGroup||!this.activeGroup.focusSessionEnd)return;let e=$.fromISO(this.activeGroup.focusSessionEnd);this.subscriptions.push(W(0,5e3).pipe(Dt(this.stopTimer)).subscribe(()=>{$.now()<e||(this.stopTimer.next(),this.livekit.leaveActiveGroups(this.livekit.room.name).subscribe({next:()=>{this.showSessionSummary(),this.livekit.room.activeGroup.next(null)},error:t=>this.handleErrors(t)}))}))}showSessionSummary(){this.activeGroup&&this.dialog.open(Ho,{panelClass:"fullscreen-dialog",width:"600px",data:{sessionId:this.activeGroup.focusSessionId}})}toggleShownOnVideoTile(e){this.activeGroup!==null&&(this.activeGroup.shownOnVideoTile=e.checked,this.livekit.updateFocusRoomSessionGroup(this.livekit.room.name,this.activeGroup.id,e.checked).subscribe({next:()=>{this.activeGroup&&this.livekit.room.activeGroup.next(this.activeGroup)},error:t=>{this.handleErrors(t),this.activeGroup!==null&&(this.activeGroup.shownOnVideoTile=!e.checked)}}))}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(N),m(tr),m(H),m(G),m(_e),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-session-group"]],hostVars:2,hostBindings:function(t,o){t&2&&S("focus-session",o.isFocusSession)},inputs:{theme:"theme"},standalone:!1,decls:18,vars:12,consts:[[1,"menu"],[1,"left"],[3,"activeGroupName","buttonLocation"],["color","website-transparent","matTooltip","Invite users","iconName","add",3,"buttonClick","iconSize","iconOnly"],[1,"right"],["color","website-transparent","matTooltip","Minimize","iconName","contract_down_left",1,"minimize-button",3,"iconSize","iconOnly"],["color","website-transparent","iconName","dismiss",3,"buttonClick","iconSize","iconOnly"],[1,"group-tiles-wrapper"],[3,"participant","isMobile","theme","isGroupTile"],[1,"bottom-message","invite"],[3,"click"],[1,"bottom-message"],[3,"matTooltip","disabled","checked"],["color","website-transparent","matTooltip","Copy invite link","iconName","link",1,"invite-link-button",3,"buttonClick","iconSize","iconOnly"],[3,"change","matTooltip","disabled","checked"],[1,"slide-toggle-text-big"],[1,"slide-toggle-text-small"],["color","white","iconName","eye","matTooltip","Show space on video tile and allow others to join",1,"slide-toggle-icon",3,"size"],["color","website-transparent","matTooltip","Minimize","iconName","contract_down_left",1,"minimize-button",3,"buttonClick","iconSize","iconOnly"],["role","button","iconName","dismiss","color","contrast",1,"close-bottom-message",3,"click","size","iconVariant"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"div",1),b(2,"ss-video-pill-button",2),a(3,"ss-button",3),f("buttonClick",function(){return o.showGroupInviteModal()}),c()(),a(4,"h4"),g(5),c(),a(6,"div",4),u(7,Sd,2,3),u(8,Md,1,2,"ss-button",5),a(9,"ss-button",6),f("buttonClick",function(){return o.close()}),c()()(),a(10,"div",7),V(11,wd,1,4,"ss-focus-room-tile",8,xd),c(),a(13,"div",9)(14,"small")(15,"a",10),f("click",function(){return o.copyInviteLinkToClipboard()}),g(16,"Copy invite link"),c()()(),u(17,Od,6,3,"div",11)),t&2&&(s(2),p("activeGroupName",(o.activeGroup==null?null:o.activeGroup.name)||null)("buttonLocation",o.VideoPillButtonLocationRef.PrivatePod),s(),p("iconSize",28)("iconOnly",!0),s(2),R(o.activeGroup==null?null:o.activeGroup.name),s(2),h(o.activeGroup&&!o.activeGroup.focusSessionId?7:-1),s(),h(o.isMobile?-1:8),s(),p("iconSize",28)("iconOnly",!0),s(2),A(o.livekit.room.activeGroupParticipants),s(2),S("move-up",o.shouldShowReinviteMessage&&o.activeGroup&&o.activeGroup.invitedByUser),s(4),h(o.shouldShowReinviteMessage&&o.activeGroup&&o.activeGroup.invitedByUser?17:-1))},dependencies:[I,w,L,vt,ut,Jt],styles:["[_nghost-%COMP%]{position:relative;display:block;min-width:440px;width:calc(100vw - 79px);height:calc(var(--vh) - 56px);overflow:hidden;padding:3px;margin-right:5px;border-top-left-radius:12px;border-top-right-radius:12px;background:var(--accent-gradient);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){[_nghost-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}[_nghost-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}[_nghost-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.focus-session[_nghost-%COMP%]{background:var(--accent-gradient-60-dark)}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{height:calc(var(--vh) - 70px)}}[_nghost-%COMP%]   ss-focus-room-tile[_ngcontent-%COMP%] {width:100%!important;height:auto!important;aspect-ratio:16/9;margin-bottom:4px}.group-tiles-wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;grid-gap:5px;height:auto}@media only screen and (max-width: 767px){.group-tiles-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media only screen and (max-width: 479px){.group-tiles-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr}}.menu[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:3px 8px}.menu[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%], .menu[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;align-items:center}.menu[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{max-width:50vw;overflow:hidden;margin:0 8px;color:var(--contrast);text-overflow:ellipsis;white-space:nowrap}.menu[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]  button{width:28px;height:28px}.menu[_ngcontent-%COMP%]   .minimize-button[_ngcontent-%COMP%], .menu[_ngcontent-%COMP%]   .invite-link-button[_ngcontent-%COMP%]{margin-right:8px}@media only screen and (max-width: 479px){.menu[_ngcontent-%COMP%]   .invite-link-button[_ngcontent-%COMP%]{display:none}}mat-slide-toggle.disabled[_ngcontent-%COMP%]{opacity:.5}mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{display:flex;flex-direction:row-reverse;margin-right:16px}mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field label{padding:0 6px 0 0;font-weight:600;color:var(--contrast)}.slide-toggle-text-big[_ngcontent-%COMP%]{display:block}@media only screen and (max-width: 1024px){.slide-toggle-text-big[_ngcontent-%COMP%]{display:none}}.slide-toggle-text-small[_ngcontent-%COMP%]{display:none}@media only screen and (max-width: 1024px){.slide-toggle-text-small[_ngcontent-%COMP%]{display:block}}@media only screen and (max-width: 767px){.slide-toggle-text-small[_ngcontent-%COMP%]{display:none}}.slide-toggle-icon[_ngcontent-%COMP%]{display:none}@media only screen and (max-width: 767px){.slide-toggle-icon[_ngcontent-%COMP%]{display:block}}.bottom-message[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;z-index:3;display:flex;justify-content:center;align-items:center;width:100%;padding:4px 20px 4px 4px;background-color:var(--grayscale-dark);opacity:.7}.bottom-message.move-up[_ngcontent-%COMP%]{bottom:24px}.bottom-message.invite[_ngcontent-%COMP%]{display:none}@media only screen and (max-width: 479px){.bottom-message.invite[_ngcontent-%COMP%]{display:initial}}.bottom-message[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--contrast)}.bottom-message[_ngcontent-%COMP%]   .close-bottom-message[_ngcontent-%COMP%]{position:absolute;top:6px;right:6px}"]});let n=r;return n})();var $r=(()=>{let r=class r{constructor(e,t){this.livekit=e,this.elementRef=t,this.onRemoteParticipantConnected=this.onRemoteParticipantConnected.bind(this),this.onRemoteParticipantDisconnected=this.onRemoteParticipantDisconnected.bind(this),this.onTrackSubscribed=this.onTrackSubscribed.bind(this),this.onTrackUnsubscribed=this.onTrackUnsubscribed.bind(this),this.onTrackPublished=this.onTrackPublished.bind(this),this.onTrackUnpublished=this.onTrackUnpublished.bind(this)}ngAfterViewInit(){this.livekit.room.on(Q.ParticipantConnected,this.onRemoteParticipantConnected).on(Q.ParticipantDisconnected,this.onRemoteParticipantDisconnected);let e=Array.from(this.livekit.room.remoteParticipants.values());for(let t of e)this.onRemoteParticipantConnected(t)}ngOnDestroy(){this.livekit.room.off(Q.ParticipantConnected,this.onRemoteParticipantConnected).off(Q.ParticipantDisconnected,this.onRemoteParticipantDisconnected)}onRemoteParticipantConnected(e){e.on(U.TrackSubscribed,this.onTrackSubscribed).on(U.TrackUnsubscribed,this.onTrackUnsubscribed).on(U.TrackPublished,this.onTrackPublished).on(U.TrackUnpublished,this.onTrackUnpublished),setTimeout(()=>this.setTrackSubscribedState(e,!0))}onRemoteParticipantDisconnected(e){setTimeout(()=>this.setTrackSubscribedState(e,!1)),e.off(U.TrackSubscribed,this.onTrackSubscribed).off(U.TrackUnsubscribed,this.onTrackUnsubscribed).off(U.TrackPublished,this.onTrackPublished).off(U.TrackUnpublished,this.onTrackUnpublished),this.removeAllParticipantAudioElements(e.identity)}onTrackSubscribed(e,t){e.kind===j.Kind.Audio&&this.tryToAttachAudioElement(t)}onTrackUnsubscribed(e,t){e.kind===j.Kind.Audio&&this.removeAudioElement(t.trackSid)}onTrackPublished(e){e.isSubscribed||e.kind!==j.Kind.Audio||e.setSubscribed(!0)}onTrackUnpublished(e){!e.isSubscribed||e.kind!==j.Kind.Audio||e.setSubscribed(!1)}setTrackSubscribedState(e,t){e.audioTrackPublications.forEach(o=>{o.setSubscribed(t)})}tryToAttachAudioElement(e){let t=e.track;if(!t)return;let o=this.elementRef.nativeElement,d=`audio-${e.trackSid}`,v=o.querySelector(`#${d}`);if(v===null){v=document.createElement("audio"),v.id=d,v.hidden=!0;let T=Array.from(this.livekit.room.remoteParticipants.values()).find(B=>Array.from(B.trackPublications.values()).some(z=>z.trackSid===e.trackSid));T&&(v.className=`audio-${T.identity}`),o.appendChild(v)}else if(t.attachedElements.includes(v))return;t.attach(v)}removeAllParticipantAudioElements(e){let t=this.elementRef.nativeElement;Array.from(t.querySelectorAll(`audio.audio-${e}`)).forEach(d=>{t.removeChild(d)})}removeAudioElement(e){let t=this.elementRef.nativeElement,o=t.querySelector(`#audio-${e}`);o&&t.removeChild(o)}};r.\u0275fac=function(t){return new(t||r)(m(M),m(ze))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room-audio"]],standalone:!1,decls:0,vars:0,template:function(t,o){},encapsulation:2});let n=r;return n})();function Fd(n,r){if(n&1){let i=P();a(0,"div",4),f("click",function(){_(i);let t=l();return C(t.showParticipantHighlight())}),b(1,"ss-icon",5),c()}n&2&&(s(),p("size",18))}function Rd(n,r){if(n&1){let i=P();a(0,"ss-user-avatar",11),f("click",function(){_(i);let t=l(2);return C(t.popupOpened=!0)}),c()}if(n&2){let i=l(2);p("size",36)("title",i.participant.userInfo.displayName)("initials",i.participant.userInfo.initials)("avatarColor",i.participant.userInfo.avatarColor)("avatarThumbUrl",i.participant.userInfo.avatarThumbUrl)("userId",i.participant.identity)("matTooltip",i.isPinningMe?"Pinning you":"")}}function Ed(n,r){if(n&1){let i=P();a(0,"ss-user-popup",12),f("focusRoomUnauthenticatedActionAttempt",function(){_(i);let t=l(2);return C(t.handleUnauthenticatedActionAttempt())})("closePopup",function(){_(i);let t=l(2);return C(t.popupOpened=!1)}),c()}if(n&2){let i=l(2);p("userId",i.participant.identity)("openedFromSource",i.OpenedFromSourceRef.FocusRoom)}}function Ud(n,r){n&1&&b(0,"ss-premium-tick")}function Vd(n,r){if(n&1&&b(0,"ss-badge",10),n&2){let i=l(2);p("badge",i.participant.userInfo.userBadge)("size",20)}}function Ad(n,r){if(n&1){let i=P();a(0,"div",6,0),u(2,Rd,1,7,"ss-user-avatar",7),ae(3,Ed,1,2,"ng-template",8),f("backdropClick",function(){_(i);let t=l();return C(t.popupOpened=!1)}),u(4,Ud,1,0,"ss-premium-tick"),a(5,"p",9),f("click",function(){_(i);let t=l();return C(t.popupOpened=!0)}),g(6),c(),u(7,Vd,1,2,"ss-badge",10),c()}if(n&2){let i=xe(1),e=l();S("margin-left",e.pinnedParticipant),s(2),h(e.participant.identity?2:-1),s(),p("cdkConnectedOverlayOrigin",i)("cdkConnectedOverlayOpen",e.popupOpened)("cdkConnectedOverlayHasBackdrop",!0)("cdkConnectedOverlayDisableClose",!0),s(),h(!e.settingsService.isB2BApp()&&e.participant.userInfo.showPremiumTick?4:-1),s(2),R(e.participant.userInfo.displayName),s(),h(e.participant.userInfo.userBadge?7:-1)}}function Ld(n,r){if(n&1){let i=P();a(0,"ss-button",16),f("buttonClick",function(){_(i);let t=l(2);return C(t.toggleVideoSessionNotification())}),c()}if(n&2){let i=l(2);p("matTooltip",i.participant.videoSessionStartedNotification?"":"Notify me (on mobile) the first time this user turns camera on each day")("color",i.participant.videoSessionStartedNotification?"gradient":"default-80")("iconColor",i.participant.videoSessionStartedNotification?"gradient":"default-80")("iconOnly",!0)("iconSize",20)("isLoading",i.notificationLoading)("disabled",i.notificationLoading)}}function Gd(n,r){if(n&1){let i=P();u(0,Ld,1,7,"ss-button",13),a(1,"ss-button",14),f("buttonClick",function(){_(i);let t=l();return C(t.participant.favorited?t.removeFavorite():t.favoriteUser())}),c(),a(2,"ss-button",15),f("buttonClick",function(){_(i);let t=l();return C(t.isPinned?t.unpin():t.pin())}),c()}if(n&2){let i=l();h(i.isFavoriteTab?0:-1),s(),p("color",i.participant.favorited?"gold":"default-80")("iconColor",i.participant.favorited?"gold":"default-80")("iconOnly",!0)("iconSize",20)("isLoading",i.favoriteLoading)("disabled",i.favoriteLoading),s(),S("move-from-right",i.isCurrentUser),p("color",i.isPinned?"gradient":"default-80")("iconColor",i.isPinned?"gradient":"default-80")("iconOnly",!0)("iconSize",20)("isLoading",i.livekit.room.pinningUserIds!==null&&i.livekit.room.pinningUserIds.includes(i.participant.identity))("disabled",i.livekit.room.pinningUserIds!==null&&!i.livekit.room.pinningUserIds.includes(i.participant.identity))}}function Dd(n,r){if(n&1&&b(0,"ss-participant-menu",3),n&2){let i=l();p("participant",i.participant)("showHideUserOptions",i.showHideUserOptions)("isHiddenParticipant",i.isHiddenParticipant)}}var It=(()=>{let r=class r{get isPinningMe(){return this.livekit.room.pinnedByUserIds.some(e=>e===this.participant.identity)}get ishHighlighted(){return this.participantHighlighted}get isPinned(){return this.livekit.room.isPinned(this.participant.identity)}get isCurrentUser(){return this.accountService.currentUser.id===this.participant.identity}constructor(e,t,o,d,v,k,T,B,z){this.livekit=e,this.settingsService=t,this.accountModalsService=o,this.accountService=d,this.toastService=v,this.utilityService=k,this.userFollowService=T,this.userFavoriteService=B,this.elementRef=z,this.isHiddenParticipant=!1,this.pinnedParticipant=!1,this.showHideUserOptions=!1,this.isFavoriteTab=!1,this.popupOpened=!1,this.followLoading=!1,this.favoriteLoading=!1,this.notificationLoading=!1,this.subscriptions=[],this.participantHighlighted=!1,this.OpenedFromSourceRef=Pt}ngOnInit(){let e=this.participant.getTrackPublication(j.Source.Camera);e&&e.track&&(this.track=e.track)}ngAfterViewInit(){this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.livekit.participantHighlight.hide.subscribe(()=>this.participantHighlighted=!1))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}showParticipantHighlight(){if(this.isMobile)return;this.livekit.participantHighlight.hideOverlay.next(!0),this.participantHighlighted=!0;let e=this.elementRef.nativeElement.getBoundingClientRect(),t=document.querySelector(".dashboard-wrapper").clientHeight,o={id:this.participant.identity,left:e.left-234,bottom:t-e.top-94,source:Be.ParticipantListItem};this.livekit.participantHighlight.show.next(o)}pin(){this.livekit.room.pin({participant:this.participant,forcePinView:!0})}unpin(){this.livekit.room.unpin({pinnedUserId:this.participant.identity})}favoriteUser(){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.favoriteLoading=!0,this.userFavoriteService.addUserToFavorites(this.participant.identity).subscribe({next:()=>this.favoriteLoading=!1,error:e=>{this.favoriteLoading=!1,e.length&&e[0].errorCode==="MaxFavoriteUsersCountReached"?this.toastService.info({title:"Maximum favorites reached",exceptionDetail:e[0],paidFeatureText:"Upgrade to add more",triggeredUpgradeFromSource:re.MaxFavoriteUsersReached,autoClose:!1}):this.handleErrors(e)}}))}removeFavorite(){this.favoriteLoading=!0,this.userFavoriteService.removeUserFromFavorites(this.participant.identity).subscribe({next:()=>this.favoriteLoading=!1,error:e=>this.handleErrors(e)})}handleUnauthenticatedActionAttempt(){this.accountModalsService.ensureUserCompletedBasicInfo()}toggleVideoSessionNotification(){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.notificationLoading=!0,this.userFavoriteService.toggleVideoSessionStartedNotification(this.participant.identity,!this.participant.videoSessionStartedNotification).subscribe({next:()=>{this.participant.videoSessionStartedNotification=!this.participant.videoSessionStartedNotification,this.notificationLoading=!1},error:e=>{this.notificationLoading=!1,this.handleErrors(e)}}))}handleErrors(e){this.followLoading=!1,this.favoriteLoading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(X),m(K),m(G),m(F),m(J),m(Mo),m(ct),m(ze))},r.\u0275cmp=x({type:r,selectors:[["ss-participant-list-item"]],hostVars:4,hostBindings:function(t,o){t&2&&S("pinning-me",o.isPinningMe)("highlighted",o.ishHighlighted)},inputs:{participant:"participant",isHiddenParticipant:"isHiddenParticipant",pinnedParticipant:"pinnedParticipant",showHideUserOptions:"showHideUserOptions",isFavoriteTab:"isFavoriteTab"},standalone:!1,decls:4,vars:4,consts:[["trigger","cdkOverlayOrigin"],[1,"hover-highlight"],["cdkOverlayOrigin","",1,"user-info",3,"margin-left"],[3,"participant","showHideUserOptions","isHiddenParticipant"],[1,"hover-highlight",3,"click"],["iconName","eye",3,"size"],["cdkOverlayOrigin","",1,"user-info"],["role","button",3,"size","title","initials","avatarColor","avatarThumbUrl","userId","matTooltip"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","transparent",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayDisableClose"],["role","button",1,"name",3,"click"],[1,"user-marker",3,"badge","size"],["role","button",3,"click","size","title","initials","avatarColor","avatarThumbUrl","userId","matTooltip"],["cssClass","margin-horizontal",3,"focusRoomUnauthenticatedActionAttempt","closePopup","userId","openedFromSource"],["iconName","alert",1,"notify",3,"matTooltip","color","iconColor","iconOnly","iconSize","isLoading","disabled"],["iconName","star",1,"favorite-user",3,"buttonClick","color","iconColor","iconOnly","iconSize","isLoading","disabled"],["iconName","pin",3,"buttonClick","color","iconColor","iconOnly","iconSize","isLoading","disabled"],["iconName","alert",1,"notify",3,"buttonClick","matTooltip","color","iconColor","iconOnly","iconSize","isLoading","disabled"]],template:function(t,o){t&1&&(u(0,Fd,2,1,"div",1),u(1,Ad,8,10,"div",2),u(2,Gd,3,15),u(3,Dd,1,3,"ss-participant-menu",3)),t&2&&(h(o.pinnedParticipant?-1:0),s(),h(o.participant.userInfo?1:-1),s(),h(o.isHiddenParticipant?-1:2),s(),h(o.isCurrentUser?-1:3))},dependencies:[I,w,Me,at,rt,Ii,Fe,Ie,L,Li],styles:["[_nghost-%COMP%]{position:relative;display:flex;align-items:center;width:100%}.highlighted[_nghost-%COMP%]{background:var(--alt-40)}.pinning-me[_nghost-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{border:1px solid var(--grayscale);border-radius:50%;outline:3px solid var(--accent-blue)}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{margin:6px 0}}.hover-highlight[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:20px;height:52px;margin-right:5px;cursor:pointer}.hover-highlight[_ngcontent-%COMP%]:hover   ss-icon[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{flex-shrink:0}.hover-highlight[_ngcontent-%COMP%]:hover   ss-icon[_ngcontent-%COMP%]     i{background:var(--accent-gradient);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}@media only screen and (max-width: 1024px){.hover-highlight[_ngcontent-%COMP%]{display:none}}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-right:auto}.user-info[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{max-width:154px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}ss-user-avatar[_ngcontent-%COMP%]{margin-right:8px}ss-badge[_ngcontent-%COMP%]{flex-shrink:0;margin-left:6px}ss-button[_ngcontent-%COMP%]{margin:0 4px}ss-button.move-from-right[_ngcontent-%COMP%]{margin-right:22px}ss-button.favorite-user[_ngcontent-%COMP%]{position:relative;margin-top:-1px}ss-button.notify[_ngcontent-%COMP%]{position:relative;margin-top:1px}button[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer}"]});let n=r;return n})();var Nd=(n,r)=>r.id;function zd(n,r){n&1&&(a(0,"div",3),g(1," No results. "),c())}function jd(n,r){n&1&&b(0,"mat-spinner",5)}function Hd(n,r){if(n&1){let i=P();a(0,"div",8),b(1,"ss-user-avatar-and-info",9),a(2,"ss-button-small",10),f("buttonClick",function(){let t=_(i).$implicit,o=l(3);return C(o.unhide(t.id))}),g(3," Unhide "),c()()}if(n&2){let i=r.$implicit,e=l(3);s(),p("user",i)("avatarSize",36)("descriptionField",e.UserDescriptionFieldRef.Bio)("source",e.ActivitySourceRef.HiddenUserItemMiniBioOpened),s(),p("color",e.ButtonColorRef.Secondary)}}function Wd(n,r){if(n&1&&(a(0,"div",7),V(1,Hd,4,5,"div",8,Nd),c()),n&2){let i=l(2);S("no-results",i.hiddenUsers.length===0),s(),A(i.hiddenUsers)}}function $d(n,r){if(n&1&&u(0,jd,1,0,"mat-spinner",5)(1,Wd,3,2,"div",6),n&2){let i=l();h(i.hiddenUsersLoading?0:1)}}function Jd(n,r){if(n&1&&b(0,"ss-participant-list-item",13),n&2){let i=r.$implicit,e=l(2);p("isHiddenParticipant",e.showHiddenUsers)("showHideUserOptions",!0)("participant",i)}}function qd(n,r){if(n&1&&(a(0,"cdk-virtual-scroll-viewport",11),ae(1,Jd,1,3,"ss-participant-list-item",12),c()),n&2){let i=l();S("no-results",i.filteredParticipants.length===0),s(),p("cdkVirtualForOf",i.filteredParticipants)}}var Jr=(()=>{let r=class r{get anyPinnedUsers(){return this.livekit.room.pinnedParticipants.length>0&&!this.searchTerm&&!this.showHiddenUsers}get filteredParticipants(){let e=this.livekit.room.allParticipants.filter(t=>!t.anonymous&&t.identity&&!this.livekit.room.hiddenUsersInfo.myHiddenUsers.some(o=>o.hiddenUserId===t.identity)&&!this.livekit.room.hiddenUsersInfo.twoWayHiddenMeUserIds.some(o=>o===t.identity));return this.searchTerm?e.filter(t=>{let o=(this.searchTerm??"").trim().toLowerCase();return t?.userInfo?.displayName&&t.userInfo.displayName.toLowerCase().includes(o)}):e}constructor(e,t,o,d,v){this.livekit=e,this.accountService=t,this.focusRoomService=o,this.accountModalsService=d,this.toastService=v,this.hiddenUsers=[],this.searchTerm=null,this.showHiddenUsers=!1,this.hiddenUsersLoading=!1,this.UserDescriptionFieldRef=To,this.ActivitySourceRef=y,this.ButtonColorRef=He,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.focusRoomService.hiddenParticipant.subscribe(e=>this.addHiddenParticipant(e)),this.focusRoomService.unhiddenParticipant.subscribe(e=>this.removeHiddenParticipant(e)))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}toggleHiddenParticipants(){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.showHiddenUsers=!this.showHiddenUsers,this.showHiddenUsers&&this.fetchHiddenUsers())}unhide(e){let t=this.hiddenUsers.find(o=>o.id===e);t&&this.hiddenUsers.splice(this.hiddenUsers.indexOf(t),1),this.livekit.room.unhide(e),this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next()}fetchHiddenUsers(){this.hiddenUsersLoading=!0,this.focusRoomService.getHiddenUsers().subscribe({next:e=>{this.hiddenUsers=e,this.hiddenUsersLoading=!1},error:e=>this.handleErrors(e)})}addHiddenParticipant(e){if(this.hiddenUsers.some(o=>o.id===e.identity))return;let t={id:e.identity,firstName:e.userInfo.firstName,fullName:e.userInfo.fullName,avatarColor:e.userInfo.avatarColor,avatarUrl:e.userInfo.avatarUrl,avatarThumbUrl:e.userInfo.avatarThumbUrl,initials:e.userInfo.initials,displayName:e.userInfo.displayName,showPremiumTick:e.userInfo.showPremiumTick,includePremiumFeatures:e.userInfo.includePremiumFeatures,userBadge:e.userInfo.userBadge,showNewUserMarker:e.userInfo.showNewUserMarker};this.hiddenUsers.push(t)}removeHiddenParticipant(e){let t=this.hiddenUsers.find(o=>o.id===e);t&&this.hiddenUsers.splice(this.hiddenUsers.indexOf(t),1)}handleErrors(e){this.hiddenUsersLoading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(G),m(wi),m(K),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-all-users"]],hostVars:2,hostBindings:function(t,o){t&2&&S("collapsed-filters",o.collapsedFilters)},inputs:{collapsedFilters:"collapsedFilters"},standalone:!1,decls:6,vars:6,consts:[[1,"search-wrapper"],["id","participant-search","name","participantSearch","placeholder","Search...",3,"ngModelChange","ngModel"],["color","focus-room",3,"buttonClick","matTooltip","iconName","iconOnly"],[1,"no-results-message"],["itemSize","60",1,"users-list",3,"no-results"],["diameter","30","strokeWidth","3"],[1,"users-list",3,"no-results"],[1,"users-list"],[1,"hidden-user-wrapper"],[3,"user","avatarSize","descriptionField","source"],[3,"buttonClick","color"],["itemSize","60",1,"users-list"],[3,"isHiddenParticipant","showHideUserOptions","participant",4,"cdkVirtualFor","cdkVirtualForOf"],[3,"isHiddenParticipant","showHideUserOptions","participant"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"ss-input",1),he("ngModelChange",function(v){return ue(o.searchTerm,v)||(o.searchTerm=v),v}),c(),a(2,"ss-button",2),f("buttonClick",function(){return o.toggleHiddenParticipants()}),c()(),u(3,zd,2,0,"div",3),u(4,$d,2,1)(5,qd,2,3,"cdk-virtual-scroll-viewport",4)),t&2&&(s(),me("ngModel",o.searchTerm),s(),p("matTooltip",o.showHiddenUsers?"Close hidden users":"Show hidden users")("iconName",o.showHiddenUsers?"eye":"eye_off")("iconOnly",!0),s(),h((o.showHiddenUsers?o.hiddenUsers.length===0&&!o.hiddenUsersLoading:o.filteredParticipants.length===0)?3:-1),s(),h(o.showHiddenUsers?4:5))},dependencies:[I,Ee,Ce,Oo,te,ie,wn,In,Tn,L,ve,It],styles:[".collapsed-filters[_nghost-%COMP%]   .users-list[_ngcontent-%COMP%]{height:calc(var(--vh) - 200px)}.search-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px}.search-wrapper[_ngcontent-%COMP%]   ss-input[_ngcontent-%COMP%]{width:100%;margin:0 5px 0 0}.search-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]     button{height:42px}.no-results-message[_ngcontent-%COMP%]{text-align:center}mat-spinner[_ngcontent-%COMP%]{margin:0 auto}.users-list[_ngcontent-%COMP%]{height:calc(var(--vh) - 240px);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.users-list[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.users-list[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.users-list[_ngcontent-%COMP%]::-webkit-scrollbar, .users-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.users-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.users-list.no-results[_ngcontent-%COMP%]{height:0}.hidden-user-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:6px 0}"]});let n=r;return n})();var Xd=["participantItem"],qr=(n,r)=>r.sid;function Zd(n,r){n&1&&(a(0,"div",7),g(1," You are not pinning anyone currently. "),c())}function ep(n,r){n&1&&(a(0,"div",8),g(1,"Refreshing pins list..."),c())}function tp(n,r){if(n&1){let i=P();a(0,"ss-icon",25),f("click",function(){_(i);let t=l().$implicit,o=l(2);return C(o.livekit.room.movePinnedParticipant(t))}),c()}n&2&&p("iconVariant",20)("size",14)}function ip(n,r){if(n&1){let i=P();a(0,"ss-icon",26),f("click",function(){_(i);let t=l().$implicit,o=l(2);return C(o.livekit.room.movePinnedParticipant(t,!1))}),c()}n&2&&p("iconVariant",20)("size",14)}function np(n,r){if(n&1){let i=P();a(0,"ss-icon",27),f("click",function(){_(i);let t=l().$implicit,o=l(2);return C(o.livekit.room.moveParticipantByOffset(t,-1))}),c()}n&2&&p("size",14)}function op(n,r){if(n&1){let i=P();a(0,"ss-icon",28),f("click",function(){_(i);let t=l().$implicit,o=l(2);return C(o.livekit.room.moveParticipantByOffset(t,1))}),c()}n&2&&p("size",14)}function rp(n,r){if(n&1){let i=P();a(0,"div",15,0),f("cdkDragStarted",function(){_(i);let t=l(2);return C(t.onDragStarted())})("cdkDragEnded",function(){_(i);let t=l(2);return C(t.onDragEnded())}),a(2,"div",16),f("click",function(){let t=_(i),o=t.$implicit,d=t.$index,v=l(2);return C(v.showParticipantHighlight(o,d))}),b(3,"ss-icon",17),c(),a(4,"div",18),u(5,tp,1,2,"ss-icon",19),u(6,ip,1,2,"ss-icon",20),c(),a(7,"div",18),u(8,np,1,1,"ss-icon",21),b(9,"ss-icon",22),u(10,op,1,1,"ss-icon",23),c(),b(11,"ss-participant-list-item",24),c()}if(n&2){let i=r.$implicit,e=r.$index,t=l(2);p("cdkDragDisabled",!t.subscriptionService.hasPremiumFeatures),s(3),p("size",18),s(),S("disabled",!t.subscriptionService.hasPremiumFeatures),s(),h(e>0?5:-1),s(),h(e<t.filteredParticipants.length-1?6:-1),s(2),h(e>0?8:-1),s(),S("disabled",!t.subscriptionService.hasPremiumFeatures),p("matTooltip",t.subscriptionService.hasPremiumFeatures?"":"Re-ordering pinned tiles is a premium feature.")("size",20),s(),h(e<t.filteredParticipants.length-1?10:-1),s(),S("has-move-icons",t.filteredParticipants.length>1),p("pinnedParticipant",!0)("participant",i)}}function sp(n,r){if(n&1){let i=P();a(0,"div",13),f("cdkDropListDropped",function(t){_(i);let o=l();return C(o.drop(t))}),V(1,rp,12,16,"div",14,qr),c()}if(n&2){let i=l();p("cdkDropListData",i.filteredParticipants),s(),A(i.filteredParticipants)}}function ap(n,r){if(n&1&&b(0,"ss-participant-list-item",30),n&2){let i=l().$implicit;p("participant",i)}}function cp(n,r){if(n&1&&u(0,ap,1,1,"ss-participant-list-item",30),n&2){let i=r.$implicit,e=l(2);h(e.isParticipantInRoom(i.identity)?0:-1)}}function lp(n,r){if(n&1&&(a(0,"div",29),g(1,"Here are some people you've pinned recently."),c(),V(2,cp,1,1,null,null,qr)),n&2){let i=l();s(2),A(i.previouslyPinnedParticipantsFiltered)}}function dp(n,r){n&1&&b(0,"div")}function pp(n,r){if(n&1){let i=P();a(0,"ss-button",31),f("buttonClick",function(){_(i);let t=l();return C(t.livekit.room.unpinAll())}),g(1," Unpin all "),c()}}var Yr=(()=>{let r=class r{get filteredParticipants(){return this.searchTerm?this.livekit.room.pinnedParticipants.filter(e=>{let t=(this.searchTerm??"").trim().toLowerCase();return e?.userInfo?.displayName&&e.userInfo.displayName.toLowerCase().includes(t)}):this.livekit.room.pinnedParticipants}get previouslyPinnedParticipantsFiltered(){let e=this.filteredParticipants.map(t=>t.identity);return this.previouslyPinnedParticipants.filter(t=>!e.includes(t.identity))}constructor(e,t,o,d,v){this.livekit=e,this.subscriptionService=t,this.utilityService=o,this.toastService=d,this.subscriptionNavigationService=v,this.openFavoritesModal=new ce,this.openPinSettingsModal=new ce,this.previouslyPinnedParticipants=[],this.previouslyPinnedParticipantsLoading=!0,this.searchTerm=null,this.hidePinsList=!1,this.ButtonColorRef=He,this.subscriptions=[],this.participantHighlighted=!1}ngOnInit(){this.fetchPinnedParticipants()}ngAfterViewInit(){this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.livekit.participantHighlight.hide.subscribe(()=>this.participantHighlighted=!1))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}isParticipantInRoom(e){return this.livekit.room.remoteParticipants.get(e)}drop(e){Zn(this.livekit.room.pinnedParticipants,e.previousIndex,e.currentIndex),this.livekit.room.assignDisplayedParticipants()}sortFavoriteParticipants(){if(!this.subscriptionService.hasPremiumFeatures){this.subscriptionNavigationService.openPlansAndPricing(re.SortFavoriteParticipants);return}this.livekit.room.sortFavoriteParticipants()}onDragStarted(){this.numberOfPinsOnDragStart=this.filteredParticipants.length}onDragEnded(){this.numberOfPinsOnDragEnd=this.filteredParticipants.length,this.numberOfPinsOnDragStart!==this.numberOfPinsOnDragEnd&&(this.hidePinsList=!0,setTimeout(()=>this.hidePinsList=!1,1e3))}showParticipantHighlight(e,t){if(this.isMobile)return;this.livekit.participantHighlight.hideOverlay.next(!0),this.participantHighlighted=!0;let o=this.participantItems.get(t);if(!o)return;let d=o.nativeElement.getBoundingClientRect(),v=document.querySelector(".dashboard-wrapper").clientHeight,k={id:e.identity,left:d.left-234,bottom:v-d.top-94,source:Be.ParticipantListItem};this.livekit.participantHighlight.show.next(k)}fetchPinnedParticipants(){this.livekit.getRecentlyPinnedUsers(this.livekit.room.name).subscribe({next:e=>{for(let t of e){let o=this.livekit.room.remoteParticipants.get(t.id);if(o&&!this.livekit.room.hiddenUsersInfo.myHiddenUsers.some(d=>d.hiddenUserId===o.identity)&&!this.livekit.room.hiddenUsersInfo.twoWayHiddenMeUserIds.some(d=>d===o.identity)){let d=o;d.following=t.following,this.previouslyPinnedParticipants.push(d)}}this.previouslyPinnedParticipantsLoading=!1},error:e=>this.handleErrors(e)})}handleErrors(e){this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(_e),m(J),m(F),m(yt))},r.\u0275cmp=x({type:r,selectors:[["ss-pinned-users"]],viewQuery:function(t,o){if(t&1&&Ae(Xd,5),t&2){let d;Le(d=Ge())&&(o.participantItems=d)}},hostVars:2,hostBindings:function(t,o){t&2&&S("collapsed-filters",o.collapsedFilters)},inputs:{collapsedFilters:"collapsedFilters"},outputs:{openFavoritesModal:"openFavoritesModal",openPinSettingsModal:"openPinSettingsModal"},standalone:!1,decls:16,vars:12,consts:[["participantItem",""],["id","participant-search","name","participantSearch","placeholder","Search pinned users...",3,"ngModelChange","disabled","ngModel"],[1,"favorites-options-wrapper"],["iconName","star",3,"buttonClick"],[1,"sort-by-favorites",3,"buttonClick","color"],["matTooltip","Manage Auto Pin Settings","iconName","settings","color","tertiary",3,"buttonClick","iconSize","iconOnly"],["cdkScrollable","",1,"pinned-users-wrapper"],[1,"no-pins"],[1,"refreshing-pins-list"],["cdkDropList","",3,"cdkDropListData"],[4,"ssSkeletonLoader","ssSkeletonLoaderHeight","ssSkeletonLoaderWidth"],[1,"button-wrapper"],["matTooltip","Unpin all","color","secondary","iconName","pin_off"],["cdkDropList","",3,"cdkDropListDropped","cdkDropListData"],["cdkDrag","",1,"draggable-item-wrapper",3,"cdkDragDisabled"],["cdkDrag","",1,"draggable-item-wrapper",3,"cdkDragStarted","cdkDragEnded","cdkDragDisabled"],[1,"hover-highlight",3,"click"],["iconName","eye",3,"size"],[1,"move-item-wrapper"],["matTooltip","move to top","matTooltipShowDelay","1000","role","button","iconName","caret_up",3,"iconVariant","size"],["matTooltip","move to bottom","matTooltipShowDelay","1000","role","button","iconName","caret_down",3,"iconVariant","size"],["matTooltip","Move up one spot","matTooltipShowDelay","1000","role","button","iconName","chevron_up",3,"size"],["cdkDragHandle","","iconName","re_order_dots_vertical","color","default-80",1,"draggable",3,"matTooltip","size"],["matTooltip","Move down one spot","matTooltipShowDelay","1000","role","button","iconName","chevron_down",3,"size"],[3,"pinnedParticipant","participant"],["matTooltip","move to top","matTooltipShowDelay","1000","role","button","iconName","caret_up",3,"click","iconVariant","size"],["matTooltip","move to bottom","matTooltipShowDelay","1000","role","button","iconName","caret_down",3,"click","iconVariant","size"],["matTooltip","Move up one spot","matTooltipShowDelay","1000","role","button","iconName","chevron_up",3,"click","size"],["matTooltip","Move down one spot","matTooltipShowDelay","1000","role","button","iconName","chevron_down",3,"click","size"],[1,"users-block-text"],[3,"participant"],["matTooltip","Unpin all","color","secondary","iconName","pin_off",3,"buttonClick"]],template:function(t,o){t&1&&(a(0,"ss-input",1),he("ngModelChange",function(v){return ue(o.searchTerm,v)||(o.searchTerm=v),v}),c(),a(1,"div",2)(2,"ss-button-small",3),f("buttonClick",function(){return o.openFavoritesModal.next()}),g(3," Manage favorites "),c(),a(4,"ss-button-small",4),f("buttonClick",function(){return o.sortFavoriteParticipants()}),g(5," Sort by favorites "),c(),a(6,"ss-button",5),f("buttonClick",function(){return o.openPinSettingsModal.next()}),c()(),a(7,"div",6)(8,"div"),u(9,Zd,2,0,"div",7),u(10,ep,2,0,"div",8)(11,sp,3,1,"div",9),u(12,lp,4,0),ae(13,dp,1,0,"div",10),c(),a(14,"div",11),u(15,pp,2,0,"ss-button",12),c()()),t&2&&(p("disabled",o.filteredParticipants.length===0),me("ngModel",o.searchTerm),s(4),p("color",o.ButtonColorRef.Secondary),s(2),p("iconSize",20)("iconOnly",!0),s(3),h(o.filteredParticipants.length===0?9:-1),s(),h(o.hidePinsList?10:11),s(2),h(o.previouslyPinnedParticipantsFiltered.length>0?12:-1),s(),p("ssSkeletonLoader",o.previouslyPinnedParticipantsLoading)("ssSkeletonLoaderHeight","200px")("ssSkeletonLoaderWidth","100%"),s(2),h(o.livekit.room.pinnedParticipants.length?15:-1))},dependencies:[I,w,Ee,Ce,Fi,te,ie,On,L,to,Pi,eo,It],styles:[".collapsed-filters[_nghost-%COMP%]   .pinned-users-wrapper[_ngcontent-%COMP%]{height:calc(var(--vh) - 258px)}[_nghost-%COMP%]     ss-participant-list-item.has-move-icons .user-info .name{max-width:130px}.favorites-options-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px}.favorites-options-wrapper[_ngcontent-%COMP%]   ss-button-small.sort-by-favorites[_ngcontent-%COMP%]{margin:0 6px}.favorites-options-wrapper[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]     i{color:var(--contrast)}.pinned-users-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:calc(var(--vh) - 292px);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.pinned-users-wrapper[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.pinned-users-wrapper[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.pinned-users-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar, .pinned-users-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.pinned-users-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.pinned-users-wrapper[_ngcontent-%COMP%]   .toggle-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:21px}.pinned-users-wrapper[_ngcontent-%COMP%]   .toggle-wrapper[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin-right:8px}.pinned-users-wrapper[_ngcontent-%COMP%]   ss-info-tooltip[_ngcontent-%COMP%]{margin-left:4px}.no-pins[_ngcontent-%COMP%]{margin-left:4px}.refreshing-pins-list[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:104px}.draggable-item-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:flex-end;align-items:center;height:46px}.draggable-item-wrapper[_ngcontent-%COMP%]   ss-participant-list-item[_ngcontent-%COMP%]{width:calc(100% - 39px)}.draggable-item-wrapper[_ngcontent-%COMP%]   .draggable[_ngcontent-%COMP%]{cursor:grab}.draggable-item-wrapper[_ngcontent-%COMP%]   .draggable.disabled[_ngcontent-%COMP%]{cursor:initial;opacity:.3}.users-block-text[_ngcontent-%COMP%]{padding:16px 4px 4px}.button-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;padding-right:12px}.button-wrapper[_ngcontent-%COMP%]   ss-button[_ngcontent-%COMP%]{width:132px}.move-item-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-evenly;height:100%}.move-item-wrapper[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]     i{height:10px}.move-item-wrapper.disabled[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{pointer-events:none;opacity:.6}.hover-highlight[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:20px;height:52px;margin-right:5px;cursor:pointer}.hover-highlight[_ngcontent-%COMP%]:hover   ss-icon[_ngcontent-%COMP%]     i{background:var(--accent-gradient);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}@media only screen and (max-width: 1024px){.hover-highlight[_ngcontent-%COMP%]{display:none}}"]});let n=r;return n})();var Kr=ii(_i());var Qr=(n,r)=>r.identity;function up(n,r){n&1&&(a(0,"div",1),g(1," None of the people you follow are in the room at the moment. "),c())}function hp(n,r){n&1&&b(0,"div")}function gp(n,r){if(n&1&&b(0,"ss-participant-list-item",4),n&2){let i=l().$implicit;p("participant",i)}}function fp(n,r){if(n&1&&u(0,gp,1,1,"ss-participant-list-item",4),n&2){let i=r.$implicit,e=l();h(e.isParticipantInRoom(i.identity)?0:-1)}}function vp(n,r){if(n&1&&b(0,"ss-participant-list-item",4),n&2){let i=l().$implicit;p("participant",i)}}function _p(n,r){if(n&1&&u(0,vp,1,1,"ss-participant-list-item",4),n&2){let i=r.$implicit,e=l(2);h(e.isParticipantInRoom(i.identity)?0:-1)}}function Cp(n,r){if(n&1&&(a(0,"div",5),g(1),c(),V(2,_p,1,1,null,null,Qr)),n&2){let i=l();s(),R(i.suggestedParticipantInfoText),s(),A(i.suggestedParticipants)}}var Xr=(()=>{let r=class r{get filteredParticipants(){return this.searchTerm?this.followedParticipants.filter(e=>{let t=(this.searchTerm??"").trim().toLowerCase();return e?.userInfo?.displayName&&e.userInfo.displayName.toLowerCase().includes(t)}):this.followedParticipants}constructor(e,t,o){this.livekit=e,this.accountService=t,this.toastService=o,this.followedParticipantsLoading=!0,this.suggestedParticipantInfoText="",this.followedParticipants=[],this.suggestedParticipants=[],this.searchTerm=null}ngOnInit(){this.fetchFollowedParticipants()}isParticipantInRoom(e){return this.livekit.room.remoteParticipants.get(e)}fetchFollowedParticipants(){this.livekit.getFollowedUsers(this.livekit.room.name).subscribe({next:e=>{this.followedParticipants=this.livekit.room.allParticipants.filter(t=>e.includes(t.identity)),this.followedParticipantsLoading=!1,this.populateSuggestedParticipants()},error:e=>this.handleErrors(e)})}populateSuggestedParticipants(){if(this.followedParticipantsLoading||this.followedParticipants.length>=10)return;let e=10;this.suggestedParticipants=this.livekit.room.allParticipants.filter(t=>!t.isLocal&&t.userInfo&&!this.followedParticipants.some(o=>o.identity===t.identity)&&(this.accountService.currentUser.areaOfStudyId&&t.userInfo.areaOfStudyId===this.accountService.currentUser.areaOfStudyId||this.accountService.currentUser.countryId&&t.userInfo.countryId===this.accountService.currentUser.countryId)).sort((0,Kr.firstBy)(t=>t.userInfo.areaOfStudyId===this.accountService.currentUser.areaOfStudyId,{direction:"desc"})).slice(0,e),this.setSuggestedParticipantInfoText()}setSuggestedParticipantInfoText(){let e=this.suggestedParticipants.some(o=>this.accountService.currentUser.areaOfStudyId&&o.userInfo.areaOfStudyId===this.accountService.currentUser.areaOfStudyId),t=this.suggestedParticipants.some(o=>this.accountService.currentUser.countryId&&o.userInfo.countryId===this.accountService.currentUser.countryId);if(e&&t){this.suggestedParticipantInfoText=`Here are some other people studying ${this.accountService.currentUser.areaOfStudyName} and some other people from ${this.accountService.currentUser.countryName}, try reaching out to them to connect!`;return}e?this.suggestedParticipantInfoText=`Here are some other ${this.accountService.currentUser.areaOfStudyName} students, try reaching out to them to connect!`:t&&(this.suggestedParticipantInfoText=`Here are some other people from ${this.accountService.currentUser.countryName}, try reaching out to them to connect!`)}handleErrors(e){this.followedParticipantsLoading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(G),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-following-users"]],hostVars:2,hostBindings:function(t,o){t&2&&S("collapsed-filters",o.collapsedFilters)},inputs:{collapsedFilters:"collapsedFilters"},standalone:!1,decls:7,vars:7,consts:[["id","participant-search","name","participantSearch","placeholder","Search...",3,"ngModelChange","disabled","ngModel"],[1,"empty-message"],[1,"follower-list"],[4,"ssSkeletonLoader","ssSkeletonLoaderHeight","ssSkeletonLoaderWidth"],[3,"participant"],[1,"users-block-text"]],template:function(t,o){t&1&&(a(0,"ss-input",0),he("ngModelChange",function(v){return ue(o.searchTerm,v)||(o.searchTerm=v),v}),c(),u(1,up,2,0,"div",1),a(2,"div",2),ae(3,hp,1,0,"div",3),V(4,fp,1,1,null,null,Qr),u(6,Cp,4,1),c()),t&2&&(p("disabled",o.followedParticipants.length===0),me("ngModel",o.searchTerm),s(),h(!o.followedParticipantsLoading&&o.followedParticipants.length===0?1:-1),s(2),p("ssSkeletonLoader",o.followedParticipantsLoading)("ssSkeletonLoaderHeight","200px")("ssSkeletonLoaderWidth","100%"),s(),A(o.filteredParticipants),s(2),h(o.suggestedParticipants.length>0?6:-1))},dependencies:[Ee,Fi,te,ie,It],styles:[".collapsed-filters[_nghost-%COMP%]   .follower-list[_ngcontent-%COMP%]{height:calc(var(--vh) - 210px)}.follower-list[_ngcontent-%COMP%]{height:calc(var(--vh) - 248px);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.follower-list[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.follower-list[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.follower-list[_ngcontent-%COMP%]::-webkit-scrollbar, .follower-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.follower-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.empty-message[_ngcontent-%COMP%]{display:flex}strong[_ngcontent-%COMP%], .users-block-text[_ngcontent-%COMP%]{padding:16px 4px 4px}"]});let n=r;return n})();var Zr=ii(_i());var Pp=(n,r)=>r.identity;function kp(n,r){n&1&&b(0,"mat-spinner",6)}function xp(n,r){if(n&1&&b(0,"ss-participant-list-item",7),n&2){let i=r.$implicit;p("participant",i)("isFavoriteTab",!0)}}function yp(n,r){n&1&&g(0," Favorite users list is empty. ")}function Sp(n,r){n&1&&g(0," None of your favorites are online. ")}function Mp(n,r){if(n&1&&(a(0,"div",8),u(1,yp,1,0)(2,Sp,1,0),c()),n&2){let i=l(2);s(),h(i.favorites.length===0?1:2)}}function wp(n,r){if(n&1&&(V(0,xp,1,2,"ss-participant-list-item",7,Pp),u(2,Mp,3,1,"div",8)),n&2){let i=l();A(i.filteredParticipants),s(2),h(i.filteredParticipants.length===0?2:-1)}}var es=(()=>{let r=class r{get favorites(){return this.livekit.room.allParticipants.filter(e=>e.favorited).sort((0,Zr.firstBy)(e=>this.livekit.room.getFavoriteParticipantOrder(e),{direction:"asc"}))}get filteredParticipants(){return this.searchTerm?this.favorites.filter(e=>{let t=(this.searchTerm??"").trim().toLowerCase();return e?.userInfo?.displayName&&e.userInfo.displayName.toLowerCase().includes(t)}):this.favorites}constructor(e,t,o,d,v){this.userFavoriteService=e,this.livekit=t,this.subscriptionService=o,this.subscriptionNavigationService=d,this.toastService=v,this.openFavoritesModal=new ce,this.openPinSettingsModal=new ce,this.favoritesLoading=!1,this.searchTerm=null,this.ButtonColorRef=He}ngOnInit(){this.getFavorites()}getFavorites(){this.favoritesLoading=!0,this.userFavoriteService.getFavorites().subscribe({next:()=>this.favoritesLoading=!1,error:e=>this.handleErrors(e)})}sortFavoriteParticipants(){if(!this.subscriptionService.hasPremiumFeatures){this.subscriptionNavigationService.openPlansAndPricing(re.SortFavoriteParticipants);return}this.livekit.room.sortFavoriteParticipants()}handleErrors(e){this.favoritesLoading=!1,this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(ct),m(M),m(_e),m(yt),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-favorite-users"]],hostVars:2,hostBindings:function(t,o){t&2&&S("collapsed-filters",o.collapsedFilters)},inputs:{collapsedFilters:"collapsedFilters"},outputs:{openFavoritesModal:"openFavoritesModal",openPinSettingsModal:"openPinSettingsModal"},standalone:!1,decls:10,vars:6,consts:[["id","participant-search","name","participantSearch","placeholder","Search favorites in this room...",3,"ngModelChange","disabled","ngModel"],[1,"favorites-options-wrapper"],["iconName","star",3,"buttonClick"],[1,"sort-by-favorites",3,"buttonClick","color"],["matTooltip","Manage Auto Pin Settings","iconName","settings","color","tertiary",3,"buttonClick","iconSize","iconOnly"],[1,"favorite-users-wrapper"],["diameter","20","strokeWidth","2"],[3,"participant","isFavoriteTab"],[1,"list-empty"]],template:function(t,o){t&1&&(a(0,"ss-input",0),he("ngModelChange",function(v){return ue(o.searchTerm,v)||(o.searchTerm=v),v}),c(),a(1,"div",1)(2,"ss-button-small",2),f("buttonClick",function(){return o.openFavoritesModal.next()}),g(3," Manage favorites "),c(),a(4,"ss-button-small",3),f("buttonClick",function(){return o.sortFavoriteParticipants()}),g(5," Sort by favorites "),c(),a(6,"ss-button",4),f("buttonClick",function(){return o.openPinSettingsModal.next()}),c()(),a(7,"div",5),u(8,kp,1,0,"mat-spinner",6)(9,wp,3,1),c()),t&2&&(p("disabled",o.favorites.length===0),me("ngModel",o.searchTerm),s(4),p("color",o.ButtonColorRef.Secondary),s(2),p("iconSize",20)("iconOnly",!0),s(2),h(o.favoritesLoading?8:9))},dependencies:[I,Ee,Ce,te,ie,L,ve,It],styles:[".collapsed-filters[_nghost-%COMP%]   .favorite-users-wrapper[_ngcontent-%COMP%]{height:calc(var(--vh) - 258px)}[_nghost-%COMP%]   ss-participant-list-item[_ngcontent-%COMP%]     .user-info .name{max-width:130px}.favorites-options-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px}.favorites-options-wrapper[_ngcontent-%COMP%]   ss-button-small.sort-by-favorites[_ngcontent-%COMP%]{margin:0 6px}.favorites-options-wrapper[_ngcontent-%COMP%]   ss-button-small[_ngcontent-%COMP%]     i{color:var(--contrast)}.favorite-users-wrapper[_ngcontent-%COMP%]{height:calc(var(--vh) - 292px);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){.favorite-users-wrapper[_ngcontent-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}.favorite-users-wrapper[_ngcontent-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}.favorite-users-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar, .favorite-users-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}.favorite-users-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}mat-spinner[_ngcontent-%COMP%]{margin:20px auto}"]});let n=r;return n})();var Tp=(n,r)=>r.type;function Ip(n,r){if(n&1&&(a(0,"span"),g(1),c()),n&2){let i=l().$implicit;s(),O(" ",i.type," ")}}function Fp(n,r){if(n&1){let i=P();a(0,"div",9),f("click",function(){let t=_(i).$implicit,o=l();return C(o.setActiveFilter(t.type))}),b(1,"ss-icon",10),u(2,Ip,2,1,"span"),c()}if(n&2){let i=r.$implicit,e=l();S("active",e.activeParticipantListFilter===i.type),p("matTooltip",i.type),s(),S("rotate-icon",i.type===e.FilterTypeRef.PinningMe),p("iconName",i.iconName)("size",16),s(),h(e.activeParticipantListFilter===i.type?2:-1)}}function Rp(n,r){if(n&1&&b(0,"ss-all-users",8),n&2){let i=l();p("collapsedFilters",!i.panelOpenState)}}function Ep(n,r){if(n&1){let i=P();a(0,"ss-pinned-users",11),f("openFavoritesModal",function(){_(i);let t=l();return C(t.openFavoritesModal())})("openPinSettingsModal",function(){_(i);let t=l();return C(t.openPinSettingsModal())}),c()}if(n&2){let i=l();p("collapsedFilters",!i.panelOpenState)}}function Up(n,r){if(n&1&&b(0,"ss-following-users",8),n&2){let i=l();p("collapsedFilters",!i.panelOpenState)}}function Vp(n,r){if(n&1){let i=P();a(0,"ss-favorite-users",11),f("openFavoritesModal",function(){_(i);let t=l();return C(t.openFavoritesModal())})("openPinSettingsModal",function(){_(i);let t=l();return C(t.openPinSettingsModal())}),c()}if(n&2){let i=l();p("collapsedFilters",!i.panelOpenState)}}function Ap(n,r){if(n&1&&b(0,"ss-pinned-you",8),n&2){let i=l();p("collapsedFilters",!i.panelOpenState)}}var ts=(()=>{let r=class r{get participantCount(){return this.livekit.room.allParticipants.filter(e=>!e.anonymous&&e.identity).length}constructor(e,t,o,d,v){this.livekit=e,this.subscriptionService=t,this.analyticsService=o,this.dialog=d,this.accountModalsService=v,this.filters=[{type:st.All,iconName:"people"},{type:st.Pinning,iconName:"pin"},{type:st.Following,iconName:"person"},{type:st.Favorites,iconName:"star"},{type:st.PinningMe,iconName:"pin"}],this.panelOpenState=!0,this.backgroundBlurLoading=!1,this.activeParticipantListFilter=st.All,this.FilterTypeRef=st,this.ButtonColorRef=He}handleKeyboardEvent(e){e.key==="Escape"&&this.close()}ngOnInit(){this.panelOpenState=!localStorage.getItem(ci)}close(){this.livekit.room.participantListVisibility=!1}openFavoritesModal(){this.analyticsService.markActivity(y.UserFavoritesModalOpened),this.dialog.open(Xo,{panelClass:"fullscreen-dialog",width:"600px"}).afterClosed().subscribe(()=>{this.livekit.room.sortPinnedParticipants(),this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next()})}openPinSettingsModal(){this.accountModalsService.ensureUserCompletedBasicInfo()&&this.livekit.showOptionsModal(jt.PinSettings)}expansionPanelOpened(){this.panelOpenState=!0,localStorage.removeItem(ci)}expansionPanelClosed(){this.panelOpenState=!1,localStorage.setItem(ci,"true")}setActiveFilter(e){e!==st.All&&!this.accountModalsService.ensureUserCompletedBasicInfo()||(this.activeParticipantListFilter=e,this.analyticsService.markActivity(y.ActiveParticipantsListFilter,{filter:st}))}};r.\u0275fac=function(t){return new(t||r)(m(M),m(_e),m(H),m(N),m(K))},r.\u0275cmp=x({type:r,selectors:[["ss-participant-list"]],hostBindings:function(t,o){t&1&&f("keydown",function(v){return o.handleKeyboardEvent(v)},et)},standalone:!1,decls:20,vars:5,consts:[[1,"list-header"],[3,"click"],["role","button","iconName","dismiss","color","default-20",3,"size","iconVariant"],[1,"filters-wrapper"],[3,"opened","closed","expanded"],[1,"filters"],[1,"filter-button",3,"matTooltip","active"],[1,"main-wrapper"],[3,"collapsedFilters"],[1,"filter-button",3,"click","matTooltip"],["color","default",3,"iconName","size"],[3,"openFavoritesModal","openPinSettingsModal","collapsedFilters"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h4"),g(2),c(),a(3,"button",1),f("click",function(){return o.close()}),b(4,"ss-icon",2),c()(),a(5,"div",3)(6,"mat-accordion")(7,"mat-expansion-panel",4),f("opened",function(){return o.expansionPanelOpened()})("closed",function(){return o.expansionPanelClosed()}),a(8,"mat-expansion-panel-header")(9,"mat-panel-title"),g(10,"Filters"),c()(),a(11,"div",5),V(12,Fp,3,8,"div",6,Tp),c()()()(),a(14,"div",7),u(15,Rp,1,1,"ss-all-users",8)(16,Ep,1,1,"ss-pinned-users",8)(17,Up,1,1,"ss-following-users",8)(18,Vp,1,1,"ss-favorite-users",8)(19,Ap,1,1,"ss-pinned-you",8),c()),t&2&&(s(2),O("Participant list (",o.participantCount,")"),s(2),p("size",20)("iconVariant",20),s(3),p("expanded",o.panelOpenState),s(5),A(o.filters),s(3),h(o.activeParticipantListFilter===o.FilterTypeRef.All?15:o.activeParticipantListFilter===o.FilterTypeRef.Pinning?16:o.activeParticipantListFilter===o.FilterTypeRef.Following?17:o.activeParticipantListFilter===o.FilterTypeRef.Favorites?18:o.activeParticipantListFilter===o.FilterTypeRef.PinningMe?19:-1))},dependencies:[Zo,w,L,Lo,Uo,Vo,Ao,Jr,Yr,Xr,es],styles:["[_nghost-%COMP%]{position:absolute;top:0;right:0;z-index:5;flex-shrink:0;width:380px;height:calc(100vh - 56px);margin:0;border-left:1px solid var(--alt-40);background:var(--alt-80);overflow:overlay;scrollbar-color:var(--default-80) transparent;scrollbar-width:thin}@supports (-moz-appearance: none){[_nghost-%COMP%]{scrollbar-color:var(--accent-blue-40) var(--accent-blue-40)}}[_nghost-%COMP%]:hover::-webkit-scrollbar-thumb{background:var(--accent-gradient-60)}[_nghost-%COMP%]::-webkit-scrollbar, [_nghost-%COMP%]::-webkit-scrollbar-thumb{border-radius:50px;background:transparent}[_nghost-%COMP%]::-webkit-scrollbar{width:8px;height:8px}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{z-index:3;height:100%}}.list-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}h4[_ngcontent-%COMP%]{text-align:center;margin:4px 0 4px 4px}ss-tabs[_ngcontent-%COMP%]{margin-bottom:15px}button[_ngcontent-%COMP%]{border:none;background:none}.filters-wrapper[_ngcontent-%COMP%]{padding:0 10px;margin-bottom:8px;border-radius:4px;background-color:var(--alt-40)}.filters-wrapper[_ngcontent-%COMP%]   mat-accordion[_ngcontent-%COMP%]     mat-expansion-panel-header{height:40px}.filters-wrapper[_ngcontent-%COMP%]   mat-accordion[_ngcontent-%COMP%]     mat-expansion-panel-header:hover{background:var(--alt-60)!important}.filters-wrapper[_ngcontent-%COMP%]   mat-accordion[_ngcontent-%COMP%]     mat-expansion-panel-header mat-panel-title{color:var(--default)}.filters-wrapper[_ngcontent-%COMP%]   mat-accordion[_ngcontent-%COMP%]     .mat-expansion-panel{background:none}.filters-wrapper[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{display:flex}.filters-wrapper[_ngcontent-%COMP%]   .filter-button[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:28px;padding:0 12px;margin-right:8px;border-radius:4px;color:var(--default);background-color:var(--button-1);font-size:13px;line-height:20px;cursor:pointer}.filters-wrapper[_ngcontent-%COMP%]   .filter-button[_ngcontent-%COMP%]:not(.disabled):not(.active):hover{background:var(--accent-gradient-80)}.filters-wrapper[_ngcontent-%COMP%]   .filter-button.active[_ngcontent-%COMP%]{color:var(--contrast);background:var(--accent-gradient-20);cursor:default}.filters-wrapper[_ngcontent-%COMP%]   .filter-button.active[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:4px}.filters-wrapper[_ngcontent-%COMP%]   .filter-button.active[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]     i{color:var(--contrast)}.filters-wrapper[_ngcontent-%COMP%]   .filter-button.disabled[_ngcontent-%COMP%]{cursor:default;opacity:.5}.filters-wrapper[_ngcontent-%COMP%]   .filter-button[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{position:relative;bottom:1px}.filters-wrapper[_ngcontent-%COMP%]   .filter-button[_ngcontent-%COMP%]   ss-icon.rotate-icon[_ngcontent-%COMP%]{transform:rotate(270deg)}.main-wrapper[_ngcontent-%COMP%]{padding:0 10px 10px}"]});let n=r;return n})();var Gp=["videoElement"];function Dp(n,r){}function Bp(n,r){n&1&&b(0,"mat-spinner",7)}function Np(n,r){if(n&1&&b(0,"ss-user-avatar",9),n&2){let i=l();p("size",48)("avatarColor",i.highlightedParticipant.participant.userInfo.avatarColor)("avatarThumbUrl",i.highlightedParticipant.participant.userInfo.avatarThumbUrl)("showOnlineStatus",!1)("userId",i.highlightedParticipant.participant.identity)("initials",i.highlightedParticipant.participant.userInfo.initials)}}function zp(n,r){n&1&&b(0,"img",12)}function jp(n,r){if(n&1&&(a(0,"div",10),g(1),u(2,zp,1,0,"img",12),c()),n&2){let i=l();s(),O(" ",i.goToPageTitle," "),s(),h(i.userPageNumber!==i.livekit.room.paginator.currentPage&&i.livekit.room.activeFilterCount===0?2:-1)}}function Hp(n,r){n&1&&(a(0,"div",11),g(1,"This user has left the room"),c())}function Wp(n,r){if(n&1&&(a(0,"div",14),b(1,"ss-icon",17),a(2,"small"),g(3),c()()),n&2){let i=l(2);s(),p("size",12),s(2),R(i.highlightedParticipant.participant.pinnedCount)}}function $p(n,r){n&1&&(a(0,"div",15),g(1," P4P "),c())}function Jp(n,r){if(n&1){let i=P();a(0,"div",13),u(1,Wp,4,2,"div",14),u(2,$p,2,0,"div",15),c(),a(3,"ss-button",16),f("buttonClick",function(t){_(i);let o=l();return C(o.isPinned?o.unpin(t):o.pin(t))}),c()}if(n&2){let i=l();s(),h(i.shouldShowPinCount?1:-1),s(),h(i.highlightedParticipant.participant.userInfo.pinForPinEnabled&&i.highlightedParticipant.participant.userInfo.includePremiumFeatures?2:-1),s(),p("iconName",i.isPinned?"pin_off":"pin")("iconOnly",!0)("iconSize",24)("isLoading",i.livekit.room.pinningUserIds!==null&&i.livekit.room.pinningUserIds.includes(i.highlightedParticipant.participant.identity))("disabled",i.livekit.room.pinningUserIds!==null&&!i.livekit.room.pinningUserIds.includes(i.highlightedParticipant.participant.identity))}}var is=(()=>{let r=class r{get userPageNumber(){if(!this.highlightedParticipant.participant)return null;let e=this.livekit.room.filteredParticipants.indexOf(this.highlightedParticipant.participant);return e<0?null:Math.ceil((e+1)/Math.min(this.livekit.room.paginator.tilesPerPage,this.livekit.room.paginator.maxTilesAllowed))}get isCameraOn(){return!!this.highlightedParticipant.participant?.isCameraEnabled}get participantIsInTheRoom(){return!!this.highlightedParticipant.participant?.identity&&this.livekit.room.allParticipants.some(e=>e.identity===this.highlightedParticipant.participant?.identity)}get anyPinnedUsers(){return this.livekit.room.pinnedParticipants.length>0}get isLocalParticipant(){return!!this.highlightedParticipant?.participant?.isLocal}get transformValue(){if(!this.isCameraOn)return"";let e=null;if(this.highlightedParticipant.participant?.zoomToFit&&this.videoElement?.nativeElement?.videoHeight){let d=this.videoElement.nativeElement.videoWidth/this.videoElement.nativeElement.videoHeight;e=16/9/d}let t=this.highlightedParticipant.participant?.isLocal?this.livekit.room.settings.mirrorMode:this.highlightedParticipant.participant?.mirrorModeForOthers,o=e===null||e===1?"":`scale(${e})`;return o+=t?" scaleX(-1)":"",o=o.trim(),o}get goToPageTitle(){return this.livekit.room.activeFilterCount>0?"Jump to \u2192":this.userPageNumber===this.livekit.room.paginator.currentPage&&(this.livekit.room.forceGridView||!this.anyPinnedUsers)?"On this page":`Page ${this.userPageNumber}`}get shouldShowGoToPage(){return this.highlightedParticipant.participant?.isCameraEnabled?this.userPageNumber&&this.livekit.room.activeFilterCount===0||this.userPageNumber===null&&this.livekit.room.activeFilterCount>0:!1}get isPinned(){let e=this.highlightedParticipant?.participant?.identity;return e?this.livekit.room.isPinned(e):!1}get isDisplayedParticipant(){if(!this.highlightedParticipant.participant)return!1;let e=this.livekit.room.displayedParticipants.find(d=>d.identity===this.highlightedParticipant.participant?.identity)!==void 0,t=this.highlightedParticipant.participant.identity,o=!!this.activeGroup?.members.some(d=>d.id===t);return e||o}get focusPlusActive(){return this.livekit.room.focusPlus.active}get shouldShowPinCount(){let e=this.highlightedParticipant.participant;return!!e&&e.pinnedCount>0&&!this.focusPlusActive&&(e.isLocal?!this.livekit.room.roomSettings?.pinCountHidden:!e.pinCountHidden)&&!this.livekit.room.roomSettings?.selfPinCountHidden}constructor(e,t,o,d){this.livekit=e,this.toastService=t,this.dialog=o,this.analyticsService=d,this.activeGroup=null,this.loading=!1,this.showParticipantPreview=!1,this.hideOverlay=!1,this.subscriptions=[],this.onRemoteTrackSubscribed=this.onRemoteTrackSubscribed.bind(this),this.onTrackPublished=this.onTrackPublished.bind(this),this.onLocalTrackPublished=this.onLocalTrackPublished.bind(this)}ngOnInit(){this.subscriptions.push(this.livekit.participantHighlight.show.subscribe(e=>this.onHighlightShown(e)),this.livekit.participantHighlight.hideOverlay.subscribe(e=>this.hideOverlay=e),this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e))}ngAfterViewInit(){if(this.highlightedParticipant.participant){if(this.highlightedParticipant.participant.on(U.TrackSubscribed,this.onRemoteTrackSubscribed).on(U.TrackPublished,this.onTrackPublished).on(U.LocalTrackPublished,this.onLocalTrackPublished),this.isDisplayedParticipant&&!this.hideOverlay){this.highlightedParticipant.participant.highlighted=!0,this.livekit.room.roomChatVisibility&&this.setRoomChannelStyle(!0);return}setTimeout(()=>{if(this.showParticipantPreview=!0,this.loading=!0,this.highlightedParticipant.participant?.isLocal){let e=this.highlightedParticipant.participant.getTrackPublications().find(t=>t.kind===j.Kind.Video&&t.isSubscribed);e?this.processPublishedTrack(e):this.loading=!1}else this.setRemoteTrackSubscribedState(!0)})}}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.livekit.room.roomChatVisibility&&this.setRoomChannelStyle(),this.highlightedParticipant.participant&&(this.highlightedParticipant.participant.highlighted=!1,this.showParticipantPreview&&(this.isDisplayedParticipant||this.setRemoteTrackSubscribedState(!1),this.highlightedParticipant.participant.off(U.TrackSubscribed,this.onRemoteTrackSubscribed).off(U.TrackPublished,this.onTrackPublished).off(U.LocalTrackPublished,this.onLocalTrackPublished)))}hideParticipantHighlight(){this.livekit.participantHighlight.hide.next(),this.toastService.highlightedParticipantId=null}goToPage(){this.highlightedParticipant.participant?.isCameraEnabled&&(this.livekit.room.activeFilterCount>0&&this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:"ClearFiltersAndJumpToTilePage",confirmButtonLabel:"Yes"}}).afterClosed().subscribe(t=>{t&&(this.livekit.room.clearFilters(),setTimeout(()=>{this.livekit.room.assignDisplayedParticipants(),this.livekit.room.recalculateGrid.next(),this.navigateToUserPage()},100))}),this.navigateToUserPage())}pin(e){e.stopPropagation(),this.highlightedParticipant?.participant?.identity&&this.livekit.room.pin({participant:this.highlightedParticipant.participant})}unpin(e){e.stopPropagation();let t=this.highlightedParticipant?.participant?.identity;t&&this.livekit.room.unpin({pinnedUserId:t})}navigateToUserPage(){this.anyPinnedUsers&&!this.livekit.room.forceGridView&&(this.livekit.room.forceGridView=!0,this.livekit.room.sortAndAssignDisplayedParticipants(),this.livekit.room.recalculateGrid.next()),this.userPageNumber&&this.livekit.room.paginator.currentPage!==this.userPageNumber&&(this.livekit.room.paginator.goToPage(this.userPageNumber),this.markPageChangedActivity()),this.livekit.participantHighlight.hide.next()}setRoomChannelStyle(e=!1){let t=document.querySelector("ss-focus-room ss-channel");t&&(t.style.zIndex=e?"1002":"")}markPageChangedActivity(){let e;switch(this.highlightedParticipant.source){case Be.LocalVideo:e=y.LivekitLocalVideoHighlightPageChanged;break;case Be.EncouragementToast:e=y.LivekitEncouragementPageChanged;break;case Be.ParticipantListItem:e=y.LivekitParticipantListItemHighlightPageChanged;break;case Be.MutualPinModal:e=y.LivekitParticipantMutualPinHighlight;break}this.analyticsService.markActivity(e)}markVideoLoadedActivity(){let e;switch(this.highlightedParticipant.source){case Be.LocalVideo:e=y.LivekitLocalVideoHighlightLoaded;break;case Be.EncouragementToast:e=y.LivekitEncouragementVideoLoaded;break;case Be.ParticipantListItem:e=y.LivekitParticipantListItemHighlightVideoLoaded;break;case Be.MutualPinModal:e=y.LivekitParticipantMutualPinHighlight;break}this.analyticsService.markActivity(e)}onHighlightShown(e){e.id,this.highlightedParticipant.id}setRemoteTrackSubscribedState(e){this.highlightedParticipant.participant&&(this.highlightedParticipant.participant.videoTrackPublications.size===0&&(this.loading=!1),this.highlightedParticipant.participant.videoTrackPublications.forEach(t=>{if(this.hideOverlay&&this.isDisplayedParticipant){this.processPublishedTrack(t);return}t instanceof At&&t.setSubscribed(e)}))}onTrackPublished(e){this.loading=!1,!(e.kind!==j.Kind.Video||e.isSubscribed)&&this.setRemoteTrackSubscribedState(!0)}onRemoteTrackSubscribed(e,t){this.processPublishedTrack(t)}onLocalTrackPublished(e){this.processPublishedTrack(e)}processPublishedTrack(e){if(this.loading=!1,this.markVideoLoadedActivity(),!e.track||e.track.kind!==j.Kind.Video)return;let t=this.videoElement.nativeElement;e.track.attachedElements.includes(t)||e.track.attach(t)}};r.\u0275fac=function(t){return new(t||r)(m(M),m(F),m(N),m(H))},r.\u0275cmp=x({type:r,selectors:[["ss-participant-highlight"]],viewQuery:function(t,o){if(t&1&&Ae(Gp,5),t&2){let d;Le(d=Ge())&&(o.videoElement=d.first)}},inputs:{highlightedParticipant:"highlightedParticipant"},standalone:!1,decls:13,vars:21,consts:[["trigger","cdkOverlayOrigin"],["videoElement",""],["cdkOverlayOrigin",""],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","encourage-overlay-backdrop",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop"],[1,"video-wrapper",3,"hidden"],[1,"video-preview",3,"click"],[3,"hidden"],["diameter","32","strokeWidth","2"],["autoplay","","playsInline","",3,"hidden"],["status","online",3,"size","avatarColor","avatarThumbUrl","showOnlineStatus","userId","initials"],[1,"go-to-page"],[1,"left-the-room-message"],["src","/assets/icons/finger-icon.svg","alt","go to page icon"],[1,"info-wrapper"],["title","The number of others that have pinned this user",1,"pined-count"],["title","User has pin-for-pin enabled",1,"pin-for-pin"],["color","gradient-40","iconColor","gradient-40",1,"pin-icon",3,"buttonClick","iconName","iconOnly","iconSize","isLoading","disabled"],["iconName","pin","color","light-widget-active",3,"size"]],template:function(t,o){if(t&1){let d=P();a(0,"div",2,0),ae(2,Dp,0,0,"ng-template",3),f("backdropClick",function(){return _(d),C(o.hideParticipantHighlight())}),a(3,"div",4)(4,"div",5),f("click",function(){return _(d),C(o.goToPage())}),a(5,"div",6),u(6,Bp,1,0,"mat-spinner",7),b(7,"video",8,1),u(9,Np,1,6,"ss-user-avatar",9),u(10,jp,3,2,"div",10),c(),u(11,Hp,2,0,"div",11),c(),u(12,Jp,4,7),c()()}if(t&2){let d=xe(1);s(2),p("cdkConnectedOverlayOrigin",d)("cdkConnectedOverlayOpen",!0)("cdkConnectedOverlayHasBackdrop",o.hideOverlay),s(),qe("bottom",o.highlightedParticipant.bottom,"px")("left",o.highlightedParticipant.left,"px"),S("modal-highlight-position",o.highlightedParticipant.isEncouragementModal),p("hidden",!o.showParticipantPreview),s(),S("no-video",!(o.highlightedParticipant.participant!=null&&o.highlightedParticipant.participant.isCameraEnabled)),s(),p("hidden",!o.participantIsInTheRoom),s(),h(o.loading?6:-1),s(),qe("transform",o.transformValue),p("hidden",o.loading||!o.isCameraOn),s(2),h(o.highlightedParticipant.participant&&o.highlightedParticipant.participant.userInfo&&!o.loading&&!o.isCameraOn?9:-1),s(),h(o.shouldShowGoToPage?10:-1),s(),h(o.participantIsInTheRoom?-1:11),s(),h(o.highlightedParticipant.participant?12:-1)}},dependencies:[I,w,Me,Fe,Ie,ve],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   mat-spinner[_ngcontent-%COMP%]  svg{stroke:var(--contrast)}.video-wrapper[_ngcontent-%COMP%]{position:fixed;z-index:1002}.video-wrapper.modal-highlight-position[_ngcontent-%COMP%]{left:calc(50% + 175px)!important}.video-preview[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;flex-shrink:0;width:224px;height:126px;overflow:hidden;margin-left:8px;border:1px solid var(--contrast);border-radius:16px;background:var(--blue-black);cursor:pointer}.video-preview.no-video[_ngcontent-%COMP%]{cursor:initial}.video-preview[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:224px;height:126px}.video-preview[_ngcontent-%COMP%]   .mat-spinner[_ngcontent-%COMP%]{position:absolute}.go-to-page[_ngcontent-%COMP%]{position:absolute;right:1px;bottom:0;display:flex;justify-content:flex-end;align-items:initial;padding:2px 12px 2px 10px;border-top-left-radius:8px;color:var(--contrast);background:var(--tiles-info);cursor:pointer}.go-to-page[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:15px;margin-left:4px}.left-the-room-message[_ngcontent-%COMP%]{color:var(--contrast)}.info-wrapper[_ngcontent-%COMP%]{position:absolute;top:10px;left:16px;display:flex;align-items:center}.pin-icon[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px}.pined-count[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;max-width:100px;height:16px;padding:0 6px 0 4px;border-radius:8px;background:var(--video-overlay)}.pined-count[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:4px}.pined-count[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--contrast)}.pin-for-pin[_ngcontent-%COMP%]{margin-left:8px;font-size:12px;color:var(--contrast)}"]});let n=r;return n})();function Yp(n,r){}function Kp(n,r){if(n&1&&b(0,"ss-user-avatar",4),n&2){let i=l();p("roomMobileMenuFrame",!0)("showOnlineStatus",!1)("avatarColor",i.participant.userInfo.avatarColor)("avatarThumbUrl",i.participant.userInfo.avatarThumbUrl)("userId",i.participant.identity)("initials",i.participant.userInfo.initials)}}function Qp(n,r){if(n&1&&(b(0,"div",14),a(1,"small",15),g(2),c()),n&2){let i=l(2);s(2),O(" ",i.participant.userInfo.areaOfStudyName)}}function Xp(n,r){if(n&1){let i=P();a(0,"div",9),b(1,"ss-user-avatar",10),a(2,"div",11)(3,"div",12)(4,"em"),g(5),c(),u(6,Qp,3,1),c(),a(7,"div",13),f("click",function(){_(i);let t=l();return C(t.goToProfile())}),g(8,"View profile"),c()()()}if(n&2){let i=l();S("no-border",i.isCurrentUser),s(),p("size",48)("showOnlineStatus",!1)("avatarColor",i.participant.userInfo.avatarColor)("avatarThumbUrl",i.participant.userInfo.avatarThumbUrl)("userId",i.participant.identity)("initials",i.participant.userInfo.initials),s(4),R(i.participant.userInfo.displayName),s(),h(i.participant.userInfo.areaOfStudyName?6:-1)}}function Zp(n,r){if(n&1){let i=P();a(0,"button",16),f("click",function(){_(i);let t=l();return C(t.encourageUser(t.encouragements[0]))}),b(1,"ss-icon",17),a(2,"span",18),g(3,"Send encouragement"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function em(n,r){if(n&1){let i=P();a(0,"button",16),f("click",function(){_(i);let t=l();return C(t.hideUser())}),b(1,"ss-icon",19),a(2,"span",18),g(3,"Hide user"),c()()}n&2&&(s(),p("size",24))}function tm(n,r){if(n&1&&b(0,"ss-upgrade-cta",21),n&2){let i=l(2);p("short",!0)("openedFromSource",i.TriggeredUpgradeFromSourceRef.TwoWayHide)}}function im(n,r){if(n&1){let i=P();a(0,"div",7)(1,"button",20),f("click",function(){_(i);let t=l();return C(t.hideUser(!0))}),b(2,"ss-icon",19),a(3,"span"),g(4,"Two-way hide"),c()(),u(5,tm,1,2,"ss-upgrade-cta",21),c()}if(n&2){let i=l();s(),p("disabled",!i.subscriptionService.hasPremiumFeatures),s(),p("size",24),s(3),h(i.subscriptionService.hasPremiumFeatures?-1:5)}}function nm(n,r){if(n&1){let i=P();a(0,"button",22),f("click",function(){_(i);let t=l();return C(t.reportUser())}),b(1,"ss-icon",23),a(2,"span",18),g(3,"Report user"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}function om(n,r){if(n&1){let i=P();a(0,"button",16),f("click",function(){_(i);let t=l();return C(t.saveAsTestimonial())}),b(1,"ss-icon",24),a(2,"span"),g(3,"Save status as testimonial"),c()()}n&2&&(s(),p("iconVariant",20)("size",24))}var ns=(()=>{let r=class r{get isModerator(){return!!this.livekit.room.localParticipant.userInfo?.isModerator}get isAdministrator(){return this.accountService.isInRole(ft.Administrator)}get encouragements(){return this.livekit.encouragements}get isCurrentUser(){return this.accountService.currentUser.id===this.participant.identity}constructor(e,t,o,d,v,k,T,B,z,ke,pe,Ve){this.subscriptionService=e,this.livekit=t,this.dialog=o,this.accountService=d,this.userService=v,this.testimonialService=k,this.encouragementService=T,this.onlineStatusService=B,this.toastService=z,this.badgeService=ke,this.accountModalsService=pe,this.snackBarService=Ve,this.userLoaded=!1,this.mainLoading=!1,this.TriggeredUpgradeFromSourceRef=re,this.subscriptions=[]}ngOnInit(){this.mainLoading=!0,this.fetchUserInfo()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}encourageUser(e){if(!this.accountModalsService.ensureUserCompletedBasicInfo()||this.livekit.room.checkEncouragementsDisabled(this.participant))return;let t={encouragementTypeId:e.id};this.encouragementService.postEncouragement(this.participant.identity,t).subscribe({next:o=>Y(this,null,function*(){this.livekit.room.milestones.encouragedSomeone||this.subscriptions.push(W(2e3).subscribe(()=>this.badgeService.checkForNewBadges.next())),this.livekit.room.milestones.encouragedSomeone=!0,o.receiverWasInFocusMode?yield this.snackBarService.info({message:"This user is currently focussing. They'll see your encouragement later on."}):o.encouragementsPerDayLeft!==null?yield this.snackBarService.info({message:`Encouragement sent. You have ${o.encouragementsPerDayLeft} encouragements left for today.`}):yield this.snackBarService.info({message:"Encouragement sent."})}),error:o=>{o[0].errorCode==="EncouragementTimeLimit"?this.toastService.info({title:"Please wait",exceptionDetail:o[0]}):o[0].errorCode==="MaxEncouragementsPerDayReached"?this.toastService.info({title:"Maximum encouragements reached",exceptionDetail:o[0],paidFeatureText:"Upgrade to encourage more",triggeredUpgradeFromSource:re.MaxEncouragementsReached,autoClose:!1}):o[0].errorCode==="MaxEncouragementsPerDayReachedPremium"?this.toastService.info({title:"Maximum encouragements reached",exceptionDetail:o[0]}):this.handleErrors(o)}})}reportUser(){if(!this.accountModalsService.ensureUserCompletedBasicInfo()){this.close();return}this.dialog.open(Ti,{panelClass:"fullscreen-dialog",width:"480px",disableClose:!0,data:{reportedUser:this.participant.userInfo,roomName:this.livekit.room.roomName,reportSource:Oi.FocusRoom,elementToScreenshotSelector:"ss-dashboard"}}),this.close()}goToProfile(){if(!this.accountModalsService.ensureUserCompletedBasicInfo()){this.close();return}window.open(`${le.appUrl}/profile/${this.userInfo.id}`,"_blank")}hideUser(e=!1){if(!this.accountModalsService.ensureUserCompletedBasicInfo()){this.close();return}this.livekit.room.hide(this.participant,e),this.close()}close(){this.livekit.participantInfoMobile.next(null)}saveAsTestimonial(){this.participant.status&&this.testimonialService.saveTestimonial(Ri.LivekitUserStatus,this.participant.status.id).subscribe({next:()=>Y(this,null,function*(){return yield this.snackBarService.info({message:"Saved as testimonial."})}),error:e=>this.handleErrors(e)})}fetchUserInfo(){this.mainLoading=!0;let e=this.onlineStatusService.getProfileInfo(this.participant.identity);e?(this.setUserInfo(e),this.mainLoading=!1):this.accountService.isFullyVerifiedUser()?this.userService.getUserProfileShort(this.participant.identity).subscribe({next:t=>this.handleUserInfo(t),error:t=>this.handleErrors(t)}):this.userService.getUserProfileShortPublic(this.participant.identity).subscribe({next:t=>this.handleUserInfo(t),error:t=>this.handleErrors(t)})}handleUserInfo(e){this.setUserInfo(e),this.onlineStatusService.upsertGottenInfo(this.userInfo),this.mainLoading=!1}setUserInfo(e){this.userInfo=e,this.userLoaded=!0}handleErrors(e){e[0].errorCode==="UserProfileShortModelNotFound"?(this.mainLoading=!1,this.userLoaded=!0):this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(_e),m(M),m(N),m(G),m(yi),m(Mi),m(kt),m(Po),m(F),m(Qe),m(K),m(xt))},r.\u0275cmp=x({type:r,selectors:[["ss-participant-mobile-menu"]],inputs:{participant:"participant"},standalone:!1,decls:11,vars:11,consts:[["trigger","cdkOverlayOrigin"],["cdkOverlayOrigin",""],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","encourage-overlay-backdrop",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop"],["role","button","iconName","dismiss","color","default-20",1,"close-button",3,"click","size"],[1,"frame",3,"roomMobileMenuFrame","showOnlineStatus","avatarColor","avatarThumbUrl","userId","initials"],[1,"user-info",3,"no-border"],["mat-menu-item",""],[1,"two-way-hide"],["mat-menu-item","",1,"report-button"],[1,"user-info"],[3,"size","showOnlineStatus","avatarColor","avatarThumbUrl","userId","initials"],[1,"profile-wrapper"],[1,"name"],[1,"interactable-bold",3,"click"],[1,"dot"],[1,"area-of-study"],["mat-menu-item","",3,"click"],["iconName","thumb_like","color","accent-blue-40",3,"iconVariant","size"],[1,"interactable"],["iconName","eye_off","color","accent-blue-40",3,"size"],["mat-menu-item","",3,"click","disabled"],[3,"short","openedFromSource"],["mat-menu-item","",1,"report-button",3,"click"],["iconName","warning","color","negative-20",3,"iconVariant","size"],["iconName","mail_inbox",3,"iconVariant","size"]],template:function(t,o){if(t&1){let d=P();a(0,"div",1,0),ae(2,Yp,0,0,"ng-template",2),f("backdropClick",function(){return _(d),C(o.close())}),a(3,"ss-icon",3),f("click",function(){return _(d),C(o.close())}),c(),u(4,Kp,1,6,"ss-user-avatar",4),u(5,Xp,9,10,"div",5),u(6,Zp,4,2,"button",6),u(7,em,4,1,"button",6),u(8,im,6,3,"div",7),u(9,nm,4,2,"button",8),u(10,om,4,2,"button",6),c()}if(t&2){let d=xe(1);s(2),p("cdkConnectedOverlayOrigin",d)("cdkConnectedOverlayOpen",!0)("cdkConnectedOverlayHasBackdrop",!0),s(),p("size",20),s(),h(o.participant.userInfo?4:-1),s(),h(o.participant.userInfo?5:-1),s(),h(o.encouragements.length>0&&!o.isCurrentUser?6:-1),s(),h(o.isCurrentUser?-1:7),s(),h(!o.isCurrentUser&&!o.participant.userInfo.isModerator?8:-1),s(),h(o.isCurrentUser?-1:9),s(),h(o.isAdministrator&&o.participant.status?10:-1)}},dependencies:[_t,w,Me,xi,Fe,Ie],styles:["[_nghost-%COMP%]{position:fixed;top:50%;left:50%;z-index:1001;max-width:400px;width:calc(100% - 32px);border-radius:32px;background:var(--grayscale);transform:translate(-50%,-50%)}[_nghost-%COMP%]     button.mat-mdc-menu-item>span{display:flex;align-items:center}.close-button[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px;z-index:1;display:flex;justify-content:center;width:40px;height:40px;padding:0;border-radius:12px;outline:none;background-color:var(--widget-subtle)}.frame[_ngcontent-%COMP%]{padding:8px 8px 0}@media only screen and (max-height: 480px){.frame[_ngcontent-%COMP%]{display:none}}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 8px 12px 20px;margin:16px 0 12px;border-bottom:1px solid var(--grayscale-g1)}.user-info.no-border[_ngcontent-%COMP%]{border-bottom:none}.user-info[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{display:none;margin-right:8px}@media only screen and (max-height: 480px){.user-info[_ngcontent-%COMP%]   ss-user-avatar[_ngcontent-%COMP%]{display:block}}.profile-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.profile-wrapper[_ngcontent-%COMP%]   .interactable-bold[_ngcontent-%COMP%]{color:var(--accent-blue);cursor:pointer}.profile-wrapper[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.profile-wrapper[_ngcontent-%COMP%]   .area-of-study[_ngcontent-%COMP%]{display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:1;-webkit-box-orient:vertical}.profile-wrapper[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:4px;height:4px;margin:0 8px;border-radius:50%;background:var(--default)}button[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:8px}button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--default-20)}button[mat-menu-item].mat-mdc-menu-item[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:flex-start;align-items:center;width:100%;min-height:48px;box-sizing:border-box;overflow:hidden;padding:0 16px;margin:0;border:none;outline:none;font-size:inherit;color:inherit;text-decoration:none;background:none;cursor:pointer;-webkit-user-select:none;user-select:none;text-align:left}button[mat-menu-item].mat-mdc-menu-item.mat-mdc-menu-item[_ngcontent-%COMP%]:hover:not([disabled]), button[mat-menu-item].mat-mdc-menu-item.mat-mdc-menu-item.cdk-program-focused[_ngcontent-%COMP%]:not([disabled]), button[mat-menu-item].mat-mdc-menu-item.mat-mdc-menu-item.cdk-keyboard-focused[_ngcontent-%COMP%]:not([disabled]), button[mat-menu-item].mat-mdc-menu-item.mat-mdc-menu-item-highlighted[_ngcontent-%COMP%]:not([disabled]){background:#0000000a}.two-way-hide[_ngcontent-%COMP%]{display:flex;font-size:14px}.two-way-hide[_ngcontent-%COMP%]   ss-upgrade-cta[_ngcontent-%COMP%]{margin-right:8px}.report-button[_ngcontent-%COMP%]{margin-bottom:8px;border-top:1px solid var(--grayscale-g1)}"]});let n=r;return n})();var sm=["videoElement"],os=(()=>{let r=class r{get localParticipant(){return this.livekit.room.localParticipant}get transformValue(){if(!this.localParticipant.isCameraEnabled)return"";let e=null;if(this.localParticipant.zoomToFit&&this.videoElement?.nativeElement?.videoHeight){let d=this.videoElement.nativeElement.videoWidth/this.videoElement.nativeElement.videoHeight;e=16/9/d}let t=this.localParticipant.isLocal&&this.livekit.room.settings.mirrorMode,o=e===null||this.isMobile||e===1?"":`scale(${e})`;return o+=t?" scaleX(-1)":"",o=o.trim(),o}get isPinned(){return this.livekit.room.isPinned(this.localParticipant.identity)}constructor(e,t,o,d,v){this.livekit=e,this.analyticsService=t,this.utilityService=o,this.userFavoriteService=d,this.toastService=v,this.draggingSelfViewVideo=!1,this.pinToTopLoading=!1,this.isMobile=!1}shouldShowOptionsModal(){this.draggingSelfViewVideo||this.showOptionsModal()}ngOnInit(){return Y(this,null,function*(){this.isMobileSubscription=this.utilityService.isMobile.subscribe(e=>this.isMobile=e)})}ngAfterViewInit(){this.attachVideo()}ngOnDestroy(){this.isMobileSubscription.unsubscribe()}showOptionsModal(){this.livekit.showOptionsModal()}close(){this.livekit.room.selfViewVideoVisibility=!1,this.analyticsService.markActivity(y.LivekitSelfViewVideoOff)}unpin(e){e.stopPropagation(),this.livekit.room.unpin({pinnedUserId:this.localParticipant.identity})}pinLocalParticipant(e){e.stopPropagation(),this.livekit.room?.pin({participant:this.localParticipant})}attachVideo(){let e=this.localParticipant.getTrackPublications().find(o=>o.kind===j.Kind.Video&&o.isSubscribed);if(!e||!e.track)return;let t=this.videoElement.nativeElement;e.track.attachedElements.includes(t)||e.track.attach(t)}handleErrors(e){this.toastService.error({exceptionDetail:e[0]}),this.pinToTopLoading=!1}};r.\u0275fac=function(t){return new(t||r)(m(M),m(H),m(J),m(ct),m(F))},r.\u0275cmp=x({type:r,selectors:[["ss-self-view-video"]],viewQuery:function(t,o){if(t&1&&Ae(sm,5),t&2){let d;Le(d=Ge())&&(o.videoElement=d.first)}},hostBindings:function(t,o){t&1&&f("click",function(){return o.shouldShowOptionsModal()})},inputs:{draggingSelfViewVideo:"draggingSelfViewVideo"},standalone:!1,decls:5,vars:10,consts:[["videoElement",""],["autoplay","","playsInline",""],["color","website-transparent",1,"pin-button",3,"buttonClick","matTooltip","iconName","iconOnly","iconSize","isLoading","disabled"],[1,"close-button",3,"click"],["iconName","dismiss","color","default-20",3,"size","iconVariant"]],template:function(t,o){if(t&1){let d=P();b(0,"video",1,0),a(2,"ss-button",2),f("buttonClick",function(k){return _(d),C(o.isPinned?o.unpin(k):o.pinLocalParticipant(k))}),c(),a(3,"button",3),f("click",function(){return _(d),C(o.close())}),b(4,"ss-icon",4),c()}t&2&&(qe("transform",o.transformValue),s(2),p("matTooltip",o.isPinned?"Unpin":"Pin")("iconName",o.isPinned?"pin_off":"pin")("iconOnly",!0)("iconSize",24)("isLoading",o.pinToTopLoading||o.livekit.room.pinningUserIds!==null&&o.livekit.room.pinningUserIds.includes(o.localParticipant.identity))("disabled",o.pinToTopLoading||o.livekit.room.pinningUserIds!==null&&!o.livekit.room.pinningUserIds.includes(o.localParticipant.identity)),s(2),p("size",20)("iconVariant",20))},dependencies:[I,w,L],styles:["[_nghost-%COMP%]{position:absolute;z-index:1000;display:flex;width:342px;border-radius:12px;box-shadow:0 4px 12px 0 var(--default-40);cursor:grab;aspect-ratio:16/9}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{max-width:150px;aspect-ratio:initial}}[_nghost-%COMP%]:hover   .close-button[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:12px}.pin-button[_ngcontent-%COMP%]{position:absolute;top:12px;left:12px}.pin-button[_ngcontent-%COMP%]:hover{opacity:.8}.pin-button[_ngcontent-%COMP%]     button{height:auto;padding:0}.close-button[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;justify-content:center;align-items:center;width:36px;height:36px;padding:0;border:0;border-radius:50%;outline:none;background-color:var(--grayscale-g1);cursor:pointer}@media only screen and (max-width: 1024px){.close-button[_ngcontent-%COMP%]{display:flex}}.dark-theme[_nghost-%COMP%], .dark-theme   [_nghost-%COMP%]{box-shadow:0 4px 12px 0 var(--grayscale)}"]});let n=r;return n})();var cm=(n,r)=>({x:n,y:r});function lm(n,r){n&1&&b(0,"ss-focus-room-predefined-groups")}function dm(n,r){if(n&1&&b(0,"ss-focus-room-session-group",11),n&2){let i=l(2);p("theme",i.theme)}}function pm(n,r){if(n&1){let i=P();a(0,"ss-focus-room-milestones-bar",14),f("hide",function(){_(i);let t=l(3);return C(t.milestonesDismissed=!0)}),c()}}function mm(n,r){n&1&&b(0,"ss-focus-room-predefined-groups")}function um(n,r){n&1&&b(0,"ss-paginator")}function hm(n,r){if(n&1&&(a(0,"div",13)(1,"div",15),u(2,mm,1,0,"ss-focus-room-predefined-groups"),b(3,"ss-focus-room-tile-grid",16),c(),u(4,um,1,0,"ss-paginator"),c()),n&2){let i=l(3);s(2),h(i.isMobile&&i.activePredefinedGroup?2:-1),s(),p("participants",i.livekit.room.displayedParticipants)("theme",i.theme),s(),h(i.isMobile?4:-1)}}function gm(n,r){if(n&1&&(a(0,"div",12),b(1,"ss-focus-room-actions"),u(2,pm,1,0,"ss-focus-room-milestones-bar"),u(3,hm,5,4,"div",13),c()),n&2){let i=l(2);s(2),h(i.showMilestones&&!i.milestonesDismissed&&!i.activeGroup&&!i.activePredefinedGroup?2:-1),s(),h(i.focusPlusActive?-1:3)}}function fm(n,r){if(n&1&&(a(0,"div",0)(1,"div",10),u(2,lm,1,0,"ss-focus-room-predefined-groups"),u(3,dm,1,1,"ss-focus-room-session-group",11),c(),u(4,gm,4,2,"div",12),c()),n&2){let i=l();s(2),h(!i.isMobile&&i.activePredefinedGroup?2:-1),s(),h(i.activeGroup&&!i.activePredefinedGroup&&!i.livekit.room.privateGroupMinimized?3:-1),s(),h(!i.livekit.room.predefinedGroupMaximized&&(!i.activeGroup||i.livekit.room.privateGroupMinimized)?4:-1)}}function vm(n,r){n&1&&b(0,"ss-participant-list")}function _m(n,r){if(n&1){let i=P();a(0,"ss-channel",17),f("closeRoomChatClicked",function(){_(i);let t=l();return C(t.closeRoomChat())}),c()}if(n&2){let i=l();p("roomChannelId",i.livekit.room.channelId)}}function Cm(n,r){if(n&1&&b(0,"ss-participant-highlight",2),n&2){let i=l();p("highlightedParticipant",i.highlightedParticipant)}}function bm(n,r){if(n&1&&b(0,"ss-participant-mobile-menu",3),n&2){let i=l();p("participant",i.participantInfoMobile)}}function Pm(n,r){n&1&&b(0,"ss-focus-room-audio")}function km(n,r){n&1&&b(0,"ss-focus-room-group-session-audio")}function xm(n,r){n&1&&b(0,"ss-focus-plus")}function ym(n,r){n&1&&b(0,"ss-focus-room-onboarding")}function Sm(n,r){if(n&1){let i=P();a(0,"div",18),f("click",function(){_(i);let t=l();return C(t.livekit.room.videoPillButtonExpanded.next(!1))}),c()}}function Mm(n,r){if(n&1){let i=P();a(0,"ss-self-view-video",19),f("cdkDragStarted",function(){_(i);let t=l();return C(t.selfViewVideo.draggingInProgress=!0)})("cdkDragEnded",function(t){_(i);let o=l();return C(o.setDraggingSelfViewVideoOff(t))}),c()}if(n&2){let i=l();p("cdkDragFreeDragPosition",bn(3,cm,i.selfViewVideo.coordinates.x,i.selfViewVideo.coordinates.y))("cdkDragBoundary",i.selfViewVideo.boundaryElement)("draggingSelfViewVideo",i.selfViewVideo.draggingInProgress)}}function wm(n,r){if(n&1&&b(0,"ss-focus-room-time-limit",6),n&2){let i=l();p("secondsLeft",i.secondsLeftBeforeRoomEnd)}}function Om(n,r){if(n&1){let i=P();a(0,"div",7)(1,"div"),b(2,"ss-icon",20),g(3),c(),a(4,"ss-icon",21),f("click",function(){_(i);let t=l();return C(t.livekit.room.showParticipantBreakdownOnLastPage=!1)}),c()()}if(n&2){let i=l();s(2),p("iconVariant",24)("size",24),s(),O(" ",i.getParticipantBreakdownPopupText()," "),s(),p("iconVariant",24)("size",24)}}var rs=(()=>{let r=class r{get localParticipant(){return this.livekit.room.localParticipant}get performedFirstConnect(){return this.livekit.room.performedFirstConnect}get showMilestones(){return!this.localParticipant.anonymous&&this.livekit.room.milestonesFetched&&!this.livekit.room.milestonesCompletedInitially}get canPublishAudio(){return this.livekit.room.canPublishAudio}get allowOnlyGroupAudio(){return this.livekit.room.allowOnlyGroupAudio}get isModerator(){return!!this.livekit.room.localParticipant.userInfo?.isModerator}get focusPlusActive(){return!!this.livekit.room?.focusPlus.active}get participantListVisible(){return this.livekit.room.participantListVisibility}get roomChatVisibility(){return this.livekit.room.roomChatVisibility}get focusRoomOnboardingShown(){return!!this.livekit.room?.focusRoomOnboardingShown}get allOtherParticipantsCount(){return this.livekit.room.allParticipants.filter(e=>e.identity&&(e.anonymous||!e.isCameraEnabled)).length}get anonymousParticipantCount(){return this.livekit.room.allParticipants.filter(e=>e.anonymous).length}get showFocusRoomTimeLimit(){return this.secondsLeftBeforeRoomEnd>0&&this.secondsLeftBeforeRoomEnd<=An*60}onWindowFocus(){if(this.livekit.room.state===Ye.Disconnected){this.disconnectFromRoom(we.Disconnected);return}let e=Array.from(this.livekit.room.remoteParticipants.values());for(let t of e)this.livekit.room.allParticipants.some(d=>d.identity===t.identity)||this.onRemoteParticipantConnected(t)}handleTouchStart(e){let t=e.touches[0]||e.changedTouches[0];this.defaultTouch.x=t.pageX,this.defaultTouch.y=t.pageY,this.defaultTouch.time=e.timeStamp}handleTouch(e){let o=(e.touches[0]||e.changedTouches[0]).pageX-this.defaultTouch.x;e.timeStamp-this.defaultTouch.time<500&&Math.abs(o)>60&&(o>0?this.livekit.room.paginator.previous():this.livekit.room.paginator.next())}constructor(e,t,o,d,v,k,T,B,z,ke,pe,Ve,Xe,Ft,qt,Yt,Kt,Qt,ls,ds){this.livekit=e,this.utilityService=t,this.focusRoomService=o,this.sidebarService=d,this.accountService=v,this.signalRService=k,this.themeService=T,this.analyticsService=B,this.router=z,this.activatedRoute=ke,this.dialog=pe,this.toastService=Ve,this.keyboardService=Xe,this.chatService=Ft,this.encouragementService=qt,this.accountModalsService=Yt,this.badgeService=Kt,this.subscriptionService=Qt,this.settingsService=ls,this.userFavoriteService=ds,this.disconnected=new ce,this.timeLimitReached=new ce,this.activeGroup=null,this.activePredefinedGroup=null,this.milestonesDismissed=!1,this.highlightedParticipant=null,this.participantInfoMobile=null,this.privateSpaceIdToAttemptJoining=null,this.identityToAttemptToHighlight=null,this.defaultTouch={x:0,y:0,time:0},this.roomChatVisible=!1,this.videoPillButtonExpanded=!1,this.selfViewVideo={coordinates:{},savedCoordinates:null,draggingInProgress:!1,boundaryElement:document.querySelector("ss-dashboard")},this.currentUser=this.accountService.currentUser,this.lastConnectionState=null,this.joiningPrivatePod=!1,this.checkedForBadgesOneMoreTime=!1,this.subscriptions=[],this.onConnectionStateChanged=this.onConnectionStateChanged.bind(this),this.onRemoteParticipantConnected=this.onRemoteParticipantConnected.bind(this),this.onRemoteParticipantDisconnected=this.onRemoteParticipantDisconnected.bind(this),this.onActiveSpeakersChanged=this.onActiveSpeakersChanged.bind(this),this.onMetadataChanged=this.onMetadataChanged.bind(this),this.onDisconnected=this.onDisconnected.bind(this),this.onLocalTrackPublished=this.onLocalTrackPublished.bind(this),this.onRemoteTrackPublished=this.onRemoteTrackPublished.bind(this),this.onTrackMuted=this.onTrackMuted.bind(this),this.onTrackUnmuted=this.onTrackUnmuted.bind(this)}ngOnInit(){this.activatedRoute.queryParams.subscribe(t=>{t.privateSpaceId?(this.privateSpaceIdToAttemptJoining=t.privateSpaceId,this.router.navigate([],{queryParams:{privateSpaceId:null,roomName:null},queryParamsHandling:"merge"})):t.highlight&&(this.identityToAttemptToHighlight=t.highlight,this.router.navigate([],{queryParams:{highlight:null},queryParamsHandling:"merge"}))});let e=this.livekit.room.settings.tilesPerPage;e=e>12&&!this.subscriptionService.hasPremiumFeatures?12:e,this.livekit.room.paginator.tilesPerPage=e,this.livekit.room.on(Q.ConnectionStateChanged,this.onConnectionStateChanged).on(Q.ParticipantConnected,this.onRemoteParticipantConnected).on(Q.ParticipantDisconnected,this.onRemoteParticipantDisconnected).on(Q.ActiveSpeakersChanged,this.onActiveSpeakersChanged).on(Q.Disconnected,this.onDisconnected).on(Q.ParticipantMetadataChanged,this.onMetadataChanged).on(Q.LocalTrackPublished,this.onLocalTrackPublished).on(Q.TrackPublished,this.onRemoteTrackPublished).on(U.TrackMuted,this.onTrackMuted).on(U.TrackUnmuted,this.onTrackUnmuted),this.livekit.room.connect(this.livekit.room.webSocketBaseUrl,this.token,{autoSubscribe:!1}).then(()=>Y(this,null,function*(){return yield this.onRoomConnected()}))}ngOnDestroy(){this.livekit.room.off(Q.ConnectionStateChanged,this.onConnectionStateChanged).off(Q.ParticipantConnected,this.onRemoteParticipantConnected).off(Q.ParticipantDisconnected,this.onRemoteParticipantDisconnected).off(Q.ActiveSpeakersChanged,this.onActiveSpeakersChanged).off(Q.Disconnected,this.onDisconnected).off(Q.ParticipantMetadataChanged,this.onMetadataChanged).off(Q.LocalTrackPublished,this.onLocalTrackPublished).off(Q.TrackPublished,this.onRemoteTrackPublished).off(U.TrackMuted,this.onTrackMuted).off(U.TrackUnmuted,this.onTrackUnmuted),this.livekit.room.disconnect(),this.subscriptions.forEach(e=>e.unsubscribe()),this.checkStreakTimerSubscription?.unsubscribe(),this.checkTimeLimitTimerSubscription?.unsubscribe(),this.metadataSentCheckSubscription?.unsubscribe(),window.clearTimeout(this.hideHighlightTimeoutRef),this.toastService.hideFocusRoomSessionGroupInvites()}getSubscribedParticipantsCount(){return Array.from(this.livekit.room.remoteParticipants.values()).flatMap(e=>e.getTrackPublications().map(t=>t.subscriptionStatus)).filter(e=>e===Bn.SubscriptionStatus.Subscribed).length}closeRoomChat(){this.livekit.room.roomChatVisibility=!1}onChannelLeft(e){e.channelId===this.livekit.room.channelId&&(this.roomChatVisible=!1)}setDraggingSelfViewVideoOff(e){this.selfViewVideo.savedCoordinates=e.source.getFreeDragPosition(),setTimeout(()=>this.selfViewVideo.draggingInProgress=!1)}getParticipantBreakdownPopupText(){let e=this.allOtherParticipantsCount-this.anonymousParticipantCount,t=this.anonymousParticipantCount>0?` and ${this.anonymousParticipantCount} viewer${this.anonymousParticipantCount!==1?"s":""})`:")",o=this.allOtherParticipantsCount===1?"user":"";return`There ${this.allOtherParticipantsCount!==1?"are":"is"} ${this.allOtherParticipantsCount}
    other${this.allOtherParticipantsCount!==1?"s":""} ${o} online (${e} with video off${t}`}setCheckStreakTimer(){if(!this.accountService.authenticated())return;let e=1830,t=e-this.accountService.currentUser.timeInfo.totalFocusRoomSecondsToday;if(t<=0)return;let o=$.utc().plus({minutes:this.currentUser.timezoneUtcOffset});this.timeOfStreakAchievement=o.plus({seconds:t}),this.timeOfStreakAchievement.startOf("day")>o.startOf("day")&&(this.timeOfStreakAchievement=o.startOf("day").plus({days:1}).plus({seconds:e})),this.checkStreakTimerSubscription=W(0,1e4).subscribe(()=>this.checkForNewBadges())}setCheckTimeLimitTimer(){this.checkTimeLimitTimerSubscription?.unsubscribe(),this.subscriptionService.getFocusRoomTimeLimitInMinutes()*60!==0&&(this.checkTimeLimitTimerSubscription=W(0,1e4).subscribe(()=>this.checkTimeLimit()))}checkTimeLimit(){let e=$.utc().plus({minutes:this.currentUser.timezoneUtcOffset}),t=0,o=!1;if(this.livekit.lastTimeLimitTimerRunDate&&(t=e.diff(this.livekit.lastTimeLimitTimerRunDate,"second").seconds,o=e.startOf("day")>this.livekit.lastTimeLimitTimerRunDate.startOf("day")),this.livekit.lastTimeLimitTimerRunDate=e,this.secondsLeftBeforeRoomEnd=this.accountService.authenticated()?this.checkTimeLimitForAuthenticatedUser(e,t,o):this.checkTimeLimitForUnauthenticatedUser(e,t,o),e>=e.plus({seconds:this.secondsLeftBeforeRoomEnd})){this.disconnectUserDueToTimeLimitReached();return}}checkTimeLimitForAuthenticatedUser(e,t,o){let d=this.accountService.currentUser,v=0,k=this.subscriptionService.dailyFocusRoomSecondsLeft;if(o?(d.timeInfo.purchasedSecondsSpentToday=0,k=this.subscriptionService.dailyFocusRoomSecondsLeft,d.timeInfo.totalFocusRoomSecondsToday=e.startOf("day").diff(e,"second").seconds):d.timeInfo.totalFocusRoomSecondsToday+=t,v=this.subscriptionService.dailyFocusRoomSecondsLeft+(d.timeInfo.purchasedFocusRoomSecondsLeft??0),d.timeInfo.purchasedFocusRoomSecondsLeft!=null&&v<=d.timeInfo.purchasedFocusRoomSecondsLeft){let T=k>0&&k<t?t-k:t;d.timeInfo.purchasedFocusRoomSecondsLeft-=T,d.timeInfo.purchasedSecondsSpentToday+=T}return v=this.subscriptionService.dailyFocusRoomSecondsLeft+(d.timeInfo.purchasedFocusRoomSecondsLeft??0),v}checkTimeLimitForUnauthenticatedUser(e,t,o){o?this.livekit.room.totalFocusRoomSecondsTodayAnonymous=e.startOf("day").diff(e,"second").seconds:this.livekit.room.totalFocusRoomSecondsTodayAnonymous+=t;let d=this.subscriptionService.getFocusRoomTimeLimitInMinutes()*60,v=this.livekit.room.totalFocusRoomSecondsTodayAnonymous,k=+(d-v).toFixed(1);return Math.max(k,0)}disconnectUserDueToTimeLimitReached(){let e=this.accountService.isFullyVerifiedUser()?"FocusRoomTimeLimitReached":"FocusRoomTimeLimitReachedAnonymous";this.toastService.info({exceptionDetail:{errorCode:e}}),this.secondsLeftBeforeRoomEnd=0,this.timeLimitReached.emit(),this.checkTimeLimitTimerSubscription?.unsubscribe()}restoreLostPin(e){if(this.livekit.room.pinnedParticipants.some(k=>k.identity===e))return;let o=this.livekit.room.allParticipants.find(k=>k.identity===e);if(!o)return;let d=()=>{o.reinstatedPin=!0},v=k=>{};this.livekit.room.pin({participant:o,reinstating:!0,onSuccess:d,onErrorOverride:v})}pinForPin(e){if(this.livekit.room.pinnedParticipants.some(d=>d.identity===e))return;let o=this.livekit.room.allParticipants.find(d=>d.identity===e);o&&this.livekit.room.pin({participant:o,pinForPin:!0})}pinForPinUnpin(e){this.livekit.room.pinnedParticipants.some(o=>o.identity===e)&&this.livekit.room.unpin({pinnedUserId:e,systemAction:!0})}onRoomConnected(){return Y(this,null,function*(){this.subscribeToEventsAndTimers(),(yield this.livekit.room.getSid())||this.analyticsService.markActivity(y.LivekitEmptySidOnRoomConnected);let t=Array.from(this.livekit.room.remoteParticipants.values());for(let k of t)this.onRemoteParticipantConnected(k);let o=this.livekit.room.localParticipant.metadata||"{}",d=JSON.parse(o);d.anonymous?this.processAnonymousLocalParticipantJoining():this.processLocalParticipantJoining(d.isPredefinedModerator),this.livekit.room.performedFirstConnect=!0,this.livekit.participantsLoaded.next(),this.livekit.room.sortAndAssignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.initializeFiltersFromLS(),setTimeout(()=>{this.privateSpaceIdToAttemptJoining?this.attemptJoiningPrivatePod(this.privateSpaceIdToAttemptJoining):this.identityToAttemptToHighlight&&this.livekit.room.attemptHighlightingParticipant(this.identityToAttemptToHighlight),this.livekit.recalculateGrid.next(),this.livekit.room.setupSpotifyPolling()},2e3);let v=()=>this.livekit.room.finishedInitialBulkPinOperations=!0;this.accountService.isFullyVerifiedUser()?this.livekit.room.roomSettings?.autoPinFavoritesOnJoin&&this.subscriptionService.hasPremiumFeatures?this.livekit.room.pinFavoriteUsers(()=>{this.livekit.room.pinUponJoin(v)},!0):this.utilityService.userIdsToPin.length>0?this.livekit.room.pinUponJoin(v):v():v()})}processLocalParticipantJoining(e){return Y(this,null,function*(){let t=this.livekit.room.localParticipant;t.isHandRaised=!1,t.handRaiseTimestamp=null,t.anonymous=!1,t.focusRoomGroup=null,t.showSpotifyNowPlaying=this.currentUser.includePremiumFeatures&&this.settingsService.settings.spotifyEnabled&&!!this.livekit.room.roomSettings?.enableSpotifyNowPlaying,t.hd=this.currentUser.hd,t.isPredefinedModerator=e,t.favorited=this.livekit.room.favoriteUsers.some(v=>v.favoriteUserId===this.currentUser.id),t.pinCountHidden=!!this.livekit.room.roomSettings?.pinCountHidden,t.userInfo={id:this.currentUser.id,firstName:this.currentUser.firstName,fullName:this.currentUser.fullName,avatarColor:this.currentUser.avatarColor,avatarUrl:this.currentUser.avatarUrl,avatarThumbUrl:this.currentUser.avatarThumbUrl,initials:this.currentUser.initials,displayName:this.currentUser.displayName,userBadge:this.currentUser.userBadge,areaOfStudyName:this.currentUser.areaOfStudyName,lastActive:this.currentUser.lastActive,pinForPinEnabled:this.livekit.room.roomSettings?.pinForPinEnabled,isModerator:this.utilityService.parseJwt(this.token).video.roomAdmin,pinCountHidden:t.pinCountHidden};let o=this.livekit.room.usersInfo.find(v=>v.userId===t.identity);t.pinnedCount=o?.pinCount??0,t.reportCount=o?.unresolvedRecentReportsCount??0;let d=this.livekit.room.userActiveStatus;d&&(t.status=d),this.livekit.room.settings.selfViewVideoEnabled===void 0&&(this.livekit.room.settings.selfViewVideoEnabled=!0),this.livekit.room.localParticipant.setCameraEnabled(!1),this.handleFocusRoomEntranceFlow(),this.livekit.room.localParticipant=t,this.livekit.room.allParticipants.push(this.livekit.room.localParticipant),this.livekit.updateMetadata(this.livekit.room.name,this.livekit.room.settings.zoomToFit,this.livekit.room.settings.mirrorModeForOthers).subscribe(),this.scheduleMetadataSentCheck(),this.livekit.room.localParticipant.setMicrophoneEnabled(!1),this.livekit.room.sortAndAssignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.sidebarService.setSidebarState(!1)})}processAnonymousLocalParticipantJoining(){let e=this.livekit.room.localParticipant;e.isHandRaised=!1,e.handRaiseTimestamp=null,e.anonymous=!0,e.isPredefinedModerator=!1,e.showSpotifyNowPlaying=!1,e.hd=!1,e.userInfo={id:this.accountService.authenticated()?this.currentUser.id:this.accountService.getAnonymousUserIdAndEnsureCreated(),isModerator:!1},e.pinnedCount=0,e.reportCount=0,this.livekit.room.localParticipant=e,this.livekit.room.allParticipants.push(this.livekit.room.localParticipant),this.sidebarService.setSidebarState(!1)}onRemoteParticipantConnected(e){let t=e;e.metadata?this.mapParticipantMetadata(t,e.metadata):t.userInfo={},t.anonymous?this.processAnonymousRemoteParticipantJoining(t):this.processRemoteParticipantJoining(t)}processRemoteParticipantJoining(e){if(e.audioTrackPublications.forEach(v=>{v.setSubscribed(!1)}),this.livekit.room.blockedUserIds.includes(e.identity)){this.livekit.room.blockedParticipants.some(v=>v.identity===e.identity)||this.livekit.room.blockedParticipants.push(e);return}if(this.livekit.room.allParticipants.some(v=>v.identity===e.identity))return;let t=this.livekit.room.usersInfo.find(v=>v.userId===e.identity);e.pinnedCount=t?.pinCount??0,e.reportCount=t?.unresolvedRecentReportsCount??0,e.handRaiseTimestamp=t?.handRaiseTimestamp??null,e.isHandRaised=!!e.handRaiseTimestamp,e.status=t?.status||null,e.selectedTask=t?.selectedTask||null,e.focusRoomGroup=t?.focusRoomGroup||null,e.favorited=this.livekit.room.favoriteUsers.some(v=>v.favoriteUserId===e.identity),e.showSpotifyNowPlaying=!!t?.showSpotifyNowPlaying,e.hd=!!t?.hd,e.pinCountHidden=!!t?.pinCountHidden,this.livekit.room.allParticipants.push(e),!e.isCameraEnabled&&this.livekit.room.anyFiltersSelected&&this.livekit.room.displayedParticipants.some(v=>v.identity===e.identity)&&this.livekit.recalculateGrid.next();let o=this.userFavoriteService.favorites.find(v=>v.favoriteUser.id===e.identity);if(e.videoSessionStartedNotification=o?.videoSessionStartedNotification??!1,!this.shouldPinFavorite(e))return;let d=Nn(8e3);this.subscriptions.push(W(d).subscribe(()=>{let v=this.livekit.room.allParticipants.find(k=>k.identity===e.identity);!v||!this.shouldPinFavorite(v)||(this.livekit.room.pinnedParticipants.length<this.livekit.room.pinValidationInfo.pinLimit?this.livekit.room.pin({participant:v,autoPinFavorite:!0}):this.shouldUnpinAndPinNew(v))}))}shouldPinFavorite(e){return this.livekit.room.roomSettings?.autoPinFavoritesOnJoin&&this.subscriptionService.hasPremiumFeatures&&e.favorited&&(!this.livekit.room.pinningUserIds||!this.livekit.room.pinningUserIds.includes(e.identity))&&this.livekit.room.finishedInitialBulkPinOperations}shouldUnpinAndPinNew(e){let t=-1;for(let o=this.livekit.room.pinnedParticipants.length-1;o>=0;o--)if(!this.livekit.room.pinnedParticipants[o].favorited&&this.livekit.room.pinnedParticipants[o].autoPin){t=o;break}t!==-1&&this.livekit.room.unpin({pinnedUserId:this.livekit.room.pinnedParticipants[t].identity,systemAction:!0,shouldCallApi:!0,pinParticipantAfterUnpin:e})}processAnonymousRemoteParticipantJoining(e){this.livekit.room.allParticipants.some(t=>t.identity===e.identity)||(e.pinnedCount=0,e.reportCount=0,e.handRaiseTimestamp=null,e.isHandRaised=!1,e.status=null,e.favorited=!1,this.livekit.room.allParticipants.push(e))}onRemoteParticipantDisconnected(e){e.audioTrackPublications.forEach(o=>{o.setSubscribed(!1)});let t=this.livekit.room.allParticipants.find(o=>o.identity===e.identity);t&&(this.livekit.room.allParticipants.splice(this.livekit.room.allParticipants.indexOf(t),1),this.livekit.room.localParticipant.anonymous||this.livekit.room.unpin({pinnedUserId:t.identity,logLocation:"[Disconnect] unpin() called from onRemoteParticipantDisconnected",systemAction:!0}),this.activePredefinedGroup?.members.some(o=>o.id===t.identity)&&this.livekit.room.resetActivePredefinedGroupParticipants()),this.livekit.room.displayedParticipants.some(o=>o.identity===e.identity)&&(this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next()),this.livekit.room.updateFocusPlusParticipants()}onMetadataChanged(e,t){if(!t.metadata)return;let o=this.livekit.room.allParticipants.find(d=>d.identity===t.identity);o&&this.mapParticipantMetadata(o,t.metadata)}onActiveSpeakersChanged(e){this.livekit.room.speakingParticipants=e}onDisconnected(){this.disconnectFromRoom(we.RoomEnded)}disconnectFromRoom(e,t=!0){this.disconnected.emit({reason:e,shouldUnpinAll:t})}mapParticipantMetadata(e,t){let o={identity:e.identity,previousUserInfo:e.userInfo},d=JSON.parse(t);e.userInfo=Rt({},d.userInfo),e.metadataUpdatedOnce=!0,e.anonymous=!!d.anonymous,e.zoomToFit=!!d.zoomToFit,e.mirrorModeForOthers=!!d.mirrorModeForOthers,o.currentUserInfo=e.userInfo,this.livekit.participantMetadataUpdated.next(o)}handleFocusRoomEntranceFlow(){this.currentUser.activeExperiments.some(t=>t===Qn.NewFocusRoomEntryFlow)&&this.livekit.room.milestones.dateFirstJoined&&this.livekit.room.milestones.dateFirstJoined>$.utc().minus({minutes:5}).toISO()&&this.livekit.room.allParticipants.length>=le.minParticipantsNeededForFocusRoomOnboarding?this.livekit.room.focusRoomOnboardingShown=!0:this.livekit.room.storeLivekitSettings()}forceTurnOffCamera(e){this.livekit.room.roomName===e&&(this.livekit.room.localParticipant.setCameraEnabled(!1),this.livekit.room.greetingMode.deactivate(!0),this.analyticsService.markActivity(y.LivekitGreetingModeDisabledDueToCameraOff),this.livekit.endVideoSession(e).subscribe())}forceTurnOffAudio(e){this.livekit.room.roomName===e&&this.livekit.room.localParticipant.setMicrophoneEnabled(!1)}onRoomSessionGroupMatched(e){this.livekit.room.activeGroup.next({id:e.groupId,members:e.members}),this.livekit.room.groupMatch.stopTimer(),this.livekit.room.groupMatch.waiting=!1}onHighlightShown(e){window.clearTimeout(this.hideHighlightTimeoutRef);let t=this.livekit.room.allParticipants.find(o=>o.identity===e.id);if(!t){this.highlightedParticipant=null;return}e.participant=t,this.highlightedParticipant=e}onHighlightHidden(){this.hideHighlightTimeoutRef=window.setTimeout(()=>{this.highlightedParticipant=null},100)}onRoomSessionGroupUserInvited(e){let t=localStorage.getItem(Ki);if(t&&$.utc()<$.fromISO(t))return;let o=this.livekit.room.allParticipants.find(d=>d.identity===e.userInvitingInfo.id);if(e.inviteMessage){if(!o)return;if(this.utilityService.groupInviteParticipantActive){this.toastService.groupInvitesQueue.push(e);return}this.toastService.showFocusRoomSingleInvite(e,o,()=>{this.attemptJoiningPrivatePod(e.groupId),this.toastService.checkForOtherSingleInvitesInQueue(),this.analyticsService.markActivity(y.LivekitPrivatePodSingleInvitationAccepted)},()=>{this.analyticsService.markActivity(y.LivekitPrivatePodSingleInvitationDecline),this.toastService.checkForOtherSingleInvitesInQueue()},()=>{this.muteInviteToastsFor24h(),this.toastService.info({message:"You have muted all invites for 24h"}),this.analyticsService.markActivity(y.LivekitPrivatePodSingleInvitationMuted)});return}this.toastService.showFocusRoomSessionGroupInvite(e,o,()=>this.attemptJoiningPrivatePod(e.groupId),()=>this.analyticsService.markActivity(y.LivekitPrivatePodInvitationDecline))}muteInviteToastsFor24h(){let e=$.utc().plus({days:1});localStorage.setItem(Ki,e.toString())}attemptJoiningPrivatePod(e,t=null){if(this.joiningPrivatePod)return;this.joiningPrivatePod=!0;let o=()=>{this.joinRoomSessionGroup(e,t),this.privateSpaceIdToAttemptJoining=null};this.handleLeavingActiveGroups(o)}onPartialPinMatch(e){let t=e.filter(o=>o!==this.currentUser.id);for(let o of t){let d=this.livekit.room.allParticipants.find(v=>v.identity===o);if(!d||this.livekit.room.roomSettings?.disableMutualPinNotification)return;this.toastService.showMutualPinNotification(d,()=>this.livekit.showOptionsModal(jt.PinSettings),()=>this.messageUser(d.identity))}}handleLeavingActiveGroups(e){if(this.activeGroup===null&&this.activePredefinedGroup===null){e();return}this.activeGroup?this.activeGroup.predefinedGroupId?this.leaveActiveGroups(()=>{this.livekit.room.predefinedGroupMaximized=!1,this.livekit.room.predefinedGroupInstances=[],this.livekit.room.activeGroup.next(null),this.livekit.room.activePredefinedGroup.next(null),e()}):this.leaveActiveGroups(()=>{this.livekit.room.activeGroup.next(null),e()}):this.activePredefinedGroup&&(this.livekit.room.predefinedGroupMaximized=!1,this.livekit.room.predefinedGroupInstances=[],this.livekit.unsubscribeFromSignalRPredefinedGroupUpdates(this.livekit.room.name,this.activePredefinedGroup.id).subscribe(),this.livekit.room.activePredefinedGroup.next(null),e())}joinRoomSessionGroup(e,t){this.analyticsService.markActivity(y.LivekitPrivateInvitationJoinClick),this.livekit.joinPrivateGroup(this.livekit.room.name,e).subscribe({next:()=>{t?.onCloseButtonClick(),this.livekit.room.privateGroupMinimized=!1,this.joiningPrivatePod=!1},error:o=>{if(o[0].errorCode==="LivekitRoomMaxSamePeerSessionsReached"){this.toastService.info({exceptionDetail:o[0]});return}this.handleErrors(o)}})}leaveActiveGroups(e){if(!this.activeGroup)return;this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Are you sure?",description:this.activeGroup.predefinedGroupId?"LeavePublicGroupToJoinPrivatePod":"LeavePrivatePod",confirmButtonLabel:"Leave & Join"}}).afterClosed().subscribe(o=>{o&&this.livekit.leaveActiveGroups(this.livekit.room.name,!0).subscribe({next:()=>e(),error:d=>this.handleErrors(d)})})}onRoomSessionGroupUserJoined(e){let t=!!e.predefinedGroupId;e.members.some(d=>d.id===this.currentUser.id)&&this.livekit.room.activeGroup.next(e),t&&this.activePredefinedGroup?.id===e.id&&this.livekit.room.activePredefinedGroup.next(e)}onRoomSessionGroupUserLeft(e){let t=!!e.predefinedGroupId,o=this.activeGroup!==null&&e.members.some(d=>d.id===this.currentUser.id);this.livekit.room.activeGroup.next(o?e:null),t&&this.activePredefinedGroup?.id===e.id&&this.livekit.room.activePredefinedGroup.next(e)}onRoomSessionGroupUserBanned(e){this.activeGroup?.id===e.groupId&&(this.toastService.info({message:"You have been removed from this space."}),this.livekit.room.activeGroup.next(null))}onRoomSessionGroupEnded(e){this.activeGroup&&this.activeGroup?.id===e.groupId&&(this.activeGroup.createdByUserId===this.accountService.currentUser.id||this.toastService.info({autoClose:!1,exceptionDetail:{errorCode:"LivekitRoomSessionGroupEnded"}}),this.livekit.room.activeGroup.next(null))}onConnectionStateChanged(e){this.lastConnectionState===Ye.Connected&&e===Ye.Reconnecting?this.analyticsService.markActivity(y.LivekitReconnecting,this.getUserInfoForAnalytics()):this.lastConnectionState===Ye.Reconnecting&&e===Ye.Connected&&(this.analyticsService.markActivity(y.LivekitReconnected,this.getUserInfoForAnalytics()),this.ensureActiveGroupReconnects(),this.livekit.room.roomName&&this.livekit.getFocusRoomUserInfo(this.livekit.room.roomName).subscribe({next:t=>this.livekit.room.handleUserInfoUpdate(t)})),this.lastConnectionState=e}ensureActiveGroupReconnects(){!this.activeGroup||this.activeGroup.createdByUserId!==this.accountService.currentUser.id||this.activeGroup.name===null||this.livekit.createFocusRoomSessionGroup(this.livekit.room.name,[],void 0,this.activeGroup.name,!0).subscribe({next:e=>{this.livekit.room.activeGroup.next(e),this.livekit.room.privateGroupMinimized=!1},error:e=>this.handleErrors(e)})}scheduleMetadataSentCheck(){this.metadataSentCheckSubscription=W(1e4,2e4).pipe(hn(5)).subscribe(()=>{if(this.localParticipant.metadataUpdatedOnce){this.metadataSentCheckSubscription.unsubscribe(),console.log("[scheduleMetadataSentCheck] - not checking anymore, metadata set");return}this.livekit.updateMetadata(this.livekit.room.name,this.livekit.room.settings.zoomToFit,this.livekit.room.settings.mirrorModeForOthers).subscribe(),console.log("[scheduleMetadataSentCheck] - just set the metadata from the fallback")})}getUserInfoForAnalytics(){return{roomName:this.livekit.room.name,numberOfTilesPerPage:this.livekit.room.settings.tilesPerPage,encouragementsCount:this.encouragementService.encouragementsReceived.length,pinnedUsersCount:this.livekit.room.pinnedParticipants.length,pinnedByOthersCount:this.livekit.room.localParticipant.pinnedCount}}messageUser(e){this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.analyticsService.markActivity(y.LivekitPrivateInvitationMessageClick),this.chatService.checkIfChatExists(e).subscribe({next:()=>{let t={otherUserIds:[e]};this.chatService.startChat(t).subscribe({next:o=>this.navigateToChat(o.id),error:o=>{o.length&&o[0].errorCode==="ChatAlreadyExists"?this.navigateToChat(o[0].params.chatId):this.handleErrors(o)}})},error:t=>{t.length&&t[0].errorCode==="ChatDoesNotExist"?this.isMobile?window.open(`${le.appUrl}/conversations/chats/create?userId=${e}`,"_blank"):this.utilityService.requestChatNavigation.next(e):this.handleErrors(t)}}))}navigateToChat(e){this.isMobile?window.open(`${le.appUrl}/conversations/chats/${e}`,"_blank"):this.utilityService.openDmTrayChat.next(e)}handleShortcutHit(e){this.isModerator&&e.shortcut===sr.ToggleLivekitRoomSortFreeze&&(this.livekit.room.freezeSort=!this.livekit.room.freezeSort,this.livekit.room.freezeSort||this.livekit.room.sortAndAssignDisplayedParticipants())}onLocalTrackPublished(e,t){e.kind===j.Kind.Video&&this.showSelfViewAndAssignParticipants()}showSelfViewAndAssignParticipants(){if(this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next(),this.selfViewVideo.savedCoordinates&&this.selfViewVideo.savedCoordinates.x<=window.innerWidth/2-200&&this.selfViewVideo.savedCoordinates.y<=window.innerHeight-249){this.selfViewVideo.coordinates=this.selfViewVideo.savedCoordinates;return}this.selfViewVideo.coordinates.x=window.innerWidth/2-216,this.selfViewVideo.coordinates.y=window.innerHeight-265}onRemoteTrackPublished(e,t){e.kind===j.Kind.Video?(this.livekit.room.isPinned(t.identity)&&this.livekit.room.sortPinnedParticipants(),this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next()):e.kind===j.Kind.Audio&&this.unsubscribeFromAudioIfNeeded(t)}onTrackMuted(e,t){e.kind===j.Kind.Video&&(this.livekit.room.isPinned(t.identity)&&this.livekit.room.sortPinnedParticipants(),this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next())}onTrackUnmuted(e,t){e.kind===j.Kind.Video?(this.livekit.room.isPinned(t.identity)&&this.livekit.room.sortPinnedParticipants(),t.isLocal?this.showSelfViewAndAssignParticipants():(this.livekit.room.assignDisplayedParticipants(),this.livekit.recalculateGrid.next())):e.kind===j.Kind.Audio&&this.unsubscribeFromAudioIfNeeded(t)}unsubscribeFromAudioIfNeeded(e){(this.activeGroup===null||!this.activeGroup.members.some(o=>o.id===e.identity))&&this.livekit.room.audioUnsubscribe.next(e)}sendGridResizeAnalyticsEvent(){let e=window.innerWidth,t=window.innerHeight,o=this.livekit.room.settings.tilesPerPage;this.analyticsService.markActivity(y.LivekitTilesPerPageNumberAndWindowDimensions,{windowWidth:e,windowHeight:t,numberOfTilesPerPage:o})}checkForNewBadges(){$.utc().plus({minutes:this.currentUser.timezoneUtcOffset})<=this.timeOfStreakAchievement||(this.checkStreakTimerSubscription.unsubscribe(),this.badgeService.checkForNewBadges.next(),this.checkedForBadgesOneMoreTime||this.subscriptions.push(W(3e4).subscribe(()=>{this.checkedForBadgesOneMoreTime=!0,this.checkForNewBadges()})))}subscribeToEventsAndTimers(){this.subscriptions.push(this.livekit.participantHighlight.show.subscribe(e=>this.onHighlightShown(e)),this.livekit.participantHighlight.hide.subscribe(()=>this.onHighlightHidden()),this.livekit.participantInfoMobile.subscribe(e=>this.participantInfoMobile=e),this.livekit.room.activeGroup.subscribe(e=>this.activeGroup=e),this.livekit.room.activePredefinedGroup.subscribe(e=>this.activePredefinedGroup=e),this.livekit.room.videoPillButtonExpanded.subscribe(e=>this.videoPillButtonExpanded=e),this.signalRService.userBlocked.subscribe(e=>this.livekit.room.onUserBlocked(e)),this.signalRService.userUnblocked.subscribe(e=>this.livekit.room.onUserUnblocked(e)),this.signalRService.forceTurnOffCamera.subscribe(e=>this.forceTurnOffCamera(e.roomName)),this.signalRService.forceTurnOffAudio.subscribe(e=>this.forceTurnOffAudio(e.roomName)),this.signalRService.roomSessionGroupMatched.subscribe(e=>this.onRoomSessionGroupMatched(e)),this.signalRService.channelLeft.subscribe(e=>this.onChannelLeft(e)),this.signalRService.activeSubscriptionTierUpdated.subscribe(()=>this.setCheckTimeLimitTimer()),this.signalRService.purchasedTimeIncreased.subscribe(()=>this.setCheckTimeLimitTimer()),this.signalRService.restoreLostPin.subscribe(e=>this.restoreLostPin(e)),this.signalRService.pinForPin.subscribe(e=>this.pinForPin(e)),this.signalRService.pinForPinUnpin.subscribe(e=>this.pinForPinUnpin(e)),this.signalRService.focusRoomTwoWayHide.subscribe(e=>this.livekit.room.twoWayHide(e)),this.signalRService.focusRoomTwoWayUnhide.subscribe(e=>this.livekit.room.twoWayUnhide(e)),this.signalRService.subscriptionUpdated.subscribe(()=>this.setCheckTimeLimitTimer()),this.signalRService.userFavoriteAdded.subscribe(e=>this.livekit.room.onUserFavoriteAdded(e)),this.signalRService.userFavoriteUpdated.subscribe(e=>this.livekit.room.onUserFavoriteUpdated(e.favoriteUserId,e.newOrder)),this.signalRService.userFavoriteRemoved.subscribe(e=>this.livekit.room.onUserFavoriteRemoved(e)),this.signalRService.sendMetadata.subscribe(()=>{let t=Math.floor(Math.random()*10)*1e3;setTimeout(()=>this.livekit.updateMetadata(this.livekit.room.name,this.livekit.room.settings.zoomToFit,this.livekit.room.settings.mirrorModeForOthers).subscribe(),t)}),this.themeService.themeChange.subscribe(e=>this.theme=e),this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.utilityService.groupInvitesQueuePushed.subscribe(e=>this.onRoomSessionGroupUserInvited(e)),this.settingsService.newUsersTimeLimitFromDateUpdated.subscribe(()=>this.setCheckTimeLimitTimer()),this.settingsService.activeLivekitServerChanged.subscribe(()=>this.disconnectFromRoom(we.RoomEnded)),this.keyboardService.shortcutHit.subscribe(e=>this.handleShortcutHit(e))),this.sendGridResizeAnalyticsEvent(),this.setCheckStreakTimer(),this.setCheckTimeLimitTimer(),this.livekit.room.allowOnlyGroupAudio&&this.subscriptions.push(this.signalRService.roomSessionGroupUserInvited.subscribe(e=>this.onRoomSessionGroupUserInvited(e)),this.signalRService.roomSessionGroupUserJoined.subscribe(e=>this.onRoomSessionGroupUserJoined(e)),this.signalRService.roomSessionGroupUserLeft.subscribe(e=>this.onRoomSessionGroupUserLeft(e)),this.signalRService.roomSessionGroupUserBanned.subscribe(e=>this.onRoomSessionGroupUserBanned(e)),this.signalRService.roomSessionGroupEnded.subscribe(e=>this.onRoomSessionGroupEnded(e)),this.signalRService.partialPinMatch.subscribe(e=>this.onPartialPinMatch(e)))}initializeFiltersFromLS(){if(!this.livekit.room.simpleFilter)return;let e=localStorage.getItem(Vt);if(e){let t=JSON.parse(e);this.livekit.room.filter.selectedUserTypes=[...t.selectedUserTypes],this.livekit.room.filter.selectedGenders=[...t.selectedGenders],this.livekit.room.filter.selectedSortOption=t.selectedSortOption,this.livekit.room.filter.participantsWithPinForPinEnabled=t.participantsWithPinForPinEnabled,this.livekit.room.filter.participantsWithEmptyPinSlots=t.participantsWithEmptyPinSlots,this.toastService.success({message:"We've applied your selected filters"}),this.analyticsService.markActivity(y.NewUserFilterApplied,{filters:this.livekit.room.filter,senderInfo:{gender:this.accountService.currentUser.gender,type:this.accountService.currentUser.type}})}}handleErrors(e){if(this.joiningPrivatePod=!1,e[0].errorCode==="ErrorChattingAgeRestriction"){this.toastService.info({exceptionDetail:e[0]});return}this.toastService.error({exceptionDetail:e[0]})}};r.\u0275fac=function(t){return new(t||r)(m(M),m(J),m(wi),m(Ei),m(G),m(St),m(nt),m(H),m(bt),m(ai),m(N),m(F),m(rr),m(Mt),m(kt),m(K),m(Qe),m(_e),m(X),m(ct))},r.\u0275cmp=x({type:r,selectors:[["ss-focus-room"]],hostBindings:function(t,o){t&1&&f("focus",function(){return o.onWindowFocus()},vn)("touchstart",function(v){return o.handleTouchStart(v)})("touchend",function(v){return o.handleTouch(v)})},inputs:{token:"token"},outputs:{disconnected:"disconnected",timeLimitReached:"timeLimitReached"},standalone:!1,decls:15,vars:13,consts:[[1,"room-wrapper"],[1,"room-channel",3,"roomChannelId"],[3,"highlightedParticipant"],[3,"participant"],[1,"video-pill-overlay"],["cdkDrag","",3,"cdkDragFreeDragPosition","cdkDragBoundary","draggingSelfViewVideo"],[3,"secondsLeft"],[1,"notification","participants-breakdown-popup"],["id","video-source","autoplay",""],["id","stream-source-canvas"],[1,"left"],[3,"theme"],[1,"right"],[1,"main-content-wrapper"],[3,"hide"],[1,"group-grid-wrapper"],[3,"participants","theme"],[1,"room-channel",3,"closeRoomChatClicked","roomChannelId"],[1,"video-pill-overlay",3,"click"],["cdkDrag","",3,"cdkDragStarted","cdkDragEnded","cdkDragFreeDragPosition","cdkDragBoundary","draggingSelfViewVideo"],["color","default","iconName","info",3,"iconVariant","size"],["iconName","dismiss","color","default",1,"dismiss-icon",3,"click","iconVariant","size"]],template:function(t,o){t&1&&(u(0,fm,5,3,"div",0),u(1,vm,1,0,"ss-participant-list"),u(2,_m,1,1,"ss-channel",1),u(3,Cm,1,1,"ss-participant-highlight",2),u(4,bm,1,1,"ss-participant-mobile-menu",3),u(5,Pm,1,0,"ss-focus-room-audio"),u(6,km,1,0,"ss-focus-room-group-session-audio"),u(7,xm,1,0,"ss-focus-plus"),u(8,ym,1,0,"ss-focus-room-onboarding"),u(9,Sm,1,0,"div",4),u(10,Mm,1,6,"ss-self-view-video",5),u(11,wm,1,1,"ss-focus-room-time-limit",6),u(12,Om,5,5,"div",7),b(13,"video",8)(14,"canvas",9)),t&2&&(h(o.focusRoomOnboardingShown?-1:0),s(),h(o.localParticipant.identity&&o.participantListVisible?1:-1),s(),h(o.roomChatVisibility?2:-1),s(),h(o.highlightedParticipant?3:-1),s(),h(o.participantInfoMobile?4:-1),s(),h(!o.localParticipant.anonymous&&o.performedFirstConnect&&o.canPublishAudio&&!o.allowOnlyGroupAudio?5:-1),s(),h(o.activeGroup?6:-1),s(),h(o.focusPlusActive?7:-1),s(),h(o.focusRoomOnboardingShown?8:-1),s(),h(o.videoPillButtonExpanded?9:-1),s(),h(o.localParticipant.isCameraEnabled&&o.livekit.room.settings.selfViewVideoEnabled&&o.livekit.room.selfViewVideoVisibility&&o.selfViewVideo.boundaryElement&&!o.livekit.room.focusPlus.active?10:-1),s(),h(o.showFocusRoomTimeLimit?11:-1),s(),h(o.livekit.room.showParticipantBreakdownOnLastPage&&o.allOtherParticipantsCount>0&&!o.livekit.room.anyFiltersSelectedOrSortChanged&&!o.livekit.room.focusPlus.active&&!o.livekit.room.participantListVisibility&&o.livekit.room.pinnedParticipants.length===0&&(o.livekit.room.paginator.totalPages===0||o.livekit.room.paginator.currentPage===o.livekit.room.paginator.totalPages)?12:-1))},dependencies:[jo,w,Pi,ar,zi,Lr,ts,is,Hi,ns,Gr,$r,Wr,Wi,Pr,Nr,Hr,os],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}.page-content-wrapper[_ngcontent-%COMP%]{height:calc(100vh - 56px)}@media only screen and (max-width: 1024px){.page-content-wrapper[_ngcontent-%COMP%]{height:100%}}.page-content[_ngcontent-%COMP%]{max-width:1340px;width:100%;padding:50px 70px;margin:0 auto}@media only screen and (max-width: 1024px){.page-content[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]{position:relative;display:flex;flex-direction:row;justify-content:center;align-items:flex-start;width:100%;height:100%;background:var(--coloured)}[_nghost-%COMP%]     .encouragements-mobile-menu ss-button button{height:auto;padding:0}[_nghost-%COMP%]   .button-text[_ngcontent-%COMP%]{text-transform:none}.safari[_nghost-%COMP%], .safari   [_nghost-%COMP%]{height:calc(var(--vh) - 56px)}.room-wrapper[_ngcontent-%COMP%]{display:flex}@media only screen and (max-width: 1024px){.room-wrapper[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (max-width: 1024px){.room-wrapper[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;flex-direction:column-reverse}}@media only screen and (max-height: 480px){.room-wrapper[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (max-width: 1024px){.main-content-wrapper[_ngcontent-%COMP%]{height:calc(var(--vh) - 130px);overflow:auto}.main-content-wrapper[_ngcontent-%COMP%]   ss-paginator[_ngcontent-%COMP%]{margin:15px auto}}@media only screen and (max-width: 1024px) and (max-height: 480px){.main-content-wrapper[_ngcontent-%COMP%]{height:calc(var(--vh) - 50px)}}.group-grid-wrapper[_ngcontent-%COMP%]{display:flex}@media only screen and (max-width: 1024px){.group-grid-wrapper[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (max-width: 1024px){ss-focus-room-milestones-bar[_ngcontent-%COMP%]{display:none}}#video-source[_ngcontent-%COMP%], #stream-source-canvas[_ngcontent-%COMP%]{display:none}.video-pill-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:5;width:100%;height:100%}@media only screen and (max-width: 1024px){.video-pill-overlay[_ngcontent-%COMP%]{background:var(--container-2)}}.room-channel[_ngcontent-%COMP%]{position:absolute;top:-1px;right:0;z-index:5;width:500px;border:1px solid var(--alt);box-shadow:var(--elevation-s1-bottom-only)}.room-channel[_ngcontent-%COMP%]     ss-message-list{height:calc(100vh - 97px)}.participants-breakdown-popup[_ngcontent-%COMP%]{position:absolute;bottom:90px;left:50%;z-index:1000;display:flex;justify-content:space-between;align-items:center;width:642px;height:32px;padding:0 8px;border-radius:8px;background:var(--accent-blurple-80);transform:translate(-50%)}@media only screen and (max-width: 1024px){.participants-breakdown-popup[_ngcontent-%COMP%]{max-width:500px;width:100%}}@media only screen and (max-width: 479px){.participants-breakdown-popup[_ngcontent-%COMP%]{height:auto;padding:4px 8px}}.participants-breakdown-popup[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;align-items:center}.participants-breakdown-popup[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   ss-icon[_ngcontent-%COMP%]{margin-right:8px;cursor:pointer}.participants-breakdown-popup[_ngcontent-%COMP%]   ss-icon.dismiss-icon[_ngcontent-%COMP%]{cursor:pointer}"]});let n=r;return n})();function Im(n,r){n&1&&(a(0,"small",1),g(1," Reorder frozen. Press 'f' key to unfreeze. "),c())}function Fm(n,r){if(n&1){let i=P();a(0,"ss-focus-room",5),f("disconnected",function(t){_(i);let o=l();return C(o.onDisconnectedFromRoom(t))})("timeLimitReached",function(){_(i);let t=l();return C(t.onTimeLimitReached())}),c()}if(n&2){let i=l();p("token",i.token)("hidden",i.isRoomConnecting)}}function Rm(n,r){if(n&1&&(a(0,"div",3),b(1,"div",6),a(2,"h3")(3,"h3"),g(4),c(),a(5,"h3"),g(6,"Keep waiting or "),a(7,"span"),g(8,"refresh to try again"),c(),g(9,"."),c()()()),n&2){let i=l();s(4),O("Hold on, we're trying to ",i.livekit.room.state===i.ConnectionStateRef.Reconnecting?"re":"","connect you!")}}function Em(n,r){if(n&1&&(b(0,"div",7),Te(1,"trustHtml")),n&2){let i=l(2);p("innerHTML",De(1,1,i.getDisconnectReasonMessage(i.disconnectReason)),Ze)}}function Um(n,r){if(n&1&&(b(0,"div",7),Te(1,"translate")),n&2){let i=l(2);p("innerHTML",kn(1,1,"errors."+i.joiningError.errorCode,i.joiningError.params),Ze)}}function Vm(n,r){n&1&&(a(0,"span"),g(1," This room is full for users "),a(2,"strong"),g(3,"without an account"),c(),g(4,". "),a(5,"strong"),g(6,"Register for an account"),c(),g(7," to enter. "),c())}function Am(n,r){n&1&&(a(0,"span"),g(1," This room is full for users "),a(2,"strong"),g(3,"without a confirmed email address"),c(),g(4,". "),a(5,"strong"),g(6,"Confirm your email"),c(),g(7," to enter. "),c())}function Lm(n,r){n&1&&(a(0,"span"),g(1," This room is full for users "),a(2,"strong"),g(3,"without a verified phone number"),c(),g(4,". "),a(5,"strong"),g(6,"Verify your phone number"),c(),g(7," to enter. "),c())}function Gm(n,r){n&1&&(a(0,"span"),g(1," This room is full for users "),a(2,"strong"),g(3,"without a completed account"),c(),g(4,". "),a(5,"strong"),g(6,"Fill out your basic details"),c(),g(7," to enter. "),c())}function Dm(n,r){if(n&1&&(a(0,"div",8),u(1,Vm,8,0,"span"),u(2,Am,8,0,"span"),u(3,Lm,8,0,"span"),u(4,Gm,8,0,"span"),c()),n&2){let i=l(2);s(),h(i.authenticated?-1:1),s(),h(i.emailNotConfirmed?2:-1),s(),h(i.phoneNotConfirmed?3:-1),s(),h(i.basicInfoNotCompleted?4:-1)}}function Bm(n,r){if(n&1){let i=P();a(0,"div",9)(1,"ss-button",10),f("buttonClick",function(){_(i);let t=l(2);return C(t.subscriptionNavigationService.openSubscriptionsPage())}),g(2," Subscribe "),c(),a(3,"ss-button",11),f("buttonClick",function(){_(i);let t=l(2);return C(t.subscriptionNavigationService.openProductsPage())}),g(4," Purchase hours "),c()()}}function Nm(n,r){if(n&1){let i=P();a(0,"ss-button",11),f("buttonClick",function(){_(i);let t=l(2);return C(t.joinRoom())}),g(1),c()}if(n&2){let i=l(2);s(),O(" ",i.joiningError?"Retry":"Rejoin"," ")}}function zm(n,r){if(n&1){let i=P();a(0,"ss-button",11),f("buttonClick",function(){_(i);let t=l(2);return C(t.anonymousUserAction())}),g(1),c()}if(n&2){let i=l(2);s(),O(" ",i.authenticated?i.emailNotConfirmed?"Confirm email":i.phoneNotConfirmed?"Confirm phone":"Complete your account":"Register"," ")}}function jm(n,r){if(n&1&&(a(0,"section",4),u(1,Em,2,3,"div",7),u(2,Um,2,4,"div",7),u(3,Dm,5,4,"div",8),u(4,Bm,5,0,"div",9),u(5,Nm,2,1,"ss-button"),u(6,zm,2,1,"ss-button"),c()),n&2){let i=l();s(),h(i.disconnectReason?1:-1),s(),h(i.joiningError&&i.joiningError.errorCode!=="LivekitRoomMaxAnonymousParticipantsReached"?2:-1),s(),h(i.joiningError&&i.joiningError.errorCode==="LivekitRoomMaxAnonymousParticipantsReached"?3:-1),s(),h(i.shouldShowBuyHoursButton?4:-1),s(),h(i.shouldShowRetryButton?5:-1),s(),h(i.shouldShowNextStepButton?6:-1)}}var ss=(()=>{let r=class r{get anonymous(){return!this.accountService.isFullyVerifiedUser()}get partiallyAnonymous(){return this.accountService.authenticated()&&!this.accountService.isFullyVerifiedUser()}get authenticated(){return this.accountService.authenticated()}get emailNotConfirmed(){return this.authenticated&&!this.accountService.currentUser.emailConfirmed}get phoneNotConfirmed(){return this.authenticated&&this.accountService.currentUser.emailConfirmed&&!this.accountService.isCurrentUserPhoneVerified()}get basicInfoNotCompleted(){return this.authenticated&&this.accountService.currentUser.emailConfirmed&&this.accountService.isCurrentUserPhoneVerified()&&!this.accountService.currentUser.completedBasicInfo}get sortFrozen(){return!!this.livekit.room?.freezeSort}get isRoomConnecting(){return!!this.token&&(this.livekit.room.state===Ye.Connecting||this.livekit.room.state===Ye.Reconnecting)}get shouldShowRetryButton(){return!this.shouldShowNextStepButton&&this.disconnectReason!==we.TimeLimitReached&&(this.joiningError===null||this.joiningError&&this.joiningError.errorCode!=="LivekitRoomMaxAnonymousParticipantsReached")}get shouldShowNextStepButton(){return this.disconnectReason===we.TimeLimitReached&&this.anonymous||!!this.joiningError&&(this.joiningError.errorCode==="LivekitRoomMaxAnonymousParticipantsReached"||this.anonymous)}get shouldShowBuyHoursButton(){return this.anonymous?!1:this.joiningError?this.joiningError.errorCode==="FocusRoomTimeLimitReached":this.disconnectReason===we.TimeLimitReached}constructor(e,t,o,d,v,k,T,B,z,ke,pe,Ve,Xe,Ft){this.livekit=e,this.subscriptionService=t,this.subscriptionNavigationService=o,this.router=d,this.activatedRoute=v,this.toastService=k,this.loaderService=T,this.accountService=B,this.accountModalsService=z,this.signalRService=ke,this.utilityService=pe,this.analyticsService=Ve,this.settingsService=Xe,this.dialog=Ft,this.token=null,this.disconnectReason=null,this.joiningError=null,this.loadingRoom=!1,this.finishingSession=!1,this.LivekitDisconnectReasonRef=we,this.ConnectionStateRef=Ye,this.TriggeredUpgradeFromSourceRef=re,this.isMobile=!1,this.firstPinInfoLoaded=!1,this.isModerator=!1,this.shouldHaveRequestedAGreet=!1,this.didRequestAGreet=!1,this.lastConnectionState=null,this.userInfoUpdating=!1,this.lastRefreshUserInfoCallDate=null,this.subscriptions=[],this.onConnectionStateChanged=this.onConnectionStateChanged.bind(this)}onVisibilityChange(){document.visibilityState==="hidden"||this.disconnectReason||this.joiningError||(this.anonymous?this.refreshAnonymousUserInfo():this.refreshUserInfo())}ngOnInit(){this.loaderService.stop(),this.activatedRoute.params.subscribe(e=>{let t=le.livekitRoomNamePrefix;this.roomName=`${t}${t?"-":""}${e.roomName}`,this.joinRoom()}),this.activatedRoute.queryParams.subscribe(e=>{if(e.redirectUrl){this.router.navigate([],{queryParams:{redirectUrl:null},queryParamsHandling:"merge"});return}e.authStep&&this.handleAuthSteps(e.authStep),this.activeModal=e.activeModal}),this.subscriptions.push(this.utilityService.isMobile.subscribe(e=>this.isMobile=e),this.livekit.participantsLoaded.subscribe(()=>{this.isModerator&&(this.reportInfoUpdateIntervalSubscription=W(0,6e4).subscribe(()=>{this.livekit.getFocusRoomReportsInfoForModerators(this.roomName).subscribe({next:e=>{for(let t of e)this.handleUserReportedUpdate(t)}})}))}))}ngOnDestroy(){if(this.livekit.room){let e=this.livekit.room.pipOptions;e.usePip&&!e.doNotAskMeAgain&&localStorage.setItem(Ln,JSON.stringify({usePip:!1,doNotAskMeAgain:!1})),this.livekit.room.freezeSort=!1}this.subscriptions.forEach(e=>e.unsubscribe()),this.destroyRoomSubscriptions()}finishSession(){this.finishingSession=!0,this.livekit.room.disconnect(),this.disconnectReason=we.LeftRoom,this.analyticsService.markActivity(y.LivekitFinishSession),setTimeout(()=>{if(this.livekit.initializeFocusRoom(this.accountModalsService,null),this.token=null,this.destroyRoomSubscriptions(),this.finishingSession=!1,this.accountService.isFullyVerifiedUser()){let e=localStorage.getItem(Gn)==="true";this.settingsService.settings.showBreakVideos?this.router.navigate(["/break-mode"]):this.router.navigate(["/session-summary"],{queryParams:{range:e?"today":"last"}})}else this.router.navigate(["/"])},100)}onTimeLimitReached(){this.livekit.room.disconnect().then(()=>{this.disconnectReason=we.TimeLimitReached}),this.accountModalsService.ensureUserCompletedBasicInfo()&&(this.subscriptionNavigationService.openPlansAndPricing(re.InRoomTimeLimitReached,!0),this.livekit.timeLimitReached().subscribe({error:e=>this.handleErrors(e)}))}joinRoom(){if(this.loadingRoom=!0,this.joiningError||(this.disconnectReason=null),this.anonymous){this.joinAsAnonymousUser();return}this.livekit.getInitialData(this.roomName).subscribe({next:e=>this.initializeRoom(e),error:e=>this.handleJoiningErrors(e)})}getDisconnectReasonMessage(e){switch(e){case we.JoinedInAnotherTab:return"You have been removed from the room because you joined from another tab.";case we.KickedOut:return"You have been removed from the room by one of the moderators.";case we.RoomEnded:return`
          <p>One of the following occurred:</p>
          <ul>
            <li>You entered the room in a new tab.</li>
            <li>The room automatically reset (happens every 12-24 hours).</li>
            <li>You temporarily lost connection (internet blip).</li>
            <li>You were removed or timed out by an admin or moderator for doing something that goes against our community guidelines.</li>
            <li>You exceeded max daily the time in the room. Come back tomorrow or purchase a premium plan.</li>
          </ul>
        `;case we.LeftRoom:return"You have left the room.";case we.Disconnected:return"You have left the room as a result of internet connection issues or prolonged period of inactivity.";case we.TimeLimitReached:return`You exceeded max daily the time in the room. ${this.getTimeLimitReachedMessage()} to increase this limit.`;default:return"You have left the room."}}onDisconnectedFromRoom(e){e.shouldUnpinAll&&this.livekit.unpinAllAndLowerHandAndKeepAlive(this.livekit.room.name),this.livekit.room.focusPlus.exit(),this.livekit.room.disconnect(),this.disconnectReason=e.reason,this.livekit.initializeFocusRoom(this.accountModalsService,null),this.token=null,this.destroyRoomSubscriptions(),this.livekit.lastTimeLimitTimerRunDate=null,this.livekit.room.spotifyTimerSubscription?.unsubscribe()}anonymousUserAction(){if(!this.authenticated){this.analyticsService.markActivity(y.CreateAnAccountButtonClick),this.router.navigate([],{queryParams:{authStep:ot.Register}});return}if(this.emailNotConfirmed){this.router.navigate([],{queryParams:{authStep:ot.VerifyEmail}});return}if(this.phoneNotConfirmed){this.router.navigate([],{queryParams:{authStep:ot.VerifyPhone}});return}if(this.basicInfoNotCompleted){this.router.navigate([],{queryParams:{authStep:ot.BasicInfo}});return}}onConnectionStateChanged(e){this.lastConnectionState===Ye.Reconnecting&&e===Ye.Connected&&this.shouldHaveRequestedAGreet&&!this.didRequestAGreet&&this.startFirstJoinEncourageTimer(),this.lastConnectionState=e}initializeRoom(e){this.livekit.initializeFocusRoom(this.accountModalsService,this.roomName,e.roomSettings);let t=this.utilityService.parseJwt(e.token);this.isModerator=t.video.roomAdmin;let o=JSON.parse(t.metadata).isPredefinedModerator;this.livekit.room.webSocketBaseUrl=e.webSocketBaseUrl,this.livekit.room.blockedUserIds=e.blockedUserIds??[],this.livekit.room.hiddenUsersInfo=e.hiddenUsersInfo??[],this.livekit.room.userActiveStatus=e.userActiveStatus,this.livekit.room.displayName=e.displayName,this.livekit.room.usersInfo=e.usersInfo,this.livekit.room.allowOnlyGroupAudio=e.allowOnlyGroupAudio,this.livekit.room.hasActivePredefinedGroups=e.hasActivePredefinedGroups,this.livekit.room.channelId=e.channelId,this.livekit.room.pinValidationInfo=e.pinValidationInfo,this.livekit.room.favoriteUsers=e.favoriteUsers,this.accountService.refreshUserTimeInfo(e.userTimeInfo);let d=e.usersInfo.find(v=>v.userId===this.accountService.currentUser.id);if(d&&d.pinnedByUserIds&&(this.livekit.room.pinnedByUserIds=d.pinnedByUserIds),e.checkForGreetingMode){let v=Ci(this.accountService.currentUser)>=14;this.livekit.room.greetingMode.qualifies=v&&!!this.accountService.currentUser.gender}this.token=e.token,this.livekit.encouragements=e.encouragementTypes,this.joiningError=null,this.loadingRoom=!1,this.livekit.room.updateUsersInfo(this.livekit.room.usersInfo),this.firstPinInfoLoaded=!0,this.livekit.room.milestones=e.milestones,this.livekit.room.milestonesFetched=!0,this.livekit.room.milestonesCompletedInitially=e.milestones.pinnedSomeone&&e.milestones.encouragedSomeone&&e.milestones.hadVideoOn&&e.milestones.completedProfileSetup&&e.milestones.createdTileStatus&&e.milestones.had30MinSession,this.setUpParticipantSortInterval(),this.subscriptions.push(this.signalRService.connectionChange.subscribe(v=>this.onSignalRConnectionChange(v)),this.signalRService.pinned.subscribe(()=>this.showUserPinnedToast())),this.setUpUserInfoUpdateInterval(),this.livekit.room.on(Q.ConnectionStateChanged,this.onConnectionStateChanged),e.shouldBeGreeted&&(this.shouldHaveRequestedAGreet=!0,this.startFirstJoinEncourageTimer()),this.isModerator&&!o&&this.subscriptions.push(this.signalRService.userReportCountUpdated.subscribe(v=>this.handleUserReportedUpdate(v))),localStorage.setItem(Dn,location.pathname)}joinAsAnonymousUser(){(this.partiallyAnonymous?this.livekit.getAnonymousTokenForPartiallyCompetedUser(this.roomName):this.livekit.getAnonymousToken(this.roomName)).subscribe({next:t=>{this.livekit.initializeFocusRoom(this.accountModalsService,this.roomName,null,!0),this.lastRefreshUserInfoCallDate=$.now(),this.livekit.room.webSocketBaseUrl=t.webSocketBaseUrl,this.livekit.getFocusRoomPublicInfo(this.roomName).subscribe({next:o=>{this.livekit.room.blockedUserIds=o.blockedUserIds??[],this.livekit.room.usersInfo=o.usersInfo,this.accountService.authenticated()?this.accountService.currentUser.timeInfo.totalFocusRoomSecondsToday=t.totalFocusRoomSecondsToday:this.livekit.room.totalFocusRoomSecondsTodayAnonymous=t.totalFocusRoomSecondsToday,this.livekit.encouragements=t.encouragementTypes,this.token=t.token,this.joiningError=null,this.loadingRoom=!1,this.livekit.room.updateUsersInfo(this.livekit.room.usersInfo),this.firstPinInfoLoaded=!0},error:o=>this.handleErrors(o)}),this.setUpAnonymousUserInfoUpdateInterval()},error:t=>this.handleJoiningErrors(t)})}setUpAnonymousUserInfoUpdateInterval(){this.anonymousUserInfoTimerSubscription?.unsubscribe(),this.anonymousUserInfoTimerSubscription=W(6e4,6e4).pipe(Ct(e=>document.visibilityState==="visible"&&!this.userInfoUpdating)).subscribe(()=>this.refreshAnonymousUserInfo())}refreshAnonymousUserInfo(){this.userInfoUpdating||this.lastRefreshUserInfoCallDate&&$.now().diff(this.lastRefreshUserInfoCallDate,"seconds").seconds<30||(this.userInfoUpdating=!0,this.lastRefreshUserInfoCallDate=$.now(),this.livekit.getFocusRoomPublicInfo(this.roomName).subscribe({next:e=>{this.livekit.room.usersInfo=e.usersInfo,this.livekit.room.updateUsersInfo(this.livekit.room.usersInfo),this.livekit.room.sortAndAssignDisplayedParticipants(),this.userInfoUpdating=!1},error:e=>this.userInfoUpdating=!1}))}setUpParticipantSortInterval(){this.participantSortIntervalSubscription=W(2e4,15e3).subscribe(()=>{this.firstPinInfoLoaded&&this.livekit.room.sortAndAssignDisplayedParticipants()})}setUpUserInfoUpdateInterval(){this.userInfoTimerSubscription?.unsubscribe(),this.userInfoTimerSubscription=W(3e4,3e4).pipe(Ct(e=>document.visibilityState==="visible"&&!this.userInfoUpdating)).subscribe(()=>this.refreshUserInfo())}refreshUserInfo(){this.userInfoUpdating||!this.livekit.room?.name||this.lastRefreshUserInfoCallDate&&$.now().diff(this.lastRefreshUserInfoCallDate,"seconds").seconds<15||(this.userInfoUpdating=!0,this.lastRefreshUserInfoCallDate=$.now(),this.livekit.getFocusRoomUserInfo(this.livekit.room.name).subscribe({next:e=>{this.livekit.room.handleUserInfoUpdate(e),this.userInfoUpdating=!1},error:e=>this.userInfoUpdating=!1}))}showUserPinnedToast(){this.toastService.showPinnedBy(()=>{this.analyticsService.markActivity(y.LivekitPaymentTestToastClick),this.dialog.open(de,{panelClass:"fullscreen-dialog",data:{modalTitle:"Reveal pin",description:"RevealPin",confirmButtonLabel:"Make Payment of $1.00"}}).afterClosed().subscribe(t=>{t&&(this.analyticsService.markActivity(y.LivekitPaymentTestRevealPinModalSubmit),this.dialog.open(Yo,{panelClass:"fullscreen-dialog",width:"400px"}))})})}handleUserReportedUpdate(e){let t=this.livekit.room.usersInfo.find(d=>d.userId===e.userId);if(t){t.unresolvedRecentReportsCount=e.unresolvedRecentReportsCount;return}this.livekit.room.allParticipants.some(d=>d.identity===e.userId)&&(this.livekit.room.usersInfo.push({userId:e.userId,pinCount:0,unresolvedRecentReportsCount:e.unresolvedRecentReportsCount}),this.livekit.room.updateUsersInfo(this.livekit.room.usersInfo))}handleAuthSteps(e){switch(e){case ot.Login:this.accountModalsService.openStandaloneLoginModal();break;case ot.Register:this.accountModalsService.openStandaloneRegisterModal();break;case ot.VerifyEmail:this.accountModalsService.openStandaloneEmailConfirmationModal();break;case ot.VerifyPhone:this.accountModalsService.openStandalonePhoneConfirmationModal();break;case ot.BasicInfo:this.accountModalsService.openStandaloneBasicInfoCompletedModal();break;default:break}}destroyRoomSubscriptions(){this.participantSortIntervalSubscription?.unsubscribe(),this.anonymousUserInfoTimerSubscription?.unsubscribe(),this.reportInfoUpdateIntervalSubscription?.unsubscribe(),this.userInfoTimerSubscription?.unsubscribe(),this.firstJoinEncourageTimerSubscription?.unsubscribe(),this.livekit.room&&(this.livekit.room.statusUpdateTimeouts.forEach(e=>window.clearTimeout(e.timeoutRef)),this.livekit.room.statusUpdateTimeouts=[],this.livekit.room.off(Q.ConnectionStateChanged,this.onConnectionStateChanged))}startFirstJoinEncourageTimer(){this.firstJoinEncourageTimerSubscription?.unsubscribe(),this.firstJoinEncourageTimerSubscription=W(12e4).subscribe(()=>{this.livekit.checkForGreetingUsersAndEncourage(this.roomName).subscribe(),this.didRequestAGreet=!0;let e={gender:this.accountService.currentUser.gender};this.analyticsService.markActivity(y.LivekitGreetingModeEncouragementRequested,e)})}onSignalRConnectionChange(e){e?this.livekit.subscribeToSignalRUpdates(this.roomName).subscribe():this.firstPinInfoLoaded&&this.livekit.unsubscribeFromSignalRUpdates(this.roomName).subscribe()}getTimeLimitReachedMessage(){let e="";return this.anonymous?this.authenticated?this.emailNotConfirmed?e="Please verify your email":this.phoneNotConfirmed?e="Please verify your phone number":this.basicInfoNotCompleted&&(e="Please complete your basic info"):e="Please create an account":e='Come back tomorrow or <a href="/plans-and-pricing">purchase a premium plan</a>',e}handleErrors(e){this.loaderService.stop(),this.loadingRoom=!1,this.toastService.error({exceptionDetail:e[0]})}handleJoiningErrors(e){this.loaderService.stop(),this.loadingRoom=!1,this.joiningError=e[0]}};r.\u0275fac=function(t){return new(t||r)(m(M),m(_e),m(yt),m(bt),m(ai),m(F),m(bi),m(G),m(K),m(St),m(J),m(H),m(X),m(N))},r.\u0275cmp=x({type:r,selectors:[["ss-livekit"]],hostBindings:function(t,o){t&1&&f("visibilitychange",function(){return o.onVisibilityChange()},et)},standalone:!1,decls:7,vars:7,consts:[[1,"finish-session",3,"buttonClick","isLoading","disabled"],[1,"additional-message"],[3,"token","hidden"],[1,"waiting-message"],[1,"errors-wrapper"],[3,"disconnected","timeLimitReached","token","hidden"],[1,"hourglass-icon"],[1,"message",3,"innerHTML"],[1,"message"],[1,"button-wrapper"],[1,"subscribe",3,"buttonClick"],[3,"buttonClick"]],template:function(t,o){t&1&&(a(0,"ss-main-app-header")(1,"ss-button",0),f("buttonClick",function(){return o.finishSession()}),g(2),c(),u(3,Im,2,0,"small",1),c(),u(4,Fm,1,2,"ss-focus-room",2),u(5,Rm,10,1,"div",3),u(6,jm,7,6,"section",4)),t&2&&(s(),p("isLoading",o.finishingSession)("disabled",!o.token),s(),O(" Finish ",o.isMobile?"":"session"," "),s(),h(o.sortFrozen?3:-1),s(),h(o.token?4:-1),s(),h(o.isRoomConnecting?5:-1),s(),h(!o.token&&!o.loadingRoom?6:-1))},dependencies:[Wo,I,rs,Fo,En],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100vh}.page-content-wrapper[_ngcontent-%COMP%]{height:calc(100vh - 56px)}@media only screen and (max-width: 1024px){.page-content-wrapper[_ngcontent-%COMP%]{height:100%}}.page-content[_ngcontent-%COMP%]{max-width:1340px;width:100%;padding:50px 70px;margin:0 auto}@media only screen and (max-width: 1024px){.page-content[_ngcontent-%COMP%]{padding:0}}[_nghost-%COMP%]{position:relative;display:block;width:100%;height:100%}@media only screen and (max-width: 1024px){[_nghost-%COMP%]{padding-top:70px}}@media only screen and (max-width: 767px){[_nghost-%COMP%]{padding-top:60px}}@media only screen and (max-width: 1024px){ss-main-app-header[_ngcontent-%COMP%]{position:absolute;top:3px;left:16px}ss-main-app-header[_ngcontent-%COMP%]     header{height:auto;padding:0;border:0}}@media only screen and (max-width: 1024px) and (max-height: 480px){ss-main-app-header[_ngcontent-%COMP%]{position:absolute;top:7px;left:11px}}@media only screen and (max-width: 767px){ss-main-app-header[_ngcontent-%COMP%]{top:8px}ss-main-app-header[_ngcontent-%COMP%]   .finish-session[_ngcontent-%COMP%]{margin-right:12px}}ss-main-app-header[_ngcontent-%COMP%]   .additional-message[_ngcontent-%COMP%]{max-width:150px;color:var(--negative);text-align:center}ss-focus-room[hidden][_ngcontent-%COMP%]{display:none}section.errors-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;margin-top:40vh}section.errors-wrapper[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-bottom:12px}@media only screen and (max-width: 767px){section.errors-wrapper[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{padding:12px}}.waiting-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;height:calc(100vh - 56px)}.waiting-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:400;text-align:center}.waiting-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600}.waiting-message[_ngcontent-%COMP%]   .hourglass-icon[_ngcontent-%COMP%]{width:45px;height:47px;margin:0 auto 24px;background:url(/assets/icons/hourglass-icon.svg) center no-repeat;animation:_ngcontent-%COMP%_rotating 3s linear infinite}.button-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:12px 0}.button-wrapper[_ngcontent-%COMP%]   .subscribe[_ngcontent-%COMP%]{margin-right:12px}.button-wrapper[_ngcontent-%COMP%]   .subscribe[_ngcontent-%COMP%]     button{background:var(--accent-blurple-20)}.button-wrapper[_ngcontent-%COMP%]   .subscribe[_ngcontent-%COMP%]     button:hover{background:var(--accent-blurple-40)}.dark-theme[_nghost-%COMP%]   .hourglass-icon[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .hourglass-icon[_ngcontent-%COMP%]{background:url(/assets/icons/hourglass-icon-white.svg) center no-repeat}@keyframes _ngcontent-%COMP%_rotating{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]});let n=r;return n})();var as=(()=>{let r=class r{constructor(e,t){this.livekit=e,this.accountService=t}canDeactivate(e,t,o){return e.token?confirm("Are you sure you want to leave this room?")?(this.accountService.isFullyVerifiedUser()&&this.livekit.room.storeLivekitSettings(),mn(this.livekit.unpinAllAndLowerHandAndKeepAlive(this.livekit.room.name)).pipe(un(d=>!0))):!1:!0}};r.\u0275fac=function(t){return new(t||r)(Ji(M),Ji(G))},r.\u0275prov=gn({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();var Hm=[{path:":roomName",component:ss,canDeactivate:[as]}],cs=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=ri({type:r}),r.\u0275inj=oi({imports:[qi.forChild(Hm),qi]});let n=r;return n})();var bC=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=ri({type:r}),r.\u0275inj=oi({imports:[Sn,nr,Ro,cs,wo,Jn,Rn,ao,uo,Fn,qn,lo,io,no,co,oo,Mn,Eo,Go,Un.forChild({loader:Vn({prefix:"./assets/i18n/",suffix:".json"})}),cr,or]});let n=r;return n})();ht(Ai,function(){return[w,ye,ut]},[]);ht(Si,function(){return[I,w,Zt,te,ie,oe,fe,ee,ve]},[]);ht(ho,function(){return[I,w,ko,te,Bt,ie,oe,fe,ee]},[]);ht(Co,function(){return[I,w,ye,oe,fe,ee]},[]);ht(_o,function(){return[Do,I,w,ye,oe,fe,ee,en,fo,Zi,vo]},[]);ht(en,function(){return[_t,Zt,$n,te,ie,po,mo,vt]},[]);ht(Zi,function(){return[_t,Nt,te,ie,L,vt]},[]);ht(go,function(){return[I,w,te,ie,ye,fe,ee,ki]},[]);export{bC as LivekitModule};
